const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pinia-DUyRjEeU-Bx0oe4Nu.js","./vue.runtime.esm-bundler-C248luej-D21vsmGc.js","./store-CFKHD9QO.js","./index-CCiuSqNz-BUHPWeAN.js","./reverseGeocode-DMu2C9hG-DVZwy0cG.js","./indicateLoading-Cbfqd-o5-C8dP7e-w.js"])))=>i.map(i=>d[i]);
import{a2 as B,a3 as ye,a4 as Ae,a5 as Z,a6 as Rn,a7 as je,a8 as Le,a9 as Jt,aa as Dn,ab as ne,ac as Yt,ad as On,ae as Ze,af as Bn,ag as Gn,ah as Vn,ai as Nn,aj as zn,ak as Un,al as Hn,am as $e,an as pt,ao as M,ap as p,aq as at,ar as L,as as Kt,at as O,au as ue,av as xt,aw as H,ax as Q,ay as D,az as mt,aA as Wn,aB as Qe,aC as jn,aD as Zn,aE as qn,aF as Jn,aG as Yn,aH as Xt,aI as qe,aJ as ft,aK as Pe,aL as me,aM as j,aN as he,aO as Kn,aP as Ct,aQ as fe,aR as Qt,aS as V,aT as Xn,aU as Je,aV as Qn,aW as _t,aX as W,aY as ei,aZ as U,a_ as ge,a$ as Te,b0 as $t,b1 as en,b2 as kt,b3 as St,b4 as ti,b5 as ni,b6 as ii,b7 as Mt,b8 as ot,b9 as Y,ba as tn,bb as Ye,bc as ri,bd as ai,be as oi,bf as si,bg as wt,bh as li,bi as di,bj as Lt,bk as Rt,bl as ci,bm as ui,bn as hi,bo as gi,bp as pi,bq as mi,br as fi,bs as _i,bt as nn,bu as yi,bv as vi,bw as Ce,bx as bi,F as et,I as tt,K as nt,M as We,by as xi,bz as Ci,bA as ae,bB as ki,S as Tt,H as Si,bC as rn,W as an,V as on,T as wi,U as Li}from"./runtime-core.esm-bundler-CxX1S9f1.js";import{ref as F,markRaw as Dt,defineComponent as N,createElementBlock as S,openBlock as m,createElementVNode as A,Fragment as q,renderList as ee,unref as f,createBlock as $,resolveDynamicComponent as yt,computed as w,normalizeClass as Me,watch as Ke,renderSlot as It,withCtx as se,createCommentVNode as K,createVNode as le,isRef as Ot,toDisplayString as ve,onMounted as Ti,nextTick as Ii,mergeModels as Ei,useModel as Pi,withDirectives as sn,vModelDynamic as Fi,vModelText as Ai}from"./vue.runtime.esm-bundler-C248luej-D21vsmGc.js";import{defineStore as ce,storeToRefs as de}from"./pinia-DUyRjEeU-Bx0oe4Nu.js";import{p as X,C as ie,d as Ie,L as Se}from"./index-CCiuSqNz-BUHPWeAN.js";import"./store-CFKHD9QO.js";import{indicateLoading as $i}from"./indicateLoading-Cbfqd-o5-C8dP7e-w.js";import{reverseGeocode as Mi}from"./reverseGeocode-DMu2C9hG-DVZwy0cG.js";const ln=ce("plugins/footer",()=>{const i=X(),e=F([]),t=F([]);function n(){e.value=(i.configuration.footer?.leftEntries||[]).filter(({id:a})=>{const o=i.configuration[a]?.displayComponent;return typeof o=="boolean"?o:!0}),t.value=(i.configuration.footer?.rightEntries||[]).filter(({id:a})=>{const o=i.configuration[a]?.displayComponent;return typeof o=="boolean"?o:!0}),e.value.concat(t.value).forEach(a=>{i.addPlugin(ie(a,{independent:!1}))}),e.value.map(a=>ie(a,{component:Dt(a.component)})),t.value.map(a=>ie(a,{component:Dt(a.component)}))}function r(){}return{leftEntries:e,rightEntries:t,setupPlugin:n,teardownPlugin:r}}),Ri={class:"polar-plugin-footer-wrapper"},Di=N({__name:"PolarFooter.ce",setup(i){const{leftEntries:e,rightEntries:t}=de(ln());return(n,r)=>(m(),S("div",Ri,[A("ul",null,[(m(!0),S(q,null,ee(f(e),(a,o)=>(m(),S("li",{key:o},[(m(),$(yt(a.component)))]))),128))]),A("ul",null,[(m(!0),S(q,null,ee(f(t),(a,o)=>(m(),S("li",{key:o},[(m(),$(yt(a.component)))]))),128))])]))}}),Oi=".polar-plugin-footer-wrapper{&[data-v-9004f27e]{position:absolute;bottom:0;display:flex;width:100%;height:var(--kern-metric-dimension-large);padding:var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-small);justify-content:space-between;align-items:center;flex-shrink:0;background:var(--kern-color-layout-background-hued);box-shadow:0 1px 1px #35395629,0 1px 2px #35395640,0 1px 6px #6e759740;border-radius:0 0 var(--kern-metric-border-radius-large) var(--kern-metric-border-radius-large)}ul{&[data-v-9004f27e]{display:flex;align-items:center;gap:var(--kern-metric-space-small);padding:0}li[data-v-9004f27e]{list-style:none}}}",Bi=B(Di,[["styles",[Oi]],["__scopeId","data-v-9004f27e"]]),Gi={},Vi={},Ni=[{type:"de",resources:Gi},{type:"en",resources:Vi}],zi="footer";function Ui(i){return{id:zi,component:Bi,locales:Ni,storeModule:ln,options:i}}const Hi=100,Wi=100,st={undefinedBoundaryLayer:Symbol.for("Boundary Layer undefined"),undefinedBoundarySource:Symbol.for("Boundary Source undefined"),sourceNotReady:Symbol.for("Source not ready")};async function ji(i){let e=0;for(;i.getState()!=="ready"||i.getFeatures().length===0;)if(e++<Hi)await new Promise(t=>{setTimeout(t,Wi)});else return!1;return!0}async function dn(i,e,t){if(typeof e>"u")return!0;const n=i.getLayers().getArray().find(a=>a.get("id")===e);if(!(n instanceof ye))return console.error(`@polar/polar(lib/passesBoundaryCheck:61:3)
`,`No layer configured to match boundaryLayerId "${e}".`),st.undefinedBoundaryLayer;const r=n.getSource();return r instanceof Ae?await ji(r)?r.getFeatures().some(a=>a.getGeometry()?.intersectsCoordinate(t)):(console.error(`@polar/polar(lib/passesBoundaryCheck:79:3)
`,`Layer with boundaryLayerId "${e}" did not load or is featureless.`),st.sourceNotReady):(console.error(`@polar/polar(lib/passesBoundaryCheck:70:3)
`,`Layer with boundaryLayerId "${e}" missing source.`),st.undefinedBoundarySource)}function Bt(){}const P={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Zi={ERROR:"error"};let qi=class extends $e{constructor(e){super(Zi.ERROR),this.code=e.code,this.message=e.message}},Ji=class extends Gn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Vn,this.watchId_=void 0,this.addChangeListener(P.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(P.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Nn(je("EPSG:4326"),e),this.position_&&this.set(P.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(P.ACCURACY,t.accuracy),this.set(P.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(P.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(P.HEADING,t.heading===null?void 0:zn(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(P.POSITION,n.slice()),this.set(P.SPEED,t.speed===null?void 0:t.speed);const r=Un(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(P.ACCURACY_GEOMETRY,r),this.changed()}positionError_(e){this.dispatchEvent(new qi(e))}getAccuracy(){return this.get(P.ACCURACY)}getAccuracyGeometry(){return this.get(P.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(P.ALTITUDE)}getAltitudeAccuracy(){return this.get(P.ALTITUDE_ACCURACY)}getHeading(){return this.get(P.HEADING)}getPosition(){return this.get(P.POSITION)}getProjection(){return this.get(P.PROJECTION)}getSpeed(){return this.get(P.SPEED)}getTracking(){return this.get(P.TRACKING)}getTrackingOptions(){return this.get(P.TRACKING_OPTIONS)}setProjection(e){this.set(P.PROJECTION,je(e))}setTracking(e){this.set(P.TRACKING,e)}setTrackingOptions(e){this.set(P.TRACKING_OPTIONS,e)}};const Yi=(i,e)=>()=>i.innerHTML=e.map(([t,n,r={}])=>`<${t}>${Se.t(n,r)}</${t}>`).join(""),Ki=`
	background: rgba(255, 255, 255, 0.8);
	padding: 0.2em 0.5em;
	border-radius: 4px;
	color: #16161d;
	box-shadow: 0px 0px 3px 2px rgba(0, 0, 0, 0.5);
`;function Xi(i,e=Ki){const t=document.createElement("div");t.style.cssText=e;const n=Yi(t,i);return Se.on("languageChanged",n),Se.store.on("added",n),n(),{element:t,unregister:()=>{Se.off("languageChanges",n),Se.store.off("added",n)}}}function Qi(){return navigator.permissions.query({name:"geolocation"}).then(({state:i})=>i==="denied").catch(()=>!1)}function er(i,e){const t=e/2*Math.sqrt(3),n=document.createElement("canvas").getContext("2d").createLinearGradient(0,-t,Math.sin(i),t+Math.cos(i));return n.addColorStop(0,"#0794FAFF"),n.addColorStop(2/3,"#0794FA00"),n}function tr(i){if(typeof i.get("heading")>"u")return new Ze;const e=42,t=Math.PI-i.get("heading");return new Ze({image:new Hn({points:3,radius:e,rotation:t,fill:new Yt({color:er(t,e)}),displacement:[0,-30]})})}function nr(){const i=new Yt({color:"#0078D4"}),e=new On({color:"#FFFFFF",width:2});return t=>[tr(t),new Ze({image:new Bn({fill:i,stroke:e,radius:12}),fill:i,stroke:e})]}const ir=(i,e)=>i[0]!==e[0]||i[1]!==e[1],cn=ce("plugins/geoLocation",()=>{const i=X(),e=F(!1),t=F(null),n=F(null),r=F([]),a=w(()=>ie({showTooltip:!1,zoomLevel:7},i.configuration.geoLocation||{})),o=w(()=>a.value.boundary),s=w(()=>e.value?"DISABLED":t.value===null?"LOCATABLE":"LOCATED"),l=new Z({type:"point",name:"geoLocationMarker"}),d=new ye({source:new Ae({features:[l]}),properties:{name:"geoLocationMarkerLayer"},zIndex:1/0,style:nr()});function c(){i.map.addLayer(d),a.value.checkLocationInitially?C():Qi().then(_=>e.value=_),g()}function u(){i.map.removeLayer(d),v(),E(),h()}let h=Bt;function g(){if(a.value.showTooltip){const{unregister:_,element:k}=Xi([["h2","markerText",{ns:"geoLocation"}]]),G=new Rn({element:k,positioning:"bottom-center",offset:[0,-5]});i.map.addOverlay(G);const te=({pixel:xe,dragging:An})=>{if(An)return;const $n=i.map.getFeaturesAtPixel(xe,{layerFilter:Mn=>Mn.get("name")==="geoLocationMarkerLayer"}).length?i.map.getCoordinateFromPixel(xe):void 0;G.setPosition($n)};i.map.on("pointermove",te),h=()=>{_(),i.map.removeOverlay(G),i.map.un("pointermove",te),h=Bt}}}function y(){(s.value==="LOCATABLE"?C:v)()}function C(){if(e.value){T({message:"Geolocation API usage was denied by user or configuration."});return}t.value===null?t.value=new Ji({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:je("EPSG:4326")}):b(),t.value.on("change:position",b),t.value.on("change:heading",({target:_})=>{l.set("heading",_.getHeading())}),t.value.on("error",T)}function T(_){Le("error",Ie(k=>k.button.locationAccessDenied,{ns:"geoLocation"})),console.error(`@polar/polar(plugins/geoLocation/store:176:3)
`,_.message),e.value=!0,E()}function v(){t.value?.setTracking(!1),E(),t.value=null}async function b(){const _=Jt(t.value?.getPosition(),je("EPSG:4326"),i.configuration.epsg),k=i.configuration.extent?Dn(i.configuration.extent,_):!0,G=await dn(i.map,o.value?.layerId,_),te=n.value!==G;n.value=G;const xe=typeof G=="symbol"&&o.value?.onError==="strict";if(!k||xe){x(xe),v();return}ir(r.value,_)&&(I(_),te&&!G&&x(!1))}function I(_){r.value=_;const k=!!l.getGeometry();l.setGeometry(new ne(_)),(a.value.keepCentered||!k)&&n.value&&(i.map.getView().setCenter(_),i.map.getView().setZoom(a.value.zoomLevel))}function E(){l.setGeometry(void 0),r.value=[]}function x(_){if(_){const G=Ie(te=>te.toast.boundaryError,{ns:"geoLocation"});Le("error",G),console.error(`@polar/polar(plugins/geoLocation/store:264:4)
`,G);return}const k=Ie(G=>G.toast.notInBoundary,{ns:"geoLocation"});Le("info",k,{timeout:1e4}),console.info(`@polar/polar(plugins/geoLocation/store:272:3)
`,k)}return{setupPlugin:c,teardownPlugin:u,locate:y,configuration:a,isGeolocationDenied:e,state:s,position:r,boundaryCheck:n}}),un="geoLocation",rr=N({__name:"GeoLocation.ce",setup(i){const{layout:e}=de(X()),t=cn(),{state:n}=de(t),r=w(()=>n.value==="LOCATED"?"kern-icon-fill--near-me":n.value==="LOCATABLE"?"kern-icon--near-me":"kern-icon--near-me-disabled"),a=w(()=>t.configuration.renderType==="iconMenu"?void 0:e.value==="standard"||t.configuration.layoutTag?.includes("RIGHT")?"left":"right");return(o,s)=>(m(),$(pt,{class:Me(f(e)==="nineRegions"?"polar-plugin-geoLocation-nineRegions":""),hint:o.$t(l=>l.button.tooltip,{ns:f(un)}),icon:r.value,"tooltip-position":a.value,disabled:f(n)==="DISABLED",onClick:f(t).locate},null,8,["class","hint","icon","tooltip-position","disabled","onClick"]))}}),ar=".polar-plugin-geoLocation-nineRegions[data-v-45fc3e3e]{margin:var(--kern-metric-space-small)}",or=B(rr,[["styles",[ar]],["__scopeId","data-v-45fc3e3e"]]),sr={markerText:"Aktuelle Position",button:{locationAccessDenied:"Standortzugriff nutzerseitig abgelehnt",tooltip:"Eigene Position markieren"},toast:{boundaryError:"Die Überprüfung Ihrer Position ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Sie befinden sich nicht im Kartengebiet."}},lr={markerText:"Current location",button:{locationAccessDenied:"Location access denied by user",tooltip:"Mark own location"},toast:{boundaryError:"Validating your position failed. Please try later again or contact an administrator if the issue persists.",notInBoundary:"You are not within the map's boundaries."}},dr=[{type:"de",resources:sr},{type:"en",resources:lr}];function cr(i){return{id:un,component:or,locales:dr,storeModule:cn,options:i}}const R=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Re(i){return Wn(i[0].version,"1.3")>=0}const ur=M(R,{Service:p($r),Capability:p(Ar)}),hr=M(R,{Request:p(zr),Exception:p(Or),Layer:p(Br),UserDefinedSymbolization:p(Pr)});let gr=class extends jn{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),D({version:this.version},ur,e,[])||null}};const hn={Name:p(L),Title:p(L),Abstract:p(L),KeywordList:p(yn),OnlineResource:p(xt),ContactInformation:p(Mr),Fees:p(L),AccessConstraints:p(L)},pr=M(R,hn),mr=M(R,{...hn,LayerLimit:p(at),MaxWidth:p(at),MaxHeight:p(at)}),fr=M(R,{ContactPersonPrimary:p(Rr),ContactPosition:p(L),ContactAddress:p(Dr),ContactVoiceTelephone:p(L),ContactFacsimileTelephone:p(L),ContactElectronicMailAddress:p(L)}),_r=M(R,{ContactPerson:p(L),ContactOrganization:p(L)}),yr=M(R,{AddressType:p(L),Address:p(L),City:p(L),StateOrProvince:p(L),PostCode:p(L),Country:p(L)}),vr=M(R,{Format:Kt(L)}),gn={Name:p(L),Title:p(L),Abstract:p(L),KeywordList:p(yn),BoundingBox:O(fn),Dimension:O(Gr),Attribution:p(Er),AuthorityURL:O(Wr),Identifier:O(L),MetadataURL:O(jr),DataURL:O(re),FeatureListURL:O(re),Style:O(Zr),Layer:O(it)},pn=M(R,{...gn,SRS:O(L),Extent:p(Vr),ScaleHint:O(Nr),LatLonBoundingBox:p((i,e)=>fn(i,e,!1)),Layer:O(it)}),mn=M(R,{...gn,CRS:O(L),EX_GeographicBoundingBox:p(Fr),MinScaleDenominator:p(ue),MaxScaleDenominator:p(ue),Layer:O(it)}),br=M(R,{Title:p(L),OnlineResource:p(xt),LogoURL:p(_n)}),xr=M(R,{westBoundLongitude:p(ue),eastBoundLongitude:p(ue),southBoundLatitude:p(ue),northBoundLatitude:p(ue)}),Cr=M(R,{GetCapabilities:p(ke),GetMap:p(ke),GetFeatureInfo:p(ke),DescribeLayer:p(ke),GetLegendGraphic:p(ke)}),kr=M(R,{Format:O(L),DCPType:O(Ur)}),Sr=M(R,{HTTP:p(Hr)}),wr=M(R,{Get:p(re),Post:p(re)}),Lr=M(R,{Name:p(L),Title:p(L),Abstract:p(L),LegendURL:O(_n),StyleSheetURL:p(re),StyleURL:p(re)}),Tr=M(R,{Format:p(L),OnlineResource:p(xt)}),Ir=M(R,{Keyword:Kt(L)});function Er(i,e){return D({},br,i,e)}function Pr(i,e){return{SupportSLD:!!H(i.getAttribute("SupportSLD")),UserLayer:!!H(i.getAttribute("UserLayer")),UserStyle:!!H(i.getAttribute("UserStyle")),RemoteWFS:!!H(i.getAttribute("RemoteWFS")),InlineFeatureData:!!H(i.getAttribute("InlineFeatureData")),RemoteWCS:!!H(i.getAttribute("RemoteWCS"))}}function fn(i,e,t=!0){const n=[Q(i.getAttribute("minx")),Q(i.getAttribute("miny")),Q(i.getAttribute("maxx")),Q(i.getAttribute("maxy"))],r=[Q(i.getAttribute("resx")),Q(i.getAttribute("resy"))],a={extent:n,res:r};return t&&(Re(e)?a.crs=i.getAttribute("CRS"):a.srs=i.getAttribute("SRS")),a}function Fr(i,e){const t=D({},xr,i,e);if(!t)return;const n=t.westBoundLongitude,r=t.southBoundLatitude,a=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||r===void 0||a===void 0||o===void 0))return[n,r,a,o]}function Ar(i,e){return D({},hr,i,e)}function $r(i,e){return D({},Re(e)?mr:pr,i,e)}function Mr(i,e){return D({},fr,i,e)}function Rr(i,e){return D({},_r,i,e)}function Dr(i,e){return D({},yr,i,e)}function Or(i,e){return D([],vr,i,e)}function Br(i,e){const t=D({},Re(e)?mn:pn,i,e);return t.Layer===void 0?Object.assign(t,it(i,e)):t}function it(i,e){const t=Re(e),n=e[e.length-1],r=D({},t?mn:pn,i,e);if(!r)return;let a=H(i.getAttribute("queryable"));a===void 0&&(a=n.queryable),r.queryable=a!==void 0?a:!1;let o=mt(i.getAttribute("cascaded"));o===void 0&&(o=n.cascaded),r.cascaded=o;let s=H(i.getAttribute("opaque"));s===void 0&&(s=n.opaque),r.opaque=s!==void 0?s:!1;let l=H(i.getAttribute("noSubsets"));l===void 0&&(l=n.noSubsets),r.noSubsets=l!==void 0?l:!1;let d=Q(i.getAttribute("fixedWidth"));d||(d=n.fixedWidth),r.fixedWidth=d;let c=Q(i.getAttribute("fixedHeight"));c||(c=n.fixedHeight),r.fixedHeight=c;const u=["Style","AuthorityURL"];t?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(g){if(g in n){const y=r[g]||[];r[g]=y.concat(n[g])}});const h=["BoundingBox","Attribution"];return t?h.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):h.push("LatLonBoundingBox","ScaleHint","Extent"),h.forEach(function(g){if(!(g in r)){const y=n[g];r[g]=y}}),r}function Gr(i,e){const t={name:i.getAttribute("name"),units:i.getAttribute("units"),unitSymbol:i.getAttribute("unitSymbol")};return Re(e)&&Object.assign(t,{default:i.getAttribute("default"),multipleValues:H(i.getAttribute("multipleValues")),nearestValue:H(i.getAttribute("nearestValue")),current:H(i.getAttribute("current")),values:L(i)}),t}function Vr(i,e){return{name:i.getAttribute("name"),default:i.getAttribute("default"),nearestValue:H(i.getAttribute("nearestValue"))}}function Nr(i,e){return{min:Q(i.getAttribute("min")),max:Q(i.getAttribute("max"))}}function re(i,e){return D({},Tr,i,e)}function zr(i,e){return D({},Cr,i,e)}function Ur(i,e){return D({},Sr,i,e)}function Hr(i,e){return D({},wr,i,e)}function ke(i,e){return D({},kr,i,e)}function _n(i,e){const t=re(i,e);if(t){const n=[mt(i.getAttribute("width")),mt(i.getAttribute("height"))];return t.size=n,t}}function Wr(i,e){const t=re(i,e);if(t)return t.name=i.getAttribute("name"),t}function jr(i,e){const t=re(i,e);if(t)return t.type=i.getAttribute("type"),t}function Zr(i,e){return D({},Lr,i,e)}function yn(i,e){return D([],Ir,i,e)}function qr({legendURL:i,layers:e="",url:t,typ:n,format:r,version:a}){return i?i==="ignore"?[]:[i]:e.split(",").filter(o=>o).map(o=>`${t}?SERVICE=${n}&REQUEST=GetLegendGraphic&FORMAT=${r||"image/png"}&VERSION=${a}&LAYER=${o}`)}const Gt=(i,e)=>i.filter(t=>{let{minZoom:n,maxZoom:r}=t;return typeof n>"u"&&(n=0),typeof r>"u"&&(r=Number.MAX_SAFE_INTEGER),n<=e&&e<=r});function Xe(i,e){if(Array.isArray(i))return i.map(t=>Xe(t,e)).find(t=>t!==null)||null;if(typeof i=="object"){if(i.Name===e)return i;if(i.Layer)return Xe(i.Layer,e)}return null}const Jr=i=>(Array.isArray(i)?i:[i]).map(e=>(Array.isArray(e.LegendURL)?e.LegendURL:typeof e.LegendURL=="object"?[e.LegendURL]:[]).map(t=>t.OnlineResource)).flat(1);function Yr(i,e){return Xe(i.Capability.Layer,e)?.Title||""}function Kr(i,e){const t=Xe(i.Capability.Layer,e)?.Style;return t&&Jr(t)[0]||""}function Xr(i,e){const t=e[i];if(t)try{return new gr().read(t)}catch(n){console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:21:4)
`,`Error reading xml '${t}' for id '${i}'.`,n)}return null}function Qr(i,e){return Promise.all(i.map(async t=>{const{id:n}=t,r=t.options?.layers;if(r&&(r.title===!0||r.legend===!0)){if(typeof e[n]=="string")return console.warn(`@polar/polar(plugins/layerChooser/utils/capabilities:41:6)
`,`Re-fired loadCapabilities on id '${n}' albeit the GetCapabilities have already been successfully fetched. No re-fetch will occur.`),[n,null];const a=Qe.getLayerWhere({id:t.id});if(!a||!a.url||!a.version||!a.typ)return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:49:6)
`,`Missing data for service '${a}' with id '${n}'.`),[n,null];const o=`${a.url}?service=${a.typ}&version=${a.version}&request=GetCapabilities`;try{const s=await fetch(o);return[n,await s.text()]}catch(s){return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:61:6)
`,`Capabilities from ${o} could not be fetched.`,s),[n,null]}}return[n,null]})).then(t=>t.reduce((n,[r,a])=>ie(n,{[r]:a}),{}))}function ea(i,e,t){const n=Qe.getLayerWhere({id:i}),r=Xr(i,e);return{[i]:(t.order?.split(",")||n.layers.split(",")).map(a=>({layerName:a,displayName:t.title===!0&&r?Yr(r,a):t.title===!1?a:t.title?.[a]||a,layerImage:t.legend===!0&&r?Kr(r,a):t.legend===!1?null:t.legend?.[a]||null}))}}const ta=i=>i.reduce(([e,t],n)=>Qe.getLayerWhere({id:n.id})===null?(console.error(`@polar/polar(plugins/layerChooser/utils/getBackgroundsAndMasks:15:5)
`,`Layer ${n.id} not found in service register. This is a configuration issue. The map might behave in unexpected ways.`,n),[e,t]):n.type==="background"?[[...e,n],t]:[e,[...t,n]],[[],[]]),na=i=>i.map(({id:e,name:t})=>({id:e,name:t})).map(e=>ie(e,{rawLayer:Qe.getLayerWhere({id:e.id})})).filter(({rawLayer:e})=>e!==null).reduce((e,t)=>{const n=qr(t.rawLayer)[0];return typeof n=="string"?{...e,[t.id]:{name:t.name,url:n}}:e},{}),be=ce("plugins/layerChooser",()=>{const i=X(),e=F({}),t=F([]),n=F([]),r=F([]),a=F([]),o=F(""),s=F([]),l=F({}),d=F(""),c=F({}),u=F(""),h=w(()=>t.value.reduce((x,{id:_})=>({...x,[_]:r.value.findIndex(({id:k})=>k===_)===-1}),{})),g=w(()=>y.value.reduce((x,{id:_})=>({...x,[_]:a.value.findIndex(({id:k})=>k===_)===-1}),{})),y=w(()=>n.value.filter(({hideInMenu:x})=>!x)),C=w(()=>y.value.reduce((x,_)=>ie(x,{[_.type]:Array.isArray(x[_.type])?x[_.type].concat(_):[_]}),{}));function T(){const[x,_]=ta(i.configuration.layers);t.value=x,n.value=_,x.length===0&&console.error(`@polar/polar(plugins/layerChooser/store:100:4)
`,'No layers of type "background" have been configured.'),o.value=x.find(({visibility:k})=>k)?.id||"",s.value=_.filter(({visibility:k})=>k).map(({id:k})=>k),I(),i.map.on("moveend",I),l.value=na(i.configuration.layers),Qr(i.configuration.layers,e.value).then(k=>{e.value=k,i.configuration.layers.forEach(G=>{const te=G.options?.layers;te&&(c.value=ie(c.value,ea(G.id,k,te)))})})}function v(){i.map.un("moveend",I)}Ke(o,x=>{i.map.getLayers().getArray().forEach(_=>{t.value.find(({id:k})=>k===_.get("id"))&&_.setVisible(_.get("id")===x)})}),Ke(s,x=>{b(x)});function b(x){i.map.getLayers().getArray().forEach(_=>{n.value.find(({id:k})=>k===_.get("id"))&&_.setVisible(x.includes(_.get("id")))})}function I(){const x=i.map.getView().getZoom();r.value=Gt(t.value,x),a.value=Gt(n.value,x);const _=r.value.map(({id:k})=>k);_.includes(o.value)||(o.value=_[0]||""),b(a.value.map(({id:k})=>k).filter(k=>s.value.includes(k)))}function E(x){const _=i.map.getLayers().getArray().find(k=>k.get("id")===u.value).getSource();if(!_){console.error(`@polar/polar(plugins/layerChooser/store:208:4)
`,`Action 'toggleOpenedOptionsServiceLayer' failed on ${u.value}. Layer not found in OpenLayers or source not initialized in OpenLayers.`);return}_.updateParams({..._.getParams(),LAYERS:x})}return{activeBackgroundId:o,activeMaskIds:s,backgrounds:t,capabilities:e,disabledBackgrounds:h,disabledMasks:g,layersWithLegends:l,layersWithOptions:c,masksSeparatedByType:C,shownMasks:y,openedLegendId:d,openedOptionsId:u,setupPlugin:T,teardownPlugin:v,toggleOpenedOptionsServiceLayer:E}}),ia={class:"kern-card kern-card--small"},ra={class:"kern-card__container"},aa=N({__name:"PolarCard.ce",setup(i){return(e,t)=>(m(),S("article",ia,[A("div",ra,[It(e.$slots,"default",{},void 0,!0)])]))}}),oa=".kern-card{&[data-v-6728745d]{height:inherit;min-width:25rem;border-radius:var(--kern-metric-border-radius-large);box-shadow:var(--polar-shadow)}.kern-card__container[data-v-6728745d]{padding:var(--kern-metric-space-small);padding-bottom:.625rem}}",Et=B(aa,[["styles",[oa]],["__scopeId","data-v-6728745d"]]),J="layerChooser",sa=["id"],la={class:"kern-label"},vn=N({__name:"LayerInformationCard.ce",props:{identifier:{type:String},idName:{type:String}},setup(i){const e=i,t=X(),n=be();Ti(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-back-button`)?.focus()});function r(){const a=n[e.idName];n[e.idName]="",Ii(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-${a}-button`)?.focus()})}return(a,o)=>(m(),$(Et,null,{default:se(()=>[A("button",{id:`polar-layer-chooser-${i.identifier}-back-button`,class:"kern-btn kern-btn--secondary",onClick:r},[o[0]||(o[0]=A("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),A("span",la,ve(a.$t(s=>s.returnToLayers,{ns:f(J)})),1)],8,sa),It(a.$slots,"default")]),_:3}))}}),da={class:"kern-label",for:"polar-layer-chooser-legend-anchor"},ca=["href","aria-label"],ua=["src","alt"],ha=N({__name:"LayerLegend.ce",setup(i){const e=be(),t=w(()=>e.layersWithLegends[e.openedLegendId]);return(n,r)=>(m(),$(vn,{identifier:"legend","id-name":"openedLegendId",class:"legend-card"},{default:se(()=>[A("label",da,ve(n.$t(a=>a.legend.to,{name:t.value.name,ns:f(J)})),1),A("a",{id:"polar-layer-chooser-legend-anchor",href:t.value.url,"aria-label":n.$t(a=>a.legend.to,{name:t.value.name,ns:f(J)}),target:"_blank"},[A("img",{src:t.value.url,alt:n.$t(a=>a.legend.to,{name:t.value.name,ns:f(J)})},null,8,ua)],8,ca)]),_:1}))}}),ga=".legend-card[data-v-e248e19b]{overflow-y:scroll}",pa=B(ha,[["styles",[ga]],["__scopeId","data-v-e248e19b"]]),ma={class:"kern-form-check"},fa=["id","name","value","type","disabled"],_a=["for"],ya=N({__name:"PolarInput.ce",props:Ei({idSuffix:{type:String},label:{type:String},type:{type:null},value:{type:String},disabled:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const e=Pi(i,"modelValue");return(t,n)=>(m(),S("div",ma,[sn(A("input",{id:`polar-${i.type}-${i.value}-${i.idSuffix}`,"onUpdate:modelValue":n[0]||(n[0]=r=>e.value=r),class:Me(`polar-input kern-form-check__${i.type}`),name:i.value,value:i.value,type:i.type,disabled:i.disabled},null,10,fa),[[Fi,e.value]]),A("label",{class:"polar-input kern-label",for:`polar-${i.type}-${i.value}-${i.idSuffix}`},ve(i.label),9,_a)]))}}),va=".kern-form-check__radio[disabled],.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:hover{border:var(--kern-metric-border-width-default) solid var(--kern-color-form-input-border)}}.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:checked:hover:before{margin:var(--kern-metric-space-x-small)}}",vt=B(ya,[["styles",[va]],["__scopeId","data-v-83635f17"]]),ba={class:"kern-fieldset"},xa={class:"kern-label"},Ca={class:"kern-fieldset__body"},ka=N({__name:"PolarInputGroup.ce",props:{legend:{type:String}},setup(i){return(e,t)=>(m(),S("fieldset",ba,[A("legend",xa,ve(i.legend),1),A("div",Ca,[It(e.$slots,"default",{},void 0,!0)])]))}}),Sa=".kern-fieldset[data-v-69d29a6c]{width:100%}.kern-fieldset__body[data-v-69d29a6c]{width:100%;padding:var(--kern-metric-space-small) 0;gap:var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);background-color:var(--kern-color-layout-background-hued)}.kern-label[data-v-69d29a6c]{padding-left:.75rem}[data-v-69d29a6c] .kern-form-check{align-items:center;gap:var(--kern-metric-space-large);margin-left:.75rem;padding-right:0}",bt=B(ka,[["styles",[Sa]],["__scopeId","data-v-69d29a6c"]]),wa=["src","alt"],La=N({__name:"LayerOptions.ce",setup(i){const e=X(),t=be(),{openedOptionsId:n}=de(t),r=w(()=>t.layersWithOptions[n.value]),a=F(r.value.map(({layerName:l})=>l).reverse()),o=w({get:()=>a.value,set:l=>{a.value=l,t.toggleOpenedOptionsServiceLayer(l)}}),s=w(()=>e.configuration.layers.find(({id:l})=>l===n.value)?.name||"");return(l,d)=>(m(),$(vn,{identifier:"options","id-name":"openedOptionsId"},{default:se(()=>[le(bt,{legend:l.$t(c=>c.layerHeader,{ns:f(J),name:s.value})},{default:se(()=>[(m(!0),S(q,null,ee(r.value,({displayName:c,layerImage:u,layerName:h})=>(m(),S("div",{key:`polar-layer-chooser-mask-options-checkbox-${h}`,class:"polar-layer-chooser-options-checkbox-wrapper"},[u?(m(),S("img",{key:0,src:u,alt:h},null,8,wa)):K("",!0),le(vt,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=g=>o.value=g),"id-suffix":"polar-layer-chooser-mask-options",label:c,type:"checkbox",value:h,class:Me(r.value.some(({layerImage:g})=>g!==null)?"polar-layer-chooser-options-checkbox":"")},null,8,["modelValue","label","value","class"])]))),128))]),_:1},8,["legend"])]),_:1}))}}),Ta=".polar-layer-chooser-options-checkbox-wrapper[data-v-1ce80731]{display:flex;justify-content:flex-start;align-items:center;gap:var(--kern-metric-space-large)}.kern-form-check.polar-layer-chooser-options-checkbox[data-v-1ce80731]{margin-left:0}.kern-btn[data-v-1ce80731]{border:none;min-height:inherit;padding:var(--kern-metric-space-x-small)}.kern-label[data-v-1ce80731]{padding:0;padding-left:var(--kern-metric-space-small)}",Ia=B(La,[["styles",[Ta]],["__scopeId","data-v-1ce80731"]]),Ea=["id","disabled"],Pa={class:"kern-label kern-sr-only"},Vt=N({__name:"LegendButton.ce",props:{disabled:{type:Boolean},id:{type:String}},setup(i){return(e,t)=>(m(),S("button",{id:`polar-layer-chooser-legend-${i.id}-button`,class:"kern-btn kern-btn--tertiary",disabled:i.disabled},[t[0]||(t[0]=A("span",{class:"kern-icon kern-icon--info","aria-hidden":"true"},null,-1)),A("span",Pa,ve(e.$t(n=>n.legend.open,{ns:f(J)})),1)],8,Ea))}}),Fa=["id","disabled","onClick"],Aa={class:"kern-label kern-sr-only"},$a=N({__name:"LayerSelection.ce",setup(i){const e=be(),{activeBackgroundId:t,activeMaskIds:n,backgrounds:r,disabledBackgrounds:a,disabledMasks:o,layersWithOptions:s,masksSeparatedByType:l,openedLegendId:d,shownMasks:c}=de(e),u=w(()=>Object.keys(e.layersWithLegends));function h(g){e.openedOptionsId=g}return(g,y)=>(m(),$(Et,{id:"polar-layer-chooser-card"},{default:se(()=>[f(r).length?(m(),$(bt,{key:0,legend:g.$t(C=>C.backgroundTitle,{ns:f(J)})},{default:se(()=>[(m(!0),S(q,null,ee(f(r),({name:C,id:T})=>(m(),S("div",{key:`polar-layer-chooser-background-radio-${T}`,class:"polar-layer-chooser-input-wrapper"},[le(vt,{modelValue:f(t),"onUpdate:modelValue":y[0]||(y[0]=v=>Ot(t)?t.value=v:null),"id-suffix":"polar-layer-chooser-background",label:C,type:"radio",value:T,disabled:f(a)[T]},null,8,["modelValue","label","value","disabled"]),u.value.includes(T)?(m(),$(Vt,{key:0,id:T,disabled:f(a)[T],onClick:v=>d.value=T},null,8,["id","disabled","onClick"])):K("",!0)]))),128))]),_:1},8,["legend"])):K("",!0),f(c).length?(m(!0),S(q,{key:1},ee(Object.entries(f(l)),([C,T])=>(m(),$(bt,{key:`polar-layer-chooser-mask-${C}`,legend:g.$t(v=>v[`${C}Title`],{ns:f(J)})},{default:se(()=>[(m(!0),S(q,null,ee(T,({name:v,id:b})=>(m(),S("div",{key:`polar-layer-chooser-mask-${C}-checkbox-${b}`,class:"polar-layer-chooser-input-wrapper"},[le(vt,{modelValue:f(n),"onUpdate:modelValue":y[1]||(y[1]=I=>Ot(n)?n.value=I:null),"id-suffix":`polar-layer-chooser-mask-${C}`,label:v,type:"checkbox",value:b,disabled:f(o)[b]},null,8,["modelValue","id-suffix","label","value","disabled"]),Object.keys(f(s)).includes(b)?(m(),S("button",{key:0,id:`polar-layer-chooser-options-${b}-button`,class:"kern-btn kern-btn--tertiary",disabled:f(o)[b],onClick:()=>h(b)},[y[2]||(y[2]=A("span",{class:"kern-icon kern-icon-fill--settings","aria-hidden":"true"},null,-1)),A("span",Aa,ve(g.$t(I=>I.layerOptions,{ns:f(J)})),1)],8,Fa)):u.value.includes(b)?(m(),$(Vt,{key:1,id:b,disabled:f(o)[b],onClick:I=>d.value=b},null,8,["id","disabled","onClick"])):K("",!0)]))),128))]),_:2},1032,["legend"]))),128)):K("",!0)]),_:1}))}}),Ma="#polar-layer-chooser-card[data-v-c4509e12]{overflow-y:inherit}.polar-layer-chooser-input-wrapper[data-v-c4509e12]{display:flex;justify-content:space-between;align-items:center;gap:var(--kern-metric-space-large)}.kern-btn[data-v-c4509e12]{width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large);border:none;border-radius:50%}",Ra=B($a,[["styles",[Ma]],["__scopeId","data-v-c4509e12"]]),Da=N({__name:"LayerChooser.ce",setup(i){const e=be(),t=w(()=>e.openedLegendId.length!==0),n=w(()=>e.openedOptionsId.length===0&&!t.value);return(r,a)=>n.value?(m(),$(Ra,{key:0})):t.value?(m(),$(pa,{key:1})):(m(),$(Ia,{key:2}))}}),Oa={backgroundTitle:"Hintergrundkarten",maskTitle:"Fachdaten",layerHeader:'Auswahl sichtbarer Ebenen für Layer "{{name}}"',layerOptions:"Optionen für Kartenmaterial",legend:{title:"Legende",to:'Legendenbild zu "{{name}}"',open:`$t(legend.to, {ns: ${J}}) öffnen`},returnToLayers:"Zurück"},Ba={backgroundTitle:"Background maps",maskTitle:"Subject data",layerHeader:'Visible layer selection for layer "{{name}}"',layerOptions:"Map data options",legend:{title:"Legend",to:'"{{name}}" legend image',open:`Open $t(legend.to, {ns: ${J}})`},returnToLayers:"Back"},Ga=[{type:"de",resources:Oa},{type:"en",resources:Ba}];function Va(i){return{id:J,component:Da,icon:"kern-icon-fill--layers",locales:Ga,storeModule:be,options:i}}const Na=["KernLoader","BasicLoader","RingLoader","RollerLoader","CircleLoader","SpinnerLoader"],bn=ce("plugins/loadingIndicator",()=>{const i=F(new Set),e=F("KernLoader"),t=w(()=>i.value.size>0);function n(){const l=X().configuration.loadingIndicator?.loaderStyle;l&&s(l)}function r(){s("KernLoader")}function a(l){i.value=new Set([...i.value,l])}function o(l){const d=new Set(i.value);d.delete(l),i.value=d}function s(l){Na.includes(l)?e.value=l:console.error(`@polar/polar(plugins/loadingIndicator/store:62:5)
`,`Loader style ${l} does not exist. Using previous style (${e.value}).`)}return{loaderStyle:e,showLoader:t,addLoadingKey:a,removeLoadingKey:o,setLoaderStyle:s,setupPlugin:n,teardownPlugin:r}}),za={class:"lds-default"},Ua=N({__name:"BasicLoader.ce",setup(i){return(e,t)=>(m(),S("div",za,[(m(),S(q,null,ee(12,n=>A("div",{key:n})),64))]))}}),Ha=".lds-default[data-v-6079aaec]{color:var(--kern-color-action-default)}.lds-default[data-v-6079aaec],.lds-default div[data-v-6079aaec]{box-sizing:border-box}.lds-default[data-v-6079aaec]{display:inline-block;position:relative;width:80px;height:80px}.lds-default div[data-v-6079aaec]{position:absolute;width:6.4px;height:6.4px;background:currentColor;border-radius:50%;animation:lds-default-6079aaec 1.2s linear infinite}.lds-default div[data-v-6079aaec]:nth-child(1){animation-delay:0s;top:36.8px;left:66.24px}.lds-default div[data-v-6079aaec]:nth-child(2){animation-delay:-.1s;top:22.08px;left:62.29579px}.lds-default div[data-v-6079aaec]:nth-child(3){animation-delay:-.2s;top:11.30421px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(4){animation-delay:-.3s;top:7.36px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(5){animation-delay:-.4s;top:11.30421px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(6){animation-delay:-.5s;top:22.08px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(7){animation-delay:-.6s;top:36.8px;left:7.36px}.lds-default div[data-v-6079aaec]:nth-child(8){animation-delay:-.7s;top:51.52px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(9){animation-delay:-.8s;top:62.29579px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(10){animation-delay:-.9s;top:66.24px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(11){animation-delay:-1s;top:62.29579px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(12){animation-delay:-1.1s;top:51.52px;left:62.29579px}@keyframes lds-default-6079aaec{0%,20%,80%,to{transform:scale(1)}50%{transform:scale(1.5)}}",Wa=B(Ua,[["styles",[Ha]],["__scopeId","data-v-6079aaec"]]),ja={},Za=".lds-circle[data-v-149ac9d5]{color:var(--kern-color-action-default)}.lds-circle[data-v-149ac9d5],.lds-circle div[data-v-149ac9d5]{box-sizing:border-box}.lds-circle[data-v-149ac9d5]{display:inline-block;transform:translateZ(1px);width:80px;height:80px}.lds-circle>div[data-v-149ac9d5]{display:inline-block;width:64px;height:64px;margin:8px;background:currentColor;border-radius:50%;animation:lds-circle-149ac9d5 2.4s cubic-bezier(0,.2,.8,1) infinite}@keyframes lds-circle-149ac9d5{0%,to{animation-timing-function:cubic-bezier(.5,0,1,.5)}0%{transform:rotateY(0)}50%{transform:rotateY(1800deg);animation-timing-function:cubic-bezier(0,.5,.5,1)}to{transform:rotateY(3600deg)}}",qa={class:"lds-circle"};function Ja(i,e,t,n,r,a){return m(),S("div",qa,[...e[0]||(e[0]=[A("div",null,null,-1)])])}const Ya=B(ja,[["render",Ja],["styles",[Za]],["__scopeId","data-v-149ac9d5"]]),Ka={},Xa=".lds-ring[data-v-712a38e8]{color:var(--kern-color-action-default)}.lds-ring[data-v-712a38e8],.lds-ring div[data-v-712a38e8]{box-sizing:border-box}.lds-ring[data-v-712a38e8]{display:inline-block;position:relative;width:80px;height:80px}.lds-ring div[data-v-712a38e8]{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid currentColor;border-radius:50%;animation:lds-ring-712a38e8 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.lds-ring div[data-v-712a38e8]:nth-child(1){animation-delay:-.45s}.lds-ring div[data-v-712a38e8]:nth-child(2){animation-delay:-.3s}.lds-ring div[data-v-712a38e8]:nth-child(3){animation-delay:-.15s}@keyframes lds-ring-712a38e8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",Qa={class:"lds-ring"};function eo(i,e,t,n,r,a){return m(),S("div",Qa,[(m(),S(q,null,ee(4,o=>A("div",{key:o})),64))])}const to=B(Ka,[["render",eo],["styles",[Xa]],["__scopeId","data-v-712a38e8"]]),no={},io='.lds-roller[data-v-c8254b29]{color:var(--kern-color-action-default)}.lds-roller[data-v-c8254b29],.lds-roller div[data-v-c8254b29],.lds-roller div[data-v-c8254b29]:after{box-sizing:border-box}.lds-roller[data-v-c8254b29]{display:inline-block;position:relative;width:80px;height:80px}.lds-roller div[data-v-c8254b29]{animation:lds-roller-c8254b29 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller div[data-v-c8254b29]:after{content:" ";display:block;position:absolute;width:7.2px;height:7.2px;border-radius:50%;background:currentColor;margin:-3.6px 0 0 -3.6px}.lds-roller div[data-v-c8254b29]:nth-child(1){animation-delay:-36ms}.lds-roller div[data-v-c8254b29]:nth-child(1):after{top:62.62742px;left:62.62742px}.lds-roller div[data-v-c8254b29]:nth-child(2){animation-delay:-72ms}.lds-roller div[data-v-c8254b29]:nth-child(2):after{top:67.71281px;left:56px}.lds-roller div[data-v-c8254b29]:nth-child(3){animation-delay:-.108s}.lds-roller div[data-v-c8254b29]:nth-child(3):after{top:70.90963px;left:48.28221px}.lds-roller div[data-v-c8254b29]:nth-child(4){animation-delay:-.144s}.lds-roller div[data-v-c8254b29]:nth-child(4):after{top:72px;left:40px}.lds-roller div[data-v-c8254b29]:nth-child(5){animation-delay:-.18s}.lds-roller div[data-v-c8254b29]:nth-child(5):after{top:70.90963px;left:31.71779px}.lds-roller div[data-v-c8254b29]:nth-child(6){animation-delay:-.216s}.lds-roller div[data-v-c8254b29]:nth-child(6):after{top:67.71281px;left:24px}.lds-roller div[data-v-c8254b29]:nth-child(7){animation-delay:-.252s}.lds-roller div[data-v-c8254b29]:nth-child(7):after{top:62.62742px;left:17.37258px}.lds-roller div[data-v-c8254b29]:nth-child(8){animation-delay:-.288s}.lds-roller div[data-v-c8254b29]:nth-child(8):after{top:56px;left:12.28719px}@keyframes lds-roller-c8254b29{0%{transform:rotate(0)}to{transform:rotate(360deg)}}',ro={class:"lds-roller"};function ao(i,e,t,n,r,a){return m(),S("div",ro,[(m(),S(q,null,ee(8,o=>A("div",{key:o})),64))])}const oo=B(no,[["render",ao],["styles",[io]],["__scopeId","data-v-c8254b29"]]),so={},lo='.lds-spinner[data-v-1790c8de]{color:var(--kern-color-action-default)}.lds-spinner[data-v-1790c8de],.lds-spinner div[data-v-1790c8de],.lds-spinner div[data-v-1790c8de]:after{box-sizing:border-box}.lds-spinner[data-v-1790c8de]{color:currentColor;display:inline-block;position:relative;width:80px;height:80px}.lds-spinner div[data-v-1790c8de]{transform-origin:40px 40px;animation:lds-spinner-1790c8de 1.2s linear infinite}.lds-spinner div[data-v-1790c8de]:after{content:" ";display:block;position:absolute;top:3.2px;left:36.8px;width:6.4px;height:17.6px;border-radius:20%;background:currentColor}.lds-spinner div[data-v-1790c8de]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner div[data-v-1790c8de]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div[data-v-1790c8de]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div[data-v-1790c8de]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div[data-v-1790c8de]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div[data-v-1790c8de]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div[data-v-1790c8de]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div[data-v-1790c8de]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div[data-v-1790c8de]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div[data-v-1790c8de]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div[data-v-1790c8de]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div[data-v-1790c8de]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner-1790c8de{0%{opacity:1}to{opacity:0}}',co={class:"lds-spinner"};function uo(i,e,t,n,r,a){return m(),S("div",co,[(m(),S(q,null,ee(12,o=>A("div",{key:o})),64))])}const ho=B(so,[["render",uo],["styles",[lo]],["__scopeId","data-v-1790c8de"]]),go={key:0,class:"polar-plugin-loading-indicator-wrapper"},po={key:0,class:"polar-plugin-loading-indicator-overlay"},mo={key:0,class:"kern-loader kern-loader--visible",role:"status"},fo=N({__name:"LoadingIndicator.ce",setup(i){const{layout:e}=de(X()),{loaderStyle:t,showLoader:n}=de(bn()),r={BasicLoader:Wa,CircleLoader:Ya,RingLoader:to,RollerLoader:oo,SpinnerLoader:ho};return(a,o)=>f(n)&&f(t)!==null?(m(),S("div",go,[f(e)==="standard"?(m(),S("div",po)):K("",!0),le(Et,null,{default:se(()=>[f(t)==="KernLoader"?(m(),S("div",mo)):(m(),$(yt(r[f(t)]),{key:1,class:"kern-loader--visible",role:"status"}))]),_:1})])):K("",!0)}}),_o=".polar-plugin-loading-indicator-wrapper{&[data-v-d34e6512]{z-index:100;position:absolute;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.polar-plugin-loading-indicator-overlay[data-v-d34e6512]{position:absolute;width:100%;height:100%;opacity:var(--kern-color-action-state-opacity-overlay);background:#fff}.kern-card[data-v-d34e6512]{min-width:fit-content;height:fit-content;border-radius:50%}[data-v-d34e6512] .kern-card__container{padding:var(--kern-metric-space-small)!important}}",yo=B(fo,[["styles",[_o]],["__scopeId","data-v-d34e6512"]]),vo="loadingIndicator";function bo(i){return{id:vo,component:yo,storeModule:bn,options:i}}let Pt=class xn extends ci{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new xn(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const a=this.flatCoordinates,o=e-a[0],s=t-a[1],l=o*o+s*s;if(l<r){if(l===0)for(let d=0;d<this.stride;++d)n[d]=a[d];else{const d=this.getRadius()/Math.sqrt(l);n[0]=a[0]+d*o,n[1]=a[1]+d*s;for(let c=2;c<this.stride;++c)n[c]=a[c]}return n.length=this.stride,l}return r}containsXY(e,t){const n=this.flatCoordinates,r=e-n[0],a=t-n[1];return r*r+a*a<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return ui(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(hi(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:gi(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+n;for(let a=1;a<t;++a)r[t+a]=e[a];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let a=pi(r,0,e,this.stride);r[a++]=r[0]+t;for(let o=1,s=this.stride;o<s;++o)r[a++]=r[o];r.length=a,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),r=this.getStride();this.setCenter(mi(n,0,n.length,r,e,t,n)),this.changed()}};Pt.prototype.transform;function oe(i,e){const t=i.length;return e<0?i[e+t]:e>=t?i[e-t]:i[e]}function pe(i,e){const t=i.length;let n=Math.floor(e);const r=e-n;n>=t?n-=t:n<0&&(n+=t);let a=n+1;a>=t&&(a-=t);const o=i[n],s=o[0],l=o[1],d=i[a],c=d[0]-s,u=d[1]-l;return[s+c*r,l+u*r]}const De={index:-1,endIndex:NaN,closestTargetDistance:1/0};function Cn(i,e,t,n){const r=i[0],a=i[1];let o=1/0,s=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const h=e.targets[u],g=h.coordinates;let y=1/0,C;for(let T=0;T<g.length-1;++T){const v=g[T],b=g[T+1],I=wn(r,a,v,b);I.squaredDistance<y&&(y=I.squaredDistance,C=T+I.along)}y<o&&(o=y,h.ring&&e.targetIndex===u&&(h.endIndex>h.startIndex?C<h.startIndex&&(C+=g.length):h.endIndex<h.startIndex&&C>h.startIndex&&(C-=g.length)),l=C,s=u)}const d=e.targets[s];let c=d.ring;if(e.targetIndex===s&&c){const u=pe(d.coordinates,l),h=t.getPixelFromCoordinate(u),g=t.getPixelFromCoordinate(e.startCoord);ge(h,g)>n&&(c=!1)}if(c){const u=d.coordinates,h=u.length,g=d.startIndex,y=l;if(g<y){const C=Ge(u,g,y);Ge(u,g,y-h)<C&&(l-=h)}else{const C=Ge(u,g,y);Ge(u,g,y+h)<C&&(l+=h)}}return De.index=s,De.endIndex=l,De.closestTargetDistance=o,De}function kn(i,e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].getGeometry();Sn(i,r,t)}return t}function Sn(i,e,t){if(e instanceof Te){Oe(i,e.getCoordinates(),!1,t);return}if(e instanceof kt){const n=e.getCoordinates();for(let r=0,a=n.length;r<a;++r)Oe(i,n[r],!1,t);return}if(e instanceof wt){const n=e.getCoordinates();for(let r=0,a=n.length;r<a;++r)Oe(i,n[r],!0,t);return}if(e instanceof St){const n=e.getCoordinates();for(let r=0,a=n.length;r<a;++r){const o=n[r];for(let s=0,l=o.length;s<l;++s)Oe(i,o[s],!0,t)}return}if(e instanceof fi){const n=e.getGeometries();for(let r=0;r<n.length;++r)Sn(i,n[r],t);return}}function Oe(i,e,t,n){const r=i[0],a=i[1];for(let o=0,s=e.length-1;o<s;++o){const l=e[o],d=e[o+1],c=wn(r,a,l,d);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function Be(i,e){return nn(i[0],i[1],e[0],e[1])}function Ge(i,e,t){let n,r;e<t?(n=e,r=t):(n=t,r=e);const a=Math.ceil(n),o=Math.floor(r);if(a>o){const l=pe(i,n),d=pe(i,r);return Be(l,d)}let s=0;if(n<a){const l=pe(i,n),d=oe(i,a);s+=Be(l,d)}if(o<r){const l=oe(i,o),d=pe(i,r);s+=Be(l,d)}for(let l=a;l<o-1;++l){const d=oe(i,l),c=oe(i,l+1);s+=Be(d,c)}return s}const lt={along:0,squaredDistance:0};function wn(i,e,t,n){const r=t[0],a=t[1],o=n[0],s=n[1],l=o-r,d=s-a;let c=0,u=r,h=a;return(l!==0||d!==0)&&(c=vi(((i-r)*l+(e-a)*d)/(l*l+d*d),0,1),u+=l*c,h+=d*c),lt.along=c,lt.squaredDistance=_i(nn(i,e,u,h),10),lt}const Ve={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Ne extends $e{constructor(e,t){super(e),this.feature=t}}class xo extends Ct{constructor(e){const t=e;t.stopDown||(t.stopDown=Xn),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=ko(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Pe,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const r=this.mode_;if(r==="Circle")n=(a,o,s)=>{const l=o||new Pt([NaN,NaN]),d=V(a[0]),c=Je(d,V(a[a.length-1]));return l.setCenterAndRadius(d,Math.sqrt(c),this.geometryLayout_),l};else{let a;r==="Point"?a=ne:r==="LineString"?a=Te:r==="Polygon"&&(a=wt),n=(o,s,l)=>(s?r==="Polygon"?o[0].length?s.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(o,this.geometryLayout_):s=new a(o,this.geometryLayout_),s)}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new ye({source:new Ae({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Co(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Qn,this.freehandCondition_,e.freehand?this.freehandCondition_=fe:this.freehandCondition_=e.freehandCondition?e.freehandCondition:ft,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Qt.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=fe:t=e:t=qe,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=fe:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:ft}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===_t.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===W.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===W.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===W.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===W.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===W.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===W.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===W.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new ei(W.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),a=U([n,r]),o=this.traceSource_.getFeaturesInExtent(a);if(o.length===0)return;const s=kn(e.coordinate,o);s.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,r=e.startIndex<=t;n===r?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const r=Math.ceil(e);let a=Math.floor(t);a===t&&(a-=1),n=a-r+1}else{const r=Math.floor(e);let a=Math.ceil(t);a===t&&(a+=1),n=r-a+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const r=[];if(t<n){const a=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=a;s<=o;++s)r.push(oe(e.coordinates,s))}else{const a=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=a;s>=o;--s)r.push(oe(e.coordinates,s))}r.length&&this.appendCoordinates(r)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const s=e.map.getPixelFromCoordinate(t.startCoord);if(ge(s,e.pixel)<this.snapTolerance_)return}const n=Cn(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const s=t.targets[n.index];this.addTracedCoordinates_(s,s.startIndex,n.endIndex)}else{const s=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(s,n.endIndex)}t.targetIndex=n.index;const r=t.targets[t.targetIndex];r.endIndex=n.endIndex;const a=pe(r.coordinates,r.endIndex),o=this.getMap().getPixelFromCoordinate(a);e.coordinate=a,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,r=t[0]-n[0],a=t[1]-n[1],o=r*r+a*a;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let r=!1,a=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")r=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const s=this.sketchCoords_;r=s[0].length>this.minPoints_,a=[s[0][0],s[0][s[0].length-2]],t?a=[s[0][0]]:a=[s[0][0],s[0][s[0].length-2]]}if(r){const s=this.getMap();for(let l=0,d=a.length;l<d;l++){const c=a[l],u=s.getPixelFromCoordinate(c),h=e[0]-u[0],g=e[1]-u[1],y=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(h*h+g*g)<=y,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Z(new ne(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Z);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new Te(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=$t(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Z(new Te(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new Ne(Ve.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),a=$t(this.geometryLayout_);let o,s;for(;e.length<a;)e.push(0);this.mode_==="Point"?s=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],s=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,s=o[o.length-1]),s[0]=e[0],s[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let r,a;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),a=this.sketchCoords_,a.length>=this.maxPoints_&&(this.freehand_?a.pop():r=!0),a.push(e.slice()),this.geometryFunction_(a,t,n)):o==="Polygon"&&(a=this.sketchCoords_[0],a.length>=this.maxPoints_&&(this.freehand_?a.pop():r=!0),a.push(e.slice()),r&&(this.finishCoordinate_=a[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),r=this.mode_;for(let a=0;a<e;++a){let o;if(r==="LineString"||r==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const s=this.finishCoordinate_.slice();o[o.length-1]=s,this.createOrUpdateSketchPoint_(s)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(r==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const s=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}s.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const n=e.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,r)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,r),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new en([t])):this.type_==="MultiLineString"?e.setGeometry(new kt([t])):this.type_==="MultiPolygon"&&e.setGeometry(new St([t])),this.dispatchEvent(new Ne(Ve.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Ne(Ve.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let r;if(t==="LineString"||t==="Circle")r=this.sketchCoords_;else if(t==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&r.shift(),r.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const a=e[e.length-1];this.sketchFeature_=this.addToDrawing_(a),this.modifyDrawing_(a)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Z(new ne(n)),this.updateSketchFeatures_(),this.dispatchEvent(new Ne(Ve.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Co(){const i=Lt();return function(e,t){return i[e.getGeometry().getType()]}}function ko(i){switch(i){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+i)}}const Nt=0,Ee=1,zt=[0,0,0,0],_e=[],dt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function ct(i,e,t){let n;switch(e){case"LineString":n=i;break;case"MultiLineString":case"Polygon":n=i[t[0]];break;case"MultiPolygon":n=i[t[1]][t[0]];break}return n}class ut extends $e{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class So extends Ct{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:ti,this.defaultDeleteCondition_=function(n){return ni(n)&&Xt(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:fe,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ii,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ye({source:new Ae({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Lo(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new me(this.source_.getFeatures()),this.source_.addEventListener(Mt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Mt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(he.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(he.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=fe:t=e:t=qe,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(_t.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new me;const n=this.featuresBeingModified_.getArray();for(let r=0,a=t.length;r<a;++r){const o=t[r].feature;o&&!n.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ut(dt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(_t.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(r){e===r.feature&&n.push(r)});for(let r=n.length-1;r>=0;--r){const a=n[r];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===a&&this.dragSegments_.splice(o,1);t.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),r={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let r=0,a=n.length;r<a;++r){const o=n[r],s={feature:e,geometry:t,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(t.getExtent(),s)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let r=0,a=n.length-1;r<a;++r){const o=n.slice(r,r+2),s={feature:e,geometry:t,index:r,segment:o};this.rBush_.insert(U(o),s)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let r=0,a=n.length;r<a;++r){const o=n[r];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[r],index:s,segment:d};this.rBush_.insert(U(d),c)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let r=0,a=n.length;r<a;++r){const o=n[r];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[r],index:s,segment:d};this.rBush_.insert(U(d),c)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let r=0,a=n.length;r<a;++r){const o=n[r];for(let s=0,l=o.length;s<l;++s){const d=o[s];for(let c=0,u=d.length-1;c<u;++c){const h=d.slice(c,c+2),g={feature:e,geometry:t,depth:[s,r],index:c,segment:h};this.rBush_.insert(U(h),g)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),r={feature:e,geometry:t,index:Nt,segment:[n,n]},a={feature:e,geometry:t,index:Ee,segment:[n,n]},o=[r,a];r.featureSegments=o,a.featureSegments=o,this.rBush_.insert(ot(n),r);let s=t;this.rBush_.insert(s.getExtent(),a)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let r=0;r<n.length;++r){const a=n[r],o=this.SEGMENT_WRITERS_[a.getType()];o(e,a)}}createOrUpdateVertexFeature_(e,t,n,r){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Z(new ne(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",t),a.set("geometries",n),a.set("existing",r),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==W.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=W.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==W.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const t=[],n=this.vertexFeature_.getGeometry().getCoordinates(),r=U([n]),a=this.rBush_.getInExtent(r),o={};a.sort(wo);for(let s=0,l=a.length;s<l;++s){const d=a[s],c=d.segment;let u=j(d.geometry);const h=d.depth;if(h&&(u+="-"+h.join("-")),o[u]||(o[u]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===Ee){const g=Ht(e,d);Y(g,n)&&!o[u][0]&&(this.dragSegments_.push([d,0]),o[u][0]=d);continue}if(Y(c[0],n)&&!o[u][0]){this.dragSegments_.push([d,0]),o[u][0]=d;continue}if(Y(c[1],n)&&!o[u][1]){if(o[u][0]&&o[u][0].index===0){let g=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[h[1]];case"Polygon":if(d.index!==g[h[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[u][1]=d;continue}j(c)in this.vertexSegments_&&!o[u][0]&&!o[u][1]&&t.push(d)}return t}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const a=e.map.getPixelFromCoordinate(t.startCoord);if(ge(a,e.pixel)<this.pixelTolerance_)return}const n=Cn(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(n.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const o=t.targets[t.targetIndex];this.removeTracedCoordinates_(o.startIndex,o.endIndex)}else for(const o of this.traceSegments_){const s=o[0],l=s.geometry,d=o[1],c=l.getCoordinates();ct(c,l.getType(),s.depth).splice(s.index+d,1),l.setCoordinates(c),d===0&&(s.index-=1)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const r=t.targets[t.targetIndex];r.endIndex=n.endIndex}getTraceCandidates_(e){const t=this.getMap(),n=this.pixelTolerance_,r=t.getCoordinateFromPixel([e.pixel[0]-n,e.pixel[1]+n]),a=t.getCoordinateFromPixel([e.pixel[0]+n,e.pixel[1]-n]),o=U([r,a]);return this.traceSource_.getFeaturesInExtent(o)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const n=kn(e.coordinate,t);n.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:n,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,r=e.startIndex<=t;n===r?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const r=Math.ceil(e);let a=Math.floor(t);a===t&&(a-=1),n=a-r+1}else{const r=Math.floor(e);let a=Math.ceil(t);a===t&&(a+=1),n=r-a+1}if(n>0)for(const r of this.traceSegments_){const a=r[0],o=a.geometry,s=r[1];let l=r[0].index+1;s===1&&(l-=n);const d=o.getCoordinates();ct(d,o.getType(),a.depth).splice(l,n),o.setCoordinates(d),s===1&&(a.index-=n)}}addTracedCoordinates_(e,t,n){if(t===n)return;const r=[];if(t<n){const a=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=a;s<=o;++s)r.push(oe(e.coordinates,s))}else{const a=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=a;s>=o;--s)r.push(oe(e.coordinates,s))}if(r.length)for(const a of this.traceSegments_){const o=a[0],s=o.geometry,l=a[1],d=o.index+1;l===0&&r.reverse();const c=s.getCoordinates();ct(c,s.getType(),o.depth).splice(d,0,...r),s.setCoordinates(c),l===1&&(o.index+=r.length)}}updateGeometry_(e,t){const n=t[0],r=n.depth;let a;const o=n.segment,s=n.geometry,l=t[1];for(;e.length<s.getStride();)e.push(o[l][e.length]);switch(s.getType()){case"Point":a=e,o[0]=e,o[1]=e;break;case"MultiPoint":a=s.getCoordinates(),a[n.index]=e,o[0]=e,o[1]=e;break;case"LineString":a=s.getCoordinates(),a[n.index+l]=e,o[l]=e;break;case"MultiLineString":a=s.getCoordinates(),a[r[0]][n.index+l]=e,o[l]=e;break;case"Polygon":a=s.getCoordinates(),a[r[0]][n.index+l]=e,o[l]=e;break;case"MultiPolygon":a=s.getCoordinates(),a[r[1]][r[0]][n.index+l]=e,o[l]=e;break;case"Circle":const d=s;if(o[0]=e,o[1]=e,n.index===Nt)this.changingFeature_=!0,d.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let c=ge(V(d.getCenter()),V(e));d.setRadius(c),this.changingFeature_=!1}break}a&&this.setGeometryCoordinates_(s,a)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],r=[],a=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(a){this.traceSegments_=[];for(const o of this.dragSegments_){const s=o[0];ge(tn(a,s.segment),a)/e.map.getView().getResolution()<1&&this.traceSegments_.push(o)}}for(let o=0,s=this.dragSegments_.length;o<s;++o){const l=this.dragSegments_[o],d=l[0],c=d.feature;n.includes(c)||n.push(c);const u=d.geometry;r.includes(u)||r.push(u),this.updateGeometry_(t,l)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,n,r,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(t);if(n?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){const r=this.vertexFeature_.getGeometry().getCoordinates();for(let a=n.length-1;a>=0;--a)this.insertVertex_(n[a],r);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],r=n.geometry;if(r.getType()==="Circle"){const a=r,o=a.getCenter(),s=n.featureSegments[0],l=n.featureSegments[1];s.segment[0]=o,s.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update(ot(o),s);let d=a;this.rBush_.update(d.getExtent(),l)}else this.rBush_.update(U(n.segment),n)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new ut(dt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),n=t.getPixelFromCoordinate(e);t.getView().getProjection();const r=function(s,l){return Ut(e,s)-Ut(e,l)};let a,o;if(this.hitDetection_){const s=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(n,(l,d,c)=>{c&&c.getType()==="Point"&&(c=new ne(Ye(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof Z&&this.features_.getArray().includes(l)){o=u;const h=l.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:l,geometry:o,segment:[h,h]}]}return!0},{layerFilter:s})}if(!a){const s=ri(ot(e,zt)),l=t.getView().getResolution()*this.pixelTolerance_,d=ai(oi(s,l,zt));a=this.rBush_.getInExtent(d)}if(a&&a.length>0){const s=a.sort(r)[0],l=s.segment;let d=Ht(e,s);const c=t.getPixelFromCoordinate(d);let u=ge(n,c);if(o||u<=this.pixelTolerance_){const h={};if(h[j(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),s.geometry.getType()==="Circle"&&s.index===Ee)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);else{const g=t.getPixelFromCoordinate(l[0]),y=t.getPixelFromCoordinate(l[1]),C=Je(c,g),T=Je(c,y);if(u=Math.sqrt(Math.min(C,T)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=C>T?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);const v={};v[j(s.geometry)]=!0;for(let b=1,I=a.length;b<I;++b){const E=a[b].segment;if(Y(l[0],E[0])&&Y(l[1],E[1])||Y(l[0],E[1])&&Y(l[1],E[0])){const x=j(a[b].geometry);x in v||(v[x]=!0,h[j(E)]=!0)}else break}}this.vertexSegments_=h;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,r=e.feature,a=e.geometry,o=e.depth,s=e.index;let l;for(;t.length<a.getStride();)t.push(0);switch(a.getType()){case"MultiLineString":l=a.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"Polygon":l=a.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"MultiPolygon":l=a.getCoordinates(),l[o[1]][o[0]].splice(s+1,0,t);break;case"LineString":l=a.getCoordinates(),l.splice(s+1,0,t);break;default:return!1}this.setGeometryCoordinates_(a,l);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(a,s,o,1);const c={segment:[n[0],t],feature:r,geometry:a,depth:o,index:s};d.insert(U(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,n[1]],feature:r,geometry:a,depth:o,index:s+1};return d.insert(U(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?Ye(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(U([e])).some(({segment:t})=>Y(t[0],e)||Y(t[1],e))}removePoint(e){if(e&&(e=V(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=W.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([r])=>r));const n=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ut(dt.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,n}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,r,a,o,s,l,d,c,u,h,g,y;for(l=e.length-1;l>=0;--l)o=e[l],g=o[0],y=j(g.feature),g.depth&&(y+="-"+g.depth.join("-")),y in t||(t[y]={}),o[1]===0?(t[y].right=g,t[y].index=g.index):o[1]==1&&(t[y].left=g,t[y].index=g.index+1);for(y in t){switch(h=t[y].right,c=t[y].left,d=t[y].index,u=d-1,c!==void 0?g=c:g=h,u<0&&(u=0),s=g.geometry,a=s.getCoordinates(),r=a,n=!1,s.getType()){case"MultiLineString":a[g.depth[0]].length>2&&(a[g.depth[0]].splice(d,1),n=!0);break;case"LineString":a.length>2&&(a.splice(d,1),n=!0);break;case"MultiPolygon":r=r[g.depth[1]];case"Polygon":r=r[g.depth[0]],r.length>4&&(d==r.length-1&&(d=0),r.splice(d,1),n=!0,d===0&&(r.pop(),r.push(r[0]),u=r.length-1));break}if(n){this.setGeometryCoordinates_(s,a);const C=[];if(c!==void 0&&(this.rBush_.remove(c),C.push(c.segment[0])),h!==void 0&&(this.rBush_.remove(h),C.push(h.segment[1])),c!==void 0&&h!==void 0){const T={depth:g.depth,feature:g.feature,geometry:g.geometry,index:u,segment:C};this.rBush_.insert(U(T.segment),T)}this.updateSegmentIndices_(s,d,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(U([e])).some(({segment:t})=>!(Y(t[0],e)||Y(t[1],e)))}insertPoint(e){const t=e?V(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,r)=>n||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,r){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(n===void 0||a.depth===void 0||si(a.depth,n))&&a.index>t&&(a.index+=r)})}}function wo(i,e){return i.index-e.index}function Ut(i,e,t){const n=e.geometry;if(n.getType()==="Circle"){let a=n;if(e.index===Ee){const o=Je(a.getCenter(),V(i)),s=Math.sqrt(o)-a.getRadius();return s*s}}const r=V(i);return _e[0]=V(e.segment[0]),_e[1]=V(e.segment[1]),yi(r,_e)}function Ht(i,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===Ee)return Ye(n.getClosestPoint(V(i)));const r=V(i);return _e[0]=V(e.segment[0]),_e[1]=V(e.segment[1]),Ye(tn(r,_e))}function Lo(){const i=Lt();return function(e,t){return i.Point}}const ze={SELECT:"select"};class Ue extends $e{constructor(e,t,n,r){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=r}}const He={};class Ft extends Yn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Xt,this.addCondition_=e.addCondition?e.addCondition:qe,this.removeCondition_=e.removeCondition?e.removeCondition:qe,this.toggleCondition_=e.toggleCondition?e.toggleCondition:ft,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Pe,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:To(),this.features_=e.features||new me;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(r){return n.includes(r)}}else t=Pe;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[j(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[j(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(he.ADD,this.boundAddFeature_),this.features_.addEventListener(he.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(he.ADD,this.boundAddFeature_),this.features_.removeEventListener(he.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.findLayerOfFeature_(t);n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(t){if(t instanceof ye&&t.getSource()&&t.getSource().hasFeature(e))return t})}getStyle(){return this.style_}applySelectedStyle_(e){const t=j(e);t in He||(He[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){const a=t[r];if(a!==this&&a instanceof Ft&&a.getStyle()&&a.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(a.getStyle());return}}const n=j(e);e.setStyle(He[n]),delete He[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[j(e)]}selectFeatureInternal_(e,t,n){if(!(e instanceof Z)||!this.filter_(e,t))return;const r=this.getFeatures();return r.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),r.push(e),n?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const n=this.selectFeatureInternal_(e,t);return n&&this.dispatchEvent(new Ue(ze.SELECT,[n],[],void 0)),!!n}removeFeatureInternal_(e,t){const n=this.getFeatures();if(!(!(e instanceof Z)||!n.getArray().includes(e)))return n.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new Ue(ze.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Kn(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new Ue(ze.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),r=this.toggleCondition_(e),a=!t&&!n&&!r,o=e.map,s=this.getFeatures(),l=[],d=[];if(a){let c=!1;o.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(c=!0,!!this.selectFeatureInternal_(u,h,d))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=s.getLength()-1;u>=0;--u){const h=s.item(u);(d.length>0&&!d.includes(h)||!c)&&this.removeFeatureInternal_(h,l)}}else o.forEachFeatureAtPixel(e.pixel,(c,u)=>{let h;if((n||r)&&(h=this.removeFeatureInternal_(c,l)),(t||r)&&!h&&(h=this.selectFeatureInternal_(c,u,d)),!!h)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(d.length>0||l.length>0)&&this.dispatchEvent(new Ue(ze.SELECT,d,l,e)),!0}}function To(){const i=Lt();return Rt(i.Polygon,i.LineString),Rt(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}const ht={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class gt extends $e{constructor(e,t,n,r,a){super(e),this.features=t,this.coordinate=n,this.startCoordinate=r,this.mapBrowserEvent=a}}class Io extends Ct{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(r){return n.includes(r)}}else t=Pe;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Pe,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:fe,this.lastFeature_=null,this.addChangeListener(Qt.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new me([this.lastFeature_]);return this.dispatchEvent(new gt(ht.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new me([this.lastFeature_]);return this.dispatchEvent(new gt(ht.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const n=V(t),r=V(this.lastCoordinate_),a=n[0]-r[0],o=n[1]-r[1],s=this.features_||new me([this.lastFeature_]);s.forEach(function(l){const d=l.getGeometry();d.translate(a,o),l.setGeometry(d)}),this.lastCoordinate_=t,this.dispatchEvent(new gt(ht.TRANSLATING,s,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(n,r)=>{if(!(!(n instanceof Z)||!this.filter_(n,r))&&!(this.features_&&!this.features_.getArray().includes(n)))return n},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const n=this.getActive();(!t||!n)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const Eo=(i,e,t)=>{if(t){const n=new DOMParser().parseFromString(t,"image/svg+xml");return n.querySelectorAll("[fill]").forEach(r=>{r.setAttribute("fill",i)}),n.querySelectorAll("[stroke]").forEach(r=>{r.setAttribute("stroke",e)}),n.querySelectorAll("path, circle, rect, polygon, ellipse").forEach(r=>{r.hasAttribute("fill")||r.setAttribute("fill",i),r.hasAttribute("stroke")||r.setAttribute("stroke",e)}),new XMLSerializer().serializeToString(n)}return`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="-1 -1 25 25"
  >
    <path
      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"
      fill="${i}"
      stroke="${e}"
      stroke-width="1"
    />
  </svg>
`},Po=({fill:i="#005CA9",stroke:e="#FFF",svg:t})=>{let n="";typeof i=="string"?n=i:"oklch"in i?n=`oklch(${i.oklch.l} ${i.oklch.c} ${i.oklch.h})`:"rgba"in i&&(n=`${i.rgba.r} ${i.rgba.g} ${i.rgba.b} ${i.rgba.a?i.rgba.a:""}`);let r="";return typeof e=="string"?r=e:"oklch"in e?r=`oklch(${e.oklch.l} ${e.oklch.c} ${e.oklch.h})`:"rgba"in e&&(r=`${e.rgba.r} ${e.rgba.g} ${e.rgba.b} ${e.rgba.a?e.rgba.a:""}`),new Ze({image:new Jn({src:`data:image/svg+xml;base64,${btoa(Eo(n,r,t))}`,scale:2,anchor:[.5,1]})})},Fo={Circle:Pt,LinearRing:li,LineString:Te,MultiLineString:kt,MultiPoint:en,MultiPolygon:St,Point:ne,Polygon:wt};function Ao(i,e,t,n){const r=new Fo[t](n);let a=di(r.getExtent());return(t==="Polygon"||t==="MultiPolygon")&&!r.intersectsCoordinate(a)&&(a=(r.getType()==="Polygon"?r.getInteriorPoint():r.getInteriorPoints()).getFirstCoordinate()),i===e?a:Jt(a,i,e)}async function Wt(i,e,t){if(!t)return!0;const n=await dn(e,t.layerId,i);return n===!0||typeof n=="symbol"&&t.onError!=="strict"?!0:(typeof n=="symbol"?(Le("error",()=>Ie(r=>r.boundaryError,{ns:"pins"})),console.error(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:39:3)
`,"Checking boundary layer failed.")):(Le("info",()=>Ie(r=>r.notInBoundary,{ns:"pins"})),console.info(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:43:3)
`,"Pin position outside of boundary layer:",i)),!1)}const $o=ce("plugins/pins",()=>{const i=X(),e=F(null),t=F(!1),n=w(()=>ie({minZoomLevel:0,movable:"none",toZoomLevel:0},i.configuration.pins||{})),r=w(()=>{if(!e.value)return null;const v=qn(e.value,i.configuration.epsg);return[v[1],v[0]]}),a=new ye({source:new Ae,style:Po(n.value.style||{})}),o=new Ft({layers:v=>v===a,style:null,condition:Zn}),s=new Io({condition:()=>i.map.getView().getZoom()>=n.value.minZoomLevel,layers:[a]});let l=null;function d(){i.map.addLayer(a),a.setZIndex(100),i.map.on("singleclick",async({coordinate:v})=>{await y(v)}),u(),h(),g()}function c(){const{map:v}=i;v.un("singleclick",async({coordinate:b})=>{await y(b)}),T(),v.removeLayer(a),v.removeInteraction(o),v.removeInteraction(s),l&&l()}function u(){const{coordinateSources:v}=n.value;v&&v.forEach(b=>{const I=i.getPluginStore(b.pluginName);I&&(l=Ke(()=>I[b.getterName],E=>{E&&E.type!=="reverse_geocoded"&&C(E.geometry.coordinates,!1,{epsg:E.epsg,type:E.geometry.type})}))})}function h(){const{initial:v}=n.value;if(v){const{coordinate:b,centerOn:I,epsg:E}=v;if(I){C(b,!1,{epsg:E||i.configuration.epsg,type:"Point"});return}C(b)}}function g(){o.on("select",({selected:b})=>{n.value.movable==="none"&&(document.body.style.cursor=b.length?"not-allowed":"")}),i.map.addInteraction(o);const{movable:v}=n.value;v==="drag"&&(s.on("translatestart",()=>t.value=!0),s.on("translateend",({features:b})=>{t.value=!1,b.forEach(async I=>{const E=I.getGeometry().getCoordinates(),x=await Wt(E,i.map,n.value.boundary)?E:e.value;x&&C(x)})}),i.map.addInteraction(s))}async function y(v){const b=i.map.getInteractions().getArray().some(x=>x instanceof xo&&(x._isMultiSelect||x._isDrawPlugin)||x instanceof So||x._isDeleteSelect),{minZoomLevel:I,movable:E}=n.value;(E==="drag"||E==="click")&&i.map.getView().getZoom()>=I&&!b&&await Wt(v,i.map,n.value.boundary)&&C(v)}function C(v,b=!0,I){T(),e.value=v,!b&&I&&(e.value=Ao(I.epsg,i.configuration.epsg,I.type,v),i.map.getView().setCenter(e.value),i.map.getView().setZoom(n.value.toZoomLevel)),a.getSource().addFeature(new Z({geometry:new ne(e.value),type:"point",name:"mapMarker",zIndex:100}))}function T(){a.getSource().clear()}return{coordinate:e,latLon:r,setupPlugin:d,teardownPlugin:c}}),Mo={boundaryError:"Die Überprüfung der Koordinate ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Diese Koordinate kann nicht gewählt werden."},Ro={boundaryError:"Validating the coordinate failed. Please try again later or contact an administrator if the issue persists.",notInBoundary:"It is not possible to select this coordinate."},Do=[{type:"de",resources:Mo},{type:"en",resources:Ro}],Oo="pins";function Bo(i){return{id:Oo,locales:Do,storeModule:$o,options:i}}const At="reverseGeocoder",Ln=ce("plugins/reverseGeocoder",()=>{const i=X(),e=w(()=>i.configuration[At]),t=F([]);function n(){for(const s of e.value.coordinateSources||[]){const l=s.plugin?i.getPluginStore(s.plugin):i;l&&t.value.push(Ke(()=>l[s.key],async d=>{d&&await o(d)},{immediate:!0}))}}function r(){t.value.forEach(s=>{s()})}function a(s,l){const d=s.plugin?i.getPluginStore(s.plugin):i;d&&(d[s.key]=l)}async function o(s){const l=$i();try{const d=await Mi(e.value.url,s);return e.value.addressTarget&&a(e.value.addressTarget,d),e.value.zoomTo&&i.map.getView().fit(new ne(s),{maxZoom:e.value.zoomTo,duration:400,easing:bi}),d}catch(d){return console.error(`@polar/polar(plugins/reverseGeocoder/store:102:5)
`,"Reverse geocoding failed:",d),null}finally{l()}}return{reverseGeocode:o,setupPlugin:n,teardownPlugin:r}});if(import.meta.vitest){const{expect:i,test:e,vi:t}=import.meta.vitest,{createPinia:n,setActivePinia:r}=await Ce(async()=>{const{createPinia:c,setActivePinia:u}=await import("./pinia-DUyRjEeU-Bx0oe4Nu.js");return{createPinia:c,setActivePinia:u}},__vite__mapDeps([0,1]),import.meta.url),{reactive:a}=await Ce(async()=>{const{reactive:c}=await import("./vue.runtime.esm-bundler-C248luej-D21vsmGc.js");return{reactive:c}},[],import.meta.url),o=await Ce(()=>import("./store-CFKHD9QO.js").then(c=>c.s),__vite__mapDeps([2,0,1,3]),import.meta.url),s=await Ce(()=>import("./reverseGeocode-DMu2C9hG-DVZwy0cG.js"),__vite__mapDeps([4,2,0,1,3]),import.meta.url),l=await Ce(()=>import("./indicateLoading-Cbfqd-o5-C8dP7e-w.js"),__vite__mapDeps([5,3,0,1]),import.meta.url),d=e.extend({reverseGeocodeUtil:[async({},c)=>{const u=t.spyOn(s,"reverseGeocode").mockResolvedValue(null);await c(u)},{auto:!0}],indicateLoading:[async({},c)=>{const u=t.spyOn(l,"indicateLoading").mockImplementation(()=>()=>{});await c(u)},{auto:!0}],coreStore:[async({},c)=>{const u=t.fn(),h=a({configuration:{[At]:{url:"https://wps.example",coordinateSources:[{key:"coordinateSource"}],addressTarget:{key:"addressTarget"},zoomTo:99}},map:{getView:()=>({fit:u})},coordinateSource:null,addressTarget:null});t.spyOn(o,"useCoreStore").mockReturnValue(h),await c(h)},{auto:!0}],store:[async({},c)=>{r(n());const u=Ln();u.setupPlugin(),await c(u),u.teardownPlugin()},{auto:!0}]});d("detects changes in coordinate sources",async({reverseGeocodeUtil:c,coreStore:u})=>{u.coordinateSource=[1,2],await new Promise(h=>setTimeout(h)),i(c).toHaveBeenCalledWith("https://wps.example",[1,2])}),d("passes geocoding result to address target",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const g=Symbol("feature");c.mockResolvedValueOnce(g),await h.reverseGeocode([3,4]),i(u.addressTarget).toBe(g)}),d("zooms to input coordinate",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const g=Symbol("feature");c.mockResolvedValueOnce(g),await h.reverseGeocode([3,4]),i(u.map.getView().fit).toHaveBeenCalledOnce()})}function Go(i){return{id:At,storeModule:Ln,options:i}}const Fe="zoom",rt=ce("plugins/zoom",()=>{const i=X(),e=w(()=>i.configuration[Fe]),t=w({get:()=>i.zoom,set:g=>{i.zoom=g}}),n=w(()=>i.configuration.options.map(g=>g.zoomLevel)),r=w(()=>Math.min(...n.value)),a=w(()=>Math.max(...n.value)),o=w(()=>i.zoom===r.value),s=w(()=>i.zoom===a.value),l=w(()=>e.value.showMobile||!i.hasSmallDisplay),d=w(()=>e.value.icons?.zoomIn??"kern-icon--zoom-in"),c=w(()=>e.value.icons?.zoomIn??"kern-icon--zoom-out"),u=w(()=>e.value.showZoomSlider),h=w(()=>e.value.renderType==="iconMenu"?"iconMenu":e.value.orientation??"horizontal");return{zoomLevel:t,minimumZoomLevel:r,minimumZoomLevelActive:o,maximumZoomLevel:a,maximumZoomLevelActive:s,zoomButtonsVisible:l,zoomSliderVisible:u,zoomInIcon:d,zoomOutIcon:c,renderType:h}}),Vo=N({__name:"ZoomButtons.ce",setup(i){const e=rt();return(t,n)=>(m(),S(q,null,[le(pt,{hint:t.$t(r=>r.zoomIn,{ns:f(Fe)}),icon:f(e).zoomInIcon,"tooltip-position":"left",disabled:f(e).maximumZoomLevelActive,class:"polar-plugin-zoom-icon-button",onClick:n[0]||(n[0]=r=>f(e).zoomLevel++)},null,8,["hint","icon","disabled"]),le(pt,{hint:t.$t(r=>r.zoomOut,{ns:f(Fe)}),icon:f(e).zoomOutIcon,"tooltip-position":"left",disabled:f(e).minimumZoomLevelActive,class:"polar-plugin-zoom-icon-button",onClick:n[1]||(n[1]=r=>f(e).zoomLevel--)},null,8,["hint","icon","disabled"])],64))}}),No=".polar-plugin-zoom-icon-button{&[data-v-430b8f62]{margin:var(--kern-metric-space-small)}&[data-v-430b8f62]:nth-child(n+2){margin-top:0}}.polar-plugin-icon-menu-list-item button{margin:0}",jt=B(Vo,[["styles",[No]],["__scopeId","data-v-430b8f62"]]),zo=["min","max","aria-label"],Uo=N({__name:"ZoomSlider.ce",setup(i){const e=rt();return(t,n)=>sn((m(),S("input",{"onUpdate:modelValue":n[0]||(n[0]=r=>f(e).zoomLevel=r),type:"range",min:f(e).minimumZoomLevel,max:f(e).maximumZoomLevel,step:1,"aria-label":t.$t(r=>r.slider,{ns:f(Fe)}),class:Me({vertical:f(e).renderType==="vertical"})},null,10,zo)),[[Ai,f(e).zoomLevel]])}}),Ho="input{&[data-v-e8b5dbc2]{margin:var(--kern-metric-space-small);width:12em}&.vertical[data-v-e8b5dbc2]{margin-left:var(--kern-metric-space-large);transform:translate(-50%) translateY(-50%) rotate(-90deg) translate(-50%)}}",Zt=B(Uo,[["styles",[Ho]],["__scopeId","data-v-e8b5dbc2"]]),Wo=N({__name:"ZoomUI.ce",setup(i){const e=rt();return(t,n)=>f(e).renderType==="iconMenu"?(m(),S(q,{key:0},[f(e).zoomButtonsVisible?(m(),$(jt,{key:0})):K("",!0),f(e).zoomSliderVisible?(m(),$(Zt,{key:1})):K("",!0)],64)):(m(),S("div",{key:1,class:Me({"polar-plugin-zoom-ui":!0,vertical:f(e).renderType==="vertical"})},[f(e).zoomButtonsVisible?(m(),$(jt,{key:0})):K("",!0),f(e).zoomSliderVisible?(m(),$(Zt,{key:1})):K("",!0)],2))}}),jo=".polar-plugin-zoom-ui{&[data-v-6393da72]{display:flex;flex-direction:row}&.vertical[data-v-6393da72]{flex-direction:column}}",Zo=B(Wo,[["styles",[jo]],["__scopeId","data-v-6393da72"]]),qo={zoomIn:"Reinzoomen",zoomOut:"Rauszoomen",slider:"Zoomstufe anpassen"},Jo={zoomIn:"Zoom in",zoomOut:"Zoom out",slider:"Change zoom level"},Yo=[{type:"de",resources:qo},{type:"en",resources:Jo}];function Ko(i={}){return{id:Fe,component:Zo,locales:Yo,storeModule:rt,options:i}}const Xo={style:{background:"#fff"}},Qo=et({__name:"EmptyComponent",setup(i){return(e,t)=>(nt(),tt("div",Xo,"HELLO THERE"))}}),es={class:"kern-btn kern-btn--tertiary",style:{"border-radius":"0.25rem","min-height":"2rem",width:"2rem"}},ts=et({__name:"MockAttributions.ce",setup(i){return(e,t)=>(nt(),tt("button",es,[...t[0]||(t[0]=[We("span",{class:"kern-icon kern-icon-fill--copyright",style:{color:"var(--kern-color-action-default)"}},null,-1)])]))}}),ns={style:{display:"flex",gap:"0.5rem"}},is=et({__name:"MockPointerPosition.ce",setup(i){return(e,t)=>(nt(),tt("div",ns,[...t[0]||(t[0]=[We("span",{class:"kern-icon kern-icon--fullscreen","aria-hidden":"true"},null,-1),We("span",{style:{display:"flex","align-items":"center"}},"9.9555 | 53.5479",-1),We("button",{class:"kern-btn kern-btn--tertiary",style:{"min-height":"1rem","font-size":"1.125rem","text-decoration-line":"underline","text-underline-offset":"2px","text-underline-position":"from-font",color:"#1a3da5"}}," EPSG:4326 ",-1)])]))}}),Tn=[{id:"23420",name:"basemap.de Web Raster Farbe",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_farbe",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"23421",name:"basemap.de Web Raster Grau",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_grau",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"1454",name:"Ausgleichsflächen",url:"https://geodienste.hamburg.de/HH_WFS_Ausgleichsflaechen",typ:"WFS",featureType:"ausgleichsflaechen",outputFormat:"XML",version:"1.1.0",featureNS:"https://registry.gdi-de.org/id/de.hh.up",featurePrefix:"de.hh.up",legendURL:""},{id:"6059",name:"MML Anliegen",url:"https://geodienste.hamburg.de/lgv-config/anliegen_extern.json",typ:"GeoJSON",format:"XML",version:"1.0",minScale:"0",maxScale:"2500000",legendURL:"",urlIsVisible:!0},{id:"denkmaelerWMS",name:"Denkmal WMS",url:"https://efi2-deegree.schleswig-holstein.de/dish-deegree/services/wms_shp",typ:"WMS",layers:"0,1,2,3,4,6,24,25",legendURL:"ignore",format:"image/png",version:"1.3.0",transparent:!0}],rs="data:application/json;base64,WwoJewoJCSJzdHlsZUlkIjogInBhbmRhIiwKCQkicnVsZXMiOiBbCgkJCXsKCQkJCSJzdHlsZSI6IHsKCQkJCQkicG9seWdvblN0cm9rZUNvbG9yIjogWzMsIDI1NSwgMSwgMV0sCgkJCQkJInBvbHlnb25GaWxsSGF0Y2giOiB7CgkJCQkJCSJiYWNrZ3JvdW5kQ29sb3IiOiBbMCwgMCwgMCwgMC4yNV0sCgkJCQkJCSJwYXR0ZXJuIjogImRpYWdvbmFsLXJpZ2h0IiwKCQkJCQkJInBhdHRlcm5Db2xvciI6IFszLCAyNTUsIDEsIDFdCgkJCQkJfQoJCQkJfQoJCQl9CgkJXQoJfQpdCg==",as={style:{background:"#fff"}},os=et({__name:"YetAnotherEmptyComponent",setup(i){return(e,t)=>(nt(),tt("div",as,"Awesome"))}}),In="23420",ss="23421",ls="1454",qt="6059",ds="denkmaelerWMS",En="1693";let we="light";const z=await xi("snowbox",{colorScheme:we,startCenter:[573364,6028874],layers:[{id:In,visibility:!0,type:"background",name:"Basemap.de (Farbe)"},{id:ss,type:"background",name:"Basemap.de (Grau)",maxZoom:6},{id:En,visibility:!0,hideInMenu:!0,type:"mask",name:"meldemichel.layers.hamburgBorder"},{id:qt,type:"mask",name:"Anliegen (MML)",visibility:!1},{id:ls,type:"mask",name:"Ausgleichsflächen",styleId:"panda",visibility:!0,minZoom:5},{id:ds,type:"mask",name:"Kulturdenkmale",visibility:!0,options:{layers:{order:"6,24,25,4,3,2,1,0",title:{6:"Denkmalbereich",24:"Mehrheit von baulichen Anlagen",25:"Sachgesamtheit",4:"Baudenkmal",3:"Gründenkmal",2:"Gewässer",1:"Baudenkmal (Fläche)",0:"Gründenkmal (Fläche)"},legend:!0}}}],layout:"standard",checkServiceAvailability:!0,featureStyles:rs,markers:{layers:[{id:qt,defaultStyle:{stroke:"#FFFFFF",fill:"#005CA9"},hoverStyle:{stroke:"#46688E",fill:"#8BA1B8"},selectionStyle:{stroke:"#FFFFFF",fill:"#E10019"},unselectableStyle:{stroke:"#FFFFFF",fill:"#333333"}}],clusterClickZoom:!0},locales:[{type:"de",resources:{fullscreen:{button:{label_on:"Mach groß",label_off:"Mach klein"}},iconMenu:{hints:{attributions:"LMAO",fullscreen:"BEEEEEG YOSHEEEEE"}}}}],scale:{showScaleSwitcher:!0}},Tn);document.getElementById("secondMap").addEventListener("click",async()=>{const i=Ci({startCenter:[573364,6028874],layers:[{id:In,visibility:!0,type:"background",name:"snowbox.layers.basemap"}]},Tn);i.classList.add("snowbox"),document.getElementById("secondMapContainer").appendChild(i),ae(i,an({layoutTag:"TOP_RIGHT"}))});document.getElementById("secondMapClean").addEventListener("click",()=>{document.getElementById("secondMapContainer").innerText=""});ae(z,on({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"}));setTimeout(()=>{ki(z,"toast")},3e3);setTimeout(()=>{ae(z,on({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"})),Tt(z,"toast").addToast({text:"Sechs Sekunden",severity:"info"})},6e3);ae(z,bo({loaderStyle:"BasicLoader"}));ae(z,Bo({boundary:{layerId:En},movable:"drag",style:{fill:"#FF0019"},toZoomLevel:7}));ae(z,Go({url:"https://geodienste.hamburg.de/HH_WPS",coordinateSources:[{plugin:"pins",key:"coordinate"}],addressTarget:{plugin:"addressSearch",key:"selectResult"},zoomTo:7}));ae(z,wi({displayComponent:!0,layoutTag:"TOP_RIGHT",initiallyOpen:"layerChooser",focusMenus:[{plugin:{component:os,id:"attributions",locales:[]},icon:"kern-icon--near-me"}],menus:[[],[{plugin:cr({checkLocationInitially:!1,keepCentered:!1,showTooltip:!0,zoomLevel:7})}],[{plugin:{component:Qo,id:"realKewl",locales:[]},icon:"kern-icon-fill--share"}],[{plugin:Va({})},{plugin:an({})}]]}));ae(z,Ko({showZoomSlider:!0,orientation:"vertical"}));ae(z,Ui({leftEntries:[{id:"mockPointer",component:is}],rightEntries:[Li({}),{id:"mockAttributions",component:ts}]}));const Pn=Tt(z,"toast");Pn.addToast({text:"Hallo Welt",severity:"info"});Pn.addToast({text:"Achtung! Dies ist ein Toast!",severity:"error"});const Fn=Tt(z,"loadingIndicator");Fn.addLoadingKey("loadingTest");setTimeout(()=>Fn.removeLoadingKey("loadingTest"),2e3);Si(z,"core","selectedCoordinates",i=>document.getElementById("selected-feature-coordinates").innerText=JSON.stringify(i));document.getElementById("language-switcher").addEventListener("change",i=>{const e=i.target,{value:t}=e;rn(z,"core","language",t),e[0].innerHTML=t==="en"?"English":"Englisch",e[1].innerHTML=t==="en"?"German":"Deutsch"});document.getElementById("color-scheme-switcher").addEventListener("click",({target:i})=>{i.innerHTML=`Switch to ${we} mode`,we=we==="light"?"dark":"light",rn(z,"core","colorScheme",we)});
