const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pinia-B2ywJL3t-CKqFnMG3.js","./vue.runtime.esm-bundler-D9Sv99E9-CFvmjqF-.js","./store-CCqDS0ZX.js","./index-DJ32tg1M-CqRWHqlS.js","./reverseGeocode-DMu2C9hG-Dnf25j7O.js","./indicateLoading-BmtjuhTR-DAc6gDQ6.js"])))=>i.map(i=>d[i]);
import{a2 as G,a3 as pn,a4 as Ae,a5 as St,a6 as Mt,a7 as lr,a8 as _e,a9 as Lt,aa as fn,ab as Z,ac as dr,ad as Me,ae as mn,af as Ot,ag as Rt,ah as Ze,ai as cr,aj as xe,ak as we,al as ur,am as hr,an as gr,ao as yn,ap as Dt,aq as vn,ar as Gt,as as R,at as b,au as ft,av as F,aw as _n,ax as N,ay as fe,az as Bt,aA as Y,aB as re,aC as B,aD as It,aE as pr,aF as fr,aG as mr,aH as yr,aI as bn,aJ as vr,aK as _r,aL as Te,G as at,I as ot,J as st,L as Oe,_ as br,aM as kr,aN as xr,aO as he,aP as Cr,Q as lt,X as wr,aQ as kn,U as xn,T as Cn,S as Sr,R as Lr}from"./runtime-core.esm-bundler-DM86bEki.js";import{ref as P,markRaw as Kt,defineComponent as j,createElementBlock as C,openBlock as m,createElementVNode as x,Fragment as M,renderList as X,unref as v,createBlock as O,resolveDynamicComponent as Tt,computed as L,normalizeClass as Se,renderSlot as Nt,watch as q,onScopeDispose as Qe,nextTick as wn,createCommentVNode as z,withCtx as oe,normalizeProps as Ir,mergeProps as Tr,toDisplayString as A,createVNode as pe,createTextVNode as et,mergeModels as Sn,useModel as Ln,isRef as Jt,onMounted as Fr,withDirectives as $r,vModelDynamic as Pr}from"./vue.runtime.esm-bundler-D9Sv99E9-CFvmjqF-.js";import{defineStore as ie,storeToRefs as ne}from"./pinia-B2ywJL3t-CKqFnMG3.js";import{C as H,bN as se,cb as de,cd as ge,bQ as $e,bA as W,bB as tt,c4 as Re,f as In,m as Er,bh as le,q as dt,l as Vt,g as Ce,cR as Ar,bu as Mr,cW as Or,cU as Rr,cX as Dr,cs as Gr,cS as Br,bv as Ne,bs as Nr,bt as Be,cj as V,cY as nt,I as Ft,c as K,cZ as me,c_ as Yt,b3 as ct,aT as Vr,bH as jr,R as Ur,Y as Wr,c$ as Hr,d0 as zr,d1 as jt,d2 as qr,bg as Tn,B as Kr,D as Xt,N as Jr,W as Yr,G as Xr,d3 as Zr,cc as Qr,d4 as Zt,d5 as ei,k as ti,c5 as be,r as Q,ch as ye,ax as ni,d6 as ri,am as Qt,d7 as mt,d8 as te,d9 as Fn,ci as rt,t as ii,da as ai,a2 as oi,av as si,bG as li,X as di,y as en,db as ci,by as ui}from"./index-DJ32tg1M-CqRWHqlS.js";import"./store-CCqDS0ZX.js";import{indicateLoading as hi}from"./indicateLoading-BmtjuhTR-DAc6gDQ6.js";import{reverseGeocode as gi}from"./reverseGeocode-DMu2C9hG-Dnf25j7O.js";const $n=ie("plugins/footer",()=>{const r=H(),e=P([]),t=P([]);function n(){e.value=(r.configuration.footer?.leftEntries||[]).filter(({id:a})=>{const o=r.configuration[a]?.displayComponent;return typeof o=="boolean"?o:!0}),t.value=(r.configuration.footer?.rightEntries||[]).filter(({id:a})=>{const o=r.configuration[a]?.displayComponent;return typeof o=="boolean"?o:!0}),e.value.concat(t.value).forEach(a=>{r.addPlugin(se(a,{independent:!1}))}),e.value.map(a=>se(a,{component:Kt(a.component)})),t.value.map(a=>se(a,{component:Kt(a.component)}))}function i(){}return{leftEntries:e,rightEntries:t,setupPlugin:n,teardownPlugin:i}}),pi={class:"polar-plugin-footer-wrapper"},fi=j({__name:"PolarFooter.ce",setup(r){const{leftEntries:e,rightEntries:t}=ne($n());return(n,i)=>(m(),C("div",pi,[x("ul",null,[(m(!0),C(M,null,X(v(e),(a,o)=>(m(),C("li",{key:o},[(m(),O(Tt(a.component)))]))),128))]),x("ul",null,[(m(!0),C(M,null,X(v(t),(a,o)=>(m(),C("li",{key:o},[(m(),O(Tt(a.component)))]))),128))])]))}}),mi=".polar-plugin-footer-wrapper{&[data-v-9004f27e]{position:absolute;bottom:0;display:flex;width:100%;height:var(--kern-metric-dimension-large);padding:var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-small);justify-content:space-between;align-items:center;flex-shrink:0;background:var(--kern-color-layout-background-hued);box-shadow:0 1px 1px #35395629,0 1px 2px #35395640,0 1px 6px #6e759740;border-radius:0 0 var(--kern-metric-border-radius-large) var(--kern-metric-border-radius-large)}ul{&[data-v-9004f27e]{display:flex;align-items:center;gap:var(--kern-metric-space-small);padding:0}li[data-v-9004f27e]{list-style:none}}}",yi=G(fi,[["styles",[mi]],["__scopeId","data-v-9004f27e"]]),vi={},_i={},bi=[{type:"de",resources:vi},{type:"en",resources:_i}],ki="footer";function xi(r){return{id:ki,component:yi,locales:bi,storeModule:$n,options:r}}const Ci=100,wi=100,yt={undefinedBoundaryLayer:Symbol.for("Boundary Layer undefined"),undefinedBoundarySource:Symbol.for("Boundary Source undefined"),sourceNotReady:Symbol.for("Source not ready")};async function Si(r){let e=0;for(;r.getState()!=="ready"||r.getFeatures().length===0;)if(e++<Ci)await new Promise(t=>{setTimeout(t,wi)});else return!1;return!0}async function Pn(r,e,t){if(typeof e>"u")return!0;const n=r.getLayers().getArray().find(a=>a.get("id")===e);if(!(n instanceof de))return console.error(`@polar/polar(lib/passesBoundaryCheck:61:3)
`,`No layer configured to match boundaryLayerId "${e}".`),yt.undefinedBoundaryLayer;const i=n.getSource();return i instanceof ge?await Si(i)?i.getFeatures().some(a=>a.getGeometry()?.intersectsCoordinate(t)):(console.error(`@polar/polar(lib/passesBoundaryCheck:79:3)
`,`Layer with boundaryLayerId "${e}" did not load or is featureless.`),yt.sourceNotReady):(console.error(`@polar/polar(lib/passesBoundaryCheck:70:3)
`,`Layer with boundaryLayerId "${e}" missing source.`),yt.undefinedBoundarySource)}function $t(){}const Li=(r,e)=>()=>r.innerHTML=e.map(([t,n,i={}])=>`<${t}>${$e.t(n,i)}</${t}>`).join(""),Ii=`
	background: rgba(255, 255, 255, 0.8);
	padding: 0.2em 0.5em;
	border-radius: 4px;
	color: #16161d;
	box-shadow: 0px 0px 3px 2px rgba(0, 0, 0, 0.5);
`;function En(r,e=Ii){const t=document.createElement("div");t.style.cssText=e;const n=Li(t,r);return $e.on("languageChanged",n),$e.store.on("added",n),n(),{element:t,unregister:()=>{$e.off("languageChanges",n),$e.store.off("added",n)}}}const E={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Ti={ERROR:"error"};let Fi=class extends Ne{constructor(e){super(Ti.ERROR),this.code=e.code,this.message=e.message}},$i=class extends Mr{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Or,this.watchId_=void 0,this.addChangeListener(E.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(E.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Rr(tt("EPSG:4326"),e),this.position_&&this.set(E.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(E.ACCURACY,t.accuracy),this.set(E.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(E.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(E.HEADING,t.heading===null?void 0:Dr(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(E.POSITION,n.slice()),this.set(E.SPEED,t.speed===null?void 0:t.speed);const i=Gr(this.position_,t.accuracy);i.applyTransform(this.transform_),this.set(E.ACCURACY_GEOMETRY,i),this.changed()}positionError_(e){this.dispatchEvent(new Fi(e))}getAccuracy(){return this.get(E.ACCURACY)}getAccuracyGeometry(){return this.get(E.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(E.ALTITUDE)}getAltitudeAccuracy(){return this.get(E.ALTITUDE_ACCURACY)}getHeading(){return this.get(E.HEADING)}getPosition(){return this.get(E.POSITION)}getProjection(){return this.get(E.PROJECTION)}getSpeed(){return this.get(E.SPEED)}getTracking(){return this.get(E.TRACKING)}getTrackingOptions(){return this.get(E.TRACKING_OPTIONS)}setProjection(e){this.set(E.PROJECTION,tt(e))}setTracking(e){this.set(E.TRACKING,e)}setTrackingOptions(e){this.set(E.TRACKING_OPTIONS,e)}};function Pi(){return navigator.permissions.query({name:"geolocation"}).then(({state:r})=>r==="denied").catch(()=>!1)}function Ei(r,e){const t=e/2*Math.sqrt(3),n=document.createElement("canvas").getContext("2d").createLinearGradient(0,-t,Math.sin(r),t+Math.cos(r));return n.addColorStop(0,"#0794FAFF"),n.addColorStop(2/3,"#0794FA00"),n}function Ai(r){if(typeof r.get("heading")>"u")return new Ce;const e=42,t=Math.PI-r.get("heading");return new Ce({image:new Br({points:3,radius:e,rotation:t,fill:new dt({color:Ei(t,e)}),displacement:[0,-30]})})}function Mi(){const r=new dt({color:"#0078D4"}),e=new Vt({color:"#FFFFFF",width:2});return t=>[Ai(t),new Ce({image:new Ar({fill:r,stroke:e,radius:12}),fill:r,stroke:e})]}const Oi=(r,e)=>r[0]!==e[0]||r[1]!==e[1],An=ie("plugins/geoLocation",()=>{const r=H(),e=P(!1),t=P(null),n=P(null),i=P([]),a=L(()=>se({showTooltip:!1,zoomLevel:7},r.configuration.geoLocation||{})),o=L(()=>a.value.boundary),s=L(()=>e.value?"DISABLED":t.value===null?"LOCATABLE":"LOCATED"),l=new W({type:"point",name:"geoLocationMarker"}),d=new de({source:new ge({features:[l]}),properties:{name:"geoLocationMarkerLayer"},zIndex:1/0,style:Mi()});function c(){r.map.addLayer(d),a.value.checkLocationInitially?p():Pi().then(w=>e.value=w),h()}function u(){r.map.removeLayer(d),y(),$(),g()}let g=$t;function h(){if(a.value.showTooltip){const{unregister:w,element:T}=En([["h2","markerText",{ns:"geoLocation"}]]),U=new pn({element:T,positioning:"bottom-center",offset:[0,-5]});r.map.addOverlay(U);const ae=({pixel:Ie,dragging:ar})=>{if(ar)return;const or=r.map.getFeaturesAtPixel(Ie,{layerFilter:sr=>sr.get("name")==="geoLocationMarkerLayer"}).length?r.map.getCoordinateFromPixel(Ie):void 0;U.setPosition(or)};r.map.on("pointermove",ae),g=()=>{w(),r.map.removeOverlay(U),r.map.un("pointermove",ae),g=$t}}}function f(){(s.value==="LOCATABLE"?p:y)()}function p(){if(e.value){_({message:"Geolocation API usage was denied by user or configuration."});return}t.value===null?t.value=new $i({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:tt("EPSG:4326")}):k(),t.value.on("change:position",k),t.value.on("change:heading",({target:w})=>{l.set("heading",w.getHeading())}),t.value.on("error",_)}function _(w){Ae("error",Re(T=>T.button.locationAccessDenied,{ns:"geoLocation"})),console.error(`@polar/polar(plugins/geoLocation/store:176:3)
`,w.message),e.value=!0,$()}function y(){t.value?.setTracking(!1),$(),t.value=null}async function k(){const w=In(t.value?.getPosition(),tt("EPSG:4326"),r.configuration.epsg),T=r.configuration.extent?Er(r.configuration.extent,w):!0,U=await Pn(r.map,o.value?.layerId,w),ae=n.value!==U;n.value=U;const Ie=typeof U=="symbol"&&o.value?.onError==="strict";if(!T||Ie){I(Ie),y();return}Oi(i.value,w)&&(S(w),ae&&!U&&I(!1))}function S(w){i.value=w;const T=!!l.getGeometry();l.setGeometry(new le(w)),(a.value.keepCentered||!T)&&n.value&&(r.map.getView().setCenter(w),r.map.getView().setZoom(a.value.zoomLevel))}function $(){l.setGeometry(void 0),i.value=[]}function I(w){if(w){const U=Re(ae=>ae.toast.boundaryError,{ns:"geoLocation"});Ae("error",U),console.error(`@polar/polar(plugins/geoLocation/store:264:4)
`,U);return}const T=Re(U=>U.toast.notInBoundary,{ns:"geoLocation"});Ae("info",T,{timeout:1e4}),console.info(`@polar/polar(plugins/geoLocation/store:272:3)
`,T)}return{setupPlugin:c,teardownPlugin:u,locate:f,configuration:a,isGeolocationDenied:e,state:s,position:i,boundaryCheck:n}}),Mn="geoLocation",Ri=j({__name:"GeoLocation.ce",setup(r){const{layout:e}=ne(H()),t=An(),{state:n}=ne(t),i=L(()=>n.value==="LOCATED"?"kern-icon-fill--near-me":n.value==="LOCATABLE"?"kern-icon--near-me":"kern-icon--near-me-disabled"),a=L(()=>t.configuration.renderType==="iconMenu"?void 0:e.value==="standard"||t.configuration.layoutTag?.includes("RIGHT")?"left":"right");return(o,s)=>(m(),O(St,{class:Se(v(e)==="nineRegions"?"polar-plugin-geoLocation-nineRegions":""),hint:o.$t(l=>l.button.tooltip,{ns:v(Mn)}),icon:i.value,"tooltip-position":a.value,disabled:v(n)==="DISABLED",onClick:v(t).locate},null,8,["class","hint","icon","tooltip-position","disabled","onClick"]))}}),Di=".polar-plugin-geoLocation-nineRegions[data-v-45fc3e3e]{margin:var(--kern-metric-space-small)}",Gi=G(Ri,[["styles",[Di]],["__scopeId","data-v-45fc3e3e"]]),Bi={markerText:"Aktuelle Position",button:{locationAccessDenied:"Standortzugriff nutzerseitig abgelehnt",tooltip:"Eigene Position markieren"},toast:{boundaryError:"Die Überprüfung Ihrer Position ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Sie befinden sich nicht im Kartengebiet."}},Ni={markerText:"Current location",button:{locationAccessDenied:"Location access denied by user",tooltip:"Mark own location"},toast:{boundaryError:"Validating your position failed. Please try later again or contact an administrator if the issue persists.",notInBoundary:"You are not within the map's boundaries."}},Vi=[{type:"de",resources:Bi},{type:"en",resources:Ni}];function ji(r){return{id:Mn,component:Gi,locales:Vi,storeModule:An,options:r}}const Ui={class:"kern-card kern-card--small"},Wi={class:"kern-card__container"},Hi=j({__name:"PolarCard.ce",setup(r){return(e,t)=>(m(),C("article",Ui,[x("div",Wi,[Nt(e.$slots,"default",{},void 0,!0)])]))}}),zi=".kern-card{&[data-v-6728745d]{height:inherit;min-width:25rem;border-radius:var(--kern-metric-border-radius-large);box-shadow:var(--polar-shadow)}.kern-card__container[data-v-6728745d]{padding:var(--kern-metric-space-small);padding-bottom:.625rem}}",ut=G(Hi,[["styles",[zi]],["__scopeId","data-v-6728745d"]]);let Ut=class On extends Vr{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new On(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,i){const a=this.flatCoordinates,o=e-a[0],s=t-a[1],l=o*o+s*s;if(l<i){if(l===0)for(let d=0;d<this.stride;++d)n[d]=a[d];else{const d=this.getRadius()/Math.sqrt(l);n[0]=a[0]+d*o,n[1]=a[1]+d*s;for(let c=2;c<this.stride;++c)n[c]=a[c]}return n.length=this.stride,l}return i}containsXY(e,t){const n=this.flatCoordinates,i=e-n[0],a=t-n[1];return i*i+a*a<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return jr(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Ur(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:Wr(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+n;for(let a=1;a<t;++a)i[t+a]=e[a];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const i=this.flatCoordinates;let a=Hr(i,0,e,this.stride);i[a++]=i[0]+t;for(let o=1,s=this.stride;o<s;++o)i[a++]=i[o];i.length=a,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),i=this.getStride();this.setCenter(zr(n,0,n.length,i,e,t,n)),this.changed()}};Ut.prototype.transform;function ue(r,e){const t=r.length;return e<0?r[e+t]:e>=t?r[e-t]:r[e]}function ve(r,e){const t=r.length;let n=Math.floor(e);const i=e-n;n>=t?n-=t:n<0&&(n+=t);let a=n+1;a>=t&&(a-=t);const o=r[n],s=o[0],l=o[1],d=r[a],c=d[0]-s,u=d[1]-l;return[s+c*i,l+u*i]}const je={index:-1,endIndex:NaN,closestTargetDistance:1/0};function Rn(r,e,t,n){const i=r[0],a=r[1];let o=1/0,s=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const g=e.targets[u],h=g.coordinates;let f=1/0,p;for(let _=0;_<h.length-1;++_){const y=h[_],k=h[_+1],S=Bn(i,a,y,k);S.squaredDistance<f&&(f=S.squaredDistance,p=_+S.along)}f<o&&(o=f,g.ring&&e.targetIndex===u&&(g.endIndex>g.startIndex?p<g.startIndex&&(p+=h.length):g.endIndex<g.startIndex&&p>g.startIndex&&(p-=h.length)),l=p,s=u)}const d=e.targets[s];let c=d.ring;if(e.targetIndex===s&&c){const u=ve(d.coordinates,l),g=t.getPixelFromCoordinate(u),h=t.getPixelFromCoordinate(e.startCoord);me(g,h)>n&&(c=!1)}if(c){const u=d.coordinates,g=u.length,h=d.startIndex,f=l;if(h<f){const p=He(u,h,f);He(u,h,f-g)<p&&(l-=g)}else{const p=He(u,h,f);He(u,h,f+g)<p&&(l+=g)}}return je.index=s,je.endIndex=l,je.closestTargetDistance=o,je}function Dn(r,e){const t=[];for(let n=0;n<e.length;++n){const i=e[n].getGeometry();Gn(r,i,t)}return t}function Gn(r,e,t){if(e instanceof Me){Ue(r,e.getCoordinates(),!1,t);return}if(e instanceof Ot){const n=e.getCoordinates();for(let i=0,a=n.length;i<a;++i)Ue(r,n[i],!1,t);return}if(e instanceof ct){const n=e.getCoordinates();for(let i=0,a=n.length;i<a;++i)Ue(r,n[i],!0,t);return}if(e instanceof Rt){const n=e.getCoordinates();for(let i=0,a=n.length;i<a;++i){const o=n[i];for(let s=0,l=o.length;s<l;++s)Ue(r,o[s],!0,t)}return}if(e instanceof cr){const n=e.getGeometries();for(let i=0;i<n.length;++i)Gn(r,n[i],t);return}}function Ue(r,e,t,n){const i=r[0],a=r[1];for(let o=0,s=e.length-1;o<s;++o){const l=e[o],d=e[o+1],c=Bn(i,a,l,d);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function We(r,e){return Tn(r[0],r[1],e[0],e[1])}function He(r,e,t){let n,i;e<t?(n=e,i=t):(n=t,i=e);const a=Math.ceil(n),o=Math.floor(i);if(a>o){const l=ve(r,n),d=ve(r,i);return We(l,d)}let s=0;if(n<a){const l=ve(r,n),d=ue(r,a);s+=We(l,d)}if(o<i){const l=ue(r,o),d=ve(r,i);s+=We(l,d)}for(let l=a;l<o-1;++l){const d=ue(r,l),c=ue(r,l+1);s+=We(d,c)}return s}const vt={along:0,squaredDistance:0};function Bn(r,e,t,n){const i=t[0],a=t[1],o=n[0],s=n[1],l=o-i,d=s-a;let c=0,u=i,g=a;return(l!==0||d!==0)&&(c=Kr(((r-i)*l+(e-a)*d)/(l*l+d*d),0,1),u+=l*c,g+=d*c),vt.along=c,vt.squaredDistance=qr(Tn(r,e,u,g),10),vt}const ze={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};let qe=class extends Ne{constructor(e,t){super(e),this.feature=t}};class Nn extends Mt{constructor(e){const t=e;t.stopDown||(t.stopDown=Nr),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Ji(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Be,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const i=this.mode_;if(i==="Circle")n=(a,o,s)=>{const l=o||new Ut([NaN,NaN]),d=V(a[0]),c=nt(d,V(a[a.length-1]));return l.setCenterAndRadius(d,Math.sqrt(c),this.geometryLayout_),l};else{let a;i==="Point"?a=le:i==="LineString"?a=Me:i==="Polygon"&&(a=ct),n=(o,s,l)=>(s?i==="Polygon"?o[0].length?s.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(o,this.geometryLayout_):s=new a(o,this.geometryLayout_),s)}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new de({source:new ge({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:qi(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:lr,this.freehandCondition_,e.freehand?this.freehandCondition_=_e:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Lt,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(fn.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=_e:t=e:t=Ze,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=_e:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:Lt}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===Ft.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Z.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Z.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===Z.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===Z.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Z.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Z.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new dr(Z.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),i=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),a=K([n,i]),o=this.traceSource_.getFeaturesInExtent(a);if(o.length===0)return;const s=Dn(e.coordinate,o);s.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,i=e.startIndex<=t;n===i?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const i=Math.ceil(e);let a=Math.floor(t);a===t&&(a-=1),n=a-i+1}else{const i=Math.floor(e);let a=Math.ceil(t);a===t&&(a+=1),n=i-a+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const i=[];if(t<n){const a=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=a;s<=o;++s)i.push(ue(e.coordinates,s))}else{const a=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=a;s>=o;--s)i.push(ue(e.coordinates,s))}i.length&&this.appendCoordinates(i)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const s=e.map.getPixelFromCoordinate(t.startCoord);if(me(s,e.pixel)<this.snapTolerance_)return}const n=Rn(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const s=t.targets[n.index];this.addTracedCoordinates_(s,s.startIndex,n.endIndex)}else{const s=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(s,n.endIndex)}t.targetIndex=n.index;const i=t.targets[t.targetIndex];i.endIndex=n.endIndex;const a=ve(i.coordinates,i.endIndex),o=this.getMap().getPixelFromCoordinate(a);e.coordinate=a,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const i=!this.finishCoordinate_;i&&this.startDrawing_(e.coordinate),!i&&this.freehand_?this.finishDrawing():!this.freehand_&&(!i||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,i=t[0]-n[0],a=t[1]-n[1],o=i*i+a*a;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let i=!1,a=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")i=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const s=this.sketchCoords_;i=s[0].length>this.minPoints_,a=[s[0][0],s[0][s[0].length-2]],t?a=[s[0][0]]:a=[s[0][0],s[0][s[0].length-2]]}if(i){const s=this.getMap();for(let l=0,d=a.length;l<d;l++){const c=a[l],u=s.getPixelFromCoordinate(c),g=e[0]-u[0],h=e[1]-u[1],f=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(g*g+h*h)<=f,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new W(new le(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new W);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new Me(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=Yt(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new W(new Me(this.sketchLineCoords_)));const i=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new W,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new qe(ze.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),i=t.getView().getProjection(),a=Yt(this.geometryLayout_);let o,s;for(;e.length<a;)e.push(0);this.mode_==="Point"?s=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],s=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,s=o[o.length-1]),s[0]=e[0],s[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,i),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let i,a;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),a=this.sketchCoords_,a.length>=this.maxPoints_&&(this.freehand_?a.pop():i=!0),a.push(e.slice()),this.geometryFunction_(a,t,n)):o==="Polygon"&&(a=this.sketchCoords_[0],a.length>=this.maxPoints_&&(this.freehand_?a.pop():i=!0),a.push(e.slice()),i&&(this.finishCoordinate_=a[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),i?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),i=this.mode_;for(let a=0;a<e;++a){let o;if(i==="LineString"||i==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const s=this.finishCoordinate_.slice();o[o.length-1]=s,this.createOrUpdateSketchPoint_(s)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(i==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const s=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}s.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const n=e.getGeometry(),i=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,i)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,i),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new mn([t])):this.type_==="MultiLineString"?e.setGeometry(new Ot([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Rt([t])),this.dispatchEvent(new qe(ze.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new qe(ze.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let i;if(t==="LineString"||t==="Circle")i=this.sketchCoords_;else if(t==="Polygon")i=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&i.shift(),i.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const a=e[e.length-1];this.sketchFeature_=this.addToDrawing_(a),this.modifyDrawing_(a)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new W(new le(n)),this.updateSketchFeatures_(),this.dispatchEvent(new qe(ze.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function qi(){const r=jt();return function(e,t){return r[e.getGeometry().getType()]}}function Ki(){return function(r,e,t){const n=K([r[0],r[r.length-1]].map(function(a){return V(a)})),i=[[Xt(n),Jr(n),Yr(n),Xr(n),Xt(n)]];return e?e.setCoordinates(i):e=new ct(i),e}}function Ji(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}function Pt(r){const e=H();return r.plugin?e.getPluginStore(r.plugin):e}function tn(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function nn(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const Yi="[object RegExp]",Xi="[object String]",Zi="[object Number]",Qi="[object Boolean]",rn="[object Arguments]",ea="[object Symbol]",ta="[object Date]",na="[object Map]",ra="[object Set]",ia="[object Array]",aa="[object Function]",oa="[object ArrayBuffer]",_t="[object Object]",sa="[object Error]",la="[object DataView]",da="[object Uint8Array]",ca="[object Uint8ClampedArray]",ua="[object Uint16Array]",ha="[object Uint32Array]",ga="[object BigUint64Array]",pa="[object Int8Array]",fa="[object Int16Array]",ma="[object Int32Array]",ya="[object BigInt64Array]",va="[object Float32Array]",_a="[object Float64Array]";function ba(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function ka(r,e,t){return Pe(r,e,void 0,void 0,void 0,void 0,t)}function Pe(r,e,t,n,i,a,o){const s=o(r,e,t,n,i,a);if(s!==void 0)return s;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return De(r,e,a,o)}return De(r,e,a,o)}function De(r,e,t,n){if(Object.is(r,e))return!0;let i=nn(r),a=nn(e);if(i===rn&&(i=_t),a===rn&&(a=_t),i!==a)return!1;switch(i){case Xi:return r.toString()===e.toString();case Zi:{const l=r.valueOf(),d=e.valueOf();return ba(l,d)}case Qi:case ta:case ea:return Object.is(r.valueOf(),e.valueOf());case Yi:return r.source===e.source&&r.flags===e.flags;case aa:return r===e}t=t??new Map;const o=t.get(r),s=t.get(e);if(o!=null&&s!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(i){case na:{if(r.size!==e.size)return!1;for(const[l,d]of r.entries())if(!e.has(l)||!Pe(d,e.get(l),l,r,e,t,n))return!1;return!0}case ra:{if(r.size!==e.size)return!1;const l=Array.from(r.values()),d=Array.from(e.values());for(let c=0;c<l.length;c++){const u=l[c],g=d.findIndex(h=>Pe(u,h,void 0,r,e,t,n));if(g===-1)return!1;d.splice(g,1)}return!0}case ia:case da:case ca:case ua:case ha:case ga:case pa:case fa:case ma:case ya:case va:case _a:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let l=0;l<r.length;l++)if(!Pe(r[l],e[l],l,r,e,t,n))return!1;return!0}case oa:return r.byteLength!==e.byteLength?!1:De(new Uint8Array(r),new Uint8Array(e),t,n);case la:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:De(new Uint8Array(r),new Uint8Array(e),t,n);case sa:return r.name===e.name&&r.message===e.message;case _t:{if(!(De(r.constructor,e.constructor,t,n)||Zt(r)&&Zt(e)))return!1;const l=[...Object.keys(r),...tn(r)],d=[...Object.keys(e),...tn(e)];if(l.length!==d.length)return!1;for(let c=0;c<l.length;c++){const u=l[c],g=r[u];if(!Object.hasOwn(e,u))return!1;const h=e[u];if(!Pe(g,h,u,r,e,t,n))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function xa(r,e){return ka(r,e,$t)}const ht=Dt;ht.prototype.writeFeatures;ht.prototype.writeFeaturesNode;function Ca(r){const{map:e,mode:t}=r,n={stopClick:!0,type:"Circle",style:new Ce({stroke:new Vt({color:"white",width:1.5}),fill:new dt({color:[255,255,255,.75]})}),freehandCondition:o=>o.type==="pointermove"?!1:o.type==="pointerup"?!0:ur(o),condition:()=>!1};t==="box"?n.geometryFunction=Ki():delete n.geometryFunction;const i=P(null),a=new Nn(n);return a.on("drawend",o=>i.value=o.feature.getGeometry()?.getExtent()??null),e.addInteraction(a),Qe(()=>{e.removeInteraction(a)}),{selection:i}}const Wt="gfi",wa=new xe,Sa=r=>r instanceof W&&r.get("features")?.length?r.get("features"):r,La=({map:r,coordinateOrExtent:e,layer:t})=>Promise.resolve((e.length===2?r.getFeaturesAtPixel(r.getPixelFromCoordinate(e),{layerFilter:n=>n===t}):t.getSource().getFeaturesInExtent(e).map(Sa).flat(1)).map(n=>n instanceof W?JSON.parse(wa.writeFeature(n)):!1).filter(n=>n)),Ia=(r,e)=>{const t=new Gt({version:e}),n=new xe;return t.readFeatures(r).map(i=>JSON.parse(n.writeFeature(i)))},Ta=({map:r,coordinateOrExtent:e,layerConfiguration:t,layerSpecification:n,mode:i})=>{if(e.length===4&&i!=="bboxDot")return Promise.reject(new Error(`Configuration error in requestGfiWfs.ts: mode must be "bboxDot" to be able to use an extent for gfi requests, but was "${i}".`));const{featureType:a,url:o,version:s}=n,{geometryName:l}=t,d=r.getView().getProjection().getCode(),c=s==="2.0.0"?"typeNames":"typename",u=new URL(o);if(u.searchParams.set("service","WFS"),u.searchParams.set("version",s),u.searchParams.set("request","GetFeature"),u.searchParams.set(c,a),u.searchParams.set("srsName",d),i==="bboxDot"){const g=e.length===2?[e[0]-.1,e[1]-.1,e[0]+.1,e[1]+.1]:e;u.searchParams.set("bbox",`${g.join(",")},${d}`)}else if(i==="intersects"){const g=`<gml:Point srsName="${d}"><gml:coordinates>${e[0]},${e[1]}</gml:coordinates></gml:Point>`;u.searchParams.set("FILTER",s==="2.0.0"?`<fes:Filter><fes:Intersects><fes:ValueReference>${l}</fes:ValueReference>`+g+"</fes:Intersects></fes:Filter>":`<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:Intersects><ogc:PropertyName>${l}</ogc:PropertyName>`+g+"</fes:Intersects></fes:Filter>")}else return Promise.reject(new Error(`Type error in requestGfiWfs.ts: mode must be "intersects" or "bboxDot", but was "${i}".`));return fetch(u,{method:"GET"}).then(g=>g.text()).then(g=>Ia(g,s))},an={GML:ht,GML2:vn,GML3:Dt,GML32:yn};function Fa(r){const e=r.split(`
`),t=[];let n;for(const i of e)if(!(i===""||i.startsWith("GetFeatureInfo results")||i.startsWith("Layer"))){if(i.startsWith("    ")){if(typeof n<"u"){const a=i.indexOf("="),[o,s]=[i.substring(0,a),i.substring(a+3,i.length-1)].map(l=>l.trim());n.set(o||"",s)}else console.error(`@polar/polar(plugins/gfi/utils/requestGfiWms:62:5)
`,"@polar/plugin-gfi: Found property before feature declaration in readTextFeatures.",i,"Skipping ...");continue}if(i.startsWith("  ")){if(i.includes("Search returned no results"))break;const a=i.substring(0,i.length-2).trim();n=new W,n.setId(a),t.push(n)}}return t}function $a(r){const e=r.includes('xmlns:gml="http://www.opengis.net/gml/3.2"')?yn:r.includes('xmlns:gml="http://www.opengis.net/gml"')?ht:r.includes('xmlns:gml="http://www.opengis.net/gml/2')?vn:Dt;return new Gt({gmlFormat:new e})}function Pa(r){if(an[r])return new Gt({gmlFormat:new an[r]});if(r==="text")return{readFeatures:Fa};throw new Error(`Format '${r}' not yet implemented in requestGfiWms.ts.`)}function Ea({map:r,layer:e,coordinate:t},{infoFormat:n}){const i=e.getSource(),a=r.getView(),o=i.getFeatureInfoUrl(t,a.getResolution(),a.getProjection(),{feature_count:10}),s=n&&typeof n=="string"?`&info_format=${n}`:"";return(o||"")+s}const Aa=r=>{const{coordinate:e,layerConfiguration:t,layerSpecification:n}=r,{filterBy:i,geometryName:a,format:o}=t,s=Ea(r,n);return fetch(s).then(l=>l.text()).then(l=>{const d=(n.infoFormat==="application/geojson"?new xe:o?Pa(o):$a(l)).readFeatures(l),c=new xe;return a&&d.forEach(u=>{u.setGeometryName("geometry")}),d.filter(u=>i==="clickPosition"?u.getGeometry()?.intersectsCoordinate(e):!0).map(u=>JSON.parse(c.writeFeature(u)))})};function Ma({map:r,layer:e,coordinateOrExtent:t,layerConfiguration:n,layerSpecification:i,mode:a}){const o=e.get("id");try{const s={map:r,layerConfiguration:n,layerSpecification:i};if(e instanceof hr||e instanceof gr)return t.length===2?Aa({...s,coordinate:t,layer:e}):Promise.reject(new Error(`An extent can not be used for ${o} as it is a WMS layer which only support coordinates for gfi requests.`));if(we.getLayerWhere({id:o})?.typ==="GeoJSON"&&e instanceof de)return La({...s,coordinateOrExtent:t,layer:e});if(e instanceof de)return Ta({...s,coordinateOrExtent:t,mode:a});const l=`Layer ${o} was neither a Tile- nor a VectorLayer. GFI not implemented.`;return Promise.reject(new Error(l))}catch{const s=`An error occurred while requesting features from layer with the id ${o}.`;return Promise.reject(new Error(s))}}function Oa({pixel:r,dragging:e,originalEvent:t,map:n},i,a){if(e||"pointerType"in t&&["touch","pen"].includes(t.pointerType))return null;let o=!1,s=null;return n.forEachFeatureAtPixel(r,(l,d)=>{if(!(l instanceof W))return!1;o=!0,i.setPosition(n.getCoordinateFromPixel(r)),s&&s();let c;return{element:c,unregister:s}=En(a[d.get("id")]?.(l)),i.setElement(c),!0},{layerFilter:l=>Object.keys(a).includes(l.get("id"))}),o||i.setPosition(void 0),s}function Ra(){const r=new de({source:new ge({features:[]})});return r.set("polarInternalId","pluginGfiFeatureDisplay"),r.setZIndex(90),r.set("styleId","defaultHighlightFeaturesPoint"),r}function Vn(r){return r instanceof ge}function Da(r){const e=r.getSource();Vn(e)&&e.clear()}function Ga(r,e){const t=e.getSource();Vn(t)&&t.addFeature(new xe().readFeature(r))}function Ba(r){const{map:e,style:t,features:n}=r,i=Ra();return e.addLayer(i),Qe(()=>{e.removeLayer(i)}),q(t,a=>{i.setStyle(a)},{immediate:!0}),q(n,a=>{Da(i),a.forEach(o=>{Ga(o,i)})},{immediate:!0,deep:!0}),{}}const Na=new xe;function jn(r){return Na.writeFeatureObject(r)}const on={stroke:{color:"#003064",width:3},fill:{color:"rgb(255, 255, 255, 0.7)"}},Ht=ie("plugins/gfi/main",()=>{const r=H(),e=L(()=>r.configuration[Wt]);function t(s){return e.value.layers[s]}const n=P({}),i=P({});q(n,s=>{i.value=Object.fromEntries(Object.entries(s).map(([l,d])=>[l,d.map(c=>jn(c))]))},{immediate:!0,deep:!0});const a=L(()=>new Ce({stroke:new Vt(e.value.customHighlightStyle?.stroke||on.stroke),fill:new dt(e.value.customHighlightStyle?.fill||on.fill)})),o=L(()=>Object.entries(i.value).filter(([s])=>t(s)?.geometry??!0).flatMap(([,s])=>s));return Ba({map:r.map,style:a,features:o}),{configuration:e,getLayerConfiguration:t,selectedFeatures:n,featureInformation:i}}),Va=ie("plugins/gfi/feature",()=>{const r=H(),e=Ht();async function t(h,f={}){let p=Object.fromEntries((await Promise.all(Object.entries(e.configuration.layers).map(([_,y])=>({layerId:_,layerConfiguration:y,layer:r.getLayer(_)})).filter(_=>!!_.layer).map(async({layerId:_,layer:y,layerConfiguration:k})=>[_,(await Ma({coordinateOrExtent:h,layer:y,layerConfiguration:k,layerSpecification:we.getLayerWhere({id:_}),map:r.map,mode:r.configuration.layers.find(S=>S.id===_)?.gfiMode||e.configuration.mode||"bboxDot"})).filter(S=>!k.isSelectable||k.isSelectable(S)).slice(0,e.configuration.maxFeatures||Number.POSITIVE_INFINITY)]))).filter(_=>!!_));if(e.configuration.afterLoadFunction&&(p=e.configuration.afterLoadFunction(p)),f.toggleSelection){Object.entries(p).forEach(([_,y])=>{e.featureInformation[_]||(e.featureInformation[_]=[]);const k=e.featureInformation[_];y.forEach(S=>{const $=k.findIndex(I=>xa(I.properties,S.properties));$<0?k.push(S):k.splice($,1)})});return}e.featureInformation=p}for(const h of e.configuration.coordinateSources||[]){const f=h.plugin?r.getPluginStore(h.plugin):r;f&&q(()=>f[h.key],async p=>{p?await t(p):e.featureInformation={}},{immediate:!0})}if(e.configuration.multiSelect){const h=Ca({map:r.map,mode:e.configuration.multiSelect});q(h.selection,async f=>{f?await t(f):e.featureInformation={}})}if(e.configuration.directSelect){async function h({coordinate:f,originalEvent:p}){await t(f,{toggleSelection:navigator.userAgent.indexOf("Mac")!==-1?p.metaKey:p.ctrlKey})}r.map.on("click",h),Qe(()=>{r.map.un("click",h)})}const n=L(()=>Object.entries(e.featureInformation).filter(([h])=>e.configuration.layers[h]?.window).flatMap(([h,f])=>f.map(p=>({layerId:h,feature:p})))),i=P(0),a=L(()=>n.value[i.value]),o=L(()=>e.getLayerConfiguration(a.value?.layerId||"")),s=L(()=>o.value?.properties),l=L(()=>Object.fromEntries(Object.entries(a.value?.feature.properties||{}).filter(([h])=>!s.value||s.value.includes(h)).map(([h,f])=>[h,f]))),d=L(()=>o.value?.exportProperty),c=L(()=>d.value?a.value?.feature.properties?.[d.value]:null);q(n,()=>{i.value=0},{deep:!0});const u=new pn({positioning:"bottom-center",offset:[0,-5]});r.map.addOverlay(u);let g=null;return r.map.on("pointermove",h=>{g&&g(),g=Oa(h,u,Object.fromEntries(Object.entries(e.configuration.layers).filter(([,{showTooltip:f}])=>!!f).map(([f,{showTooltip:p}])=>[f,p])))}),Qe(()=>{g&&g(),r.map.removeOverlay(u)}),e.configuration.renderType==="iconMenu"&&wn(()=>{const h=r.getPluginStore("iconMenu");h&&q(a,f=>{f&&h.openMenuById(Wt)})}),{visibleFeatures:n,selectedFeatureIndex:i,selectedFeature:a,selectedFeatureProperties:l,exportProperty:c}});function ja(r){let e=r.getSource();if(!e)throw new Error("Could not find a vector source for this layer");for(;e instanceof Qr;)if(e=e.getSource(),!e)throw new Error("Could not find a vector source for this layer");if(!(e instanceof ge))throw new Error("Could not find a vector source for this layer");return e}function Ua(r,e,t){return t==="loaded"?e.getFeatures():e.getFeaturesInExtent(r.getView().calculateExtent(r.getSize()),r.getView().getProjection())}const Wa=ie("plugins/gfi/list",()=>{const r=H(),e=Ht(),t=P({}),{selectedFeatures:n}=ne(e),i=L(()=>e.configuration.featureList),a=L(()=>{if(!i.value)return[];const p=i.value.activeLayers,_=Pt(p);return _?_[p.key]:[]}),o=L(()=>(r.extent,Object.fromEntries(a.value.map(p=>({layerId:p,layerConfiguration:e.getLayerConfiguration(p),layer:r.getLayer(p)})).filter(p=>!!p.layerConfiguration&&!!p.layer).map(({layerId:p,layerConfiguration:_,layer:y})=>{const k=ja(y);return[p,Ua(r.map,k,i.value?.mode||"visible").filter(S=>Zr(S)).filter(S=>!_.isSelectable||_.isSelectable(jn(S))).map(S=>({feature:S,...i.value?.bindWithCoreHoverSelect?{hovered:r.hoveredFeature===S||r.hoveredFeature?.get("features")?.includes(S)}:{}}))]}).filter(p=>!!p))));q([()=>i.value?.bindWithCoreHoverSelect,()=>r.selectedFeature],([p,_])=>{p&&(_?n.value[_.get("_polarLayerId")]=_.get("features")||[_]:n.value={})},{immediate:!0,deep:!0}),q([()=>i.value?.bindWithCoreHoverSelect,()=>t.value],([p,_])=>{if(p){const y=Object.entries(_).flatMap(([k,S])=>S.map($=>({layerId:k,feature:$})));if(y.length<=0||!y[0]){r.hoveredFeature=null;return}y[0].feature.set("_polarLayerId",y[0].layerId),r.hoveredFeature=y[0].feature}},{immediate:!0,deep:!0}),q([()=>i.value?.bindWithCoreHoverSelect,()=>n.value],([p,_])=>{if(p){const y=Object.values(_).flat();if(y.length<=0){r.selectedFeature=null;return}r.selectedFeature=y[0]}},{immediate:!0,deep:!0});const s=L(()=>Object.entries(o.value).flatMap(([p,_])=>_.map(y=>({layerId:p,...y})))),l=P(0),d=L(()=>i.value?.pageLength??0),c=L(()=>typeof i.value?.pageLength=="number"),u=L({get:()=>c.value?l.value*d.value:0,set:p=>{l.value=c.value?Math.round(p/d.value):0}}),g=L(()=>c.value?u.value+d.value:void 0),h=L(()=>s.value.slice(u.value,g.value));function f(p,_){const y=i.value?.text?.[_];return typeof y=="string"?y:typeof y=="function"?y(p):null}return{features:o,hoveredFeatures:t,flatFeatures:s,paginationActive:c,pageLength:d,page:l,paginationStartIndex:u,paginationEndIndex:g,paginatedFeatures:h,getText:f}}),gt=ie("plugins/gfi",()=>{const r=Ht(),e=ne(r),t=Wa(),n=ne(t),i=Va(),a=ne(i);return{configuration:e.configuration,hoveredFeatures:n.hoveredFeatures,selectedFeatures:e.selectedFeatures,featureInformation:e.featureInformation,listFeatures:n.features,listFlatFeatures:n.flatFeatures,listPaginationActive:n.paginationActive,listPageLength:n.pageLength,listPage:n.page,listPaginationStartIndex:n.paginationStartIndex,listPaginationEndIndex:n.paginationEndIndex,listPaginatedFeatures:n.paginatedFeatures,listGetText:t.getText,features:a.visibleFeatures,featureIndex:a.selectedFeatureIndex,feature:a.selectedFeature,properties:a.selectedFeatureProperties,exportProperty:a.exportProperty}});function Ha(r){let e;try{e=new URL(r)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"}const za={style:{display:"flex",gap:"var(--kern-metric-space-default)"}},qa={class:"kern-table kern-table--striped"},Ka={class:"kern-table__head"},Ja={class:"kern-table__row"},Ya={scope:"col",class:"kern-table__header"},Xa={scope:"col",class:"kern-table__header"},Za={class:"kern-table__body"},Qa={class:"kern-table__cell"},eo={class:"kern-table__cell"},to=["href"],no=["src","alt","title","height"],ro=["href","title"],io=j({__name:"GfiFeature.ce",props:{layerId:{type:String},feature:{type:Object}},setup(r){const e=H(),t=gt(),n=r;function i(a){open(a)}return(a,o)=>(m(),C(M,null,[x("div",za,[pe(St,{hint:a.$t(s=>s.header.close,{ns:"gfi"}),icon:"kern-icon--close",onClick:o[0]||(o[0]=s=>v(t).selectedFeatures={})},null,8,["hint"]),pe(St,{hint:a.$t(s=>s.property.export,{ns:"gfi"}),icon:"kern-icon--download",onClick:o[1]||(o[1]=s=>i(v(t).exportProperty))},null,8,["hint"])]),x("table",qa,[x("thead",Ka,[x("tr",Ja,[x("th",Ya,A(a.$t(s=>s.header.field,{ns:"gfi"})),1),x("th",Xa,A(a.$t(s=>s.header.value,{ns:"gfi"})),1)])]),x("tbody",Za,[(m(!0),C(M,null,X(Object.entries(v(t).properties),([s,l])=>(m(),C("tr",{key:s,class:"kern-table__row"},[x("td",Qa,A(a.$t(d=>d.layer[n.layerId].property[s],{ns:"gfi",defaultValue:s})),1),x("td",eo,[v(Ha)(l)?(m(),C(M,{key:0},[["jpg","jpeg","png","gif","webp"].some(d=>l.endsWith(`.${d}`))?(m(),C("a",{key:0,href:l,target:"_blank"},[x("img",{src:l,alt:a.$t(d=>d.property.imageAlt,{ns:"gfi"}),title:a.$t(d=>d.property.linkTitle,{ns:"gfi"}),height:Math.min(200,v(e).clientHeight*.15),width:"auto"},null,8,no)],8,to)):(m(),C("a",{key:1,href:l,target:"_blank",title:a.$t(d=>d.property.linkTitle,{ns:"gfi"})},A(a.$t(d=>d.property.linkText,{ns:"gfi"})),9,ro))],64)):(m(),C(M,{key:1},[et(A(l),1)],64))])]))),128))])])],64))}}),ao="td[data-v-771b9270]{white-space:normal}",oo=G(io,[["styles",[ao]],["__scopeId","data-v-771b9270"]]),so=["aria-label"],lo=["disabled"],co={class:"kern-label kern-sr-only"},uo=["aria-label","onClick"],ho={class:"kern-label"},go=["disabled"],po={class:"kern-label kern-sr-only"},fo=j({__name:"KernPagination.ce",props:Sn({count:{type:Number},pageSize:{type:Number}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=Ln(r,"modelValue"),n=L({get:()=>t.value/e.pageSize+1,set:o=>{t.value=(o-1)*e.pageSize}}),i=L(()=>Math.ceil(e.count/e.pageSize));q([()=>e.count,()=>e.pageSize],()=>{n.value>i.value&&(t.value=0)});const a=L(()=>{const o=(s,l)=>new Array(l-s+1).fill(null).map((d,c)=>({page:c+s}));return i.value<=7?o(1,i.value):n.value<5?[...o(1,5),{dots:"only"},...o(i.value,i.value)]:n.value>i.value-4?[...o(1,1),{dots:"only"},...o(i.value-4,i.value)]:[...o(1,1),{dots:"only"},...o(n.value-1,n.value+1),{dots:"only"},...o(i.value,i.value)]});return(o,s)=>i.value>1?(m(),C("nav",{key:0,"aria-label":o.$t(l=>l.pagination.wrapper,{ns:"shared"})},[x("ul",null,[x("li",null,[x("button",{class:"kern-btn kern-btn--secondary",disabled:n.value<=1,onClick:s[0]||(s[0]=l=>n.value--)},[s[2]||(s[2]=x("span",{class:"kern-icon kern-icon--arrow-back"},null,-1)),x("span",co,A(o.$t(l=>l.pagination.previous,{ns:"shared"})),1)],8,lo)]),(m(!0),C(M,null,X(a.value,l=>(m(),C("li",{key:"dots"in l?l.dots:l.page},["dots"in l?(m(),C(M,{key:0},[et("…")],64)):l.page?(m(),C("button",{key:1,class:Se(["kern-btn kern-btn--secondary",{active:n.value===l.page}]),"aria-label":o.$t(d=>d.pagination.page,{ns:"shared",page:l.page}),onClick:d=>n.value=l.page},[x("span",ho,A(l.page),1)],10,uo)):z("",!0)]))),128)),x("li",null,[x("button",{class:"kern-btn kern-btn--secondary",disabled:n.value>=i.value,onClick:s[1]||(s[1]=l=>n.value++)},[s[3]||(s[3]=x("span",{class:"kern-icon kern-icon--arrow-forward"},null,-1)),x("span",po,A(o.$t(l=>l.pagination.next,{ns:"shared"})),1)],8,go)])])],8,so)):z("",!0)}}),mo="nav[data-v-03afd393]{width:100%}ul[data-v-03afd393]{width:100%;display:flex;list-style-type:none;padding:0;align-items:center;justify-content:space-between;gap:var(--kern-metric-space-x-small)}.kern-btn{&[data-v-03afd393]{padding:0;min-width:var(--kern-metric-dimension-large);min-height:calc(var(--kern-metric-dimension-large) + var(--kern-metric-dimension-2x-small))}&[data-v-03afd393]:has(.kern-sr-only){width:var(--kern-metric-dimension-large)}&.active{&[data-v-03afd393]{background-color:var(--kern-color-action-default);pointer-events:none}.kern-label[data-v-03afd393]{color:#fff}}.kern-label[data-v-03afd393]{font-size:var(--kern-typography-font-size-static-small);line-height:var(--kern-typography-line-height-static-small)}}",yo=G(fo,[["styles",[mo]],["__scopeId","data-v-03afd393"]]),vo={class:"kern-heading-medium"},_o=["onClick","onMouseenter"],bo={class:"kern-title kern-title--small"},ko=j({__name:"GfiFeatureList.ce",setup(r){const e=gt();return(t,n)=>(m(),C(M,null,[x("h2",vo,A(t.$t(i=>i.list.header,{ns:"gfi"})),1),v(e).listFlatFeatures.length===0?(m(),C(M,{key:0},[et(A(t.$t(i=>i.list.emptyView,{ns:"gfi"})),1)],64)):(m(),C(M,{key:1},[v(e).listPaginationActive?(m(),O(yo,{key:0,modelValue:v(e).listPaginationStartIndex,"onUpdate:modelValue":n[0]||(n[0]=i=>v(e).listPaginationStartIndex=i),count:v(e).listFlatFeatures.length,"page-size":v(e).listPageLength},null,8,["modelValue","count","page-size"])):z("",!0),(m(!0),C(M,null,X(v(e).listPaginatedFeatures,({layerId:i,feature:a,hovered:o},s)=>(m(),C("section",{key:s,tabindex:"0",class:Se({hovered:o}),onClick:l=>{v(e).selectedFeatures={[i]:[a]},v(e).hoveredFeatures={}},onMouseenter:l=>v(e).hoveredFeatures={[i]:[a]},onMouseleave:n[1]||(n[1]=l=>v(e).hoveredFeatures={})},[x("h2",bo,A(v(e).listGetText(a,"title")),1),et(" "+A(v(e).listGetText(a,"subtitle"))+" ",1),n[2]||(n[2]=x("br",null,null,-1)),x("em",null,A(v(e).listGetText(a,"subSubtitle")),1)],42,_o))),128))],64))],64))}}),xo="section{&[data-v-5b75ce3e]{width:100%;padding:var(--kern-metric-space-small);overflow:hidden;text-overflow:ellipsis;border-width:var(--kern-metric-border-width-default);border-style:dashed;border-color:transparent}&.hovered[data-v-5b75ce3e],&[data-v-5b75ce3e]:hover{border-radius:var(--kern-metric-border-radius-default);border-color:var(--kern-color-action-default);cursor:pointer}}",Co=G(ko,[["styles",[xo]],["__scopeId","data-v-5b75ce3e"]]),wo={class:"kern-label"},So={class:"kern-label"},Lo=j({__name:"GfiUI.ce",setup(r){const e=H(),t=gt();return(n,i)=>v(t).features.length>0||v(t).configuration.featureList?(m(),O(ut,{key:0,id:"polar-card-gfi",class:Se({standard:v(e).layout==="standard","nine-regions":v(e).layout==="nineRegions"})},{default:oe(()=>[v(t).features.length>0?(m(),C(M,{key:0},[v(t).feature?(m(),O(oo,Ir(Tr({key:0},v(t).feature)),null,16)):z("",!0),v(t).featureIndex>0?(m(),C("button",{key:1,class:"kern-btn kern-btn--block kern-btn--secondary",onClick:i[0]||(i[0]=a=>v(t).featureIndex--)},[i[2]||(i[2]=x("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),x("span",wo,A(n.$t(a=>a.switch.previous,{ns:"gfi"})),1)])):z("",!0),v(t).featureIndex+1<v(t).features.length?(m(),C("button",{key:2,class:"kern-btn kern-btn--block kern-btn--primary",onClick:i[1]||(i[1]=a=>v(t).featureIndex++)},[x("span",So,A(n.$t(a=>a.switch.next,{ns:"gfi"})),1),i[3]||(i[3]=x("span",{class:"kern-icon kern-icon--arrow-forward","aria-hidden":"true"},null,-1))])):z("",!0)],64)):v(t).configuration.featureList?(m(),O(Co,{key:1})):z("",!0)]),_:1},8,["class"])):z("",!0)}}),Io="#polar-card-gfi{&[data-v-da165ae8]{width:12em;margin:var(--kern-metric-space-small);max-height:80%;overflow:auto}&.standard[data-v-da165ae8]{position:absolute}&[data-v-da165ae8]::deep(.kern-card__container){width:100%;padding-bottom:var(--kern-metric-space-small)}}button[data-v-da165ae8]{margin-top:var(--kern-metric-space-small)}",To=G(Lo,[["styles",[Io]],["__scopeId","data-v-da165ae8"]]),Fo={header:{close:"Informationsfenster schließen",field:"Feld",value:"Wert"},property:{export:"Export als PDF",imageAlt:"Bitte entnehmen Sie Informationen zum Inhalt des Bildes aus den umliegenden Tabellenfeldern",linkTitle:"In neuem Tab öffnen",linkText:"Link"},switch:{previous:"Vorangehender Datensatz",next:"Nächster Datensatz"},noActiveLayer:"Derzeit ist kein Kartenmaterial mit passenden Objekten eingeschaltet.",list:{header:"Objektliste",entry:"Eintrag",to:"bis",of:"von",emptyView:"Im aktuellen Kartenausschnitt sind keine Objekte enthalten."}},$o={header:{close:"Close information window",field:"Field",value:"Value"},property:{export:"Export as a PDF document",imageAlt:"Please refer to the other table fields for further information about the topics of the displayed picture",linkTitle:"Open in a new tab",linkText:"Link"},switch:{previous:"Previous data",next:"Next data"},noActiveLayer:"Currently, no map layer with fitting objects is active.",list:{header:"Feature list",entry:"Entry",to:"to",of:"of",emptyView:"There are no features in the current view."}},Po=[{type:"de",resources:Fo},{type:"en",resources:$o}];function Eo(r){return{id:Wt,component:To,locales:Po,storeModule:gt,options:r,icon:"kern-icon--map-pin-heart"}}const D=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Ve(r){return pr(r[0].version,"1.3")>=0}const Ao=R(D,{Service:b(ts),Capability:b(es)}),Mo=R(D,{Request:b(cs),Exception:b(as),Layer:b(os),UserDefinedSymbolization:b(Zo)});let Oo=class extends fr{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),B({version:this.version},Ao,e,[])||null}};const Un={Name:b(F),Title:b(F),Abstract:b(F),KeywordList:b(Jn),OnlineResource:b(Bt),ContactInformation:b(ns),Fees:b(F),AccessConstraints:b(F)},Ro=R(D,Un),Do=R(D,{...Un,LayerLimit:b(ft),MaxWidth:b(ft),MaxHeight:b(ft)}),Go=R(D,{ContactPersonPrimary:b(rs),ContactPosition:b(F),ContactAddress:b(is),ContactVoiceTelephone:b(F),ContactFacsimileTelephone:b(F),ContactElectronicMailAddress:b(F)}),Bo=R(D,{ContactPerson:b(F),ContactOrganization:b(F)}),No=R(D,{AddressType:b(F),Address:b(F),City:b(F),StateOrProvince:b(F),PostCode:b(F),Country:b(F)}),Vo=R(D,{Format:_n(F)}),Wn={Name:b(F),Title:b(F),Abstract:b(F),KeywordList:b(Jn),BoundingBox:N(qn),Dimension:N(ss),Attribution:b(Xo),AuthorityURL:N(gs),Identifier:N(F),MetadataURL:N(ps),DataURL:N(ce),FeatureListURL:N(ce),Style:N(fs),Layer:N(pt)},Hn=R(D,{...Wn,SRS:N(F),Extent:b(ls),ScaleHint:N(ds),LatLonBoundingBox:b((r,e)=>qn(r,e,!1)),Layer:N(pt)}),zn=R(D,{...Wn,CRS:N(F),EX_GeographicBoundingBox:b(Qo),MinScaleDenominator:b(fe),MaxScaleDenominator:b(fe),Layer:N(pt)}),jo=R(D,{Title:b(F),OnlineResource:b(Bt),LogoURL:b(Kn)}),Uo=R(D,{westBoundLongitude:b(fe),eastBoundLongitude:b(fe),southBoundLatitude:b(fe),northBoundLatitude:b(fe)}),Wo=R(D,{GetCapabilities:b(Fe),GetMap:b(Fe),GetFeatureInfo:b(Fe),DescribeLayer:b(Fe),GetLegendGraphic:b(Fe)}),Ho=R(D,{Format:N(F),DCPType:N(us)}),zo=R(D,{HTTP:b(hs)}),qo=R(D,{Get:b(ce),Post:b(ce)}),Ko=R(D,{Name:b(F),Title:b(F),Abstract:b(F),LegendURL:N(Kn),StyleSheetURL:b(ce),StyleURL:b(ce)}),Jo=R(D,{Format:b(F),OnlineResource:b(Bt)}),Yo=R(D,{Keyword:_n(F)});function Xo(r,e){return B({},jo,r,e)}function Zo(r,e){return{SupportSLD:!!Y(r.getAttribute("SupportSLD")),UserLayer:!!Y(r.getAttribute("UserLayer")),UserStyle:!!Y(r.getAttribute("UserStyle")),RemoteWFS:!!Y(r.getAttribute("RemoteWFS")),InlineFeatureData:!!Y(r.getAttribute("InlineFeatureData")),RemoteWCS:!!Y(r.getAttribute("RemoteWCS"))}}function qn(r,e,t=!0){const n=[re(r.getAttribute("minx")),re(r.getAttribute("miny")),re(r.getAttribute("maxx")),re(r.getAttribute("maxy"))],i=[re(r.getAttribute("resx")),re(r.getAttribute("resy"))],a={extent:n,res:i};return t&&(Ve(e)?a.crs=r.getAttribute("CRS"):a.srs=r.getAttribute("SRS")),a}function Qo(r,e){const t=B({},Uo,r,e);if(!t)return;const n=t.westBoundLongitude,i=t.southBoundLatitude,a=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||i===void 0||a===void 0||o===void 0))return[n,i,a,o]}function es(r,e){return B({},Mo,r,e)}function ts(r,e){return B({},Ve(e)?Do:Ro,r,e)}function ns(r,e){return B({},Go,r,e)}function rs(r,e){return B({},Bo,r,e)}function is(r,e){return B({},No,r,e)}function as(r,e){return B([],Vo,r,e)}function os(r,e){const t=B({},Ve(e)?zn:Hn,r,e);return t.Layer===void 0?Object.assign(t,pt(r,e)):t}function pt(r,e){const t=Ve(e),n=e[e.length-1],i=B({},t?zn:Hn,r,e);if(!i)return;let a=Y(r.getAttribute("queryable"));a===void 0&&(a=n.queryable),i.queryable=a!==void 0?a:!1;let o=It(r.getAttribute("cascaded"));o===void 0&&(o=n.cascaded),i.cascaded=o;let s=Y(r.getAttribute("opaque"));s===void 0&&(s=n.opaque),i.opaque=s!==void 0?s:!1;let l=Y(r.getAttribute("noSubsets"));l===void 0&&(l=n.noSubsets),i.noSubsets=l!==void 0?l:!1;let d=re(r.getAttribute("fixedWidth"));d||(d=n.fixedWidth),i.fixedWidth=d;let c=re(r.getAttribute("fixedHeight"));c||(c=n.fixedHeight),i.fixedHeight=c;const u=["Style","AuthorityURL"];t?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(h){if(h in n){const f=i[h]||[];i[h]=f.concat(n[h])}});const g=["BoundingBox","Attribution"];return t?g.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):g.push("LatLonBoundingBox","ScaleHint","Extent"),g.forEach(function(h){if(!(h in i)){const f=n[h];i[h]=f}}),i}function ss(r,e){const t={name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol")};return Ve(e)&&Object.assign(t,{default:r.getAttribute("default"),multipleValues:Y(r.getAttribute("multipleValues")),nearestValue:Y(r.getAttribute("nearestValue")),current:Y(r.getAttribute("current")),values:F(r)}),t}function ls(r,e){return{name:r.getAttribute("name"),default:r.getAttribute("default"),nearestValue:Y(r.getAttribute("nearestValue"))}}function ds(r,e){return{min:re(r.getAttribute("min")),max:re(r.getAttribute("max"))}}function ce(r,e){return B({},Jo,r,e)}function cs(r,e){return B({},Wo,r,e)}function us(r,e){return B({},zo,r,e)}function hs(r,e){return B({},qo,r,e)}function Fe(r,e){return B({},Ho,r,e)}function Kn(r,e){const t=ce(r,e);if(t){const n=[It(r.getAttribute("width")),It(r.getAttribute("height"))];return t.size=n,t}}function gs(r,e){const t=ce(r,e);if(t)return t.name=r.getAttribute("name"),t}function ps(r,e){const t=ce(r,e);if(t)return t.type=r.getAttribute("type"),t}function fs(r,e){return B({},Ko,r,e)}function Jn(r,e){return B([],Yo,r,e)}function ms({legendURL:r,layers:e="",url:t,typ:n,format:i,version:a}){return r?r==="ignore"?[]:[r]:e.split(",").filter(o=>o).map(o=>`${t}?SERVICE=${n}&REQUEST=GetLegendGraphic&FORMAT=${i||"image/png"}&VERSION=${a}&LAYER=${o}`)}const sn=(r,e)=>r.filter(t=>{let{minZoom:n,maxZoom:i}=t;return typeof n>"u"&&(n=0),typeof i>"u"&&(i=Number.MAX_SAFE_INTEGER),n<=e&&e<=i});function it(r,e){if(Array.isArray(r))return r.map(t=>it(t,e)).find(t=>t!==null)||null;if(typeof r=="object"){if(r.Name===e)return r;if(r.Layer)return it(r.Layer,e)}return null}const ys=r=>(Array.isArray(r)?r:[r]).map(e=>(Array.isArray(e.LegendURL)?e.LegendURL:typeof e.LegendURL=="object"?[e.LegendURL]:[]).map(t=>t.OnlineResource)).flat(1);function vs(r,e){return it(r.Capability.Layer,e)?.Title||""}function _s(r,e){const t=it(r.Capability.Layer,e)?.Style;return t&&ys(t)[0]||""}function bs(r,e){const t=e[r];if(t)try{return new Oo().read(t)}catch(n){console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:21:4)
`,`Error reading xml '${t}' for id '${r}'.`,n)}return null}function ks(r,e){return Promise.all(r.map(async t=>{const{id:n}=t,i=t.options?.layers;if(i&&(i.title===!0||i.legend===!0)){if(typeof e[n]=="string")return console.warn(`@polar/polar(plugins/layerChooser/utils/capabilities:41:6)
`,`Re-fired loadCapabilities on id '${n}' albeit the GetCapabilities have already been successfully fetched. No re-fetch will occur.`),[n,null];const a=we.getLayerWhere({id:t.id});if(!a||!a.url||!a.version||!a.typ)return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:49:6)
`,`Missing data for service '${a}' with id '${n}'.`),[n,null];const o=`${a.url}?service=${a.typ}&version=${a.version}&request=GetCapabilities`;try{const s=await fetch(o);return[n,await s.text()]}catch(s){return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:61:6)
`,`Capabilities from ${o} could not be fetched.`,s),[n,null]}}return[n,null]})).then(t=>t.reduce((n,[i,a])=>se(n,{[i]:a}),{}))}function xs(r,e,t){const n=we.getLayerWhere({id:r}),i=bs(r,e);return{[r]:(t.order?.split(",")||n.layers.split(",")).map(a=>({layerName:a,displayName:t.title===!0&&i?vs(i,a):t.title===!1?a:t.title?.[a]||a,layerImage:t.legend===!0&&i?_s(i,a):t.legend===!1?null:t.legend?.[a]||null}))}}const Cs=r=>r.reduce(([e,t],n)=>we.getLayerWhere({id:n.id})===null?(console.error(`@polar/polar(plugins/layerChooser/utils/getBackgroundsAndMasks:15:5)
`,`Layer ${n.id} not found in service register. This is a configuration issue. The map might behave in unexpected ways.`,n),[e,t]):n.type==="background"?[[...e,n],t]:[e,[...t,n]],[[],[]]),ws=r=>r.map(({id:e,name:t})=>({id:e,name:t})).map(e=>se(e,{rawLayer:we.getLayerWhere({id:e.id})})).filter(({rawLayer:e})=>e!==null).reduce((e,t)=>{const n=ms(t.rawLayer)[0];return typeof n=="string"?{...e,[t.id]:{name:t.name,url:n}}:e},{}),Le=ie("plugins/layerChooser",()=>{const r=H(),e=P({}),t=P([]),n=P([]),i=P([]),a=P([]),o=P(""),s=P([]),l=P({}),d=P(""),c=P({}),u=P(""),g=L(()=>t.value.reduce((I,{id:w})=>({...I,[w]:i.value.findIndex(({id:T})=>T===w)===-1}),{})),h=L(()=>f.value.reduce((I,{id:w})=>({...I,[w]:a.value.findIndex(({id:T})=>T===w)===-1}),{})),f=L(()=>n.value.filter(({hideInMenu:I})=>!I)),p=L(()=>f.value.reduce((I,w)=>se(I,{[w.type]:Array.isArray(I[w.type])?I[w.type].concat(w):[w]}),{}));function _(){const[I,w]=Cs(r.configuration.layers);t.value=I,n.value=w,I.length===0&&console.error(`@polar/polar(plugins/layerChooser/store:100:4)
`,'No layers of type "background" have been configured.'),o.value=I.find(({visibility:T})=>T)?.id||"",s.value=w.filter(({visibility:T})=>T).map(({id:T})=>T),S(),r.map.on("moveend",S),l.value=ws(r.configuration.layers),ks(r.configuration.layers,e.value).then(T=>{e.value=T,r.configuration.layers.forEach(U=>{const ae=U.options?.layers;ae&&(c.value=se(c.value,xs(U.id,T,ae)))})})}function y(){r.map.un("moveend",S)}q(o,I=>{r.map.getLayers().getArray().forEach(w=>{t.value.find(({id:T})=>T===w.get("id"))&&w.setVisible(w.get("id")===I)})}),q(s,I=>{k(I)});function k(I){r.map.getLayers().getArray().forEach(w=>{n.value.find(({id:T})=>T===w.get("id"))&&w.setVisible(I.includes(w.get("id")))})}function S(){const I=r.map.getView().getZoom();i.value=sn(t.value,I),a.value=sn(n.value,I);const w=i.value.map(({id:T})=>T);w.includes(o.value)||(o.value=w[0]||""),k(a.value.map(({id:T})=>T).filter(T=>s.value.includes(T)))}function $(I){const w=r.map.getLayers().getArray().find(T=>T.get("id")===u.value).getSource();if(!w){console.error(`@polar/polar(plugins/layerChooser/store:208:4)
`,`Action 'toggleOpenedOptionsServiceLayer' failed on ${u.value}. Layer not found in OpenLayers or source not initialized in OpenLayers.`);return}w.updateParams({...w.getParams(),LAYERS:I})}return{activeBackgroundId:o,activeMaskIds:s,backgrounds:t,capabilities:e,disabledBackgrounds:g,disabledMasks:h,layersWithLegends:l,layersWithOptions:c,masksSeparatedByType:p,shownMasks:f,openedLegendId:d,openedOptionsId:u,setupPlugin:_,teardownPlugin:y,toggleOpenedOptionsServiceLayer:$}}),ee="layerChooser",Ss=["id"],Ls={class:"kern-label"},Yn=j({__name:"LayerInformationCard.ce",props:{identifier:{type:String},idName:{type:String}},setup(r){const e=r,t=H(),n=Le();Fr(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-back-button`)?.focus()});function i(){const a=n[e.idName];n[e.idName]="",wn(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-${a}-button`)?.focus()})}return(a,o)=>(m(),O(ut,null,{default:oe(()=>[x("button",{id:`polar-layer-chooser-${r.identifier}-back-button`,class:"kern-btn kern-btn--secondary",onClick:i},[o[0]||(o[0]=x("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),x("span",Ls,A(a.$t(s=>s.returnToLayers,{ns:v(ee)})),1)],8,Ss),Nt(a.$slots,"default")]),_:3}))}}),Is={class:"kern-label",for:"polar-layer-chooser-legend-anchor"},Ts=["href","aria-label"],Fs=["src","alt"],$s=j({__name:"LayerLegend.ce",setup(r){const e=Le(),t=L(()=>e.layersWithLegends[e.openedLegendId]);return(n,i)=>(m(),O(Yn,{identifier:"legend","id-name":"openedLegendId",class:"legend-card"},{default:oe(()=>[x("label",Is,A(n.$t(a=>a.legend.to,{name:t.value.name,ns:v(ee)})),1),x("a",{id:"polar-layer-chooser-legend-anchor",href:t.value.url,"aria-label":n.$t(a=>a.legend.to,{name:t.value.name,ns:v(ee)}),target:"_blank"},[x("img",{src:t.value.url,alt:n.$t(a=>a.legend.to,{name:t.value.name,ns:v(ee)})},null,8,Fs)],8,Ts)]),_:1}))}}),Ps=".legend-card[data-v-e248e19b]{overflow-y:scroll}",Es=G($s,[["styles",[Ps]],["__scopeId","data-v-e248e19b"]]),As={class:"kern-form-check"},Ms=["id","name","value","type","disabled"],Os=["for"],Rs=j({__name:"PolarInput.ce",props:Sn({idSuffix:{type:String},label:{type:String},type:{type:null},value:{type:String},disabled:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=Ln(r,"modelValue");return(t,n)=>(m(),C("div",As,[$r(x("input",{id:`polar-${r.type}-${r.value}-${r.idSuffix}`,"onUpdate:modelValue":n[0]||(n[0]=i=>e.value=i),class:Se(`polar-input kern-form-check__${r.type}`),name:r.value,value:r.value,type:r.type,disabled:r.disabled},null,10,Ms),[[Pr,e.value]]),x("label",{class:"polar-input kern-label",for:`polar-${r.type}-${r.value}-${r.idSuffix}`},A(r.label),9,Os)]))}}),Ds=".kern-form-check__radio[disabled],.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:hover{border:var(--kern-metric-border-width-default) solid var(--kern-color-form-input-border)}}.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:checked:hover:before{margin:var(--kern-metric-space-x-small)}}",Et=G(Rs,[["styles",[Ds]],["__scopeId","data-v-83635f17"]]),Gs={class:"kern-fieldset"},Bs={class:"kern-label"},Ns={class:"kern-fieldset__body"},Vs=j({__name:"PolarInputGroup.ce",props:{legend:{type:String}},setup(r){return(e,t)=>(m(),C("fieldset",Gs,[x("legend",Bs,A(r.legend),1),x("div",Ns,[Nt(e.$slots,"default",{},void 0,!0)])]))}}),js=".kern-fieldset[data-v-69d29a6c]{width:100%}.kern-fieldset__body[data-v-69d29a6c]{width:100%;padding:var(--kern-metric-space-small) 0;gap:var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);background-color:var(--kern-color-layout-background-hued)}.kern-label[data-v-69d29a6c]{padding-left:.75rem}[data-v-69d29a6c] .kern-form-check{align-items:center;gap:var(--kern-metric-space-large);margin-left:.75rem;padding-right:0}",At=G(Vs,[["styles",[js]],["__scopeId","data-v-69d29a6c"]]),Us=["src","alt"],Ws=j({__name:"LayerOptions.ce",setup(r){const e=H(),t=Le(),{openedOptionsId:n}=ne(t),i=L(()=>t.layersWithOptions[n.value]),a=P(i.value.map(({layerName:l})=>l).reverse()),o=L({get:()=>a.value,set:l=>{a.value=l,t.toggleOpenedOptionsServiceLayer(l)}}),s=L(()=>e.configuration.layers.find(({id:l})=>l===n.value)?.name||"");return(l,d)=>(m(),O(Yn,{identifier:"options","id-name":"openedOptionsId"},{default:oe(()=>[pe(At,{legend:l.$t(c=>c.layerHeader,{ns:v(ee),name:s.value})},{default:oe(()=>[(m(!0),C(M,null,X(i.value,({displayName:c,layerImage:u,layerName:g})=>(m(),C("div",{key:`polar-layer-chooser-mask-options-checkbox-${g}`,class:"polar-layer-chooser-options-checkbox-wrapper"},[u?(m(),C("img",{key:0,src:u,alt:g},null,8,Us)):z("",!0),pe(Et,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=h=>o.value=h),"id-suffix":"polar-layer-chooser-mask-options",label:c,type:"checkbox",value:g,class:Se(i.value.some(({layerImage:h})=>h!==null)?"polar-layer-chooser-options-checkbox":"")},null,8,["modelValue","label","value","class"])]))),128))]),_:1},8,["legend"])]),_:1}))}}),Hs=".polar-layer-chooser-options-checkbox-wrapper[data-v-1ce80731]{display:flex;justify-content:flex-start;align-items:center;gap:var(--kern-metric-space-large)}.kern-form-check.polar-layer-chooser-options-checkbox[data-v-1ce80731]{margin-left:0}.kern-btn[data-v-1ce80731]{border:none;min-height:inherit;padding:var(--kern-metric-space-x-small)}.kern-label[data-v-1ce80731]{padding:0;padding-left:var(--kern-metric-space-small)}",zs=G(Ws,[["styles",[Hs]],["__scopeId","data-v-1ce80731"]]),qs=["id","disabled"],Ks={class:"kern-label kern-sr-only"},ln=j({__name:"LegendButton.ce",props:{disabled:{type:Boolean},id:{type:String}},setup(r){return(e,t)=>(m(),C("button",{id:`polar-layer-chooser-legend-${r.id}-button`,class:"kern-btn kern-btn--tertiary",disabled:r.disabled},[t[0]||(t[0]=x("span",{class:"kern-icon kern-icon--info","aria-hidden":"true"},null,-1)),x("span",Ks,A(e.$t(n=>n.legend.open,{ns:v(ee)})),1)],8,qs))}}),Js=["id","disabled","onClick"],Ys={class:"kern-label kern-sr-only"},Xs=j({__name:"LayerSelection.ce",setup(r){const e=Le(),{activeBackgroundId:t,activeMaskIds:n,backgrounds:i,disabledBackgrounds:a,disabledMasks:o,layersWithOptions:s,masksSeparatedByType:l,openedLegendId:d,shownMasks:c}=ne(e),u=L(()=>Object.keys(e.layersWithLegends));function g(h){e.openedOptionsId=h}return(h,f)=>(m(),O(ut,{id:"polar-layer-chooser-card"},{default:oe(()=>[v(i).length?(m(),O(At,{key:0,legend:h.$t(p=>p.backgroundTitle,{ns:v(ee)})},{default:oe(()=>[(m(!0),C(M,null,X(v(i),({name:p,id:_})=>(m(),C("div",{key:`polar-layer-chooser-background-radio-${_}`,class:"polar-layer-chooser-input-wrapper"},[pe(Et,{modelValue:v(t),"onUpdate:modelValue":f[0]||(f[0]=y=>Jt(t)?t.value=y:null),"id-suffix":"polar-layer-chooser-background",label:p,type:"radio",value:_,disabled:v(a)[_]},null,8,["modelValue","label","value","disabled"]),u.value.includes(_)?(m(),O(ln,{key:0,id:_,disabled:v(a)[_],onClick:y=>d.value=_},null,8,["id","disabled","onClick"])):z("",!0)]))),128))]),_:1},8,["legend"])):z("",!0),v(c).length?(m(!0),C(M,{key:1},X(Object.entries(v(l)),([p,_])=>(m(),O(At,{key:`polar-layer-chooser-mask-${p}`,legend:h.$t(y=>y[`${p}Title`],{ns:v(ee)})},{default:oe(()=>[(m(!0),C(M,null,X(_,({name:y,id:k})=>(m(),C("div",{key:`polar-layer-chooser-mask-${p}-checkbox-${k}`,class:"polar-layer-chooser-input-wrapper"},[pe(Et,{modelValue:v(n),"onUpdate:modelValue":f[1]||(f[1]=S=>Jt(n)?n.value=S:null),"id-suffix":`polar-layer-chooser-mask-${p}`,label:y,type:"checkbox",value:k,disabled:v(o)[k]},null,8,["modelValue","id-suffix","label","value","disabled"]),Object.keys(v(s)).includes(k)?(m(),C("button",{key:0,id:`polar-layer-chooser-options-${k}-button`,class:"kern-btn kern-btn--tertiary",disabled:v(o)[k],onClick:()=>g(k)},[f[2]||(f[2]=x("span",{class:"kern-icon kern-icon-fill--settings","aria-hidden":"true"},null,-1)),x("span",Ys,A(h.$t(S=>S.layerOptions,{ns:v(ee)})),1)],8,Js)):u.value.includes(k)?(m(),O(ln,{key:1,id:k,disabled:v(o)[k],onClick:S=>d.value=k},null,8,["id","disabled","onClick"])):z("",!0)]))),128))]),_:2},1032,["legend"]))),128)):z("",!0)]),_:1}))}}),Zs="#polar-layer-chooser-card[data-v-c4509e12]{overflow-y:inherit}.polar-layer-chooser-input-wrapper[data-v-c4509e12]{display:flex;justify-content:space-between;align-items:center;gap:var(--kern-metric-space-large)}.kern-btn[data-v-c4509e12]{width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large);border:none;border-radius:50%}",Qs=G(Xs,[["styles",[Zs]],["__scopeId","data-v-c4509e12"]]),el=j({__name:"LayerChooser.ce",setup(r){const e=Le(),t=L(()=>e.openedLegendId.length!==0),n=L(()=>e.openedOptionsId.length===0&&!t.value);return(i,a)=>n.value?(m(),O(Qs,{key:0})):t.value?(m(),O(Es,{key:1})):(m(),O(zs,{key:2}))}}),tl={backgroundTitle:"Hintergrundkarten",maskTitle:"Fachdaten",layerHeader:'Auswahl sichtbarer Ebenen für Layer "{{name}}"',layerOptions:"Optionen für Kartenmaterial",legend:{title:"Legende",to:'Legendenbild zu "{{name}}"',open:`$t(legend.to, {ns: ${ee}}) öffnen`},returnToLayers:"Zurück"},nl={backgroundTitle:"Background maps",maskTitle:"Subject data",layerHeader:'Visible layer selection for layer "{{name}}"',layerOptions:"Map data options",legend:{title:"Legend",to:'"{{name}}" legend image',open:`Open $t(legend.to, {ns: ${ee}})`},returnToLayers:"Back"},rl=[{type:"de",resources:tl},{type:"en",resources:nl}];function il(r){return{id:ee,component:el,icon:"kern-icon-fill--layers",locales:rl,storeModule:Le,options:r}}const al=["KernLoader","BasicLoader","RingLoader","RollerLoader","CircleLoader","SpinnerLoader"],Xn=ie("plugins/loadingIndicator",()=>{const r=P(new Set),e=P("KernLoader"),t=L(()=>r.value.size>0);function n(){const l=H().configuration.loadingIndicator?.loaderStyle;l&&s(l)}function i(){s("KernLoader")}function a(l){r.value=new Set([...r.value,l])}function o(l){const d=new Set(r.value);d.delete(l),r.value=d}function s(l){al.includes(l)?e.value=l:console.error(`@polar/polar(plugins/loadingIndicator/store:62:5)
`,`Loader style ${l} does not exist. Using previous style (${e.value}).`)}return{loaderStyle:e,showLoader:t,addLoadingKey:a,removeLoadingKey:o,setLoaderStyle:s,setupPlugin:n,teardownPlugin:i}}),ol={class:"lds-default"},sl=j({__name:"BasicLoader.ce",setup(r){return(e,t)=>(m(),C("div",ol,[(m(),C(M,null,X(12,n=>x("div",{key:n})),64))]))}}),ll=".lds-default[data-v-6079aaec]{color:var(--kern-color-action-default)}.lds-default[data-v-6079aaec],.lds-default div[data-v-6079aaec]{box-sizing:border-box}.lds-default[data-v-6079aaec]{display:inline-block;position:relative;width:80px;height:80px}.lds-default div[data-v-6079aaec]{position:absolute;width:6.4px;height:6.4px;background:currentColor;border-radius:50%;animation:lds-default-6079aaec 1.2s linear infinite}.lds-default div[data-v-6079aaec]:nth-child(1){animation-delay:0s;top:36.8px;left:66.24px}.lds-default div[data-v-6079aaec]:nth-child(2){animation-delay:-.1s;top:22.08px;left:62.29579px}.lds-default div[data-v-6079aaec]:nth-child(3){animation-delay:-.2s;top:11.30421px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(4){animation-delay:-.3s;top:7.36px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(5){animation-delay:-.4s;top:11.30421px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(6){animation-delay:-.5s;top:22.08px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(7){animation-delay:-.6s;top:36.8px;left:7.36px}.lds-default div[data-v-6079aaec]:nth-child(8){animation-delay:-.7s;top:51.52px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(9){animation-delay:-.8s;top:62.29579px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(10){animation-delay:-.9s;top:66.24px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(11){animation-delay:-1s;top:62.29579px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(12){animation-delay:-1.1s;top:51.52px;left:62.29579px}@keyframes lds-default-6079aaec{0%,20%,80%,to{transform:scale(1)}50%{transform:scale(1.5)}}",dl=G(sl,[["styles",[ll]],["__scopeId","data-v-6079aaec"]]),cl={},ul=".lds-circle[data-v-149ac9d5]{color:var(--kern-color-action-default)}.lds-circle[data-v-149ac9d5],.lds-circle div[data-v-149ac9d5]{box-sizing:border-box}.lds-circle[data-v-149ac9d5]{display:inline-block;transform:translateZ(1px);width:80px;height:80px}.lds-circle>div[data-v-149ac9d5]{display:inline-block;width:64px;height:64px;margin:8px;background:currentColor;border-radius:50%;animation:lds-circle-149ac9d5 2.4s cubic-bezier(0,.2,.8,1) infinite}@keyframes lds-circle-149ac9d5{0%,to{animation-timing-function:cubic-bezier(.5,0,1,.5)}0%{transform:rotateY(0)}50%{transform:rotateY(1800deg);animation-timing-function:cubic-bezier(0,.5,.5,1)}to{transform:rotateY(3600deg)}}",hl={class:"lds-circle"};function gl(r,e,t,n,i,a){return m(),C("div",hl,[...e[0]||(e[0]=[x("div",null,null,-1)])])}const pl=G(cl,[["render",gl],["styles",[ul]],["__scopeId","data-v-149ac9d5"]]),fl={},ml=".lds-ring[data-v-712a38e8]{color:var(--kern-color-action-default)}.lds-ring[data-v-712a38e8],.lds-ring div[data-v-712a38e8]{box-sizing:border-box}.lds-ring[data-v-712a38e8]{display:inline-block;position:relative;width:80px;height:80px}.lds-ring div[data-v-712a38e8]{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid currentColor;border-radius:50%;animation:lds-ring-712a38e8 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.lds-ring div[data-v-712a38e8]:nth-child(1){animation-delay:-.45s}.lds-ring div[data-v-712a38e8]:nth-child(2){animation-delay:-.3s}.lds-ring div[data-v-712a38e8]:nth-child(3){animation-delay:-.15s}@keyframes lds-ring-712a38e8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",yl={class:"lds-ring"};function vl(r,e,t,n,i,a){return m(),C("div",yl,[(m(),C(M,null,X(4,o=>x("div",{key:o})),64))])}const _l=G(fl,[["render",vl],["styles",[ml]],["__scopeId","data-v-712a38e8"]]),bl={},kl='.lds-roller[data-v-c8254b29]{color:var(--kern-color-action-default)}.lds-roller[data-v-c8254b29],.lds-roller div[data-v-c8254b29],.lds-roller div[data-v-c8254b29]:after{box-sizing:border-box}.lds-roller[data-v-c8254b29]{display:inline-block;position:relative;width:80px;height:80px}.lds-roller div[data-v-c8254b29]{animation:lds-roller-c8254b29 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller div[data-v-c8254b29]:after{content:" ";display:block;position:absolute;width:7.2px;height:7.2px;border-radius:50%;background:currentColor;margin:-3.6px 0 0 -3.6px}.lds-roller div[data-v-c8254b29]:nth-child(1){animation-delay:-36ms}.lds-roller div[data-v-c8254b29]:nth-child(1):after{top:62.62742px;left:62.62742px}.lds-roller div[data-v-c8254b29]:nth-child(2){animation-delay:-72ms}.lds-roller div[data-v-c8254b29]:nth-child(2):after{top:67.71281px;left:56px}.lds-roller div[data-v-c8254b29]:nth-child(3){animation-delay:-.108s}.lds-roller div[data-v-c8254b29]:nth-child(3):after{top:70.90963px;left:48.28221px}.lds-roller div[data-v-c8254b29]:nth-child(4){animation-delay:-.144s}.lds-roller div[data-v-c8254b29]:nth-child(4):after{top:72px;left:40px}.lds-roller div[data-v-c8254b29]:nth-child(5){animation-delay:-.18s}.lds-roller div[data-v-c8254b29]:nth-child(5):after{top:70.90963px;left:31.71779px}.lds-roller div[data-v-c8254b29]:nth-child(6){animation-delay:-.216s}.lds-roller div[data-v-c8254b29]:nth-child(6):after{top:67.71281px;left:24px}.lds-roller div[data-v-c8254b29]:nth-child(7){animation-delay:-.252s}.lds-roller div[data-v-c8254b29]:nth-child(7):after{top:62.62742px;left:17.37258px}.lds-roller div[data-v-c8254b29]:nth-child(8){animation-delay:-.288s}.lds-roller div[data-v-c8254b29]:nth-child(8):after{top:56px;left:12.28719px}@keyframes lds-roller-c8254b29{0%{transform:rotate(0)}to{transform:rotate(360deg)}}',xl={class:"lds-roller"};function Cl(r,e,t,n,i,a){return m(),C("div",xl,[(m(),C(M,null,X(8,o=>x("div",{key:o})),64))])}const wl=G(bl,[["render",Cl],["styles",[kl]],["__scopeId","data-v-c8254b29"]]),Sl={},Ll='.lds-spinner[data-v-1790c8de]{color:var(--kern-color-action-default)}.lds-spinner[data-v-1790c8de],.lds-spinner div[data-v-1790c8de],.lds-spinner div[data-v-1790c8de]:after{box-sizing:border-box}.lds-spinner[data-v-1790c8de]{color:currentColor;display:inline-block;position:relative;width:80px;height:80px}.lds-spinner div[data-v-1790c8de]{transform-origin:40px 40px;animation:lds-spinner-1790c8de 1.2s linear infinite}.lds-spinner div[data-v-1790c8de]:after{content:" ";display:block;position:absolute;top:3.2px;left:36.8px;width:6.4px;height:17.6px;border-radius:20%;background:currentColor}.lds-spinner div[data-v-1790c8de]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner div[data-v-1790c8de]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div[data-v-1790c8de]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div[data-v-1790c8de]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div[data-v-1790c8de]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div[data-v-1790c8de]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div[data-v-1790c8de]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div[data-v-1790c8de]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div[data-v-1790c8de]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div[data-v-1790c8de]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div[data-v-1790c8de]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div[data-v-1790c8de]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner-1790c8de{0%{opacity:1}to{opacity:0}}',Il={class:"lds-spinner"};function Tl(r,e,t,n,i,a){return m(),C("div",Il,[(m(),C(M,null,X(12,o=>x("div",{key:o})),64))])}const Fl=G(Sl,[["render",Tl],["styles",[Ll]],["__scopeId","data-v-1790c8de"]]),$l={key:0,class:"polar-plugin-loading-indicator-wrapper"},Pl={key:0,class:"polar-plugin-loading-indicator-overlay"},El={key:0,class:"kern-loader kern-loader--visible",role:"status"},Al=j({__name:"LoadingIndicator.ce",setup(r){const{layout:e}=ne(H()),{loaderStyle:t,showLoader:n}=ne(Xn()),i={BasicLoader:dl,CircleLoader:pl,RingLoader:_l,RollerLoader:wl,SpinnerLoader:Fl};return(a,o)=>v(n)&&v(t)!==null?(m(),C("div",$l,[v(e)==="standard"?(m(),C("div",Pl)):z("",!0),pe(ut,null,{default:oe(()=>[v(t)==="KernLoader"?(m(),C("div",El)):(m(),O(Tt(i[v(t)]),{key:1,class:"kern-loader--visible",role:"status"}))]),_:1})])):z("",!0)}}),Ml=".polar-plugin-loading-indicator-wrapper{&[data-v-d34e6512]{z-index:100;position:absolute;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.polar-plugin-loading-indicator-overlay[data-v-d34e6512]{position:absolute;width:100%;height:100%;opacity:var(--kern-color-action-state-opacity-overlay);background:#fff}.kern-card[data-v-d34e6512]{min-width:fit-content;height:fit-content;border-radius:50%}[data-v-d34e6512] .kern-card__container{padding:var(--kern-metric-space-small)!important}}",Ol=G(Al,[["styles",[Ml]],["__scopeId","data-v-d34e6512"]]),Rl="loadingIndicator";function Dl(r){return{id:Rl,component:Ol,storeModule:Xn,options:r}}const dn=0,Ge=1,cn=[0,0,0,0],ke=[],bt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function kt(r,e,t){let n;switch(e){case"LineString":n=r;break;case"MultiLineString":case"Polygon":n=r[t[0]];break;case"MultiPolygon":n=r[t[1]][t[0]];break}return n}class xt extends Ne{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class Gl extends Mt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:vr,this.defaultDeleteCondition_=function(n){return _r(n)&&bn(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:_e,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ri,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new de({source:new ge({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Nl(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new be(this.source_.getFeatures()),this.source_.addEventListener(Qt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Qt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ye.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ye.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=_e:t=e:t=Ze,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(Ft.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new be;const n=this.featuresBeingModified_.getArray();for(let i=0,a=t.length;i<a;++i){const o=t[i].feature;o&&!n.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new xt(bt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Ft.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(i){e===i.feature&&n.push(i)});for(let i=n.length-1;i>=0;--i){const a=n[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===a&&this.dragSegments_.splice(o,1);t.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),i={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),i)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let i=0,a=n.length;i<a;++i){const o=n[i],s={feature:e,geometry:t,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(t.getExtent(),s)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let i=0,a=n.length-1;i<a;++i){const o=n.slice(i,i+2),s={feature:e,geometry:t,index:i,segment:o};this.rBush_.insert(K(o),s)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let i=0,a=n.length;i<a;++i){const o=n[i];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[i],index:s,segment:d};this.rBush_.insert(K(d),c)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let i=0,a=n.length;i<a;++i){const o=n[i];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[i],index:s,segment:d};this.rBush_.insert(K(d),c)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let i=0,a=n.length;i<a;++i){const o=n[i];for(let s=0,l=o.length;s<l;++s){const d=o[s];for(let c=0,u=d.length-1;c<u;++c){const g=d.slice(c,c+2),h={feature:e,geometry:t,depth:[s,i],index:c,segment:g};this.rBush_.insert(K(g),h)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),i={feature:e,geometry:t,index:dn,segment:[n,n]},a={feature:e,geometry:t,index:Ge,segment:[n,n]},o=[i,a];i.featureSegments=o,a.featureSegments=o,this.rBush_.insert(mt(n),i);let s=t;this.rBush_.insert(s.getExtent(),a)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let i=0;i<n.length;++i){const a=n[i],o=this.SEGMENT_WRITERS_[a.getType()];o(e,a)}}createOrUpdateVertexFeature_(e,t,n,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new W(new le(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",t),a.set("geometries",n),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Z.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const t=[],n=this.vertexFeature_.getGeometry().getCoordinates(),i=K([n]),a=this.rBush_.getInExtent(i),o={};a.sort(Bl);for(let s=0,l=a.length;s<l;++s){const d=a[s],c=d.segment;let u=Q(d.geometry);const g=d.depth;if(g&&(u+="-"+g.join("-")),o[u]||(o[u]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===Ge){const h=hn(e,d);te(h,n)&&!o[u][0]&&(this.dragSegments_.push([d,0]),o[u][0]=d);continue}if(te(c[0],n)&&!o[u][0]){this.dragSegments_.push([d,0]),o[u][0]=d;continue}if(te(c[1],n)&&!o[u][1]){if(o[u][0]&&o[u][0].index===0){let h=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":h=h[g[1]];case"Polygon":if(d.index!==h[g[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[u][1]=d;continue}Q(c)in this.vertexSegments_&&!o[u][0]&&!o[u][1]&&t.push(d)}return t}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const a=e.map.getPixelFromCoordinate(t.startCoord);if(me(a,e.pixel)<this.pixelTolerance_)return}const n=Rn(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(n.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const o=t.targets[t.targetIndex];this.removeTracedCoordinates_(o.startIndex,o.endIndex)}else for(const o of this.traceSegments_){const s=o[0],l=s.geometry,d=o[1],c=l.getCoordinates();kt(c,l.getType(),s.depth).splice(s.index+d,1),l.setCoordinates(c),d===0&&(s.index-=1)}const a=t.targets[n.index];this.addTracedCoordinates_(a,a.startIndex,n.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,n.endIndex)}t.targetIndex=n.index;const i=t.targets[t.targetIndex];i.endIndex=n.endIndex}getTraceCandidates_(e){const t=this.getMap(),n=this.pixelTolerance_,i=t.getCoordinateFromPixel([e.pixel[0]-n,e.pixel[1]+n]),a=t.getCoordinateFromPixel([e.pixel[0]+n,e.pixel[1]-n]),o=K([i,a]);return this.traceSource_.getFeaturesInExtent(o)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const n=Dn(e.coordinate,t);n.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:n,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,i=e.startIndex<=t;n===i?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const i=Math.ceil(e);let a=Math.floor(t);a===t&&(a-=1),n=a-i+1}else{const i=Math.floor(e);let a=Math.ceil(t);a===t&&(a+=1),n=i-a+1}if(n>0)for(const i of this.traceSegments_){const a=i[0],o=a.geometry,s=i[1];let l=i[0].index+1;s===1&&(l-=n);const d=o.getCoordinates();kt(d,o.getType(),a.depth).splice(l,n),o.setCoordinates(d),s===1&&(a.index-=n)}}addTracedCoordinates_(e,t,n){if(t===n)return;const i=[];if(t<n){const a=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=a;s<=o;++s)i.push(ue(e.coordinates,s))}else{const a=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=a;s>=o;--s)i.push(ue(e.coordinates,s))}if(i.length)for(const a of this.traceSegments_){const o=a[0],s=o.geometry,l=a[1],d=o.index+1;l===0&&i.reverse();const c=s.getCoordinates();kt(c,s.getType(),o.depth).splice(d,0,...i),s.setCoordinates(c),l===1&&(o.index+=i.length)}}updateGeometry_(e,t){const n=t[0],i=n.depth;let a;const o=n.segment,s=n.geometry,l=t[1];for(;e.length<s.getStride();)e.push(o[l][e.length]);switch(s.getType()){case"Point":a=e,o[0]=e,o[1]=e;break;case"MultiPoint":a=s.getCoordinates(),a[n.index]=e,o[0]=e,o[1]=e;break;case"LineString":a=s.getCoordinates(),a[n.index+l]=e,o[l]=e;break;case"MultiLineString":a=s.getCoordinates(),a[i[0]][n.index+l]=e,o[l]=e;break;case"Polygon":a=s.getCoordinates(),a[i[0]][n.index+l]=e,o[l]=e;break;case"MultiPolygon":a=s.getCoordinates(),a[i[1]][i[0]][n.index+l]=e,o[l]=e;break;case"Circle":const d=s;if(o[0]=e,o[1]=e,n.index===dn)this.changingFeature_=!0,d.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let c=me(V(d.getCenter()),V(e));d.setRadius(c),this.changingFeature_=!1}break}a&&this.setGeometryCoordinates_(s,a)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],i=[],a=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(a){this.traceSegments_=[];for(const o of this.dragSegments_){const s=o[0];me(Fn(a,s.segment),a)/e.map.getView().getResolution()<1&&this.traceSegments_.push(o)}}for(let o=0,s=this.dragSegments_.length;o<s;++o){const l=this.dragSegments_[o],d=l[0],c=d.feature;n.includes(c)||n.push(c);const u=d.geometry;i.includes(u)||i.push(u),this.updateGeometry_(t,l)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,n,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(t);if(n?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=n.length-1;a>=0;--a)this.insertVertex_(n[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],i=n.geometry;if(i.getType()==="Circle"){const a=i,o=a.getCenter(),s=n.featureSegments[0],l=n.featureSegments[1];s.segment[0]=o,s.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update(mt(o),s);let d=a;this.rBush_.update(d.getExtent(),l)}else this.rBush_.update(K(n.segment),n)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new xt(bt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),n=t.getPixelFromCoordinate(e);t.getView().getProjection();const i=function(s,l){return un(e,s)-un(e,l)};let a,o;if(this.hitDetection_){const s=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(n,(l,d,c)=>{c&&c.getType()==="Point"&&(c=new le(rt(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof W&&this.features_.getArray().includes(l)){o=u;const g=l.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:l,geometry:o,segment:[g,g]}]}return!0},{layerFilter:s})}if(!a){const s=ii(mt(e,cn)),l=t.getView().getResolution()*this.pixelTolerance_,d=ai(oi(s,l,cn));a=this.rBush_.getInExtent(d)}if(a&&a.length>0){const s=a.sort(i)[0],l=s.segment;let d=hn(e,s);const c=t.getPixelFromCoordinate(d);let u=me(n,c);if(o||u<=this.pixelTolerance_){const g={};if(g[Q(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),s.geometry.getType()==="Circle"&&s.index===Ge)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);else{const h=t.getPixelFromCoordinate(l[0]),f=t.getPixelFromCoordinate(l[1]),p=nt(c,h),_=nt(c,f);if(u=Math.sqrt(Math.min(p,_)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=p>_?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);const y={};y[Q(s.geometry)]=!0;for(let k=1,S=a.length;k<S;++k){const $=a[k].segment;if(te(l[0],$[0])&&te(l[1],$[1])||te(l[0],$[1])&&te(l[1],$[0])){const I=Q(a[k].geometry);I in y||(y[I]=!0,g[Q($)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,i=e.feature,a=e.geometry,o=e.depth,s=e.index;let l;for(;t.length<a.getStride();)t.push(0);switch(a.getType()){case"MultiLineString":l=a.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"Polygon":l=a.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"MultiPolygon":l=a.getCoordinates(),l[o[1]][o[0]].splice(s+1,0,t);break;case"LineString":l=a.getCoordinates(),l.splice(s+1,0,t);break;default:return!1}this.setGeometryCoordinates_(a,l);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(a,s,o,1);const c={segment:[n[0],t],feature:i,geometry:a,depth:o,index:s};d.insert(K(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,n[1]],feature:i,geometry:a,depth:o,index:s+1};return d.insert(K(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?rt(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(K([e])).some(({segment:t})=>te(t[0],e)||te(t[1],e))}removePoint(e){if(e&&(e=V(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Z.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([i])=>i));const n=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new xt(bt.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,n}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,i,a,o,s,l,d,c,u,g,h,f;for(l=e.length-1;l>=0;--l)o=e[l],h=o[0],f=Q(h.feature),h.depth&&(f+="-"+h.depth.join("-")),f in t||(t[f]={}),o[1]===0?(t[f].right=h,t[f].index=h.index):o[1]==1&&(t[f].left=h,t[f].index=h.index+1);for(f in t){switch(g=t[f].right,c=t[f].left,d=t[f].index,u=d-1,c!==void 0?h=c:h=g,u<0&&(u=0),s=h.geometry,a=s.getCoordinates(),i=a,n=!1,s.getType()){case"MultiLineString":a[h.depth[0]].length>2&&(a[h.depth[0]].splice(d,1),n=!0);break;case"LineString":a.length>2&&(a.splice(d,1),n=!0);break;case"MultiPolygon":i=i[h.depth[1]];case"Polygon":i=i[h.depth[0]],i.length>4&&(d==i.length-1&&(d=0),i.splice(d,1),n=!0,d===0&&(i.pop(),i.push(i[0]),u=i.length-1));break}if(n){this.setGeometryCoordinates_(s,a);const p=[];if(c!==void 0&&(this.rBush_.remove(c),p.push(c.segment[0])),g!==void 0&&(this.rBush_.remove(g),p.push(g.segment[1])),c!==void 0&&g!==void 0){const _={depth:h.depth,feature:h.feature,geometry:h.geometry,index:u,segment:p};this.rBush_.insert(K(_.segment),_)}this.updateSegmentIndices_(s,d,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(K([e])).some(({segment:t})=>!(te(t[0],e)||te(t[1],e)))}insertPoint(e){const t=e?V(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,i)=>n||this.insertVertex_(i,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(n===void 0||a.depth===void 0||si(a.depth,n))&&a.index>t&&(a.index+=i)})}}function Bl(r,e){return r.index-e.index}function un(r,e,t){const n=e.geometry;if(n.getType()==="Circle"){let a=n;if(e.index===Ge){const o=nt(a.getCenter(),V(r)),s=Math.sqrt(o)-a.getRadius();return s*s}}const i=V(r);return ke[0]=V(e.segment[0]),ke[1]=V(e.segment[1]),ci(i,ke)}function hn(r,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===Ge)return rt(n.getClosestPoint(V(r)));const i=V(r);return ke[0]=V(e.segment[0]),ke[1]=V(e.segment[1]),rt(Fn(i,ke))}function Nl(){const r=jt();return function(e,t){return r.Point}}const Ke={SELECT:"select"};class Je extends Ne{constructor(e,t,n,i){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=i}}const Ye={};class zt extends yr{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:bn,this.addCondition_=e.addCondition?e.addCondition:Ze,this.removeCondition_=e.removeCondition?e.removeCondition:Ze,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Lt,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Be,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Vl(),this.features_=e.features||new be;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(i){return n.includes(i)}}else t=Be;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[Q(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[Q(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ye.ADD,this.boundAddFeature_),this.features_.addEventListener(ye.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ye.ADD,this.boundAddFeature_),this.features_.removeEventListener(ye.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.findLayerOfFeature_(t);n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(t){if(t instanceof de&&t.getSource()&&t.getSource().hasFeature(e))return t})}getStyle(){return this.style_}applySelectedStyle_(e){const t=Q(e);t in Ye||(Ye[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let i=t.length-1;i>=0;--i){const a=t[i];if(a!==this&&a instanceof zt&&a.getStyle()&&a.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(a.getStyle());return}}const n=Q(e);e.setStyle(Ye[n]),delete Ye[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[Q(e)]}selectFeatureInternal_(e,t,n){if(!(e instanceof W)||!this.filter_(e,t))return;const i=this.getFeatures();return i.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),i.push(e),n?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const n=this.selectFeatureInternal_(e,t);return n&&this.dispatchEvent(new Je(Ke.SELECT,[n],[],void 0)),!!n}removeFeatureInternal_(e,t){const n=this.getFeatures();if(!(!(e instanceof W)||!n.getArray().includes(e)))return n.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new Je(Ke.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){ni(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new Je(Ke.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),i=this.toggleCondition_(e),a=!t&&!n&&!i,o=e.map,s=this.getFeatures(),l=[],d=[];if(a){let c=!1;o.forEachFeatureAtPixel(e.pixel,(u,g)=>{if(c=!0,!!this.selectFeatureInternal_(u,g,d))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=s.getLength()-1;u>=0;--u){const g=s.item(u);(d.length>0&&!d.includes(g)||!c)&&this.removeFeatureInternal_(g,l)}}else o.forEachFeatureAtPixel(e.pixel,(c,u)=>{let g;if((n||i)&&(g=this.removeFeatureInternal_(c,l)),(t||i)&&!g&&(g=this.selectFeatureInternal_(c,u,d)),!!g)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(d.length>0||l.length>0)&&this.dispatchEvent(new Je(Ke.SELECT,d,l,e)),!0}}function Vl(){const r=jt();return en(r.Polygon,r.LineString),en(r.GeometryCollection,r.LineString),function(e){return e.getGeometry()?r[e.getGeometry().getType()]:null}}const Ct={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class wt extends Ne{constructor(e,t,n,i,a){super(e),this.features=t,this.coordinate=n,this.startCoordinate=i,this.mapBrowserEvent=a}}class jl extends Mt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(i){return n.includes(i)}}else t=Be;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Be,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:_e,this.lastFeature_=null,this.addChangeListener(fn.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new be([this.lastFeature_]);return this.dispatchEvent(new wt(Ct.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new be([this.lastFeature_]);return this.dispatchEvent(new wt(Ct.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const n=V(t),i=V(this.lastCoordinate_),a=n[0]-i[0],o=n[1]-i[1],s=this.features_||new be([this.lastFeature_]);s.forEach(function(l){const d=l.getGeometry();d.translate(a,o),l.setGeometry(d)}),this.lastCoordinate_=t,this.dispatchEvent(new wt(Ct.TRANSLATING,s,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(n,i)=>{if(!(!(n instanceof W)||!this.filter_(n,i))&&!(this.features_&&!this.features_.getArray().includes(n)))return n},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const n=this.getActive();(!t||!n)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const Ul=(r,e,t)=>{if(t){const n=new DOMParser().parseFromString(t,"image/svg+xml");return n.querySelectorAll("[fill]").forEach(i=>{i.setAttribute("fill",r)}),n.querySelectorAll("[stroke]").forEach(i=>{i.setAttribute("stroke",e)}),n.querySelectorAll("path, circle, rect, polygon, ellipse").forEach(i=>{i.hasAttribute("fill")||i.setAttribute("fill",r),i.hasAttribute("stroke")||i.setAttribute("stroke",e)}),new XMLSerializer().serializeToString(n)}return`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="-1 -1 25 25"
  >
    <path
      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"
      fill="${r}"
      stroke="${e}"
      stroke-width="1"
    />
  </svg>
`},Wl=({fill:r="#005CA9",stroke:e="#FFF",svg:t})=>{let n="";typeof r=="string"?n=r:"oklch"in r?n=`oklch(${r.oklch.l} ${r.oklch.c} ${r.oklch.h})`:"rgba"in r&&(n=`${r.rgba.r} ${r.rgba.g} ${r.rgba.b} ${r.rgba.a?r.rgba.a:""}`);let i="";return typeof e=="string"?i=e:"oklch"in e?i=`oklch(${e.oklch.l} ${e.oklch.c} ${e.oklch.h})`:"rgba"in e&&(i=`${e.rgba.r} ${e.rgba.g} ${e.rgba.b} ${e.rgba.a?e.rgba.a:""}`),new Ce({image:new ti({src:`data:image/svg+xml;base64,${btoa(Ul(n,i,t))}`,scale:2,anchor:[.5,1]})})},Hl={Circle:Ut,LinearRing:li,LineString:Me,MultiLineString:Ot,MultiPoint:mn,MultiPolygon:Rt,Point:le,Polygon:ct};function zl(r,e,t,n){const i=new Hl[t](n);let a=di(i.getExtent());return(t==="Polygon"||t==="MultiPolygon")&&!i.intersectsCoordinate(a)&&(a=(i.getType()==="Polygon"?i.getInteriorPoint():i.getInteriorPoints()).getFirstCoordinate()),r===e?a:In(a,r,e)}async function gn(r,e,t){if(!t)return!0;const n=await Pn(e,t.layerId,r);return n===!0||typeof n=="symbol"&&t.onError!=="strict"?!0:(typeof n=="symbol"?(Ae("error",()=>Re(i=>i.boundaryError,{ns:"pins"})),console.error(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:39:3)
`,"Checking boundary layer failed.")):(Ae("info",()=>Re(i=>i.notInBoundary,{ns:"pins"})),console.info(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:43:3)
`,"Pin position outside of boundary layer:",r)),!1)}const ql=ie("plugins/pins",()=>{const r=H(),e=P(null),t=P(!1),n=L(()=>se({minZoomLevel:0,movable:"none",toZoomLevel:0},r.configuration.pins||{})),i=L(()=>{if(!e.value)return null;const y=ei(e.value,r.configuration.epsg);return[y[1],y[0]]}),a=new de({source:new ge,style:Wl(n.value.style||{})}),o=new zt({layers:y=>y===a,style:null,condition:mr}),s=new jl({condition:()=>r.map.getView().getZoom()>=n.value.minZoomLevel,layers:[a]});let l=null;function d(){r.map.addLayer(a),a.setZIndex(100),r.map.on("singleclick",async({coordinate:y})=>{await f(y)}),u(),g(),h()}function c(){const{map:y}=r;y.un("singleclick",async({coordinate:k})=>{await f(k)}),_(),y.removeLayer(a),y.removeInteraction(o),y.removeInteraction(s),l&&l()}function u(){const{coordinateSources:y}=n.value;y&&y.forEach(k=>{const S=r.getPluginStore(k.pluginName);S&&(l=q(()=>S[k.getterName],$=>{$&&$.type!=="reverse_geocoded"&&p($.geometry.coordinates,!1,{epsg:$.epsg,type:$.geometry.type})}))})}function g(){const{initial:y}=n.value;if(y){const{coordinate:k,centerOn:S,epsg:$}=y;if(S){p(k,!1,{epsg:$||r.configuration.epsg,type:"Point"});return}p(k)}}function h(){o.on("select",({selected:k})=>{n.value.movable==="none"&&(document.body.style.cursor=k.length?"not-allowed":"")}),r.map.addInteraction(o);const{movable:y}=n.value;y==="drag"&&(s.on("translatestart",()=>t.value=!0),s.on("translateend",({features:k})=>{t.value=!1,k.forEach(async S=>{const $=S.getGeometry().getCoordinates(),I=await gn($,r.map,n.value.boundary)?$:e.value;I&&p(I)})}),r.map.addInteraction(s))}async function f(y){const k=r.map.getInteractions().getArray().some(I=>I instanceof Nn&&(I._isMultiSelect||I._isDrawPlugin)||I instanceof Gl||I._isDeleteSelect),{minZoomLevel:S,movable:$}=n.value;($==="drag"||$==="click")&&r.map.getView().getZoom()>=S&&!k&&await gn(y,r.map,n.value.boundary)&&p(y)}function p(y,k=!0,S){_(),e.value=y,!k&&S&&(e.value=zl(S.epsg,r.configuration.epsg,S.type,y),r.map.getView().setCenter(e.value),r.map.getView().setZoom(n.value.toZoomLevel)),a.getSource().addFeature(new W({geometry:new le(e.value),type:"point",name:"mapMarker",zIndex:100}))}function _(){a.getSource().clear()}return{coordinate:e,latLon:i,setupPlugin:d,teardownPlugin:c}}),Kl={boundaryError:"Die Überprüfung der Koordinate ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Diese Koordinate kann nicht gewählt werden."},Jl={boundaryError:"Validating the coordinate failed. Please try again later or contact an administrator if the issue persists.",notInBoundary:"It is not possible to select this coordinate."},Yl=[{type:"de",resources:Kl},{type:"en",resources:Jl}],Xl="pins";function Zl(r){return{id:Xl,locales:Yl,storeModule:ql,options:r}}const qt="reverseGeocoder",Zn=ie("plugins/reverseGeocoder",()=>{const r=H(),e=L(()=>r.configuration[qt]),t=P([]);function n(){for(const s of e.value.coordinateSources||[]){const l=Pt(s);l&&t.value.push(q(()=>l[s.key],async d=>{d&&await o(d)},{immediate:!0}))}}function i(){t.value.forEach(s=>{s()})}function a(s,l){const d=Pt(s);d&&(d[s.key]=l)}async function o(s){const l=hi();try{const d=await gi(e.value.url,s);return e.value.addressTarget&&a(e.value.addressTarget,d),e.value.zoomTo&&r.map.getView().fit(new le(s),{maxZoom:e.value.zoomTo,duration:400,easing:ui}),d}catch(d){return console.error(`@polar/polar(plugins/reverseGeocoder/store:99:5)
`,"Reverse geocoding failed:",d),null}finally{l()}}return{reverseGeocode:o,setupPlugin:n,teardownPlugin:i}});if(import.meta.vitest){const{expect:r,test:e,vi:t}=import.meta.vitest,{createPinia:n,setActivePinia:i}=await Te(async()=>{const{createPinia:c,setActivePinia:u}=await import("./pinia-B2ywJL3t-CKqFnMG3.js");return{createPinia:c,setActivePinia:u}},__vite__mapDeps([0,1]),import.meta.url),{reactive:a}=await Te(async()=>{const{reactive:c}=await import("./vue.runtime.esm-bundler-D9Sv99E9-CFvmjqF-.js");return{reactive:c}},[],import.meta.url),o=await Te(()=>import("./store-CCqDS0ZX.js").then(c=>c.s),__vite__mapDeps([2,0,1,3]),import.meta.url),s=await Te(()=>import("./reverseGeocode-DMu2C9hG-Dnf25j7O.js"),__vite__mapDeps([4,2,0,1,3]),import.meta.url),l=await Te(()=>import("./indicateLoading-BmtjuhTR-DAc6gDQ6.js"),__vite__mapDeps([5,3,0,1]),import.meta.url),d=e.extend({reverseGeocodeUtil:[async({},c)=>{const u=t.spyOn(s,"reverseGeocode").mockResolvedValue(null);await c(u)},{auto:!0}],indicateLoading:[async({},c)=>{const u=t.spyOn(l,"indicateLoading").mockImplementation(()=>()=>{});await c(u)},{auto:!0}],coreStore:[async({},c)=>{const u=t.fn(),g=a({configuration:{[qt]:{url:"https://wps.example",coordinateSources:[{key:"coordinateSource"}],addressTarget:{key:"addressTarget"},zoomTo:99}},map:{getView:()=>({fit:u})},coordinateSource:null,addressTarget:null});t.spyOn(o,"useCoreStore").mockReturnValue(g),await c(g)},{auto:!0}],store:[async({},c)=>{i(n());const u=Zn();u.setupPlugin(),await c(u),u.teardownPlugin()},{auto:!0}]});d("detects changes in coordinate sources",async({reverseGeocodeUtil:c,coreStore:u})=>{u.coordinateSource=[1,2],await new Promise(g=>setTimeout(g)),r(c).toHaveBeenCalledWith("https://wps.example",[1,2])}),d("passes geocoding result to address target",async({reverseGeocodeUtil:c,coreStore:u,store:g})=>{const h=Symbol("feature");c.mockResolvedValueOnce(h),await g.reverseGeocode([3,4]),r(u.addressTarget).toBe(h)}),d("zooms to input coordinate",async({reverseGeocodeUtil:c,coreStore:u,store:g})=>{const h=Symbol("feature");c.mockResolvedValueOnce(h),await g.reverseGeocode([3,4]),r(u.map.getView().fit).toHaveBeenCalledOnce()})}function Ql(r){return{id:qt,storeModule:Zn,options:r}}const ed={style:{background:"#fff"}},td=at({__name:"EmptyComponent",setup(r){return(e,t)=>(st(),ot("div",ed,"HELLO THERE"))}}),nd={class:"kern-btn kern-btn--tertiary",style:{"border-radius":"0.25rem","min-height":"2rem",width:"2rem"}},rd=at({__name:"MockAttributions.ce",setup(r){return(e,t)=>(st(),ot("button",nd,[...t[0]||(t[0]=[Oe("span",{class:"kern-icon kern-icon-fill--copyright",style:{color:"var(--kern-color-action-default)"}},null,-1)])]))}}),id={style:{display:"flex",gap:"0.5rem"}},ad=at({__name:"MockPointerPosition.ce",setup(r){return(e,t)=>(st(),ot("div",id,[...t[0]||(t[0]=[Oe("span",{class:"kern-icon kern-icon--fullscreen","aria-hidden":"true"},null,-1),Oe("span",{style:{display:"flex","align-items":"center"}},"9.9555 | 53.5479",-1),Oe("button",{class:"kern-btn kern-btn--tertiary",style:{"min-height":"1rem","font-size":"1.125rem","text-decoration-line":"underline","text-underline-offset":"2px","text-underline-position":"from-font",color:"#1a3da5"}}," EPSG:4326 ",-1)])]))}}),Qn=[{id:"23420",name:"basemap.de Web Raster Farbe",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_farbe",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"23421",name:"basemap.de Web Raster Grau",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_grau",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"1454",name:"Ausgleichsflächen",url:"https://geodienste.hamburg.de/HH_WFS_Ausgleichsflaechen",typ:"WFS",featureType:"ausgleichsflaechen",outputFormat:"XML",version:"1.1.0",featureNS:"https://registry.gdi-de.org/id/de.hh.up",featurePrefix:"de.hh.up",legendURL:""},{id:"6059",name:"MML Anliegen",url:"https://geodienste.hamburg.de/lgv-config/anliegen_extern.json",typ:"GeoJSON",format:"XML",version:"1.0",minScale:"0",maxScale:"2500000",legendURL:"",urlIsVisible:!0},{id:"denkmaelerWMS",name:"Denkmal WMS",url:"https://efi2-deegree.schleswig-holstein.de/dish-deegree/services/wms_shp",typ:"WMS",layers:"0,1,2,3,4,6,24,25",legendURL:"ignore",format:"image/png",version:"1.3.0",transparent:!0},{id:"kiel_polygon",name:"Kiel Polygon",url:"https://polar.dataport.de/qgisserver?MAP=/home/qgis/projects/dev_services.qgz",typ:"WFS",featureType:"polygon_kiel",outputFormat:"XML",version:"1.1.0",legendURL:""}],od="data:application/json;base64,WwoJewoJCSJzdHlsZUlkIjogInBhbmRhIiwKCQkicnVsZXMiOiBbCgkJCXsKCQkJCSJzdHlsZSI6IHsKCQkJCQkicG9seWdvblN0cm9rZUNvbG9yIjogWzMsIDI1NSwgMSwgMV0sCgkJCQkJInBvbHlnb25GaWxsSGF0Y2giOiB7CgkJCQkJCSJiYWNrZ3JvdW5kQ29sb3IiOiBbMCwgMCwgMCwgMC4yNV0sCgkJCQkJCSJwYXR0ZXJuIjogImRpYWdvbmFsLXJpZ2h0IiwKCQkJCQkJInBhdHRlcm5Db2xvciI6IFszLCAyNTUsIDEsIDFdCgkJCQkJfQoJCQkJfQoJCQl9CgkJXQoJfQpdCg==",sd={style:{background:"#fff","z-index":"99999","pointer-events":"all"}},ld=at({__name:"YetAnotherEmptyComponent",setup(r){const e=document.getElementById("snowbox").store;function t(){e.center=[561210,5932600]}return(n,i)=>(st(),ot("div",sd,[i[1]||(i[1]=br(" Awesome ",-1)),Oe("button",{onClick:i[0]||(i[0]=a=>t())},"Go to Hamburg")]))}}),er="23420",dd="23421",cd="1454",Xe="6059",ud="denkmaelerWMS",tr="kiel_polygon",nr="1693";let Ee="light";const J=await kr("snowbox",{colorScheme:Ee,startCenter:[573364,6028874],layers:[{id:er,visibility:!0,type:"background",name:"Basemap.de (Farbe)"},{id:dd,type:"background",name:"Basemap.de (Grau)",maxZoom:6},{id:nr,visibility:!0,hideInMenu:!0,type:"mask",name:"meldemichel.layers.hamburgBorder"},{id:Xe,type:"mask",name:"Anliegen (MML)",visibility:!1},{id:cd,type:"mask",name:"Ausgleichsflächen",styleId:"panda",visibility:!0,minZoom:5},{id:ud,type:"mask",name:"Kulturdenkmale",visibility:!0,options:{layers:{order:"6,24,25,4,3,2,1,0",title:{6:"Denkmalbereich",24:"Mehrheit von baulichen Anlagen",25:"Sachgesamtheit",4:"Baudenkmal",3:"Gründenkmal",2:"Gewässer",1:"Baudenkmal (Fläche)",0:"Gründenkmal (Fläche)"},legend:!0}}},{id:tr,type:"mask",name:"Kiel Polygone",visibility:!0}],layout:"standard",checkServiceAvailability:!0,featureStyles:od,markers:{layers:[{id:Xe,defaultStyle:{stroke:"#FFFFFF",fill:"#005CA9"},hoverStyle:{stroke:"#46688E",fill:"#8BA1B8"},selectionStyle:{stroke:"#FFFFFF",fill:"#E10019"},unselectableStyle:{stroke:"#FFFFFF",fill:"#333333"}}],clusterClickZoom:!0},locales:[{type:"de",resources:{fullscreen:{button:{label_on:"Mach groß",label_off:"Mach klein"}},gfi:{layer:{[Xe]:{property:{addr:"Adresse",statu:"Status",beschr:"Beschr.",kat_text:"Kat."}}}},iconMenu:{hints:{attributions:"LMAO",fullscreen:"BEEEEEG YOSHEEEEE"}}}}],scale:{showScaleSwitcher:!0}},Qn);document.getElementById("secondMap").addEventListener("click",async()=>{const r=xr({startCenter:[573364,6028874],layers:[{id:er,visibility:!0,type:"background",name:"snowbox.layers.basemap"}]},Qn);r.classList.add("snowbox"),document.getElementById("secondMapContainer").appendChild(r),he(r,xn({layoutTag:"TOP_RIGHT"}))});document.getElementById("secondMapClean").addEventListener("click",()=>{document.getElementById("secondMapContainer").innerText=""});he(J,Cn({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"}));setTimeout(()=>{Cr(J,"toast")},3e3);setTimeout(()=>{he(J,Cn({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"})),lt(J,"toast").addToast({text:"Sechs Sekunden",severity:"info"})},6e3);he(J,Dl({loaderStyle:"BasicLoader"}));he(J,Zl({boundary:{layerId:nr},movable:"drag",style:{fill:"#FF0019"},toZoomLevel:7}));he(J,Ql({url:"https://geodienste.hamburg.de/HH_WPS",coordinateSources:[{plugin:"pins",key:"coordinate"}],addressTarget:{plugin:"addressSearch",key:"selectResult"},zoomTo:7}));he(J,Sr({displayComponent:!0,layoutTag:"TOP_RIGHT",initiallyOpen:"layerChooser",focusMenus:[{plugin:{component:ld,id:"attributions",locales:[]},icon:"kern-icon--near-me"}],menus:[[{plugin:ji({checkLocationInitially:!1,keepCentered:!1,showTooltip:!0,zoomLevel:7})}],[{plugin:Eo({layers:{[Xe]:{window:!0,properties:["addr","statu","beschr","pic","kat_text","skat_text"],exportProperty:"pic",showTooltip:r=>[["span",`Coordinates: ${r.getGeometry().getCoordinates().join(", ")}`]]},[tr]:{window:!0}},afterLoadFunction:r=>(Object.values(r).forEach(e=>{e.forEach(t=>{t.properties&&(t.properties={addr:[t.properties.str,t.properties.hsnr].join(" "),...t.properties})})}),r),featureList:{activeLayers:{plugin:"layerChooser",key:"activeMaskIds"},mode:"visible",bindWithCoreHoverSelect:!1,pageLength:5,text:{title:r=>r.get("str")+" "+r.get("hsnr"),subtitle:"Michels Meldung",subSubtitle:r=>r.get("skat_text")}},multiSelect:"box",directSelect:!0})}],[{plugin:{component:td,id:"realKewl",locales:[]},icon:"kern-icon-fill--share"}],[{plugin:il({})},{plugin:xn({})}]]}));he(J,xi({leftEntries:[{id:"mockPointer",component:ad}],rightEntries:[Lr({}),{id:"mockAttributions",component:rd}]}));const rr=lt(J,"toast");rr.addToast({text:"Hallo Welt",severity:"info"});rr.addToast({text:"Achtung! Dies ist ein Toast!",severity:"error"});const ir=lt(J,"loadingIndicator");ir.addLoadingKey("loadingTest");setTimeout(()=>ir.removeLoadingKey("loadingTest"),2e3);wr(J,"core","selectedCoordinates",r=>document.getElementById("selected-feature-coordinates").innerText=JSON.stringify(r));document.getElementById("language-switcher").addEventListener("change",r=>{const e=r.target,{value:t}=e;kn(J,"core","language",t),e[0].innerHTML=t==="en"?"English":"Englisch",e[1].innerHTML=t==="en"?"German":"Deutsch"});document.getElementById("color-scheme-switcher").addEventListener("click",({target:r})=>{r.innerHTML=`Switch to ${Ee} mode`,Ee=Ee==="light"?"dark":"light",kn(J,"core","colorScheme",Ee)});function hd(){const r=document.getElementById("snowbox"),e=lt(r,"core"),t=e.activePluginIds;window.map=r,window.olMap=e.map,window.coreStore=e,window.activePluginIds=t;for(const n of t)window[`${n}Store`]=e.getPluginStore(n)}setTimeout(()=>{hd(),console.info("POLAR debug assistant was successfully initialized")},7e3);
