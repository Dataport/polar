const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pinia-BhmAVTvm-Dvvq2Cue.js","./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js","./store-C5OS7H-y.js","./index-DIHDkKBB-DoYV-2cU.js","./reverseGeocode-CR3Bbmu1-DNBqHopz.js","./indicateLoading-BDKoxTDd-CXoezeA8.js"])))=>i.map(i=>d[i]);
import{a2 as H,a3 as gn,a4 as pn,a5 as fn,a6 as He,a7 as ce,a8 as yt,a9 as mn,aa as Ye,ab as yn,ac as wr,ad as Ae,ae as We,af as ne,ag as _n,ah as lt,ai as Ne,aj as vn,ak as Cr,al as bn,am as dt,an as xn,ao as kn,ap as wn,aq as Cn,ar as Sn,as as En,at as Tn,au as je,av as O,aw as _,ax as Lt,ay as A,az as Sr,aA as U,aB as xe,aC as Wt,aD as J,aE as de,aF as V,aG as Nt,aH as $n,aI as _t,aJ as Ln,aK as In,aL as An,aM as Pn,aN as Fn,aO as Er,aP as ct,aQ as Bt,aR as ze,aS as Ee,aT as re,aU as ke,aV as Rn,aW as jt,aX as Te,aY as Tr,aZ as z,a_ as Mn,a$ as ut,b0 as Dn,b1 as Vt,b2 as te,b3 as On,b4 as X,b5 as we,b6 as Be,b7 as ir,b8 as $r,b9 as qt,ba as Kt,bb as Gn,bc as Nn,bd as Bn,be as or,bf as It,bg as oe,bh as Lr,bi as ht,bj as Vn,bk as Un,bl as zn,bm as Hn,bn as Wn,bo as jn,bp as Xt,bq as lr,br as qn,bs as Kn,bt as Xn,bu as Jn,bv as Yn,bw as Qn,bx as Zn,by as ea,bz as Ir,bA as ta,bB as ra,bC as Re,bD as na,F as vt,H as bt,I as xt,L as ot,bE as aa,bF as sa,bG as pe,bH as ia,R as Jt,J as oa,bI as Ar,U as Pr,T as Fr,$ as la,S as da}from"./runtime-core.esm-bundler-DLDCte3X.js";import{defineComponent as W,createElementBlock as E,openBlock as v,createElementVNode as L,renderSlot as Yt,computed as $,ref as F,createBlock as D,unref as y,withCtx as he,createVNode as Le,createCommentVNode as j,withDirectives as Qt,withKeys as me,withModifiers as ve,isRef as gt,vModelText as ca,toDisplayString as ae,normalizeClass as qe,nextTick as Zt,vModelSelect as ua,Fragment as K,renderList as Q,watch as Ie,toRaw as ha,resolveDynamicComponent as pt,normalizeStyle as ga,markRaw as dr,onMounted as pa,mergeModels as fa,useModel as ma,vModelDynamic as ya}from"./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js";import{defineStore as be,storeToRefs as ue}from"./pinia-BhmAVTvm-Dvvq2Cue.js";import{R as B,h as Z,f as le,v as De}from"./index-DIHDkKBB-DoYV-2cU.js";import{X as cr}from"./store-C5OS7H-y.js";import{indicateLoading as _a}from"./indicateLoading-BDKoxTDd-CXoezeA8.js";import{reverseGeocode as va}from"./reverseGeocode-CR3Bbmu1-DNBqHopz.js";const ba={class:"kern-card kern-card--small"},xa={class:"kern-card__container"},ka=W({__name:"PolarCard.ce",setup(n){return(e,t)=>(v(),E("article",ba,[L("div",xa,[Yt(e.$slots,"default",{},void 0,!0)])]))}}),wa=".kern-card{&[data-v-937e165b]{height:auto;min-width:25rem;border-radius:var(--kern-metric-border-radius-large);box-shadow:var(--polar-shadow)}.kern-card__container[data-v-937e165b]{padding:var(--kern-metric-space-small);padding-bottom:.625rem}}",kt=H(ka,[["styles",[wa]],["__scopeId","data-v-937e165b"]]);function Ca(n){const e=n.map(parseFloat),t=[];for(;e.length;)t.push(e.splice(0,2));return t}function Sa(n,e,t={}){n.getView().fit(e,t)}function Ea(n,e,t={}){let r;switch(e.geometry.type){case"Polygon":r=new yt([Ca(e.geometry.coordinates)]);break;case"Point":r=new ce(e.geometry.coordinates.map(parseFloat));break;default:console.warn(`ZoomTo for type ${e.geometry.type} not implemented.`);return}Sa(n,r,t)}const P={STREET:"street",DISTRICT:"district",PARCEL:"parcel",STREET_KEY:"streetKey",ADDRESS_AFFIXED:"addressAffixed",ADDRESS_UNAFFIXED:"addressUnaffixed",HOUSE_NUMBERS_FOR_STREET:"houseNumbersForStreet"};function Rr(n){return Array.isArray(n)&&n.length===1?Rr(n[0]):n}function ft(n,e){return Array.isArray(n)?n.map(t=>ft(t,e)).filter(t=>t)[0]:typeof n!="object"?null:typeof n[e]<"u"?n[e]:Object.keys(n).map(t=>ft(n[t],e)).filter(t=>t)[0]}function Ta(n){const e={objectType:Object.keys(n)[0]};return Object.keys(n[e.objectType][0]).forEach(t=>{e[t]=Rr(n[e.objectType][0][t])}),e}function $a(n){let e=[];return n.startsWith("POINT")&&(e=n.split(")")[0]?.split("(")[1]),e}function La(n,e){const t={type:e,properties:Ta(n)};let r=t.properties?.pos?$a(t.properties.pos):ft(t.properties,"pos")[0],a="",s="",i="";switch(e){case P.DISTRICT:t.name=t.properties.geographicIdentifier?._?t.properties.geographicIdentifier._:t.properties.geographicIdentifier;break;case P.STREET_KEY:case P.STREET:t.properties?.position_strassenachse&&(r=ft(t.properties?.position_strassenachse,"pos")[0]),t.name=Ye()?t.properties.geographicIdentifier._:t.properties.strassenname;break;case P.PARCEL:t.name=`${t.properties.gemarkung}/${t.properties.flurstuecksnummer}`;break;case P.HOUSE_NUMBERS_FOR_STREET:a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,t.properties.hausnummernzusatz&&(s=t.properties.hausnummernzusatz?._?t.properties.hausnummernzusatz._:t.properties.hausnummernzusatz),t.properties.hausnummerkomplett=`${a}${s}`,t.name=Ye()?t.properties.geographicIdentifier._:(t.properties?.geographicIdentifier?t.properties.geographicIdentifier._.split(t.properties.hausnummerkomplett)[0]:t.properties.strassenname+" ")+t.properties.hausnummerkomplett;break;case P.ADDRESS_AFFIXED:i=t.properties.strassenname?._?t.properties.strassenname._:t.properties.strassenname,a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,s=t.properties.hausnummernzusatz?._?t.properties.hausnummernzusatz._:t.properties.hausnummernzusatz,t.name=Ye()?t.properties.geographicIdentifier._:`${i} ${a}${s}`;break;case P.ADDRESS_UNAFFIXED:i=t.properties.strassenname?._?t.properties.strassenname._:t.properties.strassenname,a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,t.name=Ye()?t.properties.geographicIdentifier._:(t.properties?.geographicIdentifier?t.properties.geographicIdentifier._.split(a)[0]:i+" ")+a;break;default:t.name=null,console.error(`Unknown type in searchAddress.parse: '${e}'. Could not set name.`);break}switch(e){case P.DISTRICT:case P.STREET_KEY:case P.STREET:case P.PARCEL:case P.HOUSE_NUMBERS_FOR_STREET:case P.ADDRESS_AFFIXED:case P.ADDRESS_UNAFFIXED:t.geometry={type:"Point",coordinates:r.split(" ")};break;default:t.geometry=null,console.error(`Unknown type in searchAddress.parse: '${e}'. Could not set geometry.`);break}return t}function Mr(n,e){return new Promise((t,r)=>{cr.parseString(e,{tagNameProcessors:[cr.processors.stripPrefix]},(a,s)=>{if(a){r(a);return}try{const i=s.FeatureCollection?.member?s.FeatureCollection.member.map(o=>La(o,n)).sort((o,l)=>o.name.localeCompare(l.name)):[];t(i)}catch(i){r(i)}})})}function Ia(n){return Array.isArray(n)?n.map(encodeURIComponent):encodeURIComponent(n)}function Aa(n,e,t=!0){return{[P.STREET]:r=>t?`&StoredQuery_ID=findeStrasse&strassenname=*${r}`:`&StoredQuery_ID=findeStrasse&strassenname=${r}`,[P.DISTRICT]:r=>`&StoredQuery_ID=findeStadtteil&stadtteilname=${r}`,[P.PARCEL]:r=>`&StoredQuery_ID=Flurstueck&gemarkung=${r[0]}&flurstuecksnummer=${r[1]}`,[P.STREET_KEY]:r=>`&StoredQuery_ID=findeStrassenSchluessel&strassenschluessel=${r}`,[P.ADDRESS_AFFIXED]:r=>`&StoredQuery_ID=AdresseMitZusatz&strassenname=${r[0]}&hausnummer=${r[1]}&zusatz=${r[2]}`,[P.ADDRESS_UNAFFIXED]:r=>`&StoredQuery_ID=AdresseOhneZusatz&strassenname=${r[0]}&hausnummer=${r[1]}`,[P.HOUSE_NUMBERS_FOR_STREET]:r=>`&StoredQuery_ID=HausnummernZuStrasse&strassenname=${r}`}[n](Ia(e))}function Dr(n,e,t,r){return new Promise((a,s)=>{const i=mn()+Aa(n,e,r);fetch(i,{signal:t?.signal,timeout:6e3}).then(o=>a(o.text())).catch(o=>s(o))})}let Ve=null;function Ce(n,e,t=(s,i)=>s.name.localeCompare(i.name),r=()=>!0,a){return new Promise((s,i)=>{Dr(n,e,Ve,a).then(o=>{Mr(n,o).then(l=>{s(l.filter(r).sort(t))})}).catch(o=>i(o))})}function Pa(n,e,t){return new Promise((r,a)=>{Dr(P.STREET,n,Ve,t).then(s=>Mr(P.STREET,s)).then(s=>{const i=[],o=n.match(new RegExp("^(.+)[\\s,](\\d+|\\d.*)$"));for(let l=0;l<s.length;l++)i.push([s[l]]),e&&i.push(Ce(P.HOUSE_NUMBERS_FOR_STREET,s[l].name,void 0,void 0,t));return!s.length&&o?.length&&e&&i.push(Ce(P.HOUSE_NUMBERS_FOR_STREET,o[1],(l,d)=>parseInt(l.properties?.hausnummer,10)-parseInt(d.properties?.hausnummer,10),l=>l.properties?.hausnummerkomplett?.indexOf(o[2])===0,t)),Promise.all(i)}).then(s=>r([].concat(...s))).catch(s=>a(s))})}function ur(n,e,t=!1){return t&&Ve!==null&&Ve.abort(),Ve=new AbortController,new Promise((r,a)=>{const{map:s,zoom:i=!1,zoomToParams:o,searchAddress:l=!1,searchStreets:d=!1,searchStreetBeforeWord:c=!0,searchDistricts:u=!1,searchParcels:h=!1,searchStreetKey:g=!1,minCharacters:f=3}=e,C=[];let{searchHouseNumbers:b=!1}=e;if(n.length<f){a({error:"Search string too short."});return}if(i&&!s&&console.warn("Instructed to zoom, but required map object was not given. Zooming will be skipped."),!d&&b&&(console.warn(`Search for '${n}' supposed to retrieve house numbers, but not streets. Invalid search configuration. House numbers will not be searched for as a result.`),b=!1),!(l||d||b||u||h||g)){a({error:`Search for '${n}' received no indication what to search for. Search is canceled.`});return}if(d&&C.push(Pa(n,b,c)),l){let p=n.split(/(\d+)/).map(k=>k.trim()).filter(k=>k);if(p.length>3){const k=p[0],S=p[1],w=n.replace(p[0],"").replace(p[1],"").trim();p=[k,S,w]}const m=[!1,!1,P.ADDRESS_UNAFFIXED,P.ADDRESS_AFFIXED][p.length];m&&C.push(Ce(m,p))}if(u&&/^[a-z-üäöß]+$/i.test(n)&&C.push(Ce(P.DISTRICT,n)),g&&/^[a-z]{1}[0-9]{1,5}$/i.test(n)&&C.push(Ce(P.STREET_KEY,n)),h){let p;/^[0-9]{4}[\s|/][0-9]*$/.test(n)?p=n.split(/[\s|/]/):/^[0-9]{5,}$/.test(n)&&(p=[n.slice(0,4),n.slice(4)]),p&&C.push(Ce(P.PARCEL,p))}Promise.all(C).then(p=>{const m=[].concat(...p);if(i&&s&&m.length===1)try{Ea(s,m[0],o)}catch(k){console.error("Zooming to element from gazetteer failed."),console.error(k)}r(m)}).catch(p=>a(p))})}const Y="addressSearch";function Fa(n,e){const t=n.reduce((r,a)=>a.status==="fulfilled"?[...r,a.value]:r,[]);return e.signal.aborted||n.filter(({status:r})=>r==="rejected").forEach(({reason:r})=>{console.error(`@polar/polar(plugins/addressSearch/utils/getResultsFromPromises:20:4)
`,"An error occurred while sending a request: ",r)}),t}function Or(n){if(!n.ok)throw new Error(n.status===418?"The server refuses to brew coffee because it is, permanently, a teapot.":`The received status code ${n.status} indicates an error.`)}function Ra(n,e){let t=`query=${n.replace(" ","+")}`;for(const[r,a]of Object.entries(e).filter(([s])=>s!=="filter"&&s!=="epsg"&&s!=="apiKey"&&s!=="accessToken"))t+=`&${r}=${a}`;return e.filter&&Object.keys(e.filter).length>0&&(t+="&filter=",t=Object.entries(e.filter).reduce((r,[a,s])=>`${r+a}:${s}&`,t).slice(0,-1)),t}async function Ma(n,e,t,r){const a=`${e}?`+Ra(t,r),s={signal:n};r.accessToken?s.headers={Authorization:`Bearer ${r.accessToken}`}:r.apiKey&&(s.headers={"X-Api-Key":r.apiKey});const i=await fetch(encodeURI(a),s);Or(i);const o=await i.json();return{...o,features:o.features.map(l=>B(l,{geometry:B(l.geometry,{coordinates:r.epsg==="EPSG:4326"?l.geometry.coordinates:He(l.geometry.coordinates,"EPSG:4326",r.epsg)}),title:l.properties.text}))}}async function Da(n,e,t,r){yn(e);try{const a=B(r,{minCharacters:0});let s=await ur(t,B(a,{searchStreetBeforeWord:!1}));return!s[0]&&(s=await ur(t,a),!s[0])?{type:"FeatureCollection",features:[]}:{type:"FeatureCollection",features:Ga(s,r.epsg,Oa(s[0].properties.position.Point[0].$.srsName))}}catch(a){throw console.error(`@polar/polar(lib/getFeatures/mpapi:50:3)
`,a),new Error("An error occurred while fetching the feature collection.")}}function Oa(n){if(n.includes("::"))return`EPSG:${n.split("::")[1]}`;if(n.includes(":"))return n;throw console.error(`@polar/polar(lib/getFeatures/mpapi:63:2)
`,"Unknown formatting of projection:",n),Error("Unknown formatting of projection: "+n)}const Ga=(n,e,t)=>n.map(r=>{const{name:a,geometry:s}=r;return{type:"Feature",title:a,geometry:B(s,{coordinates:t===e?s.coordinates.map(Number):He(s.coordinates.map(Number),t,e)}),properties:r.properties}}),Na=n=>n.replace(/\r?\n|\r/g,""),Ba=({maxFeatures:n})=>`
<?xml version="1.0" encoding="UTF-8"?>
<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"${n?` maxFeatures="${n}"`:""}>`,Va={wildCard:"*",singleChar:".",escapeChar:"!"},Ua=({srsName:n,featurePrefix:e,typeName:t,xmlns:r})=>`
<wfs:Query typeName="${e}:${t}" xmlns:${e}="${r}"${n?` srsName="${n}"`:""}>
<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">`;function hr(n,e,{featurePrefix:t,useRightHandWildcard:r,likeFilterAttributes:a}){const s=B(Va,a||{});return`
<ogc:PropertyIsLike${Object.entries(s).reduce((i,[o,l])=>`${i} ${o}="${l}"`,"")}>
<ogc:PropertyName>${t}:${n}</ogc:PropertyName>
<ogc:Literal>${e}${typeof r=="boolean"&&!r?"":Object.hasOwn(s,"wildCard")?s.wildCard:"*"}</ogc:Literal>
</ogc:PropertyIsLike>`}function za(n,e){let t=Ua(e);if(n.length>1)t+=`<ogc:And>${n.map(([r,a])=>hr(r,a,e)).join("")}</ogc:And>`;else if(n.length===1){const r=n[0];t+=hr(r[0],r[1],e)}return t+"</ogc:Filter></wfs:Query>"}const Oe=(n,e)=>Na(Ba(e)+n.map(t=>za(t,e)).join("")+"</wfs:GetFeature>");if(import.meta.vitest){const{expect:n,test:e}=import.meta.vitest,t={typeName:"TyPeNaMe",featurePrefix:"prefix",xmlns:"example.com",maxFeatures:999};e("creates an empty search for an empty input",()=>{n(Oe([],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"></wfs:GetFeature>')}),e("creates a one-query search for a single match",()=>{n(Oe([[["a","5"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query></wfs:GetFeature>')}),e("creates a one-query and-ed search for a single match with multiple fields",()=>{n(Oe([[["a","5"],["b","3"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:b</ogc:PropertyName><ogc:Literal>3*</ogc:Literal></ogc:PropertyIsLike></ogc:And></ogc:Filter></wfs:Query></wfs:GetFeature>')}),e("creates a multi-query search for a multiple matches",()=>{n(Oe([[["a","5"]],[["b","3"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:b</ogc:PropertyName><ogc:Literal>3*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query></wfs:GetFeature>')})}const At={};function er(n){if(At[n])return At[n];const e=Array.from(n.matchAll(/{{(.*?)}}/g)),t=[];let r=0;for(const a of e)r<a.index&&(t.push(n.substring(r,a.index)),r=a.index),t.push(a),r+=a[0].length;return At[n]=t,t}const Ha=(n,e)=>n.uninterpreted>e.uninterpreted?1:n.uninterpreted<e.uninterpreted?-1:n.index>e.index?1:n.index<e.index?-1:0,Wa=(n,e,t)=>{const r=[...n.map((s,i)=>({match:s,uninterpreted:t[i],patternLengthDiff:(e[i].match(/{{/g)||[]).length-s.length,index:i}))].sort(Ha).map(({match:s})=>s),a=[];return r.filter(s=>{if(s.length===0)return!1;const i=JSON.stringify(s);return a.includes(i)?!1:(a.push(i),!0)})},Ut=(n,e,t)=>{if(!n)throw new Error('Parameter "patterns" is missing on wfs configuration for pattern-based search.');if(!e)throw new Error('Parameter "patternKeys" is missing on wfs configuration for pattern-based search.');const r=[],a=[];return n.forEach(s=>{const i=er(s),o=[];let l=t;i.forEach(d=>{let c="";if(Array.isArray(d)){const u=d[1],h=e[u],g=l.match(new RegExp("^"+h));if(g!==null){const f=g[1];o.push([u,f.trim()]),c=g[0].trim()}}else c=d.trim();l.startsWith(c)&&(l=l.substring(c.length).trim())}),a.push(l.length),r.push(o)}),Wa(r,n,a)};if(import.meta.vitest){const{expect:n,test:e}=import.meta.vitest,t=(s,i,o,l,d)=>{const c=[s,i];return c.index=o,c.input=l,c.groups=d,c},r=["{{gemarkung}} {{flur}} {{flstnrzae}}/{{flstnrnen}}, {{flstkennz}}","{{gemarkung}} {{flur}} {{flstnrzae}}, {{flstkennz}}","{{gemarkung}} {{flstnrzae}}/{{flstnrnen}}, {{flstkennz}}","{{gemarkung}} {{flstnrzae}}, {{flstkennz}}","{{flstkennz}}"],a={gemarkung:"([^0-9]+)",flur:"([0-9]+)",flstnrzae:"([0-9]+)",flstnrnen:"([0-9]+)",flstkennz:"([0-9_]+)"};e("getBlocks parts pattern strings to Block[][]",()=>{n(er(r[0])).toEqual([t("{{gemarkung}}","gemarkung",0,r[0])," ",t("{{flur}}","flur",14,r[0])," ",t("{{flstnrzae}}","flstnrzae",23,r[0]),"/",t("{{flstnrnen}}","flstnrnen",37,r[0]),", ",t("{{flstkennz}}","flstkennz",52,r[0])])}),e("match builds full match groups",()=>{n(Ut(r,a,"Musterhausen 12 3/4, 1234___")).toEqual([[["gemarkung","Musterhausen"],["flur","12"],["flstnrzae","3"],["flstnrnen","4"],["flstkennz","1234___"]],[["gemarkung","Musterhausen"],["flur","12"],["flstnrzae","3"]],[["gemarkung","Musterhausen"],["flstnrzae","12"],["flstnrnen","3"]],[["gemarkung","Musterhausen"],["flstnrzae","12"],["flstkennz","3"]]])}),e("match manages to decide the best fit",()=>{n(Ut(r,a,"1234___")).toEqual([[["flur","1234"],["flstkennz","___"]],[["flstnrzae","1234"],["flstkennz","___"]],[["flstkennz","1234___"]]])})}function ja(n,e){return n.fillPercentage>e.fillPercentage?-1:n.fillPercentage<e.fillPercentage?1:n.keys.length>e.keys.length?-1:n.keys.length<e.keys.length?1:n.index>e.index?-1:n.index<e.index?1:0}function qa(n,e){const t=n.properties||{},r=[...e.map((a,s)=>{const i=er(a).reduce((l,d)=>Array.isArray(d)?[...l,d[1]]:l,[]),o=i.reduce((l,d)=>typeof t[d]<"u"&&t[d]!==""?l+1:l,0);return{pattern:a,keys:i,index:s,fillPercentage:o/i.length}})].sort(ja)[0];return r.keys.reduce((a,s)=>a.replace(`{{${s}}}`,t[s]||""),r.pattern)}const gr=new gn,Ka=new pn;async function Xa(n,e,t,r){const a=[],s={type:"FeatureCollection",features:a},i=await n.text(),o=gr.readFeatures(i),{srsName:l}=gr.readFeatureCollectionMetadata(i);return o.forEach(d=>{const c=JSON.parse(Ka.writeFeature(d));c.title="",e&&(t?c.title=qa(c,e):c.title=Array.isArray(e)?e.map(u=>c.properties[u]).join(" "):c.properties[e]),l&&(c.geometry=B(c.geometry,{coordinates:He(c.geometry.coordinates,`EPSG:${l.split("::")[1]}`,r)})),a.push(c)}),s}async function Ja(n,e,t,r){const{fieldName:a,patterns:s,patternKeys:i}=r;if(!a&&(!s||!i))throw new Error('Incomplete WFS search configuration. Either "fieldName" or "patterns" & "patternKeys" are required.');a&&s&&console.error(`@polar/polar(lib/getFeatures/wfs/index:22:3)
`,'Using both "fieldName" and "patterns" for WFS search. These are mutually exclusive. "patterns" will be ignored.');const o=a?[[[a,t]]]:Ut(s,i,t),l=Oe(o,r),d=await fetch(encodeURI(e),{signal:n,method:"POST",body:l});return Or(d),Xa(d,a||s,!a,r.epsg)}function Ya(){const n={bkg:Ma,mpapi:Da,wfs:Ja};return{registerSearchMethods:e=>{Object.entries(e).forEach(([t,r])=>{if(n[t]){console.error(`@polar/polar(plugins/addressSearch/utils/methodContainer:16:6)
`,`Method "${t}" already exists. Please choose a different name. Overrides are not allowed.`);return}n[t]=r})},getSearchMethod:e=>{const t=n[e];if(t)return t;throw new Error(`The given type "${e}" does not define a valid searchMethod.`)}}}const fe={ERROR:Symbol("error"),NO_SEARCH:Symbol("noSearch")},wt=be("plugins/addressSearch",()=>{const n=Z(),e={label:"defaultLabel",hint:"",resultDisplayMode:"mixed",limitResults:Number.MAX_SAFE_INTEGER};let t=null,r,a;const s=F(null),i=F(""),o=F(!1),l=F(fe.NO_SEARCH),d=F("defaultGroup"),c=$(()=>u.value.afterResultComponent||null),u=$(()=>n.configuration.addressSearch),h=$({get:()=>i.value,set:I=>{I!==i.value&&(i.value=I,Je())}}),g=$(()=>Array.isArray(l.value)&&l.value.length>0&&l.value.some(({features:{features:I}})=>Array.isArray(I)&&I.length>0)),f=$(()=>u.value.focusAfterSearch||!1),C=$(()=>I=>{const N=u.value.groupProperties?.[I]||{};return I==="defaultGroup"?B(e,N):N}),b=$(()=>Object.keys(x.value)),p=$(()=>Object.keys(x.value).map(I=>({groupId:I,text:C.value(I).label}))),m=$(()=>b.value.length>1),k=$(()=>o.value?le(I=>I.hint.loading,{ns:Y}):l.value===fe.ERROR?le(I=>I.hint.error,{ns:Y}):h.value.length>0&&h.value.length<w.value?le(I=>I.hint.tooShort,{ns:Y,minLength:w.value}):l.value!==fe.NO_SEARCH&&!g.value?le(I=>I.hint.noResults,{ns:Y}):M.value.hint||""),S=$(()=>M.value.limitResults||e.limitResults),w=$(()=>typeof u.value.minLength=="number"?u.value.minLength:0),x=$(()=>u.value.searchMethods.reduce((I,N)=>{const ee=N.groupId||"defaultGroup";return I[ee]?I[ee].push(N):I[ee]=[N],I},{})),T=$({get:()=>d.value,set:I=>{I!==d.value&&(d.value=I,l.value=fe.NO_SEARCH,h.value.length>0&&Tt())}}),M=$(()=>C.value(T.value)),ie=$(()=>typeof u.value.waitMs=="number"?u.value.waitMs:0);function _e(){r=fn(Tt,ie.value),a=Ya(),T.value=b.value[0],u.value.customSearchMethods&&a.registerSearchMethods(u.value.customSearchMethods)}function St(){}function Je(){t&&(t.abort(),t=null),r()}function Et(){h.value="",l.value=fe.NO_SEARCH,s.value=null}function Tt(){if(h.value.length<w.value)return l.value=fe.NO_SEARCH,o.value=!1,Promise.resolve();o.value=!0,t=new AbortController;const I=t;return Promise.allSettled(u.value.searchMethods.map(async({categoryId:N,groupId:ee,queryParameters:Fe,type:$t,url:cn})=>{const un=await a.getSearchMethod($t)(I.signal,cn,h.value,B(Fe||{},{epsg:n.configuration.epsg})),ar=N||"default",sr=u.value.categoryProperties?.[ar];return{categoryId:ar,categoryLabel:sr?le(sr.label):le(hn=>hn.defaultLabel,{ns:Y}),features:un,groupId:ee||"defaultGroup"}})).then(N=>l.value=Fa(N,I)).catch(N=>{console.error(`@polar/polar(plugins/addressSearch/store:249:6)
`,"An error occurred while searching.",N),l.value=fe.ERROR}).finally(()=>{o.value=!1})}async function dn(I,N="never"){if(h.value=I,t&&(t.abort(),t=null),await Tt(),!Array.isArray(l.value))return;const ee=l.value.find(({features:$t})=>$t.features.length);if(!ee)return;const Fe=ee.features.features;(N==="first"&&Fe.length>=1||N==="only"&&Fe.length===1)&&nr(Fe[0],ee.categoryId)}function nr(I,N="default"){const ee=u.value.customSelectResult?.[N];ee?ee(I,N):(s.value=I,i.value=I.title,l.value=fe.NO_SEARCH)}return{chosenAddress:s,inputValue:h,afterResultComponent:c,focusAfterSearch:f,groupSelectOptions:p,hasMultipleGroups:m,isLoading:o,searchResults:l,selectedGroupId:T,featuresAvailable:g,hint:k,limitResults:S,abortAndRequest:Je,clear:Et,search:dn,selectResult:nr,setupPlugin:_e,teardownPlugin:St}});function Gr(n,e,t){for(let r=0;r<n;r++){const a=e.getElementById(`polar-plugin-address-search-results-feature-${r}-0`);if(a){a.focus(),t?.preventDefault();break}}}const Qa={class:"kern-form-input__select-wrapper"},Za=["aria-label"],es=["value"],ts=W({__name:"GroupSelect.ce",setup(n){const{groupSelectOptions:e,selectedGroupId:t}=ue(wt());return(r,a)=>(v(),E("div",Qa,[Qt(L("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>gt(t)?t.value=s:null),class:"kern-form-input__select","aria-label":r.$t(s=>s.groupSelector,{ns:y(Y)})},[(v(!0),E(K,null,Q(y(e),({groupId:s,text:i})=>(v(),E("option",{key:s,value:s},ae(r.$t(o=>o[i],{ns:y(Y)})),9,es))),128))],8,Za),[[ua,y(t)]])]))}});function rs(n,e){const t=n.toLowerCase().indexOf(e.toLowerCase());return t===-1?n:n.substring(0,t)+"<strong>"+n.substring(t,t+e.length)+"</strong>"+n.substring(t+e.length)}const ns={key:0,class:"polar-plugin-address-search-category-label"},as={tabindex:"-1"},ss=["id","onClick","onKeydown"],is=["innerHTML"],os=["onClick"],ls={class:"kern-label"},ds={key:2,class:"kern-divider","aria-hidden":"true"},cs=W({__name:"SearchResults.ce",setup(n){const e=Z(),t=wt(),{afterResultComponent:r,featuresAvailable:a,inputValue:s,limitResults:i,searchResults:o,selectedGroupId:l}=ue(t);Ie(l,()=>d.value=[]),Ie(a,()=>{t.focusAfterSearch&&Zt(()=>{Gr(u.value.length,e.shadowRoot)})});const d=F([]),c=$(()=>e.hasWindowSize?"inherit":`${e.clientHeight*.8}px`),u=$(()=>Array.isArray(t.searchResults)?structuredClone(ha(t.searchResults)).filter(b=>b.groupId===t.selectedGroupId).reduce((b,p)=>{const m=b.findIndex(k=>k.categoryId===p.categoryId);return m===-1?[...b,p]:(b[m].features.features=[...b[m].features.features,...p.features.features],b)},[]).map(b=>(h(b.categoryId)||(b.features.features=b.features.features.slice(0,i.value)),b)):[]);function h(b){return d.value.includes(b)}function g(){e.shadowRoot.getElementById("polar-plugin-address-search-input")?.focus()}function f(b,p){const{target:m}=p;if(m===null){console.warn(`@polar/polar(plugins/addressSearch/components/SearchResults.ce.vue?vue&type=script&setup=true&lang:110:3)
`,`@polar/polar(plugins/addressSearch/components/SearchResults.ce:168:3)
`,"Could not focus any element.");return}const k=(e.shadowRoot?.getElementById("polar-plugin-address-search-result-wrapper")).querySelectorAll("li, button"),S=[...k].indexOf(m),w=k[(S+(b?1:-1))%k.length];if(w){w.focus();return}e.shadowRoot.getElementById("polar-plugin-address-search-input")?.focus()}function C(b){d.value=d.value.indexOf(b)===-1?[...d.value,b]:d.value.filter(p=>p!==b)}return(b,p)=>y(a)?(v(),E("div",{key:0,id:"polar-plugin-address-search-result-wrapper",style:ga(`max-height: ${c.value}`)},[(v(!0),E(K,null,Q(u.value,(m,k)=>(v(),E(K,{key:m.categoryId},[u.value.length>1?(v(),E("span",ns,ae(m.categoryLabel)+" "+ae(b.$t(S=>S.resultCount,{count:y(o)[k].features.features.length,ns:y(Y)})),1)):j("",!0),L("ul",as,[(v(!0),E(K,null,Q(m.features.features,(S,w)=>(v(),E("li",{key:`result-${k}-${w}`,id:`polar-plugin-address-search-results-feature-${k}-${w}`,tabindex:"-1",onClick:x=>y(t).selectResult(S,m.categoryId),onKeydown:[me(ve(x=>y(t).selectResult(S,m.categoryId),["prevent","stop"]),["enter"]),p[0]||(p[0]=me(ve(x=>f(!0,x),["prevent","stop"]),["down"])),p[1]||(p[1]=me(ve(x=>f(!1,x),["prevent","stop"]),["up"])),me(ve(g,["prevent","stop"]),["escape"])]},[L("span",{innerHTML:y(rs)(S.title,y(s))},null,8,is),y(r)?(v(),D(pt(y(r)),{key:0,feature:S},null,8,["feature"])):j("",!0)],40,ss))),128))]),y(o)[k].features.features.length>y(i)?(v(),E("button",{key:1,class:"kern-btn kern-btn--tertiary",onKeydown:[p[2]||(p[2]=me(ve(S=>f(!0,S),["prevent","stop"]),["down"])),p[3]||(p[3]=me(ve(S=>f(!1,S),["prevent","stop"]),["up"]))],onClick:S=>C(m.categoryId)},[L("span",{class:qe(`kern-icon ${h(m.categoryId)?"kern-icon--keyboard-arrow-up":"kern-icon--keyboard-arrow-down"}`),"aria-hidden":"true"},null,2),L("span",ls,ae(b.$t(S=>S.resultList[h(m.categoryId)?"reduce":"extend"],{ns:y(Y)})),1)],40,os)):j("",!0),k<u.value.length-1?(v(),E("hr",ds)):j("",!0)],64))),128))],4)):j("",!0)}}),us="#polar-plugin-address-search-result-wrapper{&[data-v-3aa20fa5]{width:100%;padding-bottom:.625rem;overflow-y:auto}.polar-plugin-address-search-category-label[data-v-3aa20fa5]{display:flex;align-items:center;height:var(--kern-metric-dimension-x-large);padding:0 var(--kern-metric-space-small);font-size:.875rem;color:var(--kern-color-layout-text-muted)}ul{&[data-v-3aa20fa5]{margin:0;padding:0}li{&[data-v-3aa20fa5]{display:flex;align-items:center;min-height:var(--kern-metric-dimension-x-large);padding:var(--kern-metric-space-none) var(--kern-metric-space-small);margin:var(--kern-metric-space-none) var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);color:var(--kern-color-layout-text-default);transition:.3s cubic-bezier(.25,.8,.5,1)}&[data-v-3aa20fa5]:hover,&[data-v-3aa20fa5]:focus{background-color:var(--kern-color-layout-background-hued);cursor:pointer}}}button[data-v-3aa20fa5]{width:95%;margin:var(--kern-metric-space-none) var(--kern-metric-space-small)}}",hs=H(cs,[["styles",[us]],["__scopeId","data-v-3aa20fa5"]]),gs={class:"polar-plugin-address-search-selection-wrapper"},ps={class:"polar-plugin-address-search-input-wrapper"},fs=["aria-description","onKeydown"],ms={key:0,class:"loader",role:"status"},ys={class:"kern-label kern-sr-only"},_s={key:1,class:"polar-plugin-address-search-hint"},vs=W({__name:"AddressSearch.ce",setup(n){const e=Z(),t=wt(),{hasMultipleGroups:r,hint:a,inputValue:s,isLoading:i,searchResults:o}=ue(t),l=F(!1),d=$(()=>(e.hasSmallDisplay||!e.hasWindowSize)&&!l.value);function c(){(!l.value||!s.value.length&&!r.value)&&(l.value=!l.value,Zt(()=>{(e.shadowRoot?.getElementById(`polar-plugin-address-search-${l.value?"input":"icon-button"}`)).focus()}))}function u(h){Array.isArray(t.searchResults)&&Gr(t.searchResults.length,e.shadowRoot,h)}return(h,g)=>d.value?(v(),D(wr,{key:0,id:"polar-plugin-address-search-icon-button",hint:h.$t(f=>f.hint.button,{ns:y(Y)}),icon:"kern-icon--search",onClick:c},null,8,["hint"])):(v(),D(kt,{key:1,class:qe({"has-hint":y(a).length>0,"polar-plugin-address-search-shown-results":Array.isArray(y(o))&&y(o).length})},{default:he(()=>[L("div",gs,[y(r)?(v(),D(ts,{key:0})):j("",!0),L("div",ps,[Qt(L("input",{id:"polar-plugin-address-search-input","onUpdate:modelValue":g[0]||(g[0]=f=>gt(s)?s.value=f:null),class:"kern-form-input__input",type:"text","aria-description":y(a).length>0?y(a):h.$t(f=>f.ariaDescription,{ns:y(Y)}),onKeydown:[g[1]||(g[1]=me((...f)=>y(t).abortAndRequest&&y(t).abortAndRequest(...f),["enter"])),me(ve(u,["prevent","stop"]),["down"])],onFocusout:c},null,40,fs),[[ca,y(s)]]),y(i)?(v(),E("div",ms,[...g[3]||(g[3]=[L("div",null,null,-1),L("div",null,null,-1),L("div",null,null,-1),L("div",null,null,-1)])])):j("",!0),L("button",{class:"kern-btn kern-btn--tertiary polar-plugin-address-search-input-button",onClick:g[2]||(g[2]=(...f)=>y(t).clear&&y(t).clear(...f))},[g[4]||(g[4]=L("span",{class:"kern-icon kern-icon--close","aria-hidden":"true"},null,-1)),L("span",ys,ae(h.$t(f=>f.hint.clear,{ns:y(Y)})),1)]),y(a).length>0?(v(),E("span",_s,ae(y(a)),1)):j("",!0)])]),Le(hs)]),_:1},8,["class"]))}}),bs="#polar-plugin-address-search-icon-button[data-v-77e06208]{position:absolute;margin:var(--kern-metric-space-small)}.has-hint[data-v-77e06208] .kern-card__container{padding-bottom:var(--kern-metric-space-small)!important}.polar-plugin-address-search-shown-results[data-v-77e06208] .kern-card__container{padding-bottom:0!important}.kern-card{&[data-v-77e06208]{display:flex;flex-direction:column;align-items:flex-start;gap:var(--kern-metric-space-small);position:absolute;margin:var(--kern-metric-space-small)}.polar-plugin-address-search-selection-wrapper{&[data-v-77e06208]{display:flex;flex-direction:row;align-items:center;width:100%;gap:var(--kern-metric-space-small)}.polar-plugin-address-search-input-wrapper{&[data-v-77e06208]{display:flex;flex-direction:column;width:100%}#polar-plugin-address-search-input[data-v-77e06208]{border-radius:var(--kern-metric-border-radius-small);background:var(--kern-color-form-input-background)}.polar-plugin-address-search-input-button[data-v-77e06208]{position:absolute;right:0;border-radius:var(--kern-metric-border-radius-small);margin:var(--kern-metric-space-small);margin-right:var(--kern-metric-space-default);width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large)}.polar-plugin-address-search-hint[data-v-77e06208]{color:var(--kern-color-layout-text-muted);font-size:.875rem;padding:0 .1rem;margin-top:var(--kern-metric-space-small)}}}}.loader[data-v-77e06208],.loader div[data-v-77e06208]{box-sizing:border-box}.loader[data-v-77e06208]{position:absolute;right:3rem;width:var(--kern-metric-dimension-large);height:var(--kern-metric-dimension-large);margin:var(--kern-metric-space-small)}.loader div[data-v-77e06208]{box-sizing:border-box;display:block;position:absolute;width:var(--kern-metric-dimension-large);height:var(--kern-metric-dimension-large);border:4px solid currentColor;border-radius:50%;animation:loader-77e06208 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.loader div[data-v-77e06208]:nth-child(1){animation-delay:-.45s}.loader div[data-v-77e06208]:nth-child(2){animation-delay:-.3s}.loader div[data-v-77e06208]:nth-child(3){animation-delay:-.15s}@keyframes loader-77e06208{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",xs=H(vs,[["styles",[bs]],["__scopeId","data-v-77e06208"]]),ks={ariaDescription:"Durch Eingabe in das Suchfeld kann die Suche nach Adressen gestartet werden",defaultLabel:"Adresssuche",hint:{button:"Eingabefeld der Addresssuche anzeigen",clear:"Das Eingabefeld der Addresssuche leeren",error:"Etwas ist bei der Suche schiefgegangen.",loading:"Suche ...",noResults:"Keine Ergebnisse gefunden.",tooShort:"Für die Suche bitte mindestens {{minLength}} Zeichen eingeben."},groupSelector:"Suchthema auswählen",resultCount:"({{count}} Ergebnisse)",resultList:{extend:"Alle Ergebnisse anzeigen",reduce:"Ergebnisliste reduzieren"}},ws={ariaDescription:"Durch Eingabe in das Suchfeld kann die Suche nach Adressen gestartet werden",defaultLabel:"Address Search",hint:{button:"Show address search input field",clear:"Clear address search input field",error:"Something went wrong.",loading:"Searching ...",noResults:"No results for the current query.",tooShort:"Please enter at least {{minLength}} characters."},groupSelector:"Select search topic",resultCount:"({{count}} results)",resultList:{extend:"Show all results",reduce:"Reduce result list"}},Cs=[{type:"de",resources:ks},{type:"en",resources:ws}];function Ss(n){return{id:Y,component:xs,locales:Cs,storeModule:wt,options:n}}const Nr=be("plugins/footer",()=>{const n=Z(),e=F([]),t=F([]);function r(){e.value=(n.configuration.footer?.leftEntries||[]).filter(({id:s})=>{const i=n.configuration[s]?.displayComponent;return typeof i=="boolean"?i:!0}),t.value=(n.configuration.footer?.rightEntries||[]).filter(({id:s})=>{const i=n.configuration[s]?.displayComponent;return typeof i=="boolean"?i:!0}),e.value.concat(t.value).forEach(s=>{n.addPlugin(B(s,{independent:!1}))}),e.value.map(s=>B(s,{component:dr(s.component)})),t.value.map(s=>B(s,{component:dr(s.component)}))}function a(){}return{leftEntries:e,rightEntries:t,setupPlugin:r,teardownPlugin:a}}),Es={class:"polar-plugin-footer-wrapper"},Ts=W({__name:"PolarFooter.ce",setup(n){const{leftEntries:e,rightEntries:t}=ue(Nr());return(r,a)=>(v(),E("div",Es,[L("ul",null,[(v(!0),E(K,null,Q(y(e),(s,i)=>(v(),E("li",{key:i},[(v(),D(pt(s.component)))]))),128))]),L("ul",null,[(v(!0),E(K,null,Q(y(t),(s,i)=>(v(),E("li",{key:i},[(v(),D(pt(s.component)))]))),128))])]))}}),$s=".polar-plugin-footer-wrapper{&[data-v-9004f27e]{position:absolute;bottom:0;display:flex;width:100%;height:var(--kern-metric-dimension-large);padding:var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-small);justify-content:space-between;align-items:center;flex-shrink:0;background:var(--kern-color-layout-background-hued);box-shadow:0 1px 1px #35395629,0 1px 2px #35395640,0 1px 6px #6e759740;border-radius:0 0 var(--kern-metric-border-radius-large) var(--kern-metric-border-radius-large)}ul{&[data-v-9004f27e]{display:flex;align-items:center;gap:var(--kern-metric-space-small);padding:0}li[data-v-9004f27e]{list-style:none}}}",Ls=H(Ts,[["styles",[$s]],["__scopeId","data-v-9004f27e"]]),Is={},As={},Ps=[{type:"de",resources:Is},{type:"en",resources:As}],Fs="footer";function Rs(n){return{id:Fs,component:Ls,locales:Ps,storeModule:Nr,options:n}}const Ms=100,Ds=100,Pt={undefinedBoundaryLayer:Symbol.for("Boundary Layer undefined"),undefinedBoundarySource:Symbol.for("Boundary Source undefined"),sourceNotReady:Symbol.for("Source not ready")};async function Os(n){let e=0;for(;n.getState()!=="ready"||n.getFeatures().length===0;)if(e++<Ms)await new Promise(t=>{setTimeout(t,Ds)});else return!1;return!0}async function Br(n,e,t){if(typeof e>"u")return!0;const r=n.getLayers().getArray().find(s=>s.get("id")===e);if(!(r instanceof Ae))return console.error(`@polar/polar(lib/passesBoundaryCheck:61:3)
`,`No layer configured to match boundaryLayerId "${e}".`),Pt.undefinedBoundaryLayer;const a=r.getSource();return a instanceof We?await Os(a)?a.getFeatures().some(s=>s.getGeometry()?.intersectsCoordinate(t)):(console.error(`@polar/polar(lib/passesBoundaryCheck:79:3)
`,`Layer with boundaryLayerId "${e}" did not load or is featureless.`),Pt.sourceNotReady):(console.error(`@polar/polar(lib/passesBoundaryCheck:70:3)
`,`Layer with boundaryLayerId "${e}" missing source.`),Pt.undefinedBoundarySource)}function pr(){}const R={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Gs={ERROR:"error"};let Ns=class extends je{constructor(e){super(Gs.ERROR),this.code=e.code,this.message=e.message}},Bs=class extends kn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=wn,this.watchId_=void 0,this.addChangeListener(R.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(R.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Cn(lt("EPSG:4326"),e),this.position_&&this.set(R.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(R.ACCURACY,t.accuracy),this.set(R.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(R.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(R.HEADING,t.heading===null?void 0:Sn(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const r=this.transform_(this.position_);this.set(R.POSITION,r.slice()),this.set(R.SPEED,t.speed===null?void 0:t.speed);const a=En(this.position_,t.accuracy);a.applyTransform(this.transform_),this.set(R.ACCURACY_GEOMETRY,a),this.changed()}positionError_(e){this.dispatchEvent(new Ns(e))}getAccuracy(){return this.get(R.ACCURACY)}getAccuracyGeometry(){return this.get(R.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(R.ALTITUDE)}getAltitudeAccuracy(){return this.get(R.ALTITUDE_ACCURACY)}getHeading(){return this.get(R.HEADING)}getPosition(){return this.get(R.POSITION)}getProjection(){return this.get(R.PROJECTION)}getSpeed(){return this.get(R.SPEED)}getTracking(){return this.get(R.TRACKING)}getTrackingOptions(){return this.get(R.TRACKING_OPTIONS)}setProjection(e){this.set(R.PROJECTION,lt(e))}setTracking(e){this.set(R.TRACKING,e)}setTrackingOptions(e){this.set(R.TRACKING_OPTIONS,e)}};const Vs=(n,e)=>()=>n.innerHTML=e.map(([t,r,a={}])=>`<${t}>${De.t(r,a)}</${t}>`).join(""),Us=`
	background: rgba(255, 255, 255, 0.8);
	padding: 0.2em 0.5em;
	border-radius: 4px;
	color: #16161d;
	box-shadow: 0px 0px 3px 2px rgba(0, 0, 0, 0.5);
`;function zs(n,e=Us){const t=document.createElement("div");t.style.cssText=e;const r=Vs(t,n);return De.on("languageChanged",r),De.store.on("added",r),r(),{element:t,unregister:()=>{De.off("languageChanges",r),De.store.off("added",r)}}}function Hs(){return navigator.permissions.query({name:"geolocation"}).then(({state:n})=>n==="denied").catch(()=>!1)}function Ws(n,e){const t=e/2*Math.sqrt(3),r=document.createElement("canvas").getContext("2d").createLinearGradient(0,-t,Math.sin(n),t+Math.cos(n));return r.addColorStop(0,"#0794FAFF"),r.addColorStop(2/3,"#0794FA00"),r}function js(n){if(typeof n.get("heading")>"u")return new dt;const e=42,t=Math.PI-n.get("heading");return new dt({image:new Tn({points:3,radius:e,rotation:t,fill:new Cr({color:Ws(t,e)}),displacement:[0,-30]})})}function qs(){const n=new Cr({color:"#0078D4"}),e=new bn({color:"#FFFFFF",width:2});return t=>[js(t),new dt({image:new xn({fill:n,stroke:e,radius:12}),fill:n,stroke:e})]}const Ks=(n,e)=>n[0]!==e[0]||n[1]!==e[1],Vr=be("plugins/geoLocation",()=>{const n=Z(),e=F(!1),t=F(null),r=F(null),a=F([]),s=$(()=>B({showTooltip:!1,zoomLevel:7},n.configuration.geoLocation||{})),i=$(()=>s.value.boundary),o=$(()=>e.value?"DISABLED":t.value===null?"LOCATABLE":"LOCATED"),l=new ne({type:"point",name:"geoLocationMarker"}),d=new Ae({source:new We({features:[l]}),properties:{name:"geoLocationMarkerLayer"},zIndex:1/0,style:qs()});function c(){n.map.addLayer(d),s.value.checkLocationInitially?C():Hs().then(x=>e.value=x),g()}function u(){n.map.removeLayer(d),p(),S(),h()}let h=pr;function g(){if(s.value.showTooltip){const{unregister:x,element:T}=zs([["h2","markerText",{ns:"geoLocation"}]]),M=new _n({element:T,positioning:"bottom-center",offset:[0,-5]});n.map.addOverlay(M);const ie=({pixel:_e,dragging:St})=>{if(St)return;const Je=n.map.getFeaturesAtPixel(_e,{layerFilter:Et=>Et.get("name")==="geoLocationMarkerLayer"}).length?n.map.getCoordinateFromPixel(_e):void 0;M.setPosition(Je)};n.map.on("pointermove",ie),h=()=>{x(),n.map.removeOverlay(M),n.map.un("pointermove",ie),h=pr}}}function f(){(o.value==="LOCATABLE"?C:p)()}function C(){if(e.value){b({message:"Geolocation API usage was denied by user or configuration."});return}t.value===null?t.value=new Bs({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:lt("EPSG:4326")}):m(),t.value.on("change:position",m),t.value.on("change:heading",({target:x})=>{l.set("heading",x.getHeading())}),t.value.on("error",b)}function b(x){Ne("error",le(T=>T.button.locationAccessDenied,{ns:"geoLocation"})),console.error(`@polar/polar(plugins/geoLocation/store:176:3)
`,x.message),e.value=!0,S()}function p(){t.value?.setTracking(!1),S(),t.value=null}async function m(){const x=He(t.value?.getPosition(),lt("EPSG:4326"),n.configuration.epsg),T=n.configuration.extent?vn(n.configuration.extent,x):!0,M=await Br(n.map,i.value?.layerId,x),ie=r.value!==M;r.value=M;const _e=typeof M=="symbol"&&i.value?.onError==="strict";if(!T||_e){w(_e),p();return}Ks(a.value,x)&&(k(x),ie&&!M&&w(!1))}function k(x){a.value=x;const T=!!l.getGeometry();l.setGeometry(new ce(x)),(s.value.keepCentered||!T)&&r.value&&(n.map.getView().setCenter(x),n.map.getView().setZoom(s.value.zoomLevel))}function S(){l.setGeometry(void 0),a.value=[]}function w(x){if(x){const M=le(ie=>ie.toast.boundaryError,{ns:"geoLocation"});Ne("error",M),console.error(`@polar/polar(plugins/geoLocation/store:264:4)
`,M);return}const T=le(M=>M.toast.notInBoundary,{ns:"geoLocation"});Ne("info",T,{timeout:1e4}),console.info(`@polar/polar(plugins/geoLocation/store:272:3)
`,T)}return{setupPlugin:c,teardownPlugin:u,locate:f,configuration:s,isGeolocationDenied:e,state:o,position:a,boundaryCheck:r}}),Ur="geoLocation",Xs=W({__name:"GeoLocation.ce",setup(n){const{layout:e}=ue(Z()),t=Vr(),{state:r}=ue(t),a=$(()=>r.value==="LOCATED"?"kern-icon-fill--near-me":r.value==="LOCATABLE"?"kern-icon--near-me":"kern-icon--near-me-disabled"),s=$(()=>t.configuration.renderType==="iconMenu"?void 0:e.value==="standard"||t.configuration.layoutTag?.includes("RIGHT")?"left":"right");return(i,o)=>(v(),D(wr,{class:qe(y(e)==="nineRegions"?"polar-plugin-geoLocation-nineRegions":""),hint:i.$t(l=>l.button.tooltip,{ns:y(Ur)}),icon:a.value,"tooltip-position":s.value,disabled:y(r)==="DISABLED",onClick:y(t).locate},null,8,["class","hint","icon","tooltip-position","disabled","onClick"]))}}),Js=".polar-plugin-geoLocation-nineRegions[data-v-45fc3e3e]{margin:var(--kern-metric-space-small)}",Ys=H(Xs,[["styles",[Js]],["__scopeId","data-v-45fc3e3e"]]),Qs={markerText:"Aktuelle Position",button:{locationAccessDenied:"Standortzugriff nutzerseitig abgelehnt",tooltip:"Eigene Position markieren"},toast:{boundaryError:"Die Überprüfung Ihrer Position ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Sie befinden sich nicht im Kartengebiet."}},Zs={markerText:"Current location",button:{locationAccessDenied:"Location access denied by user",tooltip:"Mark own location"},toast:{boundaryError:"Validating your position failed. Please try later again or contact an administrator if the issue persists.",notInBoundary:"You are not within the map's boundaries."}},ei=[{type:"de",resources:Qs},{type:"en",resources:Zs}];function ti(n){return{id:Ur,component:Ys,locales:ei,storeModule:Vr,options:n}}const G=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Ke(n){return $n(n[0].version,"1.3")>=0}const ri=O(G,{Service:_(Ci),Capability:_(wi)}),ni=O(G,{Request:_(Fi),Exception:_($i),Layer:_(Li),UserDefinedSymbolization:_(xi)});let ai=class extends Ln{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),V({version:this.version},ri,e,[])||null}};const zr={Name:_(A),Title:_(A),Abstract:_(A),KeywordList:_(Xr),OnlineResource:_(Wt),ContactInformation:_(Si),Fees:_(A),AccessConstraints:_(A)},si=O(G,zr),ii=O(G,{...zr,LayerLimit:_(Lt),MaxWidth:_(Lt),MaxHeight:_(Lt)}),oi=O(G,{ContactPersonPrimary:_(Ei),ContactPosition:_(A),ContactAddress:_(Ti),ContactVoiceTelephone:_(A),ContactFacsimileTelephone:_(A),ContactElectronicMailAddress:_(A)}),li=O(G,{ContactPerson:_(A),ContactOrganization:_(A)}),di=O(G,{AddressType:_(A),Address:_(A),City:_(A),StateOrProvince:_(A),PostCode:_(A),Country:_(A)}),ci=O(G,{Format:Sr(A)}),Hr={Name:_(A),Title:_(A),Abstract:_(A),KeywordList:_(Xr),BoundingBox:U(qr),Dimension:U(Ii),Attribution:_(bi),AuthorityURL:U(Di),Identifier:U(A),MetadataURL:U(Oi),DataURL:U(ge),FeatureListURL:U(ge),Style:U(Gi),Layer:U(Ct)},Wr=O(G,{...Hr,SRS:U(A),Extent:_(Ai),ScaleHint:U(Pi),LatLonBoundingBox:_((n,e)=>qr(n,e,!1)),Layer:U(Ct)}),jr=O(G,{...Hr,CRS:U(A),EX_GeographicBoundingBox:_(ki),MinScaleDenominator:_(xe),MaxScaleDenominator:_(xe),Layer:U(Ct)}),ui=O(G,{Title:_(A),OnlineResource:_(Wt),LogoURL:_(Kr)}),hi=O(G,{westBoundLongitude:_(xe),eastBoundLongitude:_(xe),southBoundLatitude:_(xe),northBoundLatitude:_(xe)}),gi=O(G,{GetCapabilities:_(Me),GetMap:_(Me),GetFeatureInfo:_(Me),DescribeLayer:_(Me),GetLegendGraphic:_(Me)}),pi=O(G,{Format:U(A),DCPType:U(Ri)}),fi=O(G,{HTTP:_(Mi)}),mi=O(G,{Get:_(ge),Post:_(ge)}),yi=O(G,{Name:_(A),Title:_(A),Abstract:_(A),LegendURL:U(Kr),StyleSheetURL:_(ge),StyleURL:_(ge)}),_i=O(G,{Format:_(A),OnlineResource:_(Wt)}),vi=O(G,{Keyword:Sr(A)});function bi(n,e){return V({},ui,n,e)}function xi(n,e){return{SupportSLD:!!J(n.getAttribute("SupportSLD")),UserLayer:!!J(n.getAttribute("UserLayer")),UserStyle:!!J(n.getAttribute("UserStyle")),RemoteWFS:!!J(n.getAttribute("RemoteWFS")),InlineFeatureData:!!J(n.getAttribute("InlineFeatureData")),RemoteWCS:!!J(n.getAttribute("RemoteWCS"))}}function qr(n,e,t=!0){const r=[de(n.getAttribute("minx")),de(n.getAttribute("miny")),de(n.getAttribute("maxx")),de(n.getAttribute("maxy"))],a=[de(n.getAttribute("resx")),de(n.getAttribute("resy"))],s={extent:r,res:a};return t&&(Ke(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function ki(n,e){const t=V({},hi,n,e);if(!t)return;const r=t.westBoundLongitude,a=t.southBoundLatitude,s=t.eastBoundLongitude,i=t.northBoundLatitude;if(!(r===void 0||a===void 0||s===void 0||i===void 0))return[r,a,s,i]}function wi(n,e){return V({},ni,n,e)}function Ci(n,e){return V({},Ke(e)?ii:si,n,e)}function Si(n,e){return V({},oi,n,e)}function Ei(n,e){return V({},li,n,e)}function Ti(n,e){return V({},di,n,e)}function $i(n,e){return V([],ci,n,e)}function Li(n,e){const t=V({},Ke(e)?jr:Wr,n,e);return t.Layer===void 0?Object.assign(t,Ct(n,e)):t}function Ct(n,e){const t=Ke(e),r=e[e.length-1],a=V({},t?jr:Wr,n,e);if(!a)return;let s=J(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),a.queryable=s!==void 0?s:!1;let i=Nt(n.getAttribute("cascaded"));i===void 0&&(i=r.cascaded),a.cascaded=i;let o=J(n.getAttribute("opaque"));o===void 0&&(o=r.opaque),a.opaque=o!==void 0?o:!1;let l=J(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),a.noSubsets=l!==void 0?l:!1;let d=de(n.getAttribute("fixedWidth"));d||(d=r.fixedWidth),a.fixedWidth=d;let c=de(n.getAttribute("fixedHeight"));c||(c=r.fixedHeight),a.fixedHeight=c;const u=["Style","AuthorityURL"];t?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(g){if(g in r){const f=a[g]||[];a[g]=f.concat(r[g])}});const h=["BoundingBox","Attribution"];return t?h.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):h.push("LatLonBoundingBox","ScaleHint","Extent"),h.forEach(function(g){if(!(g in a)){const f=r[g];a[g]=f}}),a}function Ii(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return Ke(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:J(n.getAttribute("multipleValues")),nearestValue:J(n.getAttribute("nearestValue")),current:J(n.getAttribute("current")),values:A(n)}),t}function Ai(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:J(n.getAttribute("nearestValue"))}}function Pi(n,e){return{min:de(n.getAttribute("min")),max:de(n.getAttribute("max"))}}function ge(n,e){return V({},_i,n,e)}function Fi(n,e){return V({},gi,n,e)}function Ri(n,e){return V({},fi,n,e)}function Mi(n,e){return V({},mi,n,e)}function Me(n,e){return V({},pi,n,e)}function Kr(n,e){const t=ge(n,e);if(t){const r=[Nt(n.getAttribute("width")),Nt(n.getAttribute("height"))];return t.size=r,t}}function Di(n,e){const t=ge(n,e);if(t)return t.name=n.getAttribute("name"),t}function Oi(n,e){const t=ge(n,e);if(t)return t.type=n.getAttribute("type"),t}function Gi(n,e){return V({},yi,n,e)}function Xr(n,e){return V([],vi,n,e)}function Ni({legendURL:n,layers:e="",url:t,typ:r,format:a,version:s}){return n?n==="ignore"?[]:[n]:e.split(",").filter(i=>i).map(i=>`${t}?SERVICE=${r}&REQUEST=GetLegendGraphic&FORMAT=${a||"image/png"}&VERSION=${s}&LAYER=${i}`)}const fr=(n,e)=>n.filter(t=>{let{minZoom:r,maxZoom:a}=t;return typeof r>"u"&&(r=0),typeof a>"u"&&(a=Number.MAX_SAFE_INTEGER),r<=e&&e<=a});function mt(n,e){if(Array.isArray(n))return n.map(t=>mt(t,e)).find(t=>t!==null)||null;if(typeof n=="object"){if(n.Name===e)return n;if(n.Layer)return mt(n.Layer,e)}return null}const Bi=n=>(Array.isArray(n)?n:[n]).map(e=>(Array.isArray(e.LegendURL)?e.LegendURL:typeof e.LegendURL=="object"?[e.LegendURL]:[]).map(t=>t.OnlineResource)).flat(1);function Vi(n,e){return mt(n.Capability.Layer,e)?.Title||""}function Ui(n,e){const t=mt(n.Capability.Layer,e)?.Style;return t&&Bi(t)[0]||""}function zi(n,e){const t=e[n];if(t)try{return new ai().read(t)}catch(r){console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:21:4)
`,`Error reading xml '${t}' for id '${n}'.`,r)}return null}function Hi(n,e){return Promise.all(n.map(async t=>{const{id:r}=t,a=t.options?.layers;if(a&&(a.title===!0||a.legend===!0)){if(typeof e[r]=="string")return console.warn(`@polar/polar(plugins/layerChooser/utils/capabilities:41:6)
`,`Re-fired loadCapabilities on id '${r}' albeit the GetCapabilities have already been successfully fetched. No re-fetch will occur.`),[r,null];const s=_t.getLayerWhere({id:t.id});if(!s||!s.url||!s.version||!s.typ)return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:49:6)
`,`Missing data for service '${s}' with id '${r}'.`),[r,null];const i=`${s.url}?service=${s.typ}&version=${s.version}&request=GetCapabilities`;try{const o=await fetch(i);return[r,await o.text()]}catch(o){return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:61:6)
`,`Capabilities from ${i} could not be fetched.`,o),[r,null]}}return[r,null]})).then(t=>t.reduce((r,[a,s])=>B(r,{[a]:s}),{}))}function Wi(n,e,t){const r=_t.getLayerWhere({id:n}),a=zi(n,e);return{[n]:(t.order?.split(",")||r.layers.split(",")).map(s=>({layerName:s,displayName:t.title===!0&&a?Vi(a,s):t.title===!1?s:t.title?.[s]||s,layerImage:t.legend===!0&&a?Ui(a,s):t.legend===!1?null:t.legend?.[s]||null}))}}const ji=n=>n.reduce(([e,t],r)=>_t.getLayerWhere({id:r.id})===null?(console.error(`@polar/polar(plugins/layerChooser/utils/getBackgroundsAndMasks:15:5)
`,`Layer ${r.id} not found in service register. This is a configuration issue. The map might behave in unexpected ways.`,r),[e,t]):r.type==="background"?[[...e,r],t]:[e,[...t,r]],[[],[]]),qi=n=>n.map(({id:e,name:t})=>({id:e,name:t})).map(e=>B(e,{rawLayer:_t.getLayerWhere({id:e.id})})).filter(({rawLayer:e})=>e!==null).reduce((e,t)=>{const r=Ni(t.rawLayer)[0];return typeof r=="string"?{...e,[t.id]:{name:t.name,url:r}}:e},{}),Pe=be("plugins/layerChooser",()=>{const n=Z(),e=F({}),t=F([]),r=F([]),a=F([]),s=F([]),i=F(""),o=F([]),l=F({}),d=F(""),c=F({}),u=F(""),h=$(()=>t.value.reduce((w,{id:x})=>({...w,[x]:a.value.findIndex(({id:T})=>T===x)===-1}),{})),g=$(()=>f.value.reduce((w,{id:x})=>({...w,[x]:s.value.findIndex(({id:T})=>T===x)===-1}),{})),f=$(()=>r.value.filter(({hideInMenu:w})=>!w)),C=$(()=>f.value.reduce((w,x)=>B(w,{[x.type]:Array.isArray(w[x.type])?w[x.type].concat(x):[x]}),{}));function b(){const[w,x]=ji(n.configuration.layers);t.value=w,r.value=x,w.length===0&&console.error(`@polar/polar(plugins/layerChooser/store:100:4)
`,'No layers of type "background" have been configured.'),i.value=w.find(({visibility:T})=>T)?.id||"",o.value=x.filter(({visibility:T})=>T).map(({id:T})=>T),k(),n.map.on("moveend",k),l.value=qi(n.configuration.layers),Hi(n.configuration.layers,e.value).then(T=>{e.value=T,n.configuration.layers.forEach(M=>{const ie=M.options?.layers;ie&&(c.value=B(c.value,Wi(M.id,T,ie)))})})}function p(){n.map.un("moveend",k)}Ie(i,w=>{n.map.getLayers().getArray().forEach(x=>{t.value.find(({id:T})=>T===x.get("id"))&&x.setVisible(x.get("id")===w)})}),Ie(o,w=>{m(w)});function m(w){n.map.getLayers().getArray().forEach(x=>{r.value.find(({id:T})=>T===x.get("id"))&&x.setVisible(w.includes(x.get("id")))})}function k(){const w=n.map.getView().getZoom();a.value=fr(t.value,w),s.value=fr(r.value,w);const x=a.value.map(({id:T})=>T);x.includes(i.value)||(i.value=x[0]||""),m(s.value.map(({id:T})=>T).filter(T=>o.value.includes(T)))}function S(w){const x=n.map.getLayers().getArray().find(T=>T.get("id")===u.value).getSource();if(!x){console.error(`@polar/polar(plugins/layerChooser/store:208:4)
`,`Action 'toggleOpenedOptionsServiceLayer' failed on ${u.value}. Layer not found in OpenLayers or source not initialized in OpenLayers.`);return}x.updateParams({...x.getParams(),LAYERS:w})}return{activeBackgroundId:i,activeMaskIds:o,backgrounds:t,capabilities:e,disabledBackgrounds:h,disabledMasks:g,layersWithLegends:l,layersWithOptions:c,masksSeparatedByType:C,shownMasks:f,openedLegendId:d,openedOptionsId:u,setupPlugin:b,teardownPlugin:p,toggleOpenedOptionsServiceLayer:S}}),se="layerChooser",Ki=["id"],Xi={class:"kern-label"},Jr=W({__name:"LayerInformationCard.ce",props:{identifier:{type:String},idName:{type:String}},setup(n){const e=n,t=Z(),r=Pe();pa(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-back-button`)?.focus()});function a(){const s=r[e.idName];r[e.idName]="",Zt(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-${s}-button`)?.focus()})}return(s,i)=>(v(),D(kt,null,{default:he(()=>[L("button",{id:`polar-layer-chooser-${n.identifier}-back-button`,class:"kern-btn kern-btn--secondary",onClick:a},[i[0]||(i[0]=L("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),L("span",Xi,ae(s.$t(o=>o.returnToLayers,{ns:y(se)})),1)],8,Ki),Yt(s.$slots,"default")]),_:3}))}}),Ji={class:"kern-label",for:"polar-layer-chooser-legend-anchor"},Yi=["href","aria-label"],Qi=["src","alt"],Zi=W({__name:"LayerLegend.ce",setup(n){const e=Pe(),t=$(()=>e.layersWithLegends[e.openedLegendId]);return(r,a)=>(v(),D(Jr,{identifier:"legend","id-name":"openedLegendId",class:"legend-card"},{default:he(()=>[L("label",Ji,ae(r.$t(s=>s.legend.to,{name:t.value.name,ns:y(se)})),1),L("a",{id:"polar-layer-chooser-legend-anchor",href:t.value.url,"aria-label":r.$t(s=>s.legend.to,{name:t.value.name,ns:y(se)}),target:"_blank"},[L("img",{src:t.value.url,alt:r.$t(s=>s.legend.to,{name:t.value.name,ns:y(se)})},null,8,Qi)],8,Yi)]),_:1}))}}),eo=".legend-card[data-v-e248e19b]{overflow-y:scroll}",to=H(Zi,[["styles",[eo]],["__scopeId","data-v-e248e19b"]]),ro={class:"kern-form-check"},no=["id","name","value","type","disabled"],ao=["for"],so=W({__name:"PolarInput.ce",props:fa({idSuffix:{type:String},label:{type:String},type:{type:null},value:{type:String},disabled:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=ma(n,"modelValue");return(t,r)=>(v(),E("div",ro,[Qt(L("input",{id:`polar-${n.type}-${n.value}-${n.idSuffix}`,"onUpdate:modelValue":r[0]||(r[0]=a=>e.value=a),class:qe(`polar-input kern-form-check__${n.type}`),name:n.value,value:n.value,type:n.type,disabled:n.disabled},null,10,no),[[ya,e.value]]),L("label",{class:"polar-input kern-label",for:`polar-${n.type}-${n.value}-${n.idSuffix}`},ae(n.label),9,ao)]))}}),io=".kern-form-check__radio[disabled],.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:hover{border:var(--kern-metric-border-width-default) solid var(--kern-color-form-input-border)}}.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:checked:hover:before{margin:var(--kern-metric-space-x-small)}}",zt=H(so,[["styles",[io]],["__scopeId","data-v-83635f17"]]),oo={class:"kern-fieldset"},lo={class:"kern-label"},co={class:"kern-fieldset__body"},uo=W({__name:"PolarInputGroup.ce",props:{legend:{type:String}},setup(n){return(e,t)=>(v(),E("fieldset",oo,[L("legend",lo,ae(n.legend),1),L("div",co,[Yt(e.$slots,"default",{},void 0,!0)])]))}}),ho=".kern-fieldset[data-v-69d29a6c]{width:100%}.kern-fieldset__body[data-v-69d29a6c]{width:100%;padding:var(--kern-metric-space-small) 0;gap:var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);background-color:var(--kern-color-layout-background-hued)}.kern-label[data-v-69d29a6c]{padding-left:.75rem}[data-v-69d29a6c] .kern-form-check{align-items:center;gap:var(--kern-metric-space-large);margin-left:.75rem;padding-right:0}",Ht=H(uo,[["styles",[ho]],["__scopeId","data-v-69d29a6c"]]),go=["src","alt"],po=W({__name:"LayerOptions.ce",setup(n){const e=Z(),t=Pe(),{openedOptionsId:r}=ue(t),a=$(()=>t.layersWithOptions[r.value]),s=F(a.value.map(({layerName:l})=>l).reverse()),i=$({get:()=>s.value,set:l=>{s.value=l,t.toggleOpenedOptionsServiceLayer(l)}}),o=$(()=>e.configuration.layers.find(({id:l})=>l===r.value)?.name||"");return(l,d)=>(v(),D(Jr,{identifier:"options","id-name":"openedOptionsId"},{default:he(()=>[Le(Ht,{legend:l.$t(c=>c.layerHeader,{ns:y(se),name:o.value})},{default:he(()=>[(v(!0),E(K,null,Q(a.value,({displayName:c,layerImage:u,layerName:h})=>(v(),E("div",{key:`polar-layer-chooser-mask-options-checkbox-${h}`,class:"polar-layer-chooser-options-checkbox-wrapper"},[u?(v(),E("img",{key:0,src:u,alt:h},null,8,go)):j("",!0),Le(zt,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=g=>i.value=g),"id-suffix":"polar-layer-chooser-mask-options",label:c,type:"checkbox",value:h,class:qe(a.value.some(({layerImage:g})=>g!==null)?"polar-layer-chooser-options-checkbox":"")},null,8,["modelValue","label","value","class"])]))),128))]),_:1},8,["legend"])]),_:1}))}}),fo=".polar-layer-chooser-options-checkbox-wrapper[data-v-1ce80731]{display:flex;justify-content:flex-start;align-items:center;gap:var(--kern-metric-space-large)}.kern-form-check.polar-layer-chooser-options-checkbox[data-v-1ce80731]{margin-left:0}.kern-btn[data-v-1ce80731]{border:none;min-height:inherit;padding:var(--kern-metric-space-x-small)}.kern-label[data-v-1ce80731]{padding:0;padding-left:var(--kern-metric-space-small)}",mo=H(po,[["styles",[fo]],["__scopeId","data-v-1ce80731"]]),yo=["id","disabled"],_o={class:"kern-label kern-sr-only"},mr=W({__name:"LegendButton.ce",props:{disabled:{type:Boolean},id:{type:String}},setup(n){return(e,t)=>(v(),E("button",{id:`polar-layer-chooser-legend-${n.id}-button`,class:"kern-btn kern-btn--tertiary",disabled:n.disabled},[t[0]||(t[0]=L("span",{class:"kern-icon kern-icon--info","aria-hidden":"true"},null,-1)),L("span",_o,ae(e.$t(r=>r.legend.open,{ns:y(se)})),1)],8,yo))}}),vo=["id","disabled","onClick"],bo={class:"kern-label kern-sr-only"},xo=W({__name:"LayerSelection.ce",setup(n){const e=Pe(),{activeBackgroundId:t,activeMaskIds:r,backgrounds:a,disabledBackgrounds:s,disabledMasks:i,layersWithOptions:o,masksSeparatedByType:l,openedLegendId:d,shownMasks:c}=ue(e),u=$(()=>Object.keys(e.layersWithLegends));function h(g){e.openedOptionsId=g}return(g,f)=>(v(),D(kt,{id:"polar-layer-chooser-card"},{default:he(()=>[y(a).length?(v(),D(Ht,{key:0,legend:g.$t(C=>C.backgroundTitle,{ns:y(se)})},{default:he(()=>[(v(!0),E(K,null,Q(y(a),({name:C,id:b})=>(v(),E("div",{key:`polar-layer-chooser-background-radio-${b}`,class:"polar-layer-chooser-input-wrapper"},[Le(zt,{modelValue:y(t),"onUpdate:modelValue":f[0]||(f[0]=p=>gt(t)?t.value=p:null),"id-suffix":"polar-layer-chooser-background",label:C,type:"radio",value:b,disabled:y(s)[b]},null,8,["modelValue","label","value","disabled"]),u.value.includes(b)?(v(),D(mr,{key:0,id:b,disabled:y(s)[b],onClick:p=>d.value=b},null,8,["id","disabled","onClick"])):j("",!0)]))),128))]),_:1},8,["legend"])):j("",!0),y(c).length?(v(!0),E(K,{key:1},Q(Object.entries(y(l)),([C,b])=>(v(),D(Ht,{key:`polar-layer-chooser-mask-${C}`,legend:g.$t(p=>p[`${C}Title`],{ns:y(se)})},{default:he(()=>[(v(!0),E(K,null,Q(b,({name:p,id:m})=>(v(),E("div",{key:`polar-layer-chooser-mask-${C}-checkbox-${m}`,class:"polar-layer-chooser-input-wrapper"},[Le(zt,{modelValue:y(r),"onUpdate:modelValue":f[1]||(f[1]=k=>gt(r)?r.value=k:null),"id-suffix":`polar-layer-chooser-mask-${C}`,label:p,type:"checkbox",value:m,disabled:y(i)[m]},null,8,["modelValue","id-suffix","label","value","disabled"]),Object.keys(y(o)).includes(m)?(v(),E("button",{key:0,id:`polar-layer-chooser-options-${m}-button`,class:"kern-btn kern-btn--tertiary",disabled:y(i)[m],onClick:()=>h(m)},[f[2]||(f[2]=L("span",{class:"kern-icon kern-icon-fill--settings","aria-hidden":"true"},null,-1)),L("span",bo,ae(g.$t(k=>k.layerOptions,{ns:y(se)})),1)],8,vo)):u.value.includes(m)?(v(),D(mr,{key:1,id:m,disabled:y(i)[m],onClick:k=>d.value=m},null,8,["id","disabled","onClick"])):j("",!0)]))),128))]),_:2},1032,["legend"]))),128)):j("",!0)]),_:1}))}}),ko="#polar-layer-chooser-card[data-v-c4509e12]{overflow-y:inherit}.polar-layer-chooser-input-wrapper[data-v-c4509e12]{display:flex;justify-content:space-between;align-items:center;gap:var(--kern-metric-space-large)}.kern-btn[data-v-c4509e12]{width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large);border:none;border-radius:50%}",wo=H(xo,[["styles",[ko]],["__scopeId","data-v-c4509e12"]]),Co=W({__name:"LayerChooser.ce",setup(n){const e=Pe(),t=$(()=>e.openedLegendId.length!==0),r=$(()=>e.openedOptionsId.length===0&&!t.value);return(a,s)=>r.value?(v(),D(wo,{key:0})):t.value?(v(),D(to,{key:1})):(v(),D(mo,{key:2}))}}),So={backgroundTitle:"Hintergrundkarten",maskTitle:"Fachdaten",layerHeader:'Auswahl sichtbarer Ebenen für Layer "{{name}}"',layerOptions:"Optionen für Kartenmaterial",legend:{title:"Legende",to:'Legendenbild zu "{{name}}"',open:`$t(legend.to, {ns: ${se}}) öffnen`},returnToLayers:"Zurück"},Eo={backgroundTitle:"Background maps",maskTitle:"Subject data",layerHeader:'Visible layer selection for layer "{{name}}"',layerOptions:"Map data options",legend:{title:"Legend",to:'"{{name}}" legend image',open:`Open $t(legend.to, {ns: ${se}})`},returnToLayers:"Back"},To=[{type:"de",resources:So},{type:"en",resources:Eo}];function $o(n){return{id:se,component:Co,icon:"kern-icon-fill--layers",locales:To,storeModule:Pe,options:n}}const Lo=["KernLoader","BasicLoader","RingLoader","RollerLoader","CircleLoader","SpinnerLoader"],Yr=be("plugins/loadingIndicator",()=>{const n=F(new Set),e=F("KernLoader"),t=$(()=>n.value.size>0);function r(){const l=Z().configuration.loadingIndicator?.loaderStyle;l&&o(l)}function a(){o("KernLoader")}function s(l){n.value=new Set([...n.value,l])}function i(l){const d=new Set(n.value);d.delete(l),n.value=d}function o(l){Lo.includes(l)?e.value=l:console.error(`@polar/polar(plugins/loadingIndicator/store:62:5)
`,`Loader style ${l} does not exist. Using previous style (${e.value}).`)}return{loaderStyle:e,showLoader:t,addLoadingKey:s,removeLoadingKey:i,setLoaderStyle:o,setupPlugin:r,teardownPlugin:a}}),Io={class:"lds-default"},Ao=W({__name:"BasicLoader.ce",setup(n){return(e,t)=>(v(),E("div",Io,[(v(),E(K,null,Q(12,r=>L("div",{key:r})),64))]))}}),Po=".lds-default[data-v-6079aaec]{color:var(--kern-color-action-default)}.lds-default[data-v-6079aaec],.lds-default div[data-v-6079aaec]{box-sizing:border-box}.lds-default[data-v-6079aaec]{display:inline-block;position:relative;width:80px;height:80px}.lds-default div[data-v-6079aaec]{position:absolute;width:6.4px;height:6.4px;background:currentColor;border-radius:50%;animation:lds-default-6079aaec 1.2s linear infinite}.lds-default div[data-v-6079aaec]:nth-child(1){animation-delay:0s;top:36.8px;left:66.24px}.lds-default div[data-v-6079aaec]:nth-child(2){animation-delay:-.1s;top:22.08px;left:62.29579px}.lds-default div[data-v-6079aaec]:nth-child(3){animation-delay:-.2s;top:11.30421px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(4){animation-delay:-.3s;top:7.36px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(5){animation-delay:-.4s;top:11.30421px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(6){animation-delay:-.5s;top:22.08px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(7){animation-delay:-.6s;top:36.8px;left:7.36px}.lds-default div[data-v-6079aaec]:nth-child(8){animation-delay:-.7s;top:51.52px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(9){animation-delay:-.8s;top:62.29579px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(10){animation-delay:-.9s;top:66.24px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(11){animation-delay:-1s;top:62.29579px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(12){animation-delay:-1.1s;top:51.52px;left:62.29579px}@keyframes lds-default-6079aaec{0%,20%,80%,to{transform:scale(1)}50%{transform:scale(1.5)}}",Fo=H(Ao,[["styles",[Po]],["__scopeId","data-v-6079aaec"]]),Ro={},Mo=".lds-circle[data-v-149ac9d5]{color:var(--kern-color-action-default)}.lds-circle[data-v-149ac9d5],.lds-circle div[data-v-149ac9d5]{box-sizing:border-box}.lds-circle[data-v-149ac9d5]{display:inline-block;transform:translateZ(1px);width:80px;height:80px}.lds-circle>div[data-v-149ac9d5]{display:inline-block;width:64px;height:64px;margin:8px;background:currentColor;border-radius:50%;animation:lds-circle-149ac9d5 2.4s cubic-bezier(0,.2,.8,1) infinite}@keyframes lds-circle-149ac9d5{0%,to{animation-timing-function:cubic-bezier(.5,0,1,.5)}0%{transform:rotateY(0)}50%{transform:rotateY(1800deg);animation-timing-function:cubic-bezier(0,.5,.5,1)}to{transform:rotateY(3600deg)}}",Do={class:"lds-circle"};function Oo(n,e,t,r,a,s){return v(),E("div",Do,[...e[0]||(e[0]=[L("div",null,null,-1)])])}const Go=H(Ro,[["render",Oo],["styles",[Mo]],["__scopeId","data-v-149ac9d5"]]),No={},Bo=".lds-ring[data-v-712a38e8]{color:var(--kern-color-action-default)}.lds-ring[data-v-712a38e8],.lds-ring div[data-v-712a38e8]{box-sizing:border-box}.lds-ring[data-v-712a38e8]{display:inline-block;position:relative;width:80px;height:80px}.lds-ring div[data-v-712a38e8]{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid currentColor;border-radius:50%;animation:lds-ring-712a38e8 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.lds-ring div[data-v-712a38e8]:nth-child(1){animation-delay:-.45s}.lds-ring div[data-v-712a38e8]:nth-child(2){animation-delay:-.3s}.lds-ring div[data-v-712a38e8]:nth-child(3){animation-delay:-.15s}@keyframes lds-ring-712a38e8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",Vo={class:"lds-ring"};function Uo(n,e,t,r,a,s){return v(),E("div",Vo,[(v(),E(K,null,Q(4,i=>L("div",{key:i})),64))])}const zo=H(No,[["render",Uo],["styles",[Bo]],["__scopeId","data-v-712a38e8"]]),Ho={},Wo='.lds-roller[data-v-c8254b29]{color:var(--kern-color-action-default)}.lds-roller[data-v-c8254b29],.lds-roller div[data-v-c8254b29],.lds-roller div[data-v-c8254b29]:after{box-sizing:border-box}.lds-roller[data-v-c8254b29]{display:inline-block;position:relative;width:80px;height:80px}.lds-roller div[data-v-c8254b29]{animation:lds-roller-c8254b29 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller div[data-v-c8254b29]:after{content:" ";display:block;position:absolute;width:7.2px;height:7.2px;border-radius:50%;background:currentColor;margin:-3.6px 0 0 -3.6px}.lds-roller div[data-v-c8254b29]:nth-child(1){animation-delay:-36ms}.lds-roller div[data-v-c8254b29]:nth-child(1):after{top:62.62742px;left:62.62742px}.lds-roller div[data-v-c8254b29]:nth-child(2){animation-delay:-72ms}.lds-roller div[data-v-c8254b29]:nth-child(2):after{top:67.71281px;left:56px}.lds-roller div[data-v-c8254b29]:nth-child(3){animation-delay:-.108s}.lds-roller div[data-v-c8254b29]:nth-child(3):after{top:70.90963px;left:48.28221px}.lds-roller div[data-v-c8254b29]:nth-child(4){animation-delay:-.144s}.lds-roller div[data-v-c8254b29]:nth-child(4):after{top:72px;left:40px}.lds-roller div[data-v-c8254b29]:nth-child(5){animation-delay:-.18s}.lds-roller div[data-v-c8254b29]:nth-child(5):after{top:70.90963px;left:31.71779px}.lds-roller div[data-v-c8254b29]:nth-child(6){animation-delay:-.216s}.lds-roller div[data-v-c8254b29]:nth-child(6):after{top:67.71281px;left:24px}.lds-roller div[data-v-c8254b29]:nth-child(7){animation-delay:-.252s}.lds-roller div[data-v-c8254b29]:nth-child(7):after{top:62.62742px;left:17.37258px}.lds-roller div[data-v-c8254b29]:nth-child(8){animation-delay:-.288s}.lds-roller div[data-v-c8254b29]:nth-child(8):after{top:56px;left:12.28719px}@keyframes lds-roller-c8254b29{0%{transform:rotate(0)}to{transform:rotate(360deg)}}',jo={class:"lds-roller"};function qo(n,e,t,r,a,s){return v(),E("div",jo,[(v(),E(K,null,Q(8,i=>L("div",{key:i})),64))])}const Ko=H(Ho,[["render",qo],["styles",[Wo]],["__scopeId","data-v-c8254b29"]]),Xo={},Jo='.lds-spinner[data-v-1790c8de]{color:var(--kern-color-action-default)}.lds-spinner[data-v-1790c8de],.lds-spinner div[data-v-1790c8de],.lds-spinner div[data-v-1790c8de]:after{box-sizing:border-box}.lds-spinner[data-v-1790c8de]{color:currentColor;display:inline-block;position:relative;width:80px;height:80px}.lds-spinner div[data-v-1790c8de]{transform-origin:40px 40px;animation:lds-spinner-1790c8de 1.2s linear infinite}.lds-spinner div[data-v-1790c8de]:after{content:" ";display:block;position:absolute;top:3.2px;left:36.8px;width:6.4px;height:17.6px;border-radius:20%;background:currentColor}.lds-spinner div[data-v-1790c8de]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner div[data-v-1790c8de]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div[data-v-1790c8de]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div[data-v-1790c8de]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div[data-v-1790c8de]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div[data-v-1790c8de]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div[data-v-1790c8de]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div[data-v-1790c8de]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div[data-v-1790c8de]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div[data-v-1790c8de]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div[data-v-1790c8de]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div[data-v-1790c8de]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner-1790c8de{0%{opacity:1}to{opacity:0}}',Yo={class:"lds-spinner"};function Qo(n,e,t,r,a,s){return v(),E("div",Yo,[(v(),E(K,null,Q(12,i=>L("div",{key:i})),64))])}const Zo=H(Xo,[["render",Qo],["styles",[Jo]],["__scopeId","data-v-1790c8de"]]),el={key:0,class:"polar-plugin-loading-indicator-wrapper"},tl={key:0,class:"polar-plugin-loading-indicator-overlay"},rl={key:0,class:"kern-loader kern-loader--visible",role:"status"},nl=W({__name:"LoadingIndicator.ce",setup(n){const{layout:e}=ue(Z()),{loaderStyle:t,showLoader:r}=ue(Yr()),a={BasicLoader:Fo,CircleLoader:Go,RingLoader:zo,RollerLoader:Ko,SpinnerLoader:Zo};return(s,i)=>y(r)&&y(t)!==null?(v(),E("div",el,[y(e)==="standard"?(v(),E("div",tl)):j("",!0),Le(kt,null,{default:he(()=>[y(t)==="KernLoader"?(v(),E("div",rl)):(v(),D(pt(a[y(t)]),{key:1,class:"kern-loader--visible",role:"status"}))]),_:1})])):j("",!0)}}),al=".polar-plugin-loading-indicator-wrapper{&[data-v-d34e6512]{z-index:100;position:absolute;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.polar-plugin-loading-indicator-overlay[data-v-d34e6512]{position:absolute;width:100%;height:100%;opacity:var(--kern-color-action-state-opacity-overlay);background:#fff}.kern-card[data-v-d34e6512]{min-width:fit-content;height:fit-content;border-radius:50%}[data-v-d34e6512] .kern-card__container{padding:var(--kern-metric-space-small)!important}}",sl=H(nl,[["styles",[al]],["__scopeId","data-v-d34e6512"]]),il="loadingIndicator";function ol(n){return{id:il,component:sl,storeModule:Yr,options:n}}class Xe extends qn{constructor(e,t,r){super(),r!==void 0&&t===void 0?this.setFlatCoordinates(r,e):(t=t||0,this.setCenterAndRadius(e,t,r))}clone(){const e=new Xe(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,a){const s=this.flatCoordinates,i=e-s[0],o=t-s[1],l=i*i+o*o;if(l<a){if(l===0)for(let d=0;d<this.stride;++d)r[d]=s[d];else{const d=this.getRadius()/Math.sqrt(l);r[0]=s[0]+d*i,r[1]=s[1]+d*o;for(let c=2;c<this.stride;++c)r[c]=s[c]}return r.length=this.stride,l}return a}containsXY(e,t){const r=this.flatCoordinates,a=e-r[0],s=t-r[1];return a*a+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,r=t[this.stride]-t[0];return Kn(t[0]-r,t[1]-r,t[0]+r,t[1]+r,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Xn(e,t)){const r=this.getCenter();return e[0]<=r[0]&&e[2]>=r[0]||e[1]<=r[1]&&e[3]>=r[1]?!0:Jn(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,r=this.flatCoordinates[t]-this.flatCoordinates[0],a=e.slice();a[t]=a[0]+r;for(let s=1;s<t;++s)a[t+s]=e[s];this.setFlatCoordinates(this.layout,a),this.changed()}setCenterAndRadius(e,t,r){this.setLayout(r,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const a=this.flatCoordinates;let s=Yn(a,0,e,this.stride);a[s++]=a[0]+t;for(let i=1,o=this.stride;i<o;++i)a[s++]=a[i];a.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const r=this.getCenter(),a=this.getStride();this.setCenter(Qn(r,0,r.length,a,e,t,r)),this.changed()}}Xe.prototype.transform;function ye(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function Se(n,e){const t=n.length;let r=Math.floor(e);const a=e-r;r>=t?r-=t:r<0&&(r+=t);let s=r+1;s>=t&&(s-=t);const i=n[r],o=i[0],l=i[1],d=n[s],c=d[0]-o,u=d[1]-l;return[o+c*a,l+u*a]}const Qe={index:-1,endIndex:NaN,closestTargetDistance:1/0};function Qr(n,e,t,r){const a=n[0],s=n[1];let i=1/0,o=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const h=e.targets[u],g=h.coordinates;let f=1/0,C;for(let b=0;b<g.length-1;++b){const p=g[b],m=g[b+1],k=tn(a,s,p,m);k.squaredDistance<f&&(f=k.squaredDistance,C=b+k.along)}f<i&&(i=f,h.ring&&e.targetIndex===u&&(h.endIndex>h.startIndex?C<h.startIndex&&(C+=g.length):h.endIndex<h.startIndex&&C>h.startIndex&&(C-=g.length)),l=C,o=u)}const d=e.targets[o];let c=d.ring;if(e.targetIndex===o&&c){const u=Se(d.coordinates,l),h=t.getPixelFromCoordinate(u),g=t.getPixelFromCoordinate(e.startCoord);we(h,g)>r&&(c=!1)}if(c){const u=d.coordinates,h=u.length,g=d.startIndex,f=l;if(g<f){const C=tt(u,g,f);tt(u,g,f-h)<C&&(l-=h)}else{const C=tt(u,g,f);tt(u,g,f+h)<C&&(l+=h)}}return Qe.index=o,Qe.endIndex=l,Qe.closestTargetDistance=i,Qe}function Zr(n,e){const t=[];for(let r=0;r<e.length;++r){const a=e[r].getGeometry();en(n,a,t)}return t}function en(n,e,t){if(e instanceof Be){Ze(n,e.getCoordinates(),!1,t);return}if(e instanceof qt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a)Ze(n,r[a],!1,t);return}if(e instanceof yt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a)Ze(n,r[a],!0,t);return}if(e instanceof Kt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length;o<l;++o)Ze(n,i[o],!0,t)}return}if(e instanceof Zn){const r=e.getGeometries();for(let a=0;a<r.length;++a)en(n,r[a],t);return}}function Ze(n,e,t,r){const a=n[0],s=n[1];for(let i=0,o=e.length-1;i<o;++i){const l=e[i],d=e[i+1],c=tn(a,s,l,d);if(c.squaredDistance===0){const u=i+c.along;r.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function et(n,e){return Ir(n[0],n[1],e[0],e[1])}function tt(n,e,t){let r,a;e<t?(r=e,a=t):(r=t,a=e);const s=Math.ceil(r),i=Math.floor(a);if(s>i){const l=Se(n,r),d=Se(n,a);return et(l,d)}let o=0;if(r<s){const l=Se(n,r),d=ye(n,s);o+=et(l,d)}if(i<a){const l=ye(n,i),d=Se(n,a);o+=et(l,d)}for(let l=s;l<i-1;++l){const d=ye(n,l),c=ye(n,l+1);o+=et(d,c)}return o}const Ft={along:0,squaredDistance:0};function tn(n,e,t,r){const a=t[0],s=t[1],i=r[0],o=r[1],l=i-a,d=o-s;let c=0,u=a,h=s;return(l!==0||d!==0)&&(c=ra(((n-a)*l+(e-s)*d)/(l*l+d*d),0,1),u+=l*c,h+=d*c),Ft.along=c,Ft.squaredDistance=ea(Ir(n,e,u,h),10),Ft}const rt={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class nt extends je{constructor(e,t){super(e),this.feature=t}}class ll extends jt{constructor(e){const t=e;t.stopDown||(t.stopDown=Mn),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=cl(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:ze,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let r=e.geometryFunction;if(!r){const a=this.mode_;if(a==="Circle")r=(s,i,o)=>{const l=i||new Xe([NaN,NaN]),d=z(s[0]),c=ut(d,z(s[s.length-1]));return l.setCenterAndRadius(d,Math.sqrt(c),this.geometryLayout_),l};else{let s;a==="Point"?s=ce:a==="LineString"?s=Be:a==="Polygon"&&(s=yt),r=(i,o,l)=>(o?a==="Polygon"?i[0].length?o.setCoordinates([i[0].concat([i[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(i,this.geometryLayout_):o=new s(i,this.geometryLayout_),o)}}this.geometryFunction_=r,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Ae({source:new We({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:dl(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Dn,this.freehandCondition_,e.freehand?this.freehandCondition_=Te:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Bt,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Tr.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Te:t=e:t=ct,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=Te:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:Bt}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===Vt.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===te.POINTERMOVE,r=!0;return!this.freehand_&&this.lastDragTime_&&e.type===te.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===te.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),r=!1):this.freehand_&&e.type===te.POINTERDOWN?r=!1:t&&this.getPointerCount()<2?(r=e.type===te.POINTERMOVE,r&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===te.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===te.DBLCLICK&&(r=!1),super.handleEvent(e)&&r}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new On(te.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),r=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),a=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=X([r,a]),i=this.traceSource_.getFeaturesInExtent(s);if(i.length===0)return;const o=Zr(e.coordinate,i);o.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const r=e.startIndex<=e.endIndex,a=e.startIndex<=t;r===a?r&&t>e.endIndex||!r&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(r&&t<e.endIndex||!r&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let r=0;if(e<t){const a=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),r=s-a+1}else{const a=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),r=a-s+1}r>0&&this.removeLastPoints_(r)}addTracedCoordinates_(e,t,r){if(t===r)return;const a=[];if(t<r){const s=Math.ceil(t);let i=Math.floor(r);i===r&&(i-=1);for(let o=s;o<=i;++o)a.push(ye(e.coordinates,o))}else{const s=Math.floor(t);let i=Math.ceil(r);i===r&&(i+=1);for(let o=s;o>=i;--o)a.push(ye(e.coordinates,o))}a.length&&this.appendCoordinates(a)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const o=e.map.getPixelFromCoordinate(t.startCoord);if(we(o,e.pixel)<this.snapTolerance_)return}const r=Qr(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==r.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const o=t.targets[r.index];this.addTracedCoordinates_(o,o.startIndex,r.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,r.endIndex)}t.targetIndex=r.index;const a=t.targets[t.targetIndex];a.endIndex=r.endIndex;const s=Se(a.coordinates,a.endIndex),i=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(i[0]),Math.round(i[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const r=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const a=!this.finishCoordinate_;a&&this.startDrawing_(e.coordinate),!a&&this.freehand_?this.finishDrawing():!this.freehand_&&(!a||this.mode_==="Point")&&(this.atFinish_(e.pixel,r)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,r=e.pixel,a=t[0]-r[0],s=t[1]-r[1],i=a*a+s*s;if(this.shouldHandle_=this.freehand_?i>this.squaredClickTolerance_:i<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let r=!1;if(this.sketchFeature_){let a=!1,s=[this.finishCoordinate_];const i=this.mode_;if(i==="Point")r=!0;else if(i==="Circle")r=this.sketchCoords_.length===2;else if(i==="LineString")a=!t&&this.sketchCoords_.length>this.minPoints_;else if(i==="Polygon"){const o=this.sketchCoords_;a=o[0].length>this.minPoints_,s=[o[0][0],o[0][o[0].length-2]],t?s=[o[0][0]]:s=[o[0][0],o[0][o[0].length-2]]}if(a){const o=this.getMap();for(let l=0,d=s.length;l<d;l++){const c=s[l],u=o.getPixelFromCoordinate(c),h=e[0]-u[0],g=e[1]-u[1],f=this.freehand_?1:this.snapTolerance_;if(r=Math.sqrt(h*h+g*g)<=f,r){this.finishCoordinate_=c;break}}}}return r}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new ne(new ce(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new ne);const t=e.getLinearRing(0);let r=this.sketchLine_.getGeometry();r?(r.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),r.changed()):(r=new Be(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(r))}startDrawing_(e){const t=this.getMap().getView().getProjection(),r=ir(this.geometryLayout_);for(;e.length<r;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new ne(new Be(this.sketchLineCoords_)));const a=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new ne,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(a),this.updateSketchFeatures_(),this.dispatchEvent(new nt(rt.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),r=this.sketchFeature_.getGeometry(),a=t.getView().getProjection(),s=ir(this.geometryLayout_);let i,o;for(;e.length<s;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(i=this.sketchCoords_[0],o=i[i.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(i=this.sketchCoords_,o=i[i.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,r,a),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),r.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(r):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();let a,s;const i=this.mode_;return i==="LineString"||i==="Circle"?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():a=!0),s.push(e.slice()),this.geometryFunction_(s,t,r)):i==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():a=!0),s.push(e.slice()),a&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,r)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),a?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),a=this.mode_;for(let s=0;s<e;++s){let i;if(a==="LineString"||a==="Circle"){if(i=this.sketchCoords_,i.splice(-2,1),i.length>=2){this.finishCoordinate_=i[i.length-2].slice();const o=this.finishCoordinate_.slice();i[i.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(i,t,r),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(a==="Polygon"){i=this.sketchCoords_[0],i.splice(-2,1);const o=this.sketchLine_.getGeometry();if(i.length>=2){const l=i[i.length-2].slice();i[i.length-1]=l,this.createOrUpdateSketchPoint_(l)}o.setCoordinates(i),this.geometryFunction_(this.sketchCoords_,t,r)}if(i.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const r=e.getGeometry(),a=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,r,a)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,r,a),t=r.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new $r([t])):this.type_==="MultiLineString"?e.setGeometry(new qt([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Kt([t])),this.dispatchEvent(new nt(rt.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new nt(rt.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,r=!this.sketchFeature_;r&&this.startDrawing_(e[0]);let a;if(t==="LineString"||t==="Circle")a=this.sketchCoords_;else if(t==="Polygon")a=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;r&&a.shift(),a.pop();for(let i=0;i<e.length;i++)this.addToDrawing_(e[i]);const s=e[e.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new ne(new ce(r)),this.updateSketchFeatures_(),this.dispatchEvent(new nt(rt.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function dl(){const n=Xt();return function(e,t){return n[e.getGeometry().getType()]}}function cl(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const yr=0,Ue=1,_r=[0,0,0,0],$e=[],Rt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function Mt(n,e,t){let r;switch(e){case"LineString":r=n;break;case"MultiLineString":case"Polygon":r=n[t[0]];break;case"MultiPolygon":r=n[t[1]][t[0]];break}return r}class Dt extends je{constructor(e,t,r){super(e),this.features=t,this.mapBrowserEvent=r}}class ul extends jt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Gn,this.defaultDeleteCondition_=function(r){return Nn(r)&&Er(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Te,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Bn,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ae({source:new We({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:gl(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Ee(this.source_.getFeatures()),this.source_.addEventListener(or.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(or.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ke.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ke.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=Te:t=e:t=ct,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const a=this.SEGMENT_WRITERS_[t.getType()];a&&a(e,t)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(Vt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ee;const r=this.featuresBeingModified_.getArray();for(let a=0,s=t.length;a<s;++a){const i=t[a].feature;i&&!r.includes(i)&&this.featuresBeingModified_.push(i)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Dt(Rt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Vt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,r=[];t.forEach(function(a){e===a.feature&&r.push(a)});for(let a=r.length-1;a>=0;--a){const s=r[a];for(let i=this.dragSegments_.length-1;i>=0;--i)this.dragSegments_[i][0]===s&&this.dragSegments_.splice(i,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const r=t.getCoordinates(),a={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),a)}writeMultiPointGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a],o={feature:e,geometry:t,depth:[a],index:a,segment:[i,i]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length-1;a<s;++a){const i=r.slice(a,a+2),o={feature:e,geometry:t,index:a,segment:i};this.rBush_.insert(X(i),o)}}writeMultiLineStringGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length-1;o<l;++o){const d=i.slice(o,o+2),c={feature:e,geometry:t,depth:[a],index:o,segment:d};this.rBush_.insert(X(d),c)}}}writePolygonGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length-1;o<l;++o){const d=i.slice(o,o+2),c={feature:e,geometry:t,depth:[a],index:o,segment:d};this.rBush_.insert(X(d),c)}}}writeMultiPolygonGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length;o<l;++o){const d=i[o];for(let c=0,u=d.length-1;c<u;++c){const h=d.slice(c,c+2),g={feature:e,geometry:t,depth:[o,a],index:c,segment:h};this.rBush_.insert(X(h),g)}}}}writeCircleGeometry_(e,t){const r=t.getCenter(),a={feature:e,geometry:t,index:yr,segment:[r,r]},s={feature:e,geometry:t,index:Ue,segment:[r,r]},i=[a,s];a.featureSegments=i,s.featureSegments=i,this.rBush_.insert(It(r),a);let o=t;this.rBush_.insert(o.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const r=t.getGeometriesArray();for(let a=0;a<r.length;++a){const s=r[a],i=this.SEGMENT_WRITERS_[s.getType()];i(e,s)}}createOrUpdateVertexFeature_(e,t,r,a){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new ne(new ce(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",r),s.set("existing",a),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=te.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const t=[],r=this.vertexFeature_.getGeometry().getCoordinates(),a=X([r]),s=this.rBush_.getInExtent(a),i={};s.sort(hl);for(let o=0,l=s.length;o<l;++o){const d=s[o],c=d.segment;let u=re(d.geometry);const h=d.depth;if(h&&(u+="-"+h.join("-")),i[u]||(i[u]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===Ue){const g=br(e,d);oe(g,r)&&!i[u][0]&&(this.dragSegments_.push([d,0]),i[u][0]=d);continue}if(oe(c[0],r)&&!i[u][0]){this.dragSegments_.push([d,0]),i[u][0]=d;continue}if(oe(c[1],r)&&!i[u][1]){if(i[u][0]&&i[u][0].index===0){let g=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[h[1]];case"Polygon":if(d.index!==g[h[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),i[u][1]=d;continue}re(c)in this.vertexSegments_&&!i[u][0]&&!i[u][1]&&t.push(d)}return t}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const s=e.map.getPixelFromCoordinate(t.startCoord);if(we(s,e.pixel)<this.pixelTolerance_)return}const r=Qr(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(r.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==r.index){if(t.targetIndex!==-1){const i=t.targets[t.targetIndex];this.removeTracedCoordinates_(i.startIndex,i.endIndex)}else for(const i of this.traceSegments_){const o=i[0],l=o.geometry,d=i[1],c=l.getCoordinates();Mt(c,l.getType(),o.depth).splice(o.index+d,1),l.setCoordinates(c),d===0&&(o.index-=1)}const s=t.targets[r.index];this.addTracedCoordinates_(s,s.startIndex,r.endIndex)}else{const s=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(s,r.endIndex)}t.targetIndex=r.index;const a=t.targets[t.targetIndex];a.endIndex=r.endIndex}getTraceCandidates_(e){const t=this.getMap(),r=this.pixelTolerance_,a=t.getCoordinateFromPixel([e.pixel[0]-r,e.pixel[1]+r]),s=t.getCoordinateFromPixel([e.pixel[0]+r,e.pixel[1]-r]),i=X([a,s]);return this.traceSource_.getFeaturesInExtent(i)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const r=Zr(e.coordinate,t);r.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:r,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const r=e.startIndex<=e.endIndex,a=e.startIndex<=t;r===a?r&&t>e.endIndex||!r&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(r&&t<e.endIndex||!r&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let r=0;if(e<t){const a=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),r=s-a+1}else{const a=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),r=a-s+1}if(r>0)for(const a of this.traceSegments_){const s=a[0],i=s.geometry,o=a[1];let l=a[0].index+1;o===1&&(l-=r);const d=i.getCoordinates();Mt(d,i.getType(),s.depth).splice(l,r),i.setCoordinates(d),o===1&&(s.index-=r)}}addTracedCoordinates_(e,t,r){if(t===r)return;const a=[];if(t<r){const s=Math.ceil(t);let i=Math.floor(r);i===r&&(i-=1);for(let o=s;o<=i;++o)a.push(ye(e.coordinates,o))}else{const s=Math.floor(t);let i=Math.ceil(r);i===r&&(i+=1);for(let o=s;o>=i;--o)a.push(ye(e.coordinates,o))}if(a.length)for(const s of this.traceSegments_){const i=s[0],o=i.geometry,l=s[1],d=i.index+1;l===0&&a.reverse();const c=o.getCoordinates();Mt(c,o.getType(),i.depth).splice(d,0,...a),o.setCoordinates(c),l===1&&(i.index+=a.length)}}updateGeometry_(e,t){const r=t[0],a=r.depth;let s;const i=r.segment,o=r.geometry,l=t[1];for(;e.length<o.getStride();)e.push(i[l][e.length]);switch(o.getType()){case"Point":s=e,i[0]=e,i[1]=e;break;case"MultiPoint":s=o.getCoordinates(),s[r.index]=e,i[0]=e,i[1]=e;break;case"LineString":s=o.getCoordinates(),s[r.index+l]=e,i[l]=e;break;case"MultiLineString":s=o.getCoordinates(),s[a[0]][r.index+l]=e,i[l]=e;break;case"Polygon":s=o.getCoordinates(),s[a[0]][r.index+l]=e,i[l]=e;break;case"MultiPolygon":s=o.getCoordinates(),s[a[1]][a[0]][r.index+l]=e,i[l]=e;break;case"Circle":const d=o;if(i[0]=e,i[1]=e,r.index===yr)this.changingFeature_=!0,d.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let c=we(z(d.getCenter()),z(e));d.setRadius(c),this.changingFeature_=!1}break}s&&this.setGeometryCoordinates_(o,s)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([i])=>i));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],a=[],s=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(s){this.traceSegments_=[];for(const i of this.dragSegments_){const o=i[0];we(Lr(s,o.segment),s)/e.map.getView().getResolution()<1&&this.traceSegments_.push(i)}}for(let i=0,o=this.dragSegments_.length;i<o;++i){const l=this.dragSegments_[i],d=l[0],c=d.feature;r.includes(c)||r.push(c);const u=d.geometry;a.includes(u)||a.push(u),this.updateGeometry_(t,l)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,r,a,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(t);if(r?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const a=this.vertexFeature_.getGeometry().getCoordinates();for(let s=r.length-1;s>=0;--s)this.insertVertex_(r[s],a);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const r=this.dragSegments_[t][0],a=r.geometry;if(a.getType()==="Circle"){const s=a,i=s.getCenter(),o=r.featureSegments[0],l=r.featureSegments[1];o.segment[0]=i,o.segment[1]=i,l.segment[0]=i,l.segment[1]=i,this.rBush_.update(It(i),o);let d=s;this.rBush_.update(d.getExtent(),l)}else this.rBush_.update(X(r.segment),r)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new Dt(Rt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),r=t.getPixelFromCoordinate(e);t.getView().getProjection();const a=function(o,l){return vr(e,o)-vr(e,l)};let s,i;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(r,(l,d,c)=>{c&&c.getType()==="Point"&&(c=new ce(ht(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof ne&&this.features_.getArray().includes(l)){i=u;const h=l.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:l,geometry:i,segment:[h,h]}]}return!0},{layerFilter:o})}if(!s){const o=Vn(It(e,_r)),l=t.getView().getResolution()*this.pixelTolerance_,d=Un(zn(o,l,_r));s=this.rBush_.getInExtent(d)}if(s&&s.length>0){const o=s.sort(a)[0],l=o.segment;let d=br(e,o);const c=t.getPixelFromCoordinate(d);let u=we(r,c);if(i||u<=this.pixelTolerance_){const h={};if(h[re(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===Ue)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[o.feature],[o.geometry],this.snappedToVertex_);else{const g=t.getPixelFromCoordinate(l[0]),f=t.getPixelFromCoordinate(l[1]),C=ut(c,g),b=ut(c,f);if(u=Math.sqrt(Math.min(C,b)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=C>b?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[o.feature],[o.geometry],this.snappedToVertex_);const p={};p[re(o.geometry)]=!0;for(let m=1,k=s.length;m<k;++m){const S=s[m].segment;if(oe(l[0],S[0])&&oe(l[1],S[1])||oe(l[0],S[1])&&oe(l[1],S[0])){const w=re(s[m].geometry);w in p||(p[w]=!0,h[re(S)]=!0)}else break}}this.vertexSegments_=h;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const r=e.segment,a=e.feature,s=e.geometry,i=e.depth,o=e.index;let l;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":l=s.getCoordinates(),l[i[0]].splice(o+1,0,t);break;case"Polygon":l=s.getCoordinates(),l[i[0]].splice(o+1,0,t);break;case"MultiPolygon":l=s.getCoordinates(),l[i[1]][i[0]].splice(o+1,0,t);break;case"LineString":l=s.getCoordinates(),l.splice(o+1,0,t);break;default:return!1}this.setGeometryCoordinates_(s,l);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(s,o,i,1);const c={segment:[r[0],t],feature:a,geometry:s,depth:i,index:o};d.insert(X(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,r[1]],feature:a,geometry:s,depth:i,index:o+1};return d.insert(X(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?ht(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:t})=>oe(t[0],e)||oe(t[1],e))}removePoint(e){if(e&&(e=z(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=te.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([a])=>a));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Dt(Rt.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,t={};let r=!1,a,s,i,o,l,d,c,u,h,g,f;for(l=e.length-1;l>=0;--l)i=e[l],g=i[0],f=re(g.feature),g.depth&&(f+="-"+g.depth.join("-")),f in t||(t[f]={}),i[1]===0?(t[f].right=g,t[f].index=g.index):i[1]==1&&(t[f].left=g,t[f].index=g.index+1);for(f in t){switch(h=t[f].right,c=t[f].left,d=t[f].index,u=d-1,c!==void 0?g=c:g=h,u<0&&(u=0),o=g.geometry,s=o.getCoordinates(),a=s,r=!1,o.getType()){case"MultiLineString":s[g.depth[0]].length>2&&(s[g.depth[0]].splice(d,1),r=!0);break;case"LineString":s.length>2&&(s.splice(d,1),r=!0);break;case"MultiPolygon":a=a[g.depth[1]];case"Polygon":a=a[g.depth[0]],a.length>4&&(d==a.length-1&&(d=0),a.splice(d,1),r=!0,d===0&&(a.pop(),a.push(a[0]),u=a.length-1));break}if(r){this.setGeometryCoordinates_(o,s);const C=[];if(c!==void 0&&(this.rBush_.remove(c),C.push(c.segment[0])),h!==void 0&&(this.rBush_.remove(h),C.push(h.segment[1])),c!==void 0&&h!==void 0){const b={depth:g.depth,feature:g.feature,geometry:g.geometry,index:u,segment:C};this.rBush_.insert(X(b.segment),b)}this.updateSegmentIndices_(o,d,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:t})=>!(oe(t[0],e)||oe(t[1],e)))}insertPoint(e){const t=e?z(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((r,a)=>r||this.insertVertex_(a,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,r,a){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(r===void 0||s.depth===void 0||Hn(s.depth,r))&&s.index>t&&(s.index+=a)})}}function hl(n,e){return n.index-e.index}function vr(n,e,t){const r=e.geometry;if(r.getType()==="Circle"){let s=r;if(e.index===Ue){const i=ut(s.getCenter(),z(n)),o=Math.sqrt(i)-s.getRadius();return o*o}}const a=z(n);return $e[0]=z(e.segment[0]),$e[1]=z(e.segment[1]),ta(a,$e)}function br(n,e,t){const r=e.geometry;if(r.getType()==="Circle"&&e.index===Ue)return ht(r.getClosestPoint(z(n)));const a=z(n);return $e[0]=z(e.segment[0]),$e[1]=z(e.segment[1]),ht(Lr(a,$e))}function gl(){const n=Xt();return function(e,t){return n.Point}}const at={SELECT:"select"};class st extends je{constructor(e,t,r,a){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=a}}const it={};class tr extends Fn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Er,this.addCondition_=e.addCondition?e.addCondition:ct,this.removeCondition_=e.removeCondition?e.removeCondition:ct,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Bt,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:ze,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:pl(),this.features_=e.features||new Ee;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const r=e.layers;t=function(a){return r.includes(a)}}else t=ze;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[re(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[re(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ke.ADD,this.boundAddFeature_),this.features_.addEventListener(ke.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ke.ADD,this.boundAddFeature_),this.features_.removeEventListener(ke.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const r=this.findLayerOfFeature_(t);r&&this.addFeatureLayerAssociation_(t,r)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(t){if(t instanceof Ae&&t.getSource()&&t.getSource().hasFeature(e))return t})}getStyle(){return this.style_}applySelectedStyle_(e){const t=re(e);t in it||(it[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let a=t.length-1;a>=0;--a){const s=t[a];if(s!==this&&s instanceof tr&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(s.getStyle());return}}const r=re(e);e.setStyle(it[r]),delete it[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[re(e)]}selectFeatureInternal_(e,t,r){if(!(e instanceof ne)||!this.filter_(e,t))return;const a=this.getFeatures();return a.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),a.push(e),r?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const r=this.selectFeatureInternal_(e,t);return r&&this.dispatchEvent(new st(at.SELECT,[r],[],void 0)),!!r}removeFeatureInternal_(e,t){const r=this.getFeatures();if(!(!(e instanceof ne)||!r.getArray().includes(e)))return r.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new st(at.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Rn(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new st(at.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),a=this.toggleCondition_(e),s=!t&&!r&&!a,i=e.map,o=this.getFeatures(),l=[],d=[];if(s){let c=!1;i.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(c=!0,!!this.selectFeatureInternal_(u,h,d))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=o.getLength()-1;u>=0;--u){const h=o.item(u);(d.length>0&&!d.includes(h)||!c)&&this.removeFeatureInternal_(h,l)}}else i.forEachFeatureAtPixel(e.pixel,(c,u)=>{let h;if((r||a)&&(h=this.removeFeatureInternal_(c,l)),(t||a)&&!h&&(h=this.selectFeatureInternal_(c,u,d)),!!h)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(d.length>0||l.length>0)&&this.dispatchEvent(new st(at.SELECT,d,l,e)),!0}}function pl(){const n=Xt();return lr(n.Polygon,n.LineString),lr(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const Ot={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class Gt extends je{constructor(e,t,r,a,s){super(e),this.features=t,this.coordinate=r,this.startCoordinate=a,this.mapBrowserEvent=s}}class fl extends jt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const r=e.layers;t=function(a){return r.includes(a)}}else t=ze;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:ze,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Te,this.lastFeature_=null,this.addChangeListener(Tr.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new Ee([this.lastFeature_]);return this.dispatchEvent(new Gt(Ot.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new Ee([this.lastFeature_]);return this.dispatchEvent(new Gt(Ot.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const r=z(t),a=z(this.lastCoordinate_),s=r[0]-a[0],i=r[1]-a[1],o=this.features_||new Ee([this.lastFeature_]);o.forEach(function(l){const d=l.getGeometry();d.translate(s,i),l.setGeometry(d)}),this.lastCoordinate_=t,this.dispatchEvent(new Gt(Ot.TRANSLATING,o,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(r,a)=>{if(!(!(r instanceof ne)||!this.filter_(r,a))&&!(this.features_&&!this.features_.getArray().includes(r)))return r},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const r=this.getActive();(!t||!r)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const ml=(n,e,t)=>{if(t){const r=new DOMParser().parseFromString(t,"image/svg+xml");return r.querySelectorAll("[fill]").forEach(a=>{a.setAttribute("fill",n)}),r.querySelectorAll("[stroke]").forEach(a=>{a.setAttribute("stroke",e)}),r.querySelectorAll("path, circle, rect, polygon, ellipse").forEach(a=>{a.hasAttribute("fill")||a.setAttribute("fill",n),a.hasAttribute("stroke")||a.setAttribute("stroke",e)}),new XMLSerializer().serializeToString(r)}return`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="-1 -1 25 25"
  >
    <path
      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"
      fill="${n}"
      stroke="${e}"
      stroke-width="1"
    />
  </svg>
`},yl=({fill:n="#005CA9",stroke:e="#FFF",svg:t})=>{let r="";typeof n=="string"?r=n:"oklch"in n?r=`oklch(${n.oklch.l} ${n.oklch.c} ${n.oklch.h})`:"rgba"in n&&(r=`${n.rgba.r} ${n.rgba.g} ${n.rgba.b} ${n.rgba.a?n.rgba.a:""}`);let a="";return typeof e=="string"?a=e:"oklch"in e?a=`oklch(${e.oklch.l} ${e.oklch.c} ${e.oklch.h})`:"rgba"in e&&(a=`${e.rgba.r} ${e.rgba.g} ${e.rgba.b} ${e.rgba.a?e.rgba.a:""}`),new dt({image:new Pn({src:`data:image/svg+xml;base64,${btoa(ml(r,a,t))}`,scale:2,anchor:[.5,1]})})},_l={Circle:Xe,LinearRing:Wn,LineString:Be,MultiLineString:qt,MultiPoint:$r,MultiPolygon:Kt,Point:ce,Polygon:yt};function vl(n,e,t,r){const a=new _l[t](r);let s=jn(a.getExtent());return(t==="Polygon"||t==="MultiPolygon")&&!a.intersectsCoordinate(s)&&(s=(a.getType()==="Polygon"?a.getInteriorPoint():a.getInteriorPoints()).getFirstCoordinate()),n===e?s:He(s,n,e)}async function xr(n,e,t){if(!t)return!0;const r=await Br(e,t.layerId,n);return r===!0||typeof r=="symbol"&&t.onError!=="strict"?!0:(typeof r=="symbol"?(Ne("error",()=>le(a=>a.boundaryError,{ns:"pins"})),console.error(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:39:3)
`,"Checking boundary layer failed.")):(Ne("info",()=>le(a=>a.notInBoundary,{ns:"pins"})),console.info(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:43:3)
`,"Pin position outside of boundary layer:",n)),!1)}const bl=be("plugins/pins",()=>{const n=Z(),e=F(null),t=F(!1),r=$(()=>B({minZoomLevel:0,movable:"none",toZoomLevel:0},n.configuration.pins||{})),a=$(()=>{if(!e.value)return null;const p=An(e.value,n.configuration.epsg);return[p[1],p[0]]}),s=new Ae({source:new We,style:yl(r.value.style||{})}),i=new tr({layers:p=>p===s,style:null,condition:In}),o=new fl({condition:()=>n.map.getView().getZoom()>=r.value.minZoomLevel,layers:[s]});let l=null;function d(){n.map.addLayer(s),s.setZIndex(100),n.map.on("singleclick",async({coordinate:p})=>{await f(p)}),u(),h(),g()}function c(){const{map:p}=n;p.un("singleclick",async({coordinate:m})=>{await f(m)}),b(),p.removeLayer(s),p.removeInteraction(i),p.removeInteraction(o),l&&l()}function u(){const{coordinateSources:p}=r.value;p&&p.forEach(m=>{const k=m.plugin?n.getPluginStore(m.plugin):n;k&&(l=Ie(()=>k[m.key],S=>{S&&S.type!=="reverse_geocoded"&&C(S.geometry.coordinates,!1,{type:S.geometry.type})}))})}function h(){const{initial:p}=r.value;if(p){const{coordinate:m,centerOn:k,epsg:S}=p;if(k){C(m,!1,{epsg:S||n.configuration.epsg,type:"Point"});return}C(m)}}function g(){i.on("select",({selected:m})=>{r.value.movable==="none"&&(document.body.style.cursor=m.length?"not-allowed":"")}),n.map.addInteraction(i);const{movable:p}=r.value;p==="drag"&&(o.on("translatestart",()=>t.value=!0),o.on("translateend",({features:m})=>{t.value=!1,m.forEach(async k=>{const S=k.getGeometry().getCoordinates(),w=await xr(S,n.map,r.value.boundary)?S:e.value;w&&C(w)})}),n.map.addInteraction(o))}async function f(p){const m=n.map.getInteractions().getArray().some(w=>w instanceof ll&&(w._isMultiSelect||w._isDrawPlugin)||w instanceof ul||w._isDeleteSelect),{minZoomLevel:k,movable:S}=r.value;(S==="drag"||S==="click")&&n.map.getView().getZoom()>=k&&!m&&await xr(p,n.map,r.value.boundary)&&C(p)}function C(p,m=!0,k){b(),e.value=p,!m&&k&&(e.value=vl(k.epsg||n.configuration.epsg,n.configuration.epsg,k.type,p),n.map.getView().setCenter(e.value),n.map.getView().setZoom(r.value.toZoomLevel)),s.getSource().addFeature(new ne({geometry:new ce(e.value),type:"point",name:"mapMarker",zIndex:100}))}function b(){s.getSource().clear()}return{coordinate:e,latLon:a,setupPlugin:d,teardownPlugin:c}}),xl={boundaryError:"Die Überprüfung der Koordinate ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Diese Koordinate kann nicht gewählt werden."},kl={boundaryError:"Validating the coordinate failed. Please try again later or contact an administrator if the issue persists.",notInBoundary:"It is not possible to select this coordinate."},wl=[{type:"de",resources:xl},{type:"en",resources:kl}],Cl="pins";function Sl(n){return{id:Cl,locales:wl,storeModule:bl,options:n}}const rr="reverseGeocoder",rn=be("plugins/reverseGeocoder",()=>{const n=Z(),e=$(()=>n.configuration[rr]),t=F([]);function r(){for(const o of e.value.coordinateSources||[]){const l=o.plugin?n.getPluginStore(o.plugin):n;l&&t.value.push(Ie(()=>l[o.key],async d=>{d&&await i(d)},{immediate:!0}))}}function a(){t.value.forEach(o=>{o()})}function s(o,l){const d=o.plugin?n.getPluginStore(o.plugin):n;d&&d[o.key](l)}async function i(o){const l=_a();try{const d=await va(e.value.url,o);return e.value.addressTarget&&s(e.value.addressTarget,d),e.value.zoomTo&&n.map.getView().fit(new ce(o),{maxZoom:e.value.zoomTo,duration:400,easing:na}),d}catch(d){return console.error(`@polar/polar(plugins/reverseGeocoder/store:102:5)
`,"Reverse geocoding failed:",d),null}finally{l()}}return{reverseGeocode:i,setupPlugin:r,teardownPlugin:a}});if(import.meta.vitest){const{expect:n,test:e,vi:t}=import.meta.vitest,{createPinia:r,setActivePinia:a}=await Re(async()=>{const{createPinia:c,setActivePinia:u}=await import("./pinia-BhmAVTvm-Dvvq2Cue.js");return{createPinia:c,setActivePinia:u}},__vite__mapDeps([0,1]),import.meta.url),{reactive:s}=await Re(async()=>{const{reactive:c}=await import("./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js");return{reactive:c}},[],import.meta.url),i=await Re(()=>import("./store-C5OS7H-y.js").then(c=>c.s),__vite__mapDeps([2,0,1,3]),import.meta.url),o=await Re(()=>import("./reverseGeocode-CR3Bbmu1-DNBqHopz.js"),__vite__mapDeps([4,2,0,1,3]),import.meta.url),l=await Re(()=>import("./indicateLoading-BDKoxTDd-CXoezeA8.js"),__vite__mapDeps([5,3,0,1]),import.meta.url),d=e.extend({reverseGeocodeUtil:[async({},c)=>{const u=t.spyOn(o,"reverseGeocode").mockResolvedValue(null);await c(u)},{auto:!0}],indicateLoading:[async({},c)=>{const u=t.spyOn(l,"indicateLoading").mockImplementation(()=>()=>{});await c(u)},{auto:!0}],coreStore:[async({},c)=>{const u=t.fn(),h=s({configuration:{[rr]:{url:"https://wps.example",coordinateSources:[{key:"coordinateSource"}],addressTarget:{key:"addressTarget"},zoomTo:99}},map:{getView:()=>({fit:u})},coordinateSource:null,addressTarget:t.fn()});t.spyOn(i,"useCoreStore").mockReturnValue(h),await c(h)},{auto:!0}],store:[async({},c)=>{a(r());const u=rn();u.setupPlugin(),await c(u),u.teardownPlugin()},{auto:!0}]});d("detects changes in coordinate sources",async({reverseGeocodeUtil:c,coreStore:u})=>{u.coordinateSource=[1,2],await new Promise(h=>setTimeout(h)),n(c).toHaveBeenCalledWith("https://wps.example",[1,2])}),d("passes geocoding result to address target",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const g=Symbol("feature");c.mockResolvedValueOnce(g),await h.reverseGeocode([3,4]),n(u.addressTarget).toHaveBeenCalledOnce(),n(u.addressTarget).toHaveBeenCalledWith(g)}),d("zooms to input coordinate",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const g=Symbol("feature");c.mockResolvedValueOnce(g),await h.reverseGeocode([3,4]),n(u.map.getView().fit).toHaveBeenCalledOnce()})}function El(n){return{id:rr,storeModule:rn,options:n}}const Tl={style:{background:"#fff"}},$l=vt({__name:"EmptyComponent",setup(n){return(e,t)=>(xt(),bt("div",Tl,"HELLO THERE"))}}),Ll={class:"kern-btn kern-btn--tertiary",style:{"border-radius":"0.25rem","min-height":"2rem",width:"2rem"}},Il=vt({__name:"MockAttributions.ce",setup(n){return(e,t)=>(xt(),bt("button",Ll,[...t[0]||(t[0]=[ot("span",{class:"kern-icon kern-icon-fill--copyright",style:{color:"var(--kern-color-action-default)"}},null,-1)])]))}}),Al={style:{display:"flex",gap:"0.5rem"}},Pl=vt({__name:"MockPointerPosition.ce",setup(n){return(e,t)=>(xt(),bt("div",Al,[...t[0]||(t[0]=[ot("span",{class:"kern-icon kern-icon--fullscreen","aria-hidden":"true"},null,-1),ot("span",{style:{display:"flex","align-items":"center"}},"9.9555 | 53.5479",-1),ot("button",{class:"kern-btn kern-btn--tertiary",style:{"min-height":"1rem","font-size":"1.125rem","text-decoration-line":"underline","text-underline-offset":"2px","text-underline-position":"from-font",color:"#1a3da5"}}," EPSG:4326 ",-1)])]))}}),nn=[{id:"23420",name:"basemap.de Web Raster Farbe",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_farbe",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"23421",name:"basemap.de Web Raster Grau",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_grau",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"1454",name:"Ausgleichsflächen",url:"https://geodienste.hamburg.de/HH_WFS_Ausgleichsflaechen",typ:"WFS",featureType:"ausgleichsflaechen",outputFormat:"XML",version:"1.1.0",featureNS:"https://registry.gdi-de.org/id/de.hh.up",featurePrefix:"de.hh.up",legendURL:""},{id:"6059",name:"MML Anliegen",url:"https://geodienste.hamburg.de/lgv-config/anliegen_extern.json",typ:"GeoJSON",format:"XML",version:"1.0",minScale:"0",maxScale:"2500000",legendURL:"",urlIsVisible:!0},{id:"denkmaelerWMS",name:"Denkmal WMS",url:"https://efi2-deegree.schleswig-holstein.de/dish-deegree/services/wms_shp",typ:"WMS",layers:"0,1,2,3,4,6,24,25",legendURL:"ignore",format:"image/png",version:"1.3.0",transparent:!0}],Fl="data:application/json;base64,WwoJewoJCSJzdHlsZUlkIjogInBhbmRhIiwKCQkicnVsZXMiOiBbCgkJCXsKCQkJCSJzdHlsZSI6IHsKCQkJCQkicG9seWdvblN0cm9rZUNvbG9yIjogWzMsIDI1NSwgMSwgMV0sCgkJCQkJInBvbHlnb25GaWxsSGF0Y2giOiB7CgkJCQkJCSJiYWNrZ3JvdW5kQ29sb3IiOiBbMCwgMCwgMCwgMC4yNV0sCgkJCQkJCSJwYXR0ZXJuIjogImRpYWdvbmFsLXJpZ2h0IiwKCQkJCQkJInBhdHRlcm5Db2xvciI6IFszLCAyNTUsIDEsIDFdCgkJCQkJfQoJCQkJfQoJCQl9CgkJXQoJfQpdCg==",Rl={style:{background:"#fff"}},Ml=vt({__name:"YetAnotherEmptyComponent",setup(n){return(e,t)=>(xt(),bt("div",Rl,"Awesome"))}}),an="23420",Dl="23421",Ol="1454",kr="6059",Gl="denkmaelerWMS",sn="1693";let Ge="light";const q=await aa("snowbox",{colorScheme:Ge,startCenter:[573364,6028874],layers:[{id:an,visibility:!0,type:"background",name:"Basemap.de (Farbe)"},{id:Dl,type:"background",name:"Basemap.de (Grau)",maxZoom:6},{id:sn,visibility:!0,hideInMenu:!0,type:"mask",name:"meldemichel.layers.hamburgBorder"},{id:kr,type:"mask",name:"Anliegen (MML)",visibility:!1},{id:Ol,type:"mask",name:"Ausgleichsflächen",styleId:"panda",visibility:!0,minZoom:5},{id:Gl,type:"mask",name:"Kulturdenkmale",visibility:!0,options:{layers:{order:"6,24,25,4,3,2,1,0",title:{6:"Denkmalbereich",24:"Mehrheit von baulichen Anlagen",25:"Sachgesamtheit",4:"Baudenkmal",3:"Gründenkmal",2:"Gewässer",1:"Baudenkmal (Fläche)",0:"Gründenkmal (Fläche)"},legend:!0}}}],layout:"standard",checkServiceAvailability:!0,featureStyles:Fl,markers:{layers:[{id:kr,defaultStyle:{stroke:"#FFFFFF",fill:"#005CA9"},hoverStyle:{stroke:"#46688E",fill:"#8BA1B8"},selectionStyle:{stroke:"#FFFFFF",fill:"#E10019"},unselectableStyle:{stroke:"#FFFFFF",fill:"#333333"}}],clusterClickZoom:!0},locales:[{type:"de",resources:{fullscreen:{button:{label_on:"Mach groß",label_off:"Mach klein"}},iconMenu:{hints:{attributions:"LMAO",fullscreen:"BEEEEEG YOSHEEEEE"}}}}],scale:{showScaleSwitcher:!0}},nn);document.getElementById("secondMap").addEventListener("click",async()=>{const n=sa({startCenter:[573364,6028874],layers:[{id:an,visibility:!0,type:"background",name:"snowbox.layers.basemap"}]},nn);n.classList.add("snowbox"),document.getElementById("secondMapContainer").appendChild(n),pe(n,Pr({layoutTag:"TOP_RIGHT"}))});document.getElementById("secondMapClean").addEventListener("click",()=>{document.getElementById("secondMapContainer").innerText=""});pe(q,Fr({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"}));setTimeout(()=>{ia(q,"toast")},3e3);setTimeout(()=>{pe(q,Fr({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"})),Jt(q,"toast").addToast({text:"Sechs Sekunden",severity:"info"})},6e3);pe(q,ol({loaderStyle:"BasicLoader"}));pe(q,Ss({searchMethods:[{queryParameters:{searchStreets:!0,searchHouseNumbers:!0},type:"mpapi",url:"https://geodienste.hamburg.de/HH_WFS_GAGES?service=WFS&request=GetFeature&version=2.0.0"}],minLength:3,waitMs:300,focusAfterSearch:!0,groupProperties:{defaultGroup:{limitResults:5}}}));pe(q,Sl({coordinateSources:[{plugin:"addressSearch",key:"chosenAddress"}],boundary:{layerId:sn},movable:"drag",style:{fill:"#FF0019"},toZoomLevel:7}));pe(q,El({url:"https://geodienste.hamburg.de/HH_WPS",coordinateSources:[{plugin:"pins",key:"coordinate"}],addressTarget:{plugin:"addressSearch",key:"selectResult"},zoomTo:7}));pe(q,la({displayComponent:!0,layoutTag:"TOP_RIGHT",initiallyOpen:"layerChooser",focusMenus:[{plugin:{component:Ml,id:"attributions",locales:[]},icon:"kern-icon--near-me"}],menus:[[{plugin:ti({checkLocationInitially:!1,keepCentered:!1,showTooltip:!0,zoomLevel:7})}],[{plugin:{component:$l,id:"realKewl",locales:[]},icon:"kern-icon-fill--share"}],[{plugin:$o({})},{plugin:Pr({})}]]}));pe(q,Rs({leftEntries:[{id:"mockPointer",component:Pl}],rightEntries:[da({}),{id:"mockAttributions",component:Il}]}));const on=Jt(q,"toast");on.addToast({text:"Hallo Welt",severity:"info"});on.addToast({text:"Achtung! Dies ist ein Toast!",severity:"error"});const ln=Jt(q,"loadingIndicator");ln.addLoadingKey("loadingTest");setTimeout(()=>ln.removeLoadingKey("loadingTest"),2e3);oa(q,"core","selectedCoordinates",n=>document.getElementById("selected-feature-coordinates").innerText=JSON.stringify(n));document.getElementById("language-switcher").addEventListener("change",n=>{const e=n.target,{value:t}=e;Ar(q,"core","language",t),e[0].innerHTML=t==="en"?"English":"Englisch",e[1].innerHTML=t==="en"?"German":"Deutsch"});document.getElementById("color-scheme-switcher").addEventListener("click",({target:n})=>{n.innerHTML=`Switch to ${Ge} mode`,Ge=Ge==="light"?"dark":"light",Ar(q,"core","colorScheme",Ge)});
