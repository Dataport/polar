const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pinia-BhmAVTvm-Dvvq2Cue.js","./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js","./store-DasbBd0O.js","./index-C9PViMbS-CJilRzpe.js","./reverseGeocode-CR3Bbmu1-CShN2cyn.js","./indicateLoading-CX8lh8tr-65EH0W1L.js"])))=>i.map(i=>d[i]);
import{a2 as H,a3 as gn,a4 as pn,a5 as fn,a6 as We,a7 as ce,a8 as yt,a9 as mn,aa as Ye,ab as yn,ac as xr,ad as _n,ae as Fe,af as je,ag as re,ah as vn,ai as lt,aj as Be,ak as bn,al as wr,am as kn,an as dt,ao as xn,ap as wn,aq as Cn,ar as Sn,as as En,at as Tn,au as $n,av as qe,aw as O,ax as v,ay as $t,az as I,aA as Cr,aB as U,aC as ke,aD as Wt,aE as J,aF as de,aG as V,aH as Gt,aI as Ln,aJ as _t,aK as In,aL as An,aM as Fn,aN as Pn,aO as Rn,aP as Sr,aQ as ct,aR as Nt,aS as He,aT as Ee,aU as te,aV as xe,aW as Mn,aX as jt,aY as Te,aZ as Er,a_ as j,a$ as Dn,b0 as ut,b1 as On,b2 as Bt,b3 as ee,b4 as Gn,b5 as X,b6 as we,b7 as Ve,b8 as sr,b9 as Tr,ba as qt,bb as Kt,bc as Nn,bd as Bn,be as Vn,bf as ir,bg as Lt,bh as oe,bi as $r,bj as ht,bk as Un,bl as zn,bm as Hn,bn as Wn,bo as jn,bp as qn,bq as Xt,br as or,bs as Kn,bt as Xn,bu as Jn,bv as Yn,bw as Qn,bx as Zn,by as ea,bz as ta,bA as Lr,bB as ra,bC as na,bD as Me,bE as aa,F as vt,H as bt,I as kt,L as ot,bF as sa,bG as ia,bH as pe,bI as oa,R as Jt,J as la,bJ as Ir,U as Ar,T as Fr,$ as da,S as ca}from"./runtime-core.esm-bundler-CtaYpP3L.js";import{defineComponent as q,createElementBlock as S,openBlock as b,createElementVNode as A,renderSlot as Yt,computed as T,ref as P,createBlock as M,unref as m,withCtx as ue,createVNode as Le,createCommentVNode as W,withDirectives as Pr,withKeys as me,withModifiers as ve,isRef as Vt,vModelText as ua,toDisplayString as ne,normalizeClass as Ie,nextTick as gt,watch as Ae,toRaw as ha,Fragment as Y,renderList as ae,resolveDynamicComponent as pt,markRaw as lr,onMounted as ga,mergeModels as pa,useModel as fa,vModelDynamic as ma}from"./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js";import{defineStore as be,storeToRefs as he}from"./pinia-BhmAVTvm-Dvvq2Cue.js";import{R as B,d as Q,h as le,L as Oe}from"./index-C9PViMbS-CJilRzpe.js";import{X as dr}from"./store-DasbBd0O.js";import{indicateLoading as ya}from"./indicateLoading-CX8lh8tr-65EH0W1L.js";import{reverseGeocode as _a}from"./reverseGeocode-CR3Bbmu1-CShN2cyn.js";const va={class:"kern-card kern-card--small"},ba={class:"kern-card__container"},ka=q({__name:"PolarCard.ce",setup(n){return(e,t)=>(b(),S("article",va,[A("div",ba,[Yt(e.$slots,"default",{},void 0,!0)])]))}}),xa=".kern-card{&[data-v-937e165b]{height:auto;min-width:25rem;border-radius:var(--kern-metric-border-radius-large);box-shadow:var(--polar-shadow)}.kern-card__container[data-v-937e165b]{padding:var(--kern-metric-space-small);padding-bottom:.625rem}}",xt=H(ka,[["styles",[xa]],["__scopeId","data-v-937e165b"]]);function wa(n){const e=n.map(parseFloat),t=[];for(;e.length;)t.push(e.splice(0,2));return t}function Ca(n,e,t={}){n.getView().fit(e,t)}function Sa(n,e,t={}){let r;switch(e.geometry.type){case"Polygon":r=new yt([wa(e.geometry.coordinates)]);break;case"Point":r=new ce(e.geometry.coordinates.map(parseFloat));break;default:console.warn(`ZoomTo for type ${e.geometry.type} not implemented.`);return}Ca(n,r,t)}const F={STREET:"street",DISTRICT:"district",PARCEL:"parcel",STREET_KEY:"streetKey",ADDRESS_AFFIXED:"addressAffixed",ADDRESS_UNAFFIXED:"addressUnaffixed",HOUSE_NUMBERS_FOR_STREET:"houseNumbersForStreet"};function Rr(n){return Array.isArray(n)&&n.length===1?Rr(n[0]):n}function ft(n,e){return Array.isArray(n)?n.map(t=>ft(t,e)).filter(t=>t)[0]:typeof n!="object"?null:typeof n[e]<"u"?n[e]:Object.keys(n).map(t=>ft(n[t],e)).filter(t=>t)[0]}function Ea(n){const e={objectType:Object.keys(n)[0]};return Object.keys(n[e.objectType][0]).forEach(t=>{e[t]=Rr(n[e.objectType][0][t])}),e}function Ta(n){let e=[];return n.startsWith("POINT")&&(e=n.split(")")[0]?.split("(")[1]),e}function $a(n,e){const t={type:e,properties:Ea(n)};let r=t.properties?.pos?Ta(t.properties.pos):ft(t.properties,"pos")[0],a="",s="",i="";switch(e){case F.DISTRICT:t.name=t.properties.geographicIdentifier?._?t.properties.geographicIdentifier._:t.properties.geographicIdentifier;break;case F.STREET_KEY:case F.STREET:t.properties?.position_strassenachse&&(r=ft(t.properties?.position_strassenachse,"pos")[0]),t.name=Ye()?t.properties.geographicIdentifier._:t.properties.strassenname;break;case F.PARCEL:t.name=`${t.properties.gemarkung}/${t.properties.flurstuecksnummer}`;break;case F.HOUSE_NUMBERS_FOR_STREET:a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,t.properties.hausnummernzusatz&&(s=t.properties.hausnummernzusatz?._?t.properties.hausnummernzusatz._:t.properties.hausnummernzusatz),t.properties.hausnummerkomplett=`${a}${s}`,t.name=Ye()?t.properties.geographicIdentifier._:(t.properties?.geographicIdentifier?t.properties.geographicIdentifier._.split(t.properties.hausnummerkomplett)[0]:t.properties.strassenname+" ")+t.properties.hausnummerkomplett;break;case F.ADDRESS_AFFIXED:i=t.properties.strassenname?._?t.properties.strassenname._:t.properties.strassenname,a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,s=t.properties.hausnummernzusatz?._?t.properties.hausnummernzusatz._:t.properties.hausnummernzusatz,t.name=Ye()?t.properties.geographicIdentifier._:`${i} ${a}${s}`;break;case F.ADDRESS_UNAFFIXED:i=t.properties.strassenname?._?t.properties.strassenname._:t.properties.strassenname,a=t.properties.hausnummer?._?t.properties.hausnummer._:t.properties.hausnummer,t.name=Ye()?t.properties.geographicIdentifier._:(t.properties?.geographicIdentifier?t.properties.geographicIdentifier._.split(a)[0]:i+" ")+a;break;default:t.name=null,console.error(`Unknown type in searchAddress.parse: '${e}'. Could not set name.`);break}switch(e){case F.DISTRICT:case F.STREET_KEY:case F.STREET:case F.PARCEL:case F.HOUSE_NUMBERS_FOR_STREET:case F.ADDRESS_AFFIXED:case F.ADDRESS_UNAFFIXED:t.geometry={type:"Point",coordinates:r.split(" ")};break;default:t.geometry=null,console.error(`Unknown type in searchAddress.parse: '${e}'. Could not set geometry.`);break}return t}function Mr(n,e){return new Promise((t,r)=>{dr.parseString(e,{tagNameProcessors:[dr.processors.stripPrefix]},(a,s)=>{if(a){r(a);return}try{const i=s.FeatureCollection?.member?s.FeatureCollection.member.map(o=>$a(o,n)).sort((o,l)=>o.name.localeCompare(l.name)):[];t(i)}catch(i){r(i)}})})}function La(n){return Array.isArray(n)?n.map(encodeURIComponent):encodeURIComponent(n)}function Ia(n,e,t=!0){return{[F.STREET]:r=>t?`&StoredQuery_ID=findeStrasse&strassenname=*${r}`:`&StoredQuery_ID=findeStrasse&strassenname=${r}`,[F.DISTRICT]:r=>`&StoredQuery_ID=findeStadtteil&stadtteilname=${r}`,[F.PARCEL]:r=>`&StoredQuery_ID=Flurstueck&gemarkung=${r[0]}&flurstuecksnummer=${r[1]}`,[F.STREET_KEY]:r=>`&StoredQuery_ID=findeStrassenSchluessel&strassenschluessel=${r}`,[F.ADDRESS_AFFIXED]:r=>`&StoredQuery_ID=AdresseMitZusatz&strassenname=${r[0]}&hausnummer=${r[1]}&zusatz=${r[2]}`,[F.ADDRESS_UNAFFIXED]:r=>`&StoredQuery_ID=AdresseOhneZusatz&strassenname=${r[0]}&hausnummer=${r[1]}`,[F.HOUSE_NUMBERS_FOR_STREET]:r=>`&StoredQuery_ID=HausnummernZuStrasse&strassenname=${r}`}[n](La(e))}function Dr(n,e,t,r){return new Promise((a,s)=>{const i=mn()+Ia(n,e,r);fetch(i,{signal:t?.signal,timeout:6e3}).then(o=>a(o.text())).catch(o=>s(o))})}let Ue=null;function Ce(n,e,t=(s,i)=>s.name.localeCompare(i.name),r=()=>!0,a){return new Promise((s,i)=>{Dr(n,e,Ue,a).then(o=>{Mr(n,o).then(l=>{s(l.filter(r).sort(t))})}).catch(o=>i(o))})}function Aa(n,e,t){return new Promise((r,a)=>{Dr(F.STREET,n,Ue,t).then(s=>Mr(F.STREET,s)).then(s=>{const i=[],o=n.match(new RegExp("^(.+)[\\s,](\\d+|\\d.*)$"));for(let l=0;l<s.length;l++)i.push([s[l]]),e&&i.push(Ce(F.HOUSE_NUMBERS_FOR_STREET,s[l].name,void 0,void 0,t));return!s.length&&o?.length&&e&&i.push(Ce(F.HOUSE_NUMBERS_FOR_STREET,o[1],(l,d)=>parseInt(l.properties?.hausnummer,10)-parseInt(d.properties?.hausnummer,10),l=>l.properties?.hausnummerkomplett?.indexOf(o[2])===0,t)),Promise.all(i)}).then(s=>r([].concat(...s))).catch(s=>a(s))})}function cr(n,e,t=!1){return t&&Ue!==null&&Ue.abort(),Ue=new AbortController,new Promise((r,a)=>{const{map:s,zoom:i=!1,zoomToParams:o,searchAddress:l=!1,searchStreets:d=!1,searchStreetBeforeWord:c=!0,searchDistricts:u=!1,searchParcels:h=!1,searchStreetKey:p=!1,minCharacters:k=3}=e,f=[];let{searchHouseNumbers:_=!1}=e;if(n.length<k){a({error:"Search string too short."});return}if(i&&!s&&console.warn("Instructed to zoom, but required map object was not given. Zooming will be skipped."),!d&&_&&(console.warn(`Search for '${n}' supposed to retrieve house numbers, but not streets. Invalid search configuration. House numbers will not be searched for as a result.`),_=!1),!(l||d||_||u||h||p)){a({error:`Search for '${n}' received no indication what to search for. Search is canceled.`});return}if(d&&f.push(Aa(n,_,c)),l){let g=n.split(/(\d+)/).map(x=>x.trim()).filter(x=>x);if(g.length>3){const x=g[0],L=g[1],w=n.replace(g[0],"").replace(g[1],"").trim();g=[x,L,w]}const y=[!1,!1,F.ADDRESS_UNAFFIXED,F.ADDRESS_AFFIXED][g.length];y&&f.push(Ce(y,g))}if(u&&/^[a-z-üäöß]+$/i.test(n)&&f.push(Ce(F.DISTRICT,n)),p&&/^[a-z]{1}[0-9]{1,5}$/i.test(n)&&f.push(Ce(F.STREET_KEY,n)),h){let g;/^[0-9]{4}[\s|/][0-9]*$/.test(n)?g=n.split(/[\s|/]/):/^[0-9]{5,}$/.test(n)&&(g=[n.slice(0,4),n.slice(4)]),g&&f.push(Ce(F.PARCEL,g))}Promise.all(f).then(g=>{const y=[].concat(...g);if(i&&s&&y.length===1)try{Sa(s,y[0],o)}catch(x){console.error("Zooming to element from gazetteer failed."),console.error(x)}r(y)}).catch(g=>a(g))})}const z="addressSearch";function Fa(n,e){const t=n.reduce((r,a)=>a.status==="fulfilled"?[...r,a.value]:r,[]);return e.signal.aborted||n.filter(({status:r})=>r==="rejected").forEach(({reason:r})=>{console.error(`@polar/polar(plugins/addressSearch/utils/getResultsFromPromises:20:4)
`,"An error occurred while sending a request: ",r)}),t}function Or(n){if(!n.ok)throw new Error(n.status===418?"The server refuses to brew coffee because it is, permanently, a teapot.":`The received status code ${n.status} indicates an error.`)}function Pa(n,e){let t=`query=${n.replace(" ","+")}`;for(const[r,a]of Object.entries(e).filter(([s])=>s!=="filter"&&s!=="epsg"&&s!=="apiKey"&&s!=="accessToken"))t+=`&${r}=${a}`;return e.filter&&Object.keys(e.filter).length>0&&(t+="&filter=",t=Object.entries(e.filter).reduce((r,[a,s])=>`${r+a}:${s}&`,t).slice(0,-1)),t}async function Ra(n,e,t,r){const a=`${e}?`+Pa(t,r),s={signal:n};r.accessToken?s.headers={Authorization:`Bearer ${r.accessToken}`}:r.apiKey&&(s.headers={"X-Api-Key":r.apiKey});const i=await fetch(encodeURI(a),s);Or(i);const o=await i.json();return{...o,features:o.features.map(l=>B(l,{geometry:B(l.geometry,{coordinates:r.epsg==="EPSG:4326"?l.geometry.coordinates:We(l.geometry.coordinates,"EPSG:4326",r.epsg)}),title:l.properties.text}))}}async function Ma(n,e,t,r){yn(e);try{const a=B(r,{minCharacters:0});let s=await cr(t,B(a,{searchStreetBeforeWord:!1}));return!s[0]&&(s=await cr(t,a),!s[0])?{type:"FeatureCollection",features:[]}:{type:"FeatureCollection",features:Oa(s,r.epsg,Da(s[0].properties.position.Point[0].$.srsName))}}catch(a){throw console.error(`@polar/polar(lib/getFeatures/mpapi:50:3)
`,a),new Error("An error occurred while fetching the feature collection.")}}function Da(n){if(n.includes("::"))return`EPSG:${n.split("::")[1]}`;if(n.includes(":"))return n;throw console.error(`@polar/polar(lib/getFeatures/mpapi:63:2)
`,"Unknown formatting of projection:",n),Error("Unknown formatting of projection: "+n)}const Oa=(n,e,t)=>n.map(r=>{const{name:a,geometry:s}=r;return{type:"Feature",title:a,geometry:B(s,{coordinates:t===e?s.coordinates.map(Number):We(s.coordinates.map(Number),t,e)}),properties:r.properties}}),Ga=n=>n.replace(/\r?\n|\r/g,""),Na=({maxFeatures:n})=>`
<?xml version="1.0" encoding="UTF-8"?>
<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"${n?` maxFeatures="${n}"`:""}>`,Ba={wildCard:"*",singleChar:".",escapeChar:"!"},Va=({srsName:n,featurePrefix:e,typeName:t,xmlns:r})=>`
<wfs:Query typeName="${e}:${t}" xmlns:${e}="${r}"${n?` srsName="${n}"`:""}>
<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">`;function ur(n,e,{featurePrefix:t,useRightHandWildcard:r,likeFilterAttributes:a}){const s=B(Ba,a||{});return`
<ogc:PropertyIsLike${Object.entries(s).reduce((i,[o,l])=>`${i} ${o}="${l}"`,"")}>
<ogc:PropertyName>${t}:${n}</ogc:PropertyName>
<ogc:Literal>${e}${typeof r=="boolean"&&!r?"":Object.hasOwn(s,"wildCard")?s.wildCard:"*"}</ogc:Literal>
</ogc:PropertyIsLike>`}function Ua(n,e){let t=Va(e);if(n.length>1)t+=`<ogc:And>${n.map(([r,a])=>ur(r,a,e)).join("")}</ogc:And>`;else if(n.length===1){const r=n[0];t+=ur(r[0],r[1],e)}return t+"</ogc:Filter></wfs:Query>"}const Ge=(n,e)=>Ga(Na(e)+n.map(t=>Ua(t,e)).join("")+"</wfs:GetFeature>");if(import.meta.vitest){const{expect:n,test:e}=import.meta.vitest,t={typeName:"TyPeNaMe",featurePrefix:"prefix",xmlns:"example.com",maxFeatures:999};e("creates an empty search for an empty input",()=>{n(Ge([],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"></wfs:GetFeature>')}),e("creates a one-query search for a single match",()=>{n(Ge([[["a","5"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query></wfs:GetFeature>')}),e("creates a one-query and-ed search for a single match with multiple fields",()=>{n(Ge([[["a","5"],["b","3"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:b</ogc:PropertyName><ogc:Literal>3*</ogc:Literal></ogc:PropertyIsLike></ogc:And></ogc:Filter></wfs:Query></wfs:GetFeature>')}),e("creates a multi-query search for a multiple matches",()=>{n(Ge([[["a","5"]],[["b","3"]]],t)).toEqual('<?xml version="1.0" encoding="UTF-8"?><wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" service="WFS" version="1.1.0" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" maxFeatures="999"><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:a</ogc:PropertyName><ogc:Literal>5*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query><wfs:Query typeName="prefix:TyPeNaMe" xmlns:prefix="example.com"><ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsLike wildCard="*" singleChar="." escapeChar="!"><ogc:PropertyName>prefix:b</ogc:PropertyName><ogc:Literal>3*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></wfs:Query></wfs:GetFeature>')})}const It={};function Qt(n){if(It[n])return It[n];const e=Array.from(n.matchAll(/{{(.*?)}}/g)),t=[];let r=0;for(const a of e)r<a.index&&(t.push(n.substring(r,a.index)),r=a.index),t.push(a),r+=a[0].length;return It[n]=t,t}const za=(n,e)=>n.uninterpreted>e.uninterpreted?1:n.uninterpreted<e.uninterpreted?-1:n.index>e.index?1:n.index<e.index?-1:0,Ha=(n,e,t)=>{const r=[...n.map((s,i)=>({match:s,uninterpreted:t[i],patternLengthDiff:(e[i].match(/{{/g)||[]).length-s.length,index:i}))].sort(za).map(({match:s})=>s),a=[];return r.filter(s=>{if(s.length===0)return!1;const i=JSON.stringify(s);return a.includes(i)?!1:(a.push(i),!0)})},Ut=(n,e,t)=>{if(!n)throw new Error('Parameter "patterns" is missing on wfs configuration for pattern-based search.');if(!e)throw new Error('Parameter "patternKeys" is missing on wfs configuration for pattern-based search.');const r=[],a=[];return n.forEach(s=>{const i=Qt(s),o=[];let l=t;i.forEach(d=>{let c="";if(Array.isArray(d)){const u=d[1],h=e[u],p=l.match(new RegExp("^"+h));if(p!==null){const k=p[1];o.push([u,k.trim()]),c=p[0].trim()}}else c=d.trim();l.startsWith(c)&&(l=l.substring(c.length).trim())}),a.push(l.length),r.push(o)}),Ha(r,n,a)};if(import.meta.vitest){const{expect:n,test:e}=import.meta.vitest,t=(s,i,o,l,d)=>{const c=[s,i];return c.index=o,c.input=l,c.groups=d,c},r=["{{gemarkung}} {{flur}} {{flstnrzae}}/{{flstnrnen}}, {{flstkennz}}","{{gemarkung}} {{flur}} {{flstnrzae}}, {{flstkennz}}","{{gemarkung}} {{flstnrzae}}/{{flstnrnen}}, {{flstkennz}}","{{gemarkung}} {{flstnrzae}}, {{flstkennz}}","{{flstkennz}}"],a={gemarkung:"([^0-9]+)",flur:"([0-9]+)",flstnrzae:"([0-9]+)",flstnrnen:"([0-9]+)",flstkennz:"([0-9_]+)"};e("getBlocks parts pattern strings to Block[][]",()=>{n(Qt(r[0])).toEqual([t("{{gemarkung}}","gemarkung",0,r[0])," ",t("{{flur}}","flur",14,r[0])," ",t("{{flstnrzae}}","flstnrzae",23,r[0]),"/",t("{{flstnrnen}}","flstnrnen",37,r[0]),", ",t("{{flstkennz}}","flstkennz",52,r[0])])}),e("match builds full match groups",()=>{n(Ut(r,a,"Musterhausen 12 3/4, 1234___")).toEqual([[["gemarkung","Musterhausen"],["flur","12"],["flstnrzae","3"],["flstnrnen","4"],["flstkennz","1234___"]],[["gemarkung","Musterhausen"],["flur","12"],["flstnrzae","3"]],[["gemarkung","Musterhausen"],["flstnrzae","12"],["flstnrnen","3"]],[["gemarkung","Musterhausen"],["flstnrzae","12"],["flstkennz","3"]]])}),e("match manages to decide the best fit",()=>{n(Ut(r,a,"1234___")).toEqual([[["flur","1234"],["flstkennz","___"]],[["flstnrzae","1234"],["flstkennz","___"]],[["flstkennz","1234___"]]])})}function Wa(n,e){return n.fillPercentage>e.fillPercentage?-1:n.fillPercentage<e.fillPercentage?1:n.keys.length>e.keys.length?-1:n.keys.length<e.keys.length?1:n.index>e.index?-1:n.index<e.index?1:0}function ja(n,e){const t=n.properties||{},r=[...e.map((a,s)=>{const i=Qt(a).reduce((l,d)=>Array.isArray(d)?[...l,d[1]]:l,[]),o=i.reduce((l,d)=>typeof t[d]<"u"&&t[d]!==""?l+1:l,0);return{pattern:a,keys:i,index:s,fillPercentage:o/i.length}})].sort(Wa)[0];return r.keys.reduce((a,s)=>a.replace(`{{${s}}}`,t[s]||""),r.pattern)}const hr=new gn,qa=new pn;async function Ka(n,e,t,r){const a=[],s={type:"FeatureCollection",features:a},i=await n.text(),o=hr.readFeatures(i),{srsName:l}=hr.readFeatureCollectionMetadata(i);return o.forEach(d=>{const c=JSON.parse(qa.writeFeature(d));c.title="",e&&(t?c.title=ja(c,e):c.title=Array.isArray(e)?e.map(u=>c.properties[u]).join(" "):c.properties[e]),l&&(c.geometry=B(c.geometry,{coordinates:We(c.geometry.coordinates,`EPSG:${l.split("::")[1]}`,r)})),a.push(c)}),s}async function Xa(n,e,t,r){const{fieldName:a,patterns:s,patternKeys:i}=r;if(!a&&(!s||!i))throw new Error('Incomplete WFS search configuration. Either "fieldName" or "patterns" & "patternKeys" are required.');a&&s&&console.error(`@polar/polar(lib/getFeatures/wfs/index:22:3)
`,'Using both "fieldName" and "patterns" for WFS search. These are mutually exclusive. "patterns" will be ignored.');const o=a?[[[a,t]]]:Ut(s,i,t),l=Ge(o,r),d=await fetch(encodeURI(e),{signal:n,method:"POST",body:l});return Or(d),Ka(d,a||s,!a,r.epsg)}function Ja(){const n={bkg:Ra,mpapi:Ma,wfs:Xa};return{registerSearchMethods:e=>{Object.entries(e).forEach(([t,r])=>{if(n[t]){console.error(`@polar/polar(plugins/addressSearch/utils/methodContainer:16:6)
`,`Method "${t}" already exists. Please choose a different name. Overrides are not allowed.`);return}n[t]=r})},getSearchMethod:e=>{const t=n[e];if(t)return t;throw new Error(`The given type "${e}" does not define a valid searchMethod.`)}}}const fe={ERROR:Symbol("error"),NO_SEARCH:Symbol("noSearch")},Zt=be("plugins/addressSearch",()=>{const n=Q(),e={label:"defaultLabel",hint:"",resultDisplayMode:"mixed",limitResults:Number.MAX_SAFE_INTEGER};let t=null,r,a;const s=P(null),i=P(""),o=P(!1),l=P(fe.NO_SEARCH),d=P("defaultGroup"),c=T(()=>u.value.afterResultComponent||null),u=T(()=>n.configuration.addressSearch),h=T({get:()=>i.value,set:$=>{$!==i.value&&(i.value=$,Je())}}),p=T(()=>Array.isArray(l.value)&&l.value.length>0&&l.value.some(({features:{features:$}})=>Array.isArray($)&&$.length>0)),k=T(()=>u.value.focusAfterSearch||!1),f=T(()=>$=>{const N=u.value.groupProperties?.[$]||{};return $==="defaultGroup"?B(e,N):N}),_=T(()=>Object.keys(C.value)),g=T(()=>Object.keys(C.value).map($=>({groupId:$,text:f.value($).label}))),y=T(()=>_.value.length>1),x=T(()=>o.value?le($=>$.hint.loading,{ns:z}):l.value===fe.ERROR?le($=>$.hint.error,{ns:z}):h.value.length>0&&h.value.length<w.value?le($=>$.hint.tooShort,{ns:z,minLength:w.value}):l.value!==fe.NO_SEARCH&&!p.value?le($=>$.hint.noResults,{ns:z}):D.value.hint||""),L=T(()=>D.value.limitResults||e.limitResults),w=T(()=>typeof u.value.minLength=="number"?u.value.minLength:3),C=T(()=>u.value.searchMethods.reduce(($,N)=>{const Z=N.groupId||"defaultGroup";return $[Z]?$[Z].push(N):$[Z]=[N],$},{})),E=T({get:()=>d.value,set:$=>{$!==d.value&&(d.value=$,l.value=fe.NO_SEARCH,h.value.length>0&&Et())}}),D=T(()=>f.value(E.value)),ie=T(()=>typeof u.value.waitMs=="number"?u.value.waitMs:300);function _e(){r=fn(Et,ie.value),a=Ja(),E.value=_.value[0],u.value.customSearchMethods&&a.registerSearchMethods(u.value.customSearchMethods)}function Ct(){}function Je(){t&&(t.abort(),t=null),r()}function St(){h.value="",l.value=fe.NO_SEARCH,s.value=null}function Et(){if(h.value.length<w.value)return l.value=fe.NO_SEARCH,o.value=!1,Promise.resolve();o.value=!0,t=new AbortController;const $=t;return Promise.allSettled(u.value.searchMethods.map(async({categoryId:N,groupId:Z,queryParameters:Re,type:Tt,url:cn})=>{const un=await a.getSearchMethod(Tt)($.signal,cn,h.value,B(Re||{},{epsg:n.configuration.epsg})),nr=N||"default",ar=u.value.categoryProperties?.[nr];return{categoryId:nr,categoryLabel:ar?le(ar.label):le(hn=>hn.defaultLabel,{ns:z}),features:un,groupId:Z||"defaultGroup"}})).then(N=>l.value=Fa(N,$)).catch(N=>{console.error(`@polar/polar(plugins/addressSearch/store:249:6)
`,"An error occurred while searching.",N),l.value=fe.ERROR}).finally(()=>{o.value=!1})}async function dn($,N="never"){if(h.value=$,t&&(t.abort(),t=null),await Et(),!Array.isArray(l.value))return;const Z=l.value.find(({features:Tt})=>Tt.features.length);if(!Z)return;const Re=Z.features.features;(N==="first"&&Re.length>=1||N==="only"&&Re.length===1)&&rr(Re[0],Z.categoryId)}function rr($,N="default"){const Z=u.value.customSelectResult?.[N];Z?Z($,N):(s.value=$,i.value=$.title,l.value=fe.NO_SEARCH)}return{chosenAddress:s,inputValue:h,afterResultComponent:c,focusAfterSearch:k,groupSelectOptions:g,hasMultipleGroups:y,isLoading:o,searchResults:l,selectedGroupId:E,featuresAvailable:p,hint:x,limitResults:L,abortAndRequest:Je,clear:St,search:dn,selectResult:rr,setupPlugin:_e,teardownPlugin:Ct}});function Gr(n,e,t){for(let r=0;r<n;r++){const a=e.getElementById(`polar-plugin-address-search-results-feature-${r}-0`);if(a){a.focus(),t?.preventDefault();break}}}function Ya(n,e){const t=n.toLowerCase().indexOf(e.toLowerCase());return t===-1?n:n.substring(0,t)+"<strong>"+n.substring(t,t+e.length)+"</strong>"+n.substring(t+e.length)}const Qa={key:0,id:"polar-plugin-address-search-result-wrapper",tabindex:"-1"},Za={key:0,class:"polar-plugin-address-search-category-label"},es=["id","onClick","onKeydown"],ts=["innerHTML"],rs=["onClick"],ns={class:"kern-label"},as={key:2,class:"kern-divider","aria-hidden":"true"},ss=q({__name:"SearchResults.ce",setup(n){const e=Q(),t=Zt(),{afterResultComponent:r,featuresAvailable:a,inputValue:s,limitResults:i,searchResults:o,selectedGroupId:l}=he(t);Ae(l,()=>d.value=[]),Ae(a,()=>{t.focusAfterSearch&&gt(()=>{Gr(c.value.length,e.shadowRoot)})});const d=P([]),c=T(()=>Array.isArray(t.searchResults)?structuredClone(ha(t.searchResults)).filter(f=>f.groupId===t.selectedGroupId).reduce((f,_)=>{const g=f.findIndex(y=>y.categoryId===_.categoryId);return g===-1?[...f,_]:(f[g].features.features=[...f[g].features.features,..._.features.features],f)},[]).map(f=>(u(f.categoryId)||(f.features.features=f.features.features.slice(0,i.value)),f)):[]);function u(f){return d.value.includes(f)}function h(){e.shadowRoot.getElementById("polar-plugin-address-search-input")?.focus()}function p(f,_){const{target:g}=_;if(g===null){console.warn(`@polar/polar(plugins/addressSearch/components/SearchResults.ce.vue?vue&type=script&setup=true&lang:110:3)
`,`@polar/polar(plugins/addressSearch/components/SearchResults.ce:169:3)
`,"Could not focus any element.");return}const y=(e.shadowRoot?.getElementById("polar-plugin-address-search-result-wrapper")).querySelectorAll("li, button"),x=[...y].indexOf(g),L=y[(x+(f?1:-1))%y.length];if(L){L.focus();return}e.shadowRoot.getElementById("polar-plugin-address-search-input")?.focus()}function k(f){d.value=d.value.indexOf(f)===-1?[...d.value,f]:d.value.filter(_=>_!==f)}return(f,_)=>m(a)?(b(),S("div",Qa,[(b(!0),S(Y,null,ae(c.value,(g,y)=>(b(),S(Y,{key:g.categoryId},[c.value.length>1?(b(),S("h2",Za,ne(g.categoryLabel)+" "+ne(f.$t(x=>x.resultCount,{count:m(o)[y].features.features.length,ns:m(z)})),1)):W("",!0),A("ul",{class:Ie({"polar-plugin-address-search-list-without-label":c.value.length===1})},[(b(!0),S(Y,null,ae(g.features.features,(x,L)=>(b(),S("li",{key:`result-${y}-${L}`,id:`polar-plugin-address-search-results-feature-${y}-${L}`,tabindex:"-1",onClick:w=>m(t).selectResult(x,g.categoryId),onKeydown:[me(ve(w=>m(t).selectResult(x,g.categoryId),["prevent","stop"]),["enter"]),_[0]||(_[0]=me(ve(w=>p(!0,w),["prevent","stop"]),["down"])),_[1]||(_[1]=me(ve(w=>p(!1,w),["prevent","stop"]),["up"])),me(ve(h,["prevent","stop"]),["escape"])]},[A("span",{innerHTML:m(Ya)(x.title,m(s))},null,8,ts),m(r)?(b(),M(pt(m(r)),{key:0,feature:x},null,8,["feature"])):W("",!0)],40,es))),128))],2),m(o)[y].features.features.length>m(i)?(b(),S("button",{key:1,class:"kern-btn kern-btn--tertiary",onKeydown:[_[2]||(_[2]=me(ve(x=>p(!0,x),["prevent","stop"]),["down"])),_[3]||(_[3]=me(ve(x=>p(!1,x),["prevent","stop"]),["up"]))],onClick:x=>k(g.categoryId)},[A("span",{class:Ie(`kern-icon ${u(g.categoryId)?"kern-icon--keyboard-arrow-up":"kern-icon--keyboard-arrow-down"}`),"aria-hidden":"true"},null,2),A("span",ns,ne(f.$t(x=>x.resultList[u(g.categoryId)?"reduce":"extend"],{ns:m(z)})),1)],40,rs)):W("",!0),y<c.value.length-1?(b(),S("hr",as)):W("",!0)],64))),128))])):W("",!0)}}),is="#polar-plugin-address-search-result-wrapper{&[data-v-9bea3b92]{display:flex;flex-direction:column;gap:var(--kern-metric-space-2x-small);width:100%;padding-bottom:.625rem;overflow-y:auto}.polar-plugin-address-search-category-label[data-v-9bea3b92]{display:flex;align-items:center;min-height:var(--kern-metric-dimension-large);padding:0 var(--kern-metric-space-small);margin:0;font-size:calc(var(--kern-typography-font-size-static-small) * .875);font-weight:400;color:var(--kern-color-layout-text-muted)}.polar-plugin-address-search-list-without-label[data-v-9bea3b92]{margin-top:var(--kern-metric-space-2x-small)}ul{&[data-v-9bea3b92]{margin:0;padding:0}li{&[data-v-9bea3b92]{display:flex;align-items:center;min-height:var(--kern-metric-dimension-x-large);padding:var(--kern-metric-space-none) var(--kern-metric-space-small);margin:var(--kern-metric-space-none) var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);color:var(--kern-color-layout-text-default);transition:.3s cubic-bezier(.25,.8,.5,1)}&[data-v-9bea3b92]:hover,&[data-v-9bea3b92]:focus{background-color:var(--kern-color-layout-background-hued);cursor:pointer}}}button[data-v-9bea3b92]{margin:var(--kern-metric-space-none) var(--kern-metric-space-small)}}",os=H(ss,[["styles",[is]],["__scopeId","data-v-9bea3b92"]]),ls={class:"kern-loader kern-loader--visible",role:"status"},ds={class:"kern-sr-only"},cs=q({__name:"SmallLoader.ce",setup(n){return(e,t)=>(b(),S("div",ls,[A("span",ds,ne(e.$t(r=>r.hint.loading,{ns:m(z)})),1)]))}}),us=".kern-loader{&[data-v-06c648df]{width:var(--kern-metric-dimension-large);height:var(--kern-metric-dimension-large);margin:var(--kern-metric-space-small)}&[data-v-06c648df]:before,&[data-v-06c648df]:after{display:none}}",hs=H(cs,[["styles",[us]],["__scopeId","data-v-06c648df"]]),gs={class:"polar-plugin-address-search-selection-wrapper"},ps={class:"polar-plugin-address-search-input-wrapper"},fs=["aria-label","aria-description","onKeydown"],ms={class:"kern-label kern-sr-only"},ys={key:2,class:"polar-plugin-address-search-hint"},_s=q({__name:"AddressSearch.ce",setup(n){const e=Q(),t=Zt(),{groupSelectOptions:r,hasMultipleGroups:a,hint:s,inputValue:i,isLoading:o,searchResults:l,selectedGroupId:d}=he(t),c=P(!1),u=T(()=>(e.hasSmallDisplay||!e.hasWindowSize)&&!c.value);function h(){t.clear(),gt(()=>{(e.shadowRoot?.getElementById("polar-plugin-address-search-input")).focus()})}function p(){(!c.value||!i.value.length&&!a.value)&&(c.value=!c.value,c.value&&gt(()=>{(e.shadowRoot?.getElementById("polar-plugin-address-search-input")).focus()}))}function k(f){Array.isArray(t.searchResults)&&Gr(t.searchResults.length,e.shadowRoot,f)}return(f,_)=>u.value?(b(),M(xr,{key:0,id:"polar-plugin-address-search-icon-button",hint:f.$t(g=>g.hint.button,{ns:m(z)}),icon:"kern-icon--search",onClick:p},null,8,["hint"])):(b(),M(xt,{key:1,class:Ie({"has-hint":m(s).length>0,"polar-plugin-address-search-shown-results":Array.isArray(m(l))&&m(l).length})},{default:ue(()=>[A("div",gs,[m(a)?(b(),M(_n,{key:0,"aria-label":f.$t(g=>g.groupSelector,{ns:m(z)}),options:m(r).map(({groupId:g,text:y})=>({value:g,label:f.$t(x=>x[y],{ns:m(z)})})),value:m(d),"onUpdate:value":_[0]||(_[0]=g=>d.value=g)},null,8,["aria-label","options","value"])):W("",!0),A("div",ps,[Pr(A("input",{id:"polar-plugin-address-search-input","onUpdate:modelValue":_[1]||(_[1]=g=>Vt(i)?i.value=g:null),class:"kern-form-input__input",type:"text","aria-label":m(s).length>0?m(s):f.$t(g=>g.aria.label,{ns:m(z)}),"aria-description":m(s).length>0?m(s):f.$t(g=>g.aria.description,{ns:m(z)}),onKeydown:[_[2]||(_[2]=me((...g)=>m(t).abortAndRequest&&m(t).abortAndRequest(...g),["enter"])),me(ve(k,["prevent","stop"]),["down"])],onFocusout:p},null,40,fs),[[ua,m(i)]]),m(o)?(b(),M(hs,{key:0})):W("",!0),m(i).length?(b(),S("button",{key:1,class:"kern-btn kern-btn--tertiary polar-plugin-address-search-input-button",onClick:h},[_[3]||(_[3]=A("span",{class:"kern-icon kern-icon--close","aria-hidden":"true"},null,-1)),A("span",ms,ne(f.$t(g=>g.hint.clear,{ns:m(z)})),1)])):W("",!0),m(s).length>0?(b(),S("span",ys,ne(m(s)),1)):W("",!0)])]),Le(os)]),_:1},8,["class"]))}}),vs="#polar-plugin-address-search-icon-button[data-v-40ad94ba]{position:absolute;margin:var(--kern-metric-space-small)}.kern-card.polar-plugin-address-search-shown-results[data-v-40ad94ba] .kern-card__container{padding-bottom:0}.kern-card.has-hint[data-v-40ad94ba] .kern-card__container{padding-bottom:var(--kern-metric-space-small)}.kern-card{&[data-v-40ad94ba]{display:flex;flex-direction:column;align-items:flex-start;gap:var(--kern-metric-space-small);position:absolute;margin:var(--kern-metric-space-small);max-height:calc(calc(100% - var(--kern-metric-dimension-large)) - calc(2 * var(--kern-metric-space-small)))}&[data-v-40ad94ba] .kern-card__container{flex:0 1 auto;overflow-y:auto}.polar-plugin-address-search-selection-wrapper{&[data-v-40ad94ba]{display:flex;flex-direction:row;align-items:center;width:100%;gap:var(--kern-metric-space-small)}.polar-plugin-address-search-input-wrapper{&[data-v-40ad94ba]{display:flex;flex-direction:column;width:100%}#polar-plugin-address-search-input[data-v-40ad94ba]{border-radius:var(--kern-metric-border-radius-small);background:var(--kern-color-form-input-background);padding-right:calc(var(--kern-metric-space-x-large) * 3)}.polar-plugin-address-search-input-button[data-v-40ad94ba]{position:absolute;right:0;border-radius:var(--kern-metric-border-radius-small);margin:var(--kern-metric-space-small);margin-right:var(--kern-metric-space-default);width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large)}.polar-plugin-address-search-hint[data-v-40ad94ba]{color:var(--kern-color-layout-text-muted);font-size:calc(var(--kern-typography-font-size-static-small) * .875);padding:0 var(--kern-metric-space-2x-small);margin-top:var(--kern-metric-space-small)}.kern-loader[data-v-40ad94ba]{position:absolute;right:calc(var(--kern-metric-space-x-large) * 1.5)}}}}",bs=H(_s,[["styles",[vs]],["__scopeId","data-v-40ad94ba"]]),ks={aria:{description:"Durch Eingabe in das Suchfeld kann die Suche nach Adressen gestartet werden",label:`Eingabeelement der $t(defaultLabel, {ns: ${z}})`},defaultLabel:"Adresssuche",hint:{button:"Eingabefeld der Addresssuche anzeigen",clear:"Das Eingabefeld der Addresssuche leeren",error:"Etwas ist bei der Suche schiefgegangen.",loading:"Suche ...",noResults:"Keine Ergebnisse gefunden.",tooShort:"Für die Suche bitte mindestens {{minLength}} Zeichen eingeben."},groupSelector:"Suchthema auswählen",resultCount:"({{count}} Ergebnisse)",resultList:{extend:"Alle Ergebnisse anzeigen",reduce:"Ergebnisliste reduzieren"}},xs={aria:{description:"By entering text into the search field, the address search can be started",label:`Input element of the $t(defaultLabel, {ns: ${z}})`},defaultLabel:"Address Search",hint:{button:"Show address search input field",clear:"Clear address search input field",error:"Something went wrong.",loading:"Searching ...",noResults:"No results for the current query.",tooShort:"Please enter at least {{minLength}} characters."},groupSelector:"Select search topic",resultCount:"({{count}} results)",resultList:{extend:"Show all results",reduce:"Reduce result list"}},ws=[{type:"de",resources:ks},{type:"en",resources:xs}];function Cs(n){return{id:z,component:bs,locales:ws,storeModule:Zt,options:n}}const Nr=be("plugins/footer",()=>{const n=Q(),e=P([]),t=P([]);function r(){e.value=(n.configuration.footer?.leftEntries||[]).filter(({id:s})=>{const i=n.configuration[s]?.displayComponent;return typeof i=="boolean"?i:!0}),t.value=(n.configuration.footer?.rightEntries||[]).filter(({id:s})=>{const i=n.configuration[s]?.displayComponent;return typeof i=="boolean"?i:!0}),e.value.concat(t.value).forEach(s=>{n.addPlugin(B(s,{independent:!1}))}),e.value.map(s=>B(s,{component:lr(s.component)})),t.value.map(s=>B(s,{component:lr(s.component)}))}function a(){}return{leftEntries:e,rightEntries:t,setupPlugin:r,teardownPlugin:a}}),Ss={class:"polar-plugin-footer-wrapper"},Es=q({__name:"PolarFooter.ce",setup(n){const{leftEntries:e,rightEntries:t}=he(Nr());return(r,a)=>(b(),S("div",Ss,[A("ul",null,[(b(!0),S(Y,null,ae(m(e),(s,i)=>(b(),S("li",{key:i},[(b(),M(pt(s.component)))]))),128))]),A("ul",null,[(b(!0),S(Y,null,ae(m(t),(s,i)=>(b(),S("li",{key:i},[(b(),M(pt(s.component)))]))),128))])]))}}),Ts=".polar-plugin-footer-wrapper{&[data-v-9004f27e]{position:absolute;bottom:0;display:flex;width:100%;height:var(--kern-metric-dimension-large);padding:var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-small);justify-content:space-between;align-items:center;flex-shrink:0;background:var(--kern-color-layout-background-hued);box-shadow:0 1px 1px #35395629,0 1px 2px #35395640,0 1px 6px #6e759740;border-radius:0 0 var(--kern-metric-border-radius-large) var(--kern-metric-border-radius-large)}ul{&[data-v-9004f27e]{display:flex;align-items:center;gap:var(--kern-metric-space-small);padding:0}li[data-v-9004f27e]{list-style:none}}}",$s=H(Es,[["styles",[Ts]],["__scopeId","data-v-9004f27e"]]),Ls={},Is={},As=[{type:"de",resources:Ls},{type:"en",resources:Is}],Fs="footer";function Ps(n){return{id:Fs,component:$s,locales:As,storeModule:Nr,options:n}}const Rs=100,Ms=100,At={undefinedBoundaryLayer:Symbol.for("Boundary Layer undefined"),undefinedBoundarySource:Symbol.for("Boundary Source undefined"),sourceNotReady:Symbol.for("Source not ready")};async function Ds(n){let e=0;for(;n.getState()!=="ready"||n.getFeatures().length===0;)if(e++<Rs)await new Promise(t=>{setTimeout(t,Ms)});else return!1;return!0}async function Br(n,e,t){if(typeof e>"u")return!0;const r=n.getLayers().getArray().find(s=>s.get("id")===e);if(!(r instanceof Fe))return console.error(`@polar/polar(lib/passesBoundaryCheck:61:3)
`,`No layer configured to match boundaryLayerId "${e}".`),At.undefinedBoundaryLayer;const a=r.getSource();return a instanceof je?await Ds(a)?a.getFeatures().some(s=>s.getGeometry()?.intersectsCoordinate(t)):(console.error(`@polar/polar(lib/passesBoundaryCheck:79:3)
`,`Layer with boundaryLayerId "${e}" did not load or is featureless.`),At.sourceNotReady):(console.error(`@polar/polar(lib/passesBoundaryCheck:70:3)
`,`Layer with boundaryLayerId "${e}" missing source.`),At.undefinedBoundarySource)}function gr(){}const R={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Os={ERROR:"error"};let Gs=class extends qe{constructor(e){super(Os.ERROR),this.code=e.code,this.message=e.message}},Ns=class extends wn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=Cn,this.watchId_=void 0,this.addChangeListener(R.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(R.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Sn(lt("EPSG:4326"),e),this.position_&&this.set(R.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(R.ACCURACY,t.accuracy),this.set(R.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(R.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(R.HEADING,t.heading===null?void 0:En(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const r=this.transform_(this.position_);this.set(R.POSITION,r.slice()),this.set(R.SPEED,t.speed===null?void 0:t.speed);const a=Tn(this.position_,t.accuracy);a.applyTransform(this.transform_),this.set(R.ACCURACY_GEOMETRY,a),this.changed()}positionError_(e){this.dispatchEvent(new Gs(e))}getAccuracy(){return this.get(R.ACCURACY)}getAccuracyGeometry(){return this.get(R.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(R.ALTITUDE)}getAltitudeAccuracy(){return this.get(R.ALTITUDE_ACCURACY)}getHeading(){return this.get(R.HEADING)}getPosition(){return this.get(R.POSITION)}getProjection(){return this.get(R.PROJECTION)}getSpeed(){return this.get(R.SPEED)}getTracking(){return this.get(R.TRACKING)}getTrackingOptions(){return this.get(R.TRACKING_OPTIONS)}setProjection(e){this.set(R.PROJECTION,lt(e))}setTracking(e){this.set(R.TRACKING,e)}setTrackingOptions(e){this.set(R.TRACKING_OPTIONS,e)}};const Bs=(n,e)=>()=>n.innerHTML=e.map(([t,r,a={}])=>`<${t}>${Oe.t(r,a)}</${t}>`).join(""),Vs=`
	background: rgba(255, 255, 255, 0.8);
	padding: 0.2em 0.5em;
	border-radius: 4px;
	color: #16161d;
	box-shadow: 0px 0px 3px 2px rgba(0, 0, 0, 0.5);
`;function Us(n,e=Vs){const t=document.createElement("div");t.style.cssText=e;const r=Bs(t,n);return Oe.on("languageChanged",r),Oe.store.on("added",r),r(),{element:t,unregister:()=>{Oe.off("languageChanges",r),Oe.store.off("added",r)}}}function zs(){return navigator.permissions.query({name:"geolocation"}).then(({state:n})=>n==="denied").catch(()=>!1)}function Hs(n,e){const t=e/2*Math.sqrt(3),r=document.createElement("canvas").getContext("2d").createLinearGradient(0,-t,Math.sin(n),t+Math.cos(n));return r.addColorStop(0,"#0794FAFF"),r.addColorStop(2/3,"#0794FA00"),r}function Ws(n){if(typeof n.get("heading")>"u")return new dt;const e=42,t=Math.PI-n.get("heading");return new dt({image:new $n({points:3,radius:e,rotation:t,fill:new wr({color:Hs(t,e)}),displacement:[0,-30]})})}function js(){const n=new wr({color:"#0078D4"}),e=new kn({color:"#FFFFFF",width:2});return t=>[Ws(t),new dt({image:new xn({fill:n,stroke:e,radius:12}),fill:n,stroke:e})]}const qs=(n,e)=>n[0]!==e[0]||n[1]!==e[1],Vr=be("plugins/geoLocation",()=>{const n=Q(),e=P(!1),t=P(null),r=P(null),a=P([]),s=T(()=>B({showTooltip:!1,zoomLevel:7},n.configuration.geoLocation||{})),i=T(()=>s.value.boundary),o=T(()=>e.value?"DISABLED":t.value===null?"LOCATABLE":"LOCATED"),l=new re({type:"point",name:"geoLocationMarker"}),d=new Fe({source:new je({features:[l]}),properties:{name:"geoLocationMarkerLayer"},zIndex:1/0,style:js()});function c(){n.map.addLayer(d),s.value.checkLocationInitially?f():zs().then(C=>e.value=C),p()}function u(){n.map.removeLayer(d),g(),L(),h()}let h=gr;function p(){if(s.value.showTooltip){const{unregister:C,element:E}=Us([["h2","markerText",{ns:"geoLocation"}]]),D=new vn({element:E,positioning:"bottom-center",offset:[0,-5]});n.map.addOverlay(D);const ie=({pixel:_e,dragging:Ct})=>{if(Ct)return;const Je=n.map.getFeaturesAtPixel(_e,{layerFilter:St=>St.get("name")==="geoLocationMarkerLayer"}).length?n.map.getCoordinateFromPixel(_e):void 0;D.setPosition(Je)};n.map.on("pointermove",ie),h=()=>{C(),n.map.removeOverlay(D),n.map.un("pointermove",ie),h=gr}}}function k(){(o.value==="LOCATABLE"?f:g)()}function f(){if(e.value){_({message:"Geolocation API usage was denied by user or configuration."});return}t.value===null?t.value=new Ns({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:lt("EPSG:4326")}):y(),t.value.on("change:position",y),t.value.on("change:heading",({target:C})=>{l.set("heading",C.getHeading())}),t.value.on("error",_)}function _(C){Be("error",le(E=>E.button.locationAccessDenied,{ns:"geoLocation"})),console.error(`@polar/polar(plugins/geoLocation/store:176:3)
`,C.message),e.value=!0,L()}function g(){t.value?.setTracking(!1),L(),t.value=null}async function y(){const C=We(t.value?.getPosition(),lt("EPSG:4326"),n.configuration.epsg),E=n.configuration.extent?bn(n.configuration.extent,C):!0,D=await Br(n.map,i.value?.layerId,C),ie=r.value!==D;r.value=D;const _e=typeof D=="symbol"&&i.value?.onError==="strict";if(!E||_e){w(_e),g();return}qs(a.value,C)&&(x(C),ie&&!D&&w(!1))}function x(C){a.value=C;const E=!!l.getGeometry();l.setGeometry(new ce(C)),(s.value.keepCentered||!E)&&r.value&&(n.map.getView().setCenter(C),n.map.getView().setZoom(s.value.zoomLevel))}function L(){l.setGeometry(void 0),a.value=[]}function w(C){if(C){const D=le(ie=>ie.toast.boundaryError,{ns:"geoLocation"});Be("error",D),console.error(`@polar/polar(plugins/geoLocation/store:264:4)
`,D);return}const E=le(D=>D.toast.notInBoundary,{ns:"geoLocation"});Be("info",E,{timeout:1e4}),console.info(`@polar/polar(plugins/geoLocation/store:272:3)
`,E)}return{setupPlugin:c,teardownPlugin:u,locate:k,configuration:s,isGeolocationDenied:e,state:o,position:a,boundaryCheck:r}}),Ur="geoLocation",Ks=q({__name:"GeoLocation.ce",setup(n){const{layout:e}=he(Q()),t=Vr(),{state:r}=he(t),a=T(()=>r.value==="LOCATED"?"kern-icon-fill--near-me":r.value==="LOCATABLE"?"kern-icon--near-me":"kern-icon--near-me-disabled"),s=T(()=>t.configuration.renderType==="iconMenu"?void 0:e.value==="standard"||t.configuration.layoutTag?.includes("RIGHT")?"left":"right");return(i,o)=>(b(),M(xr,{class:Ie(m(e)==="nineRegions"?"polar-plugin-geoLocation-nineRegions":""),hint:i.$t(l=>l.button.tooltip,{ns:m(Ur)}),icon:a.value,"tooltip-position":s.value,disabled:m(r)==="DISABLED",onClick:m(t).locate},null,8,["class","hint","icon","tooltip-position","disabled","onClick"]))}}),Xs=".polar-plugin-geoLocation-nineRegions[data-v-45fc3e3e]{margin:var(--kern-metric-space-small)}",Js=H(Ks,[["styles",[Xs]],["__scopeId","data-v-45fc3e3e"]]),Ys={markerText:"Aktuelle Position",button:{locationAccessDenied:"Standortzugriff nutzerseitig abgelehnt",tooltip:"Eigene Position markieren"},toast:{boundaryError:"Die Überprüfung Ihrer Position ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Sie befinden sich nicht im Kartengebiet."}},Qs={markerText:"Current location",button:{locationAccessDenied:"Location access denied by user",tooltip:"Mark own location"},toast:{boundaryError:"Validating your position failed. Please try later again or contact an administrator if the issue persists.",notInBoundary:"You are not within the map's boundaries."}},Zs=[{type:"de",resources:Ys},{type:"en",resources:Qs}];function ei(n){return{id:Ur,component:Js,locales:Zs,storeModule:Vr,options:n}}const G=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Ke(n){return Ln(n[0].version,"1.3")>=0}const ti=O(G,{Service:v(wi),Capability:v(xi)}),ri=O(G,{Request:v(Fi),Exception:v(Ti),Layer:v($i),UserDefinedSymbolization:v(bi)});let ni=class extends In{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),V({version:this.version},ti,e,[])||null}};const zr={Name:v(I),Title:v(I),Abstract:v(I),KeywordList:v(Xr),OnlineResource:v(Wt),ContactInformation:v(Ci),Fees:v(I),AccessConstraints:v(I)},ai=O(G,zr),si=O(G,{...zr,LayerLimit:v($t),MaxWidth:v($t),MaxHeight:v($t)}),ii=O(G,{ContactPersonPrimary:v(Si),ContactPosition:v(I),ContactAddress:v(Ei),ContactVoiceTelephone:v(I),ContactFacsimileTelephone:v(I),ContactElectronicMailAddress:v(I)}),oi=O(G,{ContactPerson:v(I),ContactOrganization:v(I)}),li=O(G,{AddressType:v(I),Address:v(I),City:v(I),StateOrProvince:v(I),PostCode:v(I),Country:v(I)}),di=O(G,{Format:Cr(I)}),Hr={Name:v(I),Title:v(I),Abstract:v(I),KeywordList:v(Xr),BoundingBox:U(qr),Dimension:U(Li),Attribution:v(vi),AuthorityURL:U(Mi),Identifier:U(I),MetadataURL:U(Di),DataURL:U(ge),FeatureListURL:U(ge),Style:U(Oi),Layer:U(wt)},Wr=O(G,{...Hr,SRS:U(I),Extent:v(Ii),ScaleHint:U(Ai),LatLonBoundingBox:v((n,e)=>qr(n,e,!1)),Layer:U(wt)}),jr=O(G,{...Hr,CRS:U(I),EX_GeographicBoundingBox:v(ki),MinScaleDenominator:v(ke),MaxScaleDenominator:v(ke),Layer:U(wt)}),ci=O(G,{Title:v(I),OnlineResource:v(Wt),LogoURL:v(Kr)}),ui=O(G,{westBoundLongitude:v(ke),eastBoundLongitude:v(ke),southBoundLatitude:v(ke),northBoundLatitude:v(ke)}),hi=O(G,{GetCapabilities:v(De),GetMap:v(De),GetFeatureInfo:v(De),DescribeLayer:v(De),GetLegendGraphic:v(De)}),gi=O(G,{Format:U(I),DCPType:U(Pi)}),pi=O(G,{HTTP:v(Ri)}),fi=O(G,{Get:v(ge),Post:v(ge)}),mi=O(G,{Name:v(I),Title:v(I),Abstract:v(I),LegendURL:U(Kr),StyleSheetURL:v(ge),StyleURL:v(ge)}),yi=O(G,{Format:v(I),OnlineResource:v(Wt)}),_i=O(G,{Keyword:Cr(I)});function vi(n,e){return V({},ci,n,e)}function bi(n,e){return{SupportSLD:!!J(n.getAttribute("SupportSLD")),UserLayer:!!J(n.getAttribute("UserLayer")),UserStyle:!!J(n.getAttribute("UserStyle")),RemoteWFS:!!J(n.getAttribute("RemoteWFS")),InlineFeatureData:!!J(n.getAttribute("InlineFeatureData")),RemoteWCS:!!J(n.getAttribute("RemoteWCS"))}}function qr(n,e,t=!0){const r=[de(n.getAttribute("minx")),de(n.getAttribute("miny")),de(n.getAttribute("maxx")),de(n.getAttribute("maxy"))],a=[de(n.getAttribute("resx")),de(n.getAttribute("resy"))],s={extent:r,res:a};return t&&(Ke(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function ki(n,e){const t=V({},ui,n,e);if(!t)return;const r=t.westBoundLongitude,a=t.southBoundLatitude,s=t.eastBoundLongitude,i=t.northBoundLatitude;if(!(r===void 0||a===void 0||s===void 0||i===void 0))return[r,a,s,i]}function xi(n,e){return V({},ri,n,e)}function wi(n,e){return V({},Ke(e)?si:ai,n,e)}function Ci(n,e){return V({},ii,n,e)}function Si(n,e){return V({},oi,n,e)}function Ei(n,e){return V({},li,n,e)}function Ti(n,e){return V([],di,n,e)}function $i(n,e){const t=V({},Ke(e)?jr:Wr,n,e);return t.Layer===void 0?Object.assign(t,wt(n,e)):t}function wt(n,e){const t=Ke(e),r=e[e.length-1],a=V({},t?jr:Wr,n,e);if(!a)return;let s=J(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),a.queryable=s!==void 0?s:!1;let i=Gt(n.getAttribute("cascaded"));i===void 0&&(i=r.cascaded),a.cascaded=i;let o=J(n.getAttribute("opaque"));o===void 0&&(o=r.opaque),a.opaque=o!==void 0?o:!1;let l=J(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),a.noSubsets=l!==void 0?l:!1;let d=de(n.getAttribute("fixedWidth"));d||(d=r.fixedWidth),a.fixedWidth=d;let c=de(n.getAttribute("fixedHeight"));c||(c=r.fixedHeight),a.fixedHeight=c;const u=["Style","AuthorityURL"];t?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(p){if(p in r){const k=a[p]||[];a[p]=k.concat(r[p])}});const h=["BoundingBox","Attribution"];return t?h.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):h.push("LatLonBoundingBox","ScaleHint","Extent"),h.forEach(function(p){if(!(p in a)){const k=r[p];a[p]=k}}),a}function Li(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return Ke(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:J(n.getAttribute("multipleValues")),nearestValue:J(n.getAttribute("nearestValue")),current:J(n.getAttribute("current")),values:I(n)}),t}function Ii(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:J(n.getAttribute("nearestValue"))}}function Ai(n,e){return{min:de(n.getAttribute("min")),max:de(n.getAttribute("max"))}}function ge(n,e){return V({},yi,n,e)}function Fi(n,e){return V({},hi,n,e)}function Pi(n,e){return V({},pi,n,e)}function Ri(n,e){return V({},fi,n,e)}function De(n,e){return V({},gi,n,e)}function Kr(n,e){const t=ge(n,e);if(t){const r=[Gt(n.getAttribute("width")),Gt(n.getAttribute("height"))];return t.size=r,t}}function Mi(n,e){const t=ge(n,e);if(t)return t.name=n.getAttribute("name"),t}function Di(n,e){const t=ge(n,e);if(t)return t.type=n.getAttribute("type"),t}function Oi(n,e){return V({},mi,n,e)}function Xr(n,e){return V([],_i,n,e)}function Gi({legendURL:n,layers:e="",url:t,typ:r,format:a,version:s}){return n?n==="ignore"?[]:[n]:e.split(",").filter(i=>i).map(i=>`${t}?SERVICE=${r}&REQUEST=GetLegendGraphic&FORMAT=${a||"image/png"}&VERSION=${s}&LAYER=${i}`)}const pr=(n,e)=>n.filter(t=>{let{minZoom:r,maxZoom:a}=t;return typeof r>"u"&&(r=0),typeof a>"u"&&(a=Number.MAX_SAFE_INTEGER),r<=e&&e<=a});function mt(n,e){if(Array.isArray(n))return n.map(t=>mt(t,e)).find(t=>t!==null)||null;if(typeof n=="object"){if(n.Name===e)return n;if(n.Layer)return mt(n.Layer,e)}return null}const Ni=n=>(Array.isArray(n)?n:[n]).map(e=>(Array.isArray(e.LegendURL)?e.LegendURL:typeof e.LegendURL=="object"?[e.LegendURL]:[]).map(t=>t.OnlineResource)).flat(1);function Bi(n,e){return mt(n.Capability.Layer,e)?.Title||""}function Vi(n,e){const t=mt(n.Capability.Layer,e)?.Style;return t&&Ni(t)[0]||""}function Ui(n,e){const t=e[n];if(t)try{return new ni().read(t)}catch(r){console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:21:4)
`,`Error reading xml '${t}' for id '${n}'.`,r)}return null}function zi(n,e){return Promise.all(n.map(async t=>{const{id:r}=t,a=t.options?.layers;if(a&&(a.title===!0||a.legend===!0)){if(typeof e[r]=="string")return console.warn(`@polar/polar(plugins/layerChooser/utils/capabilities:41:6)
`,`Re-fired loadCapabilities on id '${r}' albeit the GetCapabilities have already been successfully fetched. No re-fetch will occur.`),[r,null];const s=_t.getLayerWhere({id:t.id});if(!s||!s.url||!s.version||!s.typ)return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:49:6)
`,`Missing data for service '${s}' with id '${r}'.`),[r,null];const i=`${s.url}?service=${s.typ}&version=${s.version}&request=GetCapabilities`;try{const o=await fetch(i);return[r,await o.text()]}catch(o){return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:61:6)
`,`Capabilities from ${i} could not be fetched.`,o),[r,null]}}return[r,null]})).then(t=>t.reduce((r,[a,s])=>B(r,{[a]:s}),{}))}function Hi(n,e,t){const r=_t.getLayerWhere({id:n}),a=Ui(n,e);return{[n]:(t.order?.split(",")||r.layers.split(",")).map(s=>({layerName:s,displayName:t.title===!0&&a?Bi(a,s):t.title===!1?s:t.title?.[s]||s,layerImage:t.legend===!0&&a?Vi(a,s):t.legend===!1?null:t.legend?.[s]||null}))}}const Wi=n=>n.reduce(([e,t],r)=>_t.getLayerWhere({id:r.id})===null?(console.error(`@polar/polar(plugins/layerChooser/utils/getBackgroundsAndMasks:15:5)
`,`Layer ${r.id} not found in service register. This is a configuration issue. The map might behave in unexpected ways.`,r),[e,t]):r.type==="background"?[[...e,r],t]:[e,[...t,r]],[[],[]]),ji=n=>n.map(({id:e,name:t})=>({id:e,name:t})).map(e=>B(e,{rawLayer:_t.getLayerWhere({id:e.id})})).filter(({rawLayer:e})=>e!==null).reduce((e,t)=>{const r=Gi(t.rawLayer)[0];return typeof r=="string"?{...e,[t.id]:{name:t.name,url:r}}:e},{}),Pe=be("plugins/layerChooser",()=>{const n=Q(),e=P({}),t=P([]),r=P([]),a=P([]),s=P([]),i=P(""),o=P([]),l=P({}),d=P(""),c=P({}),u=P(""),h=T(()=>t.value.reduce((w,{id:C})=>({...w,[C]:a.value.findIndex(({id:E})=>E===C)===-1}),{})),p=T(()=>k.value.reduce((w,{id:C})=>({...w,[C]:s.value.findIndex(({id:E})=>E===C)===-1}),{})),k=T(()=>r.value.filter(({hideInMenu:w})=>!w)),f=T(()=>k.value.reduce((w,C)=>B(w,{[C.type]:Array.isArray(w[C.type])?w[C.type].concat(C):[C]}),{}));function _(){const[w,C]=Wi(n.configuration.layers);t.value=w,r.value=C,w.length===0&&console.error(`@polar/polar(plugins/layerChooser/store:100:4)
`,'No layers of type "background" have been configured.'),i.value=w.find(({visibility:E})=>E)?.id||"",o.value=C.filter(({visibility:E})=>E).map(({id:E})=>E),x(),n.map.on("moveend",x),l.value=ji(n.configuration.layers),zi(n.configuration.layers,e.value).then(E=>{e.value=E,n.configuration.layers.forEach(D=>{const ie=D.options?.layers;ie&&(c.value=B(c.value,Hi(D.id,E,ie)))})})}function g(){n.map.un("moveend",x)}Ae(i,w=>{n.map.getLayers().getArray().forEach(C=>{t.value.find(({id:E})=>E===C.get("id"))&&C.setVisible(C.get("id")===w)})}),Ae(o,w=>{y(w)});function y(w){n.map.getLayers().getArray().forEach(C=>{r.value.find(({id:E})=>E===C.get("id"))&&C.setVisible(w.includes(C.get("id")))})}function x(){const w=n.map.getView().getZoom();a.value=pr(t.value,w),s.value=pr(r.value,w);const C=a.value.map(({id:E})=>E);C.includes(i.value)||(i.value=C[0]||""),y(s.value.map(({id:E})=>E).filter(E=>o.value.includes(E)))}function L(w){const C=n.map.getLayers().getArray().find(E=>E.get("id")===u.value).getSource();if(!C){console.error(`@polar/polar(plugins/layerChooser/store:208:4)
`,`Action 'toggleOpenedOptionsServiceLayer' failed on ${u.value}. Layer not found in OpenLayers or source not initialized in OpenLayers.`);return}C.updateParams({...C.getParams(),LAYERS:w})}return{activeBackgroundId:i,activeMaskIds:o,backgrounds:t,capabilities:e,disabledBackgrounds:h,disabledMasks:p,layersWithLegends:l,layersWithOptions:c,masksSeparatedByType:f,shownMasks:k,openedLegendId:d,openedOptionsId:u,setupPlugin:_,teardownPlugin:g,toggleOpenedOptionsServiceLayer:L}}),se="layerChooser",qi=["id"],Ki={class:"kern-label"},Jr=q({__name:"LayerInformationCard.ce",props:{identifier:{type:String},idName:{type:String}},setup(n){const e=n,t=Q(),r=Pe();ga(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-back-button`)?.focus()});function a(){const s=r[e.idName];r[e.idName]="",gt(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-${s}-button`)?.focus()})}return(s,i)=>(b(),M(xt,null,{default:ue(()=>[A("button",{id:`polar-layer-chooser-${n.identifier}-back-button`,class:"kern-btn kern-btn--secondary",onClick:a},[i[0]||(i[0]=A("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),A("span",Ki,ne(s.$t(o=>o.returnToLayers,{ns:m(se)})),1)],8,qi),Yt(s.$slots,"default")]),_:3}))}}),Xi={class:"kern-label",for:"polar-layer-chooser-legend-anchor"},Ji=["href","aria-label"],Yi=["src","alt"],Qi=q({__name:"LayerLegend.ce",setup(n){const e=Pe(),t=T(()=>e.layersWithLegends[e.openedLegendId]);return(r,a)=>(b(),M(Jr,{identifier:"legend","id-name":"openedLegendId",class:"legend-card"},{default:ue(()=>[A("label",Xi,ne(r.$t(s=>s.legend.to,{name:t.value.name,ns:m(se)})),1),A("a",{id:"polar-layer-chooser-legend-anchor",href:t.value.url,"aria-label":r.$t(s=>s.legend.to,{name:t.value.name,ns:m(se)}),target:"_blank"},[A("img",{src:t.value.url,alt:r.$t(s=>s.legend.to,{name:t.value.name,ns:m(se)})},null,8,Yi)],8,Ji)]),_:1}))}}),Zi=".legend-card[data-v-e248e19b]{overflow-y:scroll}",eo=H(Qi,[["styles",[Zi]],["__scopeId","data-v-e248e19b"]]),to={class:"kern-form-check"},ro=["id","name","value","type","disabled"],no=["for"],ao=q({__name:"PolarInput.ce",props:pa({idSuffix:{type:String},label:{type:String},type:{type:null},value:{type:String},disabled:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const e=fa(n,"modelValue");return(t,r)=>(b(),S("div",to,[Pr(A("input",{id:`polar-${n.type}-${n.value}-${n.idSuffix}`,"onUpdate:modelValue":r[0]||(r[0]=a=>e.value=a),class:Ie(`polar-input kern-form-check__${n.type}`),name:n.value,value:n.value,type:n.type,disabled:n.disabled},null,10,ro),[[ma,e.value]]),A("label",{class:"polar-input kern-label",for:`polar-${n.type}-${n.value}-${n.idSuffix}`},ne(n.label),9,no)]))}}),so=".kern-form-check__radio[disabled],.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:hover{border:var(--kern-metric-border-width-default) solid var(--kern-color-form-input-border)}}.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:checked:hover:before{margin:var(--kern-metric-space-x-small)}}",zt=H(ao,[["styles",[so]],["__scopeId","data-v-83635f17"]]),io={class:"kern-fieldset"},oo={class:"kern-label"},lo={class:"kern-fieldset__body"},co=q({__name:"PolarInputGroup.ce",props:{legend:{type:String}},setup(n){return(e,t)=>(b(),S("fieldset",io,[A("legend",oo,ne(n.legend),1),A("div",lo,[Yt(e.$slots,"default",{},void 0,!0)])]))}}),uo=".kern-fieldset[data-v-69d29a6c]{width:100%}.kern-fieldset__body[data-v-69d29a6c]{width:100%;padding:var(--kern-metric-space-small) 0;gap:var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);background-color:var(--kern-color-layout-background-hued)}.kern-label[data-v-69d29a6c]{padding-left:.75rem}[data-v-69d29a6c] .kern-form-check{align-items:center;gap:var(--kern-metric-space-large);margin-left:.75rem;padding-right:0}",Ht=H(co,[["styles",[uo]],["__scopeId","data-v-69d29a6c"]]),ho=["src","alt"],go=q({__name:"LayerOptions.ce",setup(n){const e=Q(),t=Pe(),{openedOptionsId:r}=he(t),a=T(()=>t.layersWithOptions[r.value]),s=P(a.value.map(({layerName:l})=>l).reverse()),i=T({get:()=>s.value,set:l=>{s.value=l,t.toggleOpenedOptionsServiceLayer(l)}}),o=T(()=>e.configuration.layers.find(({id:l})=>l===r.value)?.name||"");return(l,d)=>(b(),M(Jr,{identifier:"options","id-name":"openedOptionsId"},{default:ue(()=>[Le(Ht,{legend:l.$t(c=>c.layerHeader,{ns:m(se),name:o.value})},{default:ue(()=>[(b(!0),S(Y,null,ae(a.value,({displayName:c,layerImage:u,layerName:h})=>(b(),S("div",{key:`polar-layer-chooser-mask-options-checkbox-${h}`,class:"polar-layer-chooser-options-checkbox-wrapper"},[u?(b(),S("img",{key:0,src:u,alt:h},null,8,ho)):W("",!0),Le(zt,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=p=>i.value=p),"id-suffix":"polar-layer-chooser-mask-options",label:c,type:"checkbox",value:h,class:Ie(a.value.some(({layerImage:p})=>p!==null)?"polar-layer-chooser-options-checkbox":"")},null,8,["modelValue","label","value","class"])]))),128))]),_:1},8,["legend"])]),_:1}))}}),po=".polar-layer-chooser-options-checkbox-wrapper[data-v-1ce80731]{display:flex;justify-content:flex-start;align-items:center;gap:var(--kern-metric-space-large)}.kern-form-check.polar-layer-chooser-options-checkbox[data-v-1ce80731]{margin-left:0}.kern-btn[data-v-1ce80731]{border:none;min-height:inherit;padding:var(--kern-metric-space-x-small)}.kern-label[data-v-1ce80731]{padding:0;padding-left:var(--kern-metric-space-small)}",fo=H(go,[["styles",[po]],["__scopeId","data-v-1ce80731"]]),mo=["id","disabled"],yo={class:"kern-label kern-sr-only"},fr=q({__name:"LegendButton.ce",props:{disabled:{type:Boolean},id:{type:String}},setup(n){return(e,t)=>(b(),S("button",{id:`polar-layer-chooser-legend-${n.id}-button`,class:"kern-btn kern-btn--tertiary",disabled:n.disabled},[t[0]||(t[0]=A("span",{class:"kern-icon kern-icon--info","aria-hidden":"true"},null,-1)),A("span",yo,ne(e.$t(r=>r.legend.open,{ns:m(se)})),1)],8,mo))}}),_o=["id","disabled","onClick"],vo={class:"kern-label kern-sr-only"},bo=q({__name:"LayerSelection.ce",setup(n){const e=Pe(),{activeBackgroundId:t,activeMaskIds:r,backgrounds:a,disabledBackgrounds:s,disabledMasks:i,layersWithOptions:o,masksSeparatedByType:l,openedLegendId:d,shownMasks:c}=he(e),u=T(()=>Object.keys(e.layersWithLegends));function h(p){e.openedOptionsId=p}return(p,k)=>(b(),M(xt,{id:"polar-layer-chooser-card"},{default:ue(()=>[m(a).length?(b(),M(Ht,{key:0,legend:p.$t(f=>f.backgroundTitle,{ns:m(se)})},{default:ue(()=>[(b(!0),S(Y,null,ae(m(a),({name:f,id:_})=>(b(),S("div",{key:`polar-layer-chooser-background-radio-${_}`,class:"polar-layer-chooser-input-wrapper"},[Le(zt,{modelValue:m(t),"onUpdate:modelValue":k[0]||(k[0]=g=>Vt(t)?t.value=g:null),"id-suffix":"polar-layer-chooser-background",label:f,type:"radio",value:_,disabled:m(s)[_]},null,8,["modelValue","label","value","disabled"]),u.value.includes(_)?(b(),M(fr,{key:0,id:_,disabled:m(s)[_],onClick:g=>d.value=_},null,8,["id","disabled","onClick"])):W("",!0)]))),128))]),_:1},8,["legend"])):W("",!0),m(c).length?(b(!0),S(Y,{key:1},ae(Object.entries(m(l)),([f,_])=>(b(),M(Ht,{key:`polar-layer-chooser-mask-${f}`,legend:p.$t(g=>g[`${f}Title`],{ns:m(se)})},{default:ue(()=>[(b(!0),S(Y,null,ae(_,({name:g,id:y})=>(b(),S("div",{key:`polar-layer-chooser-mask-${f}-checkbox-${y}`,class:"polar-layer-chooser-input-wrapper"},[Le(zt,{modelValue:m(r),"onUpdate:modelValue":k[1]||(k[1]=x=>Vt(r)?r.value=x:null),"id-suffix":`polar-layer-chooser-mask-${f}`,label:g,type:"checkbox",value:y,disabled:m(i)[y]},null,8,["modelValue","id-suffix","label","value","disabled"]),Object.keys(m(o)).includes(y)?(b(),S("button",{key:0,id:`polar-layer-chooser-options-${y}-button`,class:"kern-btn kern-btn--tertiary",disabled:m(i)[y],onClick:()=>h(y)},[k[2]||(k[2]=A("span",{class:"kern-icon kern-icon-fill--settings","aria-hidden":"true"},null,-1)),A("span",vo,ne(p.$t(x=>x.layerOptions,{ns:m(se)})),1)],8,_o)):u.value.includes(y)?(b(),M(fr,{key:1,id:y,disabled:m(i)[y],onClick:x=>d.value=y},null,8,["id","disabled","onClick"])):W("",!0)]))),128))]),_:2},1032,["legend"]))),128)):W("",!0)]),_:1}))}}),ko="#polar-layer-chooser-card[data-v-c4509e12]{overflow-y:inherit}.polar-layer-chooser-input-wrapper[data-v-c4509e12]{display:flex;justify-content:space-between;align-items:center;gap:var(--kern-metric-space-large)}.kern-btn[data-v-c4509e12]{width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large);border:none;border-radius:50%}",xo=H(bo,[["styles",[ko]],["__scopeId","data-v-c4509e12"]]),wo=q({__name:"LayerChooser.ce",setup(n){const e=Pe(),t=T(()=>e.openedLegendId.length!==0),r=T(()=>e.openedOptionsId.length===0&&!t.value);return(a,s)=>r.value?(b(),M(xo,{key:0})):t.value?(b(),M(eo,{key:1})):(b(),M(fo,{key:2}))}}),Co={backgroundTitle:"Hintergrundkarten",maskTitle:"Fachdaten",layerHeader:'Auswahl sichtbarer Ebenen für Layer "{{name}}"',layerOptions:"Optionen für Kartenmaterial",legend:{title:"Legende",to:'Legendenbild zu "{{name}}"',open:`$t(legend.to, {ns: ${se}}) öffnen`},returnToLayers:"Zurück"},So={backgroundTitle:"Background maps",maskTitle:"Subject data",layerHeader:'Visible layer selection for layer "{{name}}"',layerOptions:"Map data options",legend:{title:"Legend",to:'"{{name}}" legend image',open:`Open $t(legend.to, {ns: ${se}})`},returnToLayers:"Back"},Eo=[{type:"de",resources:Co},{type:"en",resources:So}];function To(n){return{id:se,component:wo,icon:"kern-icon-fill--layers",locales:Eo,storeModule:Pe,options:n}}const $o=["KernLoader","BasicLoader","RingLoader","RollerLoader","CircleLoader","SpinnerLoader"],Yr=be("plugins/loadingIndicator",()=>{const n=P(new Set),e=P("KernLoader"),t=T(()=>n.value.size>0);function r(){const l=Q().configuration.loadingIndicator?.loaderStyle;l&&o(l)}function a(){o("KernLoader")}function s(l){n.value=new Set([...n.value,l])}function i(l){const d=new Set(n.value);d.delete(l),n.value=d}function o(l){$o.includes(l)?e.value=l:console.error(`@polar/polar(plugins/loadingIndicator/store:62:5)
`,`Loader style ${l} does not exist. Using previous style (${e.value}).`)}return{loaderStyle:e,showLoader:t,addLoadingKey:s,removeLoadingKey:i,setLoaderStyle:o,setupPlugin:r,teardownPlugin:a}}),Lo={class:"lds-default"},Io=q({__name:"BasicLoader.ce",setup(n){return(e,t)=>(b(),S("div",Lo,[(b(),S(Y,null,ae(12,r=>A("div",{key:r})),64))]))}}),Ao=".lds-default[data-v-6079aaec]{color:var(--kern-color-action-default)}.lds-default[data-v-6079aaec],.lds-default div[data-v-6079aaec]{box-sizing:border-box}.lds-default[data-v-6079aaec]{display:inline-block;position:relative;width:80px;height:80px}.lds-default div[data-v-6079aaec]{position:absolute;width:6.4px;height:6.4px;background:currentColor;border-radius:50%;animation:lds-default-6079aaec 1.2s linear infinite}.lds-default div[data-v-6079aaec]:nth-child(1){animation-delay:0s;top:36.8px;left:66.24px}.lds-default div[data-v-6079aaec]:nth-child(2){animation-delay:-.1s;top:22.08px;left:62.29579px}.lds-default div[data-v-6079aaec]:nth-child(3){animation-delay:-.2s;top:11.30421px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(4){animation-delay:-.3s;top:7.36px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(5){animation-delay:-.4s;top:11.30421px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(6){animation-delay:-.5s;top:22.08px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(7){animation-delay:-.6s;top:36.8px;left:7.36px}.lds-default div[data-v-6079aaec]:nth-child(8){animation-delay:-.7s;top:51.52px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(9){animation-delay:-.8s;top:62.29579px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(10){animation-delay:-.9s;top:66.24px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(11){animation-delay:-1s;top:62.29579px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(12){animation-delay:-1.1s;top:51.52px;left:62.29579px}@keyframes lds-default-6079aaec{0%,20%,80%,to{transform:scale(1)}50%{transform:scale(1.5)}}",Fo=H(Io,[["styles",[Ao]],["__scopeId","data-v-6079aaec"]]),Po={},Ro=".lds-circle[data-v-149ac9d5]{color:var(--kern-color-action-default)}.lds-circle[data-v-149ac9d5],.lds-circle div[data-v-149ac9d5]{box-sizing:border-box}.lds-circle[data-v-149ac9d5]{display:inline-block;transform:translateZ(1px);width:80px;height:80px}.lds-circle>div[data-v-149ac9d5]{display:inline-block;width:64px;height:64px;margin:8px;background:currentColor;border-radius:50%;animation:lds-circle-149ac9d5 2.4s cubic-bezier(0,.2,.8,1) infinite}@keyframes lds-circle-149ac9d5{0%,to{animation-timing-function:cubic-bezier(.5,0,1,.5)}0%{transform:rotateY(0)}50%{transform:rotateY(1800deg);animation-timing-function:cubic-bezier(0,.5,.5,1)}to{transform:rotateY(3600deg)}}",Mo={class:"lds-circle"};function Do(n,e,t,r,a,s){return b(),S("div",Mo,[...e[0]||(e[0]=[A("div",null,null,-1)])])}const Oo=H(Po,[["render",Do],["styles",[Ro]],["__scopeId","data-v-149ac9d5"]]),Go={},No=".lds-ring[data-v-712a38e8]{color:var(--kern-color-action-default)}.lds-ring[data-v-712a38e8],.lds-ring div[data-v-712a38e8]{box-sizing:border-box}.lds-ring[data-v-712a38e8]{display:inline-block;position:relative;width:80px;height:80px}.lds-ring div[data-v-712a38e8]{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid currentColor;border-radius:50%;animation:lds-ring-712a38e8 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.lds-ring div[data-v-712a38e8]:nth-child(1){animation-delay:-.45s}.lds-ring div[data-v-712a38e8]:nth-child(2){animation-delay:-.3s}.lds-ring div[data-v-712a38e8]:nth-child(3){animation-delay:-.15s}@keyframes lds-ring-712a38e8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",Bo={class:"lds-ring"};function Vo(n,e,t,r,a,s){return b(),S("div",Bo,[(b(),S(Y,null,ae(4,i=>A("div",{key:i})),64))])}const Uo=H(Go,[["render",Vo],["styles",[No]],["__scopeId","data-v-712a38e8"]]),zo={},Ho='.lds-roller[data-v-c8254b29]{color:var(--kern-color-action-default)}.lds-roller[data-v-c8254b29],.lds-roller div[data-v-c8254b29],.lds-roller div[data-v-c8254b29]:after{box-sizing:border-box}.lds-roller[data-v-c8254b29]{display:inline-block;position:relative;width:80px;height:80px}.lds-roller div[data-v-c8254b29]{animation:lds-roller-c8254b29 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller div[data-v-c8254b29]:after{content:" ";display:block;position:absolute;width:7.2px;height:7.2px;border-radius:50%;background:currentColor;margin:-3.6px 0 0 -3.6px}.lds-roller div[data-v-c8254b29]:nth-child(1){animation-delay:-36ms}.lds-roller div[data-v-c8254b29]:nth-child(1):after{top:62.62742px;left:62.62742px}.lds-roller div[data-v-c8254b29]:nth-child(2){animation-delay:-72ms}.lds-roller div[data-v-c8254b29]:nth-child(2):after{top:67.71281px;left:56px}.lds-roller div[data-v-c8254b29]:nth-child(3){animation-delay:-.108s}.lds-roller div[data-v-c8254b29]:nth-child(3):after{top:70.90963px;left:48.28221px}.lds-roller div[data-v-c8254b29]:nth-child(4){animation-delay:-.144s}.lds-roller div[data-v-c8254b29]:nth-child(4):after{top:72px;left:40px}.lds-roller div[data-v-c8254b29]:nth-child(5){animation-delay:-.18s}.lds-roller div[data-v-c8254b29]:nth-child(5):after{top:70.90963px;left:31.71779px}.lds-roller div[data-v-c8254b29]:nth-child(6){animation-delay:-.216s}.lds-roller div[data-v-c8254b29]:nth-child(6):after{top:67.71281px;left:24px}.lds-roller div[data-v-c8254b29]:nth-child(7){animation-delay:-.252s}.lds-roller div[data-v-c8254b29]:nth-child(7):after{top:62.62742px;left:17.37258px}.lds-roller div[data-v-c8254b29]:nth-child(8){animation-delay:-.288s}.lds-roller div[data-v-c8254b29]:nth-child(8):after{top:56px;left:12.28719px}@keyframes lds-roller-c8254b29{0%{transform:rotate(0)}to{transform:rotate(360deg)}}',Wo={class:"lds-roller"};function jo(n,e,t,r,a,s){return b(),S("div",Wo,[(b(),S(Y,null,ae(8,i=>A("div",{key:i})),64))])}const qo=H(zo,[["render",jo],["styles",[Ho]],["__scopeId","data-v-c8254b29"]]),Ko={},Xo='.lds-spinner[data-v-1790c8de]{color:var(--kern-color-action-default)}.lds-spinner[data-v-1790c8de],.lds-spinner div[data-v-1790c8de],.lds-spinner div[data-v-1790c8de]:after{box-sizing:border-box}.lds-spinner[data-v-1790c8de]{color:currentColor;display:inline-block;position:relative;width:80px;height:80px}.lds-spinner div[data-v-1790c8de]{transform-origin:40px 40px;animation:lds-spinner-1790c8de 1.2s linear infinite}.lds-spinner div[data-v-1790c8de]:after{content:" ";display:block;position:absolute;top:3.2px;left:36.8px;width:6.4px;height:17.6px;border-radius:20%;background:currentColor}.lds-spinner div[data-v-1790c8de]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner div[data-v-1790c8de]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div[data-v-1790c8de]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div[data-v-1790c8de]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div[data-v-1790c8de]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div[data-v-1790c8de]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div[data-v-1790c8de]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div[data-v-1790c8de]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div[data-v-1790c8de]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div[data-v-1790c8de]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div[data-v-1790c8de]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div[data-v-1790c8de]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner-1790c8de{0%{opacity:1}to{opacity:0}}',Jo={class:"lds-spinner"};function Yo(n,e,t,r,a,s){return b(),S("div",Jo,[(b(),S(Y,null,ae(12,i=>A("div",{key:i})),64))])}const Qo=H(Ko,[["render",Yo],["styles",[Xo]],["__scopeId","data-v-1790c8de"]]),Zo={key:0,class:"polar-plugin-loading-indicator-wrapper"},el={key:0,class:"polar-plugin-loading-indicator-overlay"},tl={key:0,class:"kern-loader kern-loader--visible",role:"status"},rl=q({__name:"LoadingIndicator.ce",setup(n){const{layout:e}=he(Q()),{loaderStyle:t,showLoader:r}=he(Yr()),a={BasicLoader:Fo,CircleLoader:Oo,RingLoader:Uo,RollerLoader:qo,SpinnerLoader:Qo};return(s,i)=>m(r)&&m(t)!==null?(b(),S("div",Zo,[m(e)==="standard"?(b(),S("div",el)):W("",!0),Le(xt,null,{default:ue(()=>[m(t)==="KernLoader"?(b(),S("div",tl)):(b(),M(pt(a[m(t)]),{key:1,class:"kern-loader--visible",role:"status"}))]),_:1})])):W("",!0)}}),nl=".polar-plugin-loading-indicator-wrapper{&[data-v-d34e6512]{z-index:100;position:absolute;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.polar-plugin-loading-indicator-overlay[data-v-d34e6512]{position:absolute;width:100%;height:100%;opacity:var(--kern-color-action-state-opacity-overlay);background:#fff}.kern-card[data-v-d34e6512]{min-width:fit-content;height:fit-content;border-radius:50%}[data-v-d34e6512] .kern-card__container{padding:var(--kern-metric-space-small)!important}}",al=H(rl,[["styles",[nl]],["__scopeId","data-v-d34e6512"]]),sl="loadingIndicator";function il(n){return{id:sl,component:al,storeModule:Yr,options:n}}class Xe extends Kn{constructor(e,t,r){super(),r!==void 0&&t===void 0?this.setFlatCoordinates(r,e):(t=t||0,this.setCenterAndRadius(e,t,r))}clone(){const e=new Xe(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,a){const s=this.flatCoordinates,i=e-s[0],o=t-s[1],l=i*i+o*o;if(l<a){if(l===0)for(let d=0;d<this.stride;++d)r[d]=s[d];else{const d=this.getRadius()/Math.sqrt(l);r[0]=s[0]+d*i,r[1]=s[1]+d*o;for(let c=2;c<this.stride;++c)r[c]=s[c]}return r.length=this.stride,l}return a}containsXY(e,t){const r=this.flatCoordinates,a=e-r[0],s=t-r[1];return a*a+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,r=t[this.stride]-t[0];return Xn(t[0]-r,t[1]-r,t[0]+r,t[1]+r,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Jn(e,t)){const r=this.getCenter();return e[0]<=r[0]&&e[2]>=r[0]||e[1]<=r[1]&&e[3]>=r[1]?!0:Yn(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,r=this.flatCoordinates[t]-this.flatCoordinates[0],a=e.slice();a[t]=a[0]+r;for(let s=1;s<t;++s)a[t+s]=e[s];this.setFlatCoordinates(this.layout,a),this.changed()}setCenterAndRadius(e,t,r){this.setLayout(r,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const a=this.flatCoordinates;let s=Qn(a,0,e,this.stride);a[s++]=a[0]+t;for(let i=1,o=this.stride;i<o;++i)a[s++]=a[i];a.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const r=this.getCenter(),a=this.getStride();this.setCenter(Zn(r,0,r.length,a,e,t,r)),this.changed()}}Xe.prototype.transform;function ye(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function Se(n,e){const t=n.length;let r=Math.floor(e);const a=e-r;r>=t?r-=t:r<0&&(r+=t);let s=r+1;s>=t&&(s-=t);const i=n[r],o=i[0],l=i[1],d=n[s],c=d[0]-o,u=d[1]-l;return[o+c*a,l+u*a]}const Qe={index:-1,endIndex:NaN,closestTargetDistance:1/0};function Qr(n,e,t,r){const a=n[0],s=n[1];let i=1/0,o=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const h=e.targets[u],p=h.coordinates;let k=1/0,f;for(let _=0;_<p.length-1;++_){const g=p[_],y=p[_+1],x=tn(a,s,g,y);x.squaredDistance<k&&(k=x.squaredDistance,f=_+x.along)}k<i&&(i=k,h.ring&&e.targetIndex===u&&(h.endIndex>h.startIndex?f<h.startIndex&&(f+=p.length):h.endIndex<h.startIndex&&f>h.startIndex&&(f-=p.length)),l=f,o=u)}const d=e.targets[o];let c=d.ring;if(e.targetIndex===o&&c){const u=Se(d.coordinates,l),h=t.getPixelFromCoordinate(u),p=t.getPixelFromCoordinate(e.startCoord);we(h,p)>r&&(c=!1)}if(c){const u=d.coordinates,h=u.length,p=d.startIndex,k=l;if(p<k){const f=tt(u,p,k);tt(u,p,k-h)<f&&(l-=h)}else{const f=tt(u,p,k);tt(u,p,k+h)<f&&(l+=h)}}return Qe.index=o,Qe.endIndex=l,Qe.closestTargetDistance=i,Qe}function Zr(n,e){const t=[];for(let r=0;r<e.length;++r){const a=e[r].getGeometry();en(n,a,t)}return t}function en(n,e,t){if(e instanceof Ve){Ze(n,e.getCoordinates(),!1,t);return}if(e instanceof qt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a)Ze(n,r[a],!1,t);return}if(e instanceof yt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a)Ze(n,r[a],!0,t);return}if(e instanceof Kt){const r=e.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length;o<l;++o)Ze(n,i[o],!0,t)}return}if(e instanceof ea){const r=e.getGeometries();for(let a=0;a<r.length;++a)en(n,r[a],t);return}}function Ze(n,e,t,r){const a=n[0],s=n[1];for(let i=0,o=e.length-1;i<o;++i){const l=e[i],d=e[i+1],c=tn(a,s,l,d);if(c.squaredDistance===0){const u=i+c.along;r.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function et(n,e){return Lr(n[0],n[1],e[0],e[1])}function tt(n,e,t){let r,a;e<t?(r=e,a=t):(r=t,a=e);const s=Math.ceil(r),i=Math.floor(a);if(s>i){const l=Se(n,r),d=Se(n,a);return et(l,d)}let o=0;if(r<s){const l=Se(n,r),d=ye(n,s);o+=et(l,d)}if(i<a){const l=ye(n,i),d=Se(n,a);o+=et(l,d)}for(let l=s;l<i-1;++l){const d=ye(n,l),c=ye(n,l+1);o+=et(d,c)}return o}const Ft={along:0,squaredDistance:0};function tn(n,e,t,r){const a=t[0],s=t[1],i=r[0],o=r[1],l=i-a,d=o-s;let c=0,u=a,h=s;return(l!==0||d!==0)&&(c=na(((n-a)*l+(e-s)*d)/(l*l+d*d),0,1),u+=l*c,h+=d*c),Ft.along=c,Ft.squaredDistance=ta(Lr(n,e,u,h),10),Ft}const rt={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class nt extends qe{constructor(e,t){super(e),this.feature=t}}class ol extends jt{constructor(e){const t=e;t.stopDown||(t.stopDown=Dn),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=dl(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:He,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let r=e.geometryFunction;if(!r){const a=this.mode_;if(a==="Circle")r=(s,i,o)=>{const l=i||new Xe([NaN,NaN]),d=j(s[0]),c=ut(d,j(s[s.length-1]));return l.setCenterAndRadius(d,Math.sqrt(c),this.geometryLayout_),l};else{let s;a==="Point"?s=ce:a==="LineString"?s=Ve:a==="Polygon"&&(s=yt),r=(i,o,l)=>(o?a==="Polygon"?i[0].length?o.setCoordinates([i[0].concat([i[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(i,this.geometryLayout_):o=new s(i,this.geometryLayout_),o)}}this.geometryFunction_=r,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Fe({source:new je({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:ll(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:On,this.freehandCondition_,e.freehand?this.freehandCondition_=Te:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Nt,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Er.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Te:t=e:t=ct,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=Te:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:Nt}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===Bt.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===ee.POINTERMOVE,r=!0;return!this.freehand_&&this.lastDragTime_&&e.type===ee.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===ee.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),r=!1):this.freehand_&&e.type===ee.POINTERDOWN?r=!1:t&&this.getPointerCount()<2?(r=e.type===ee.POINTERMOVE,r&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===ee.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===ee.DBLCLICK&&(r=!1),super.handleEvent(e)&&r}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Gn(ee.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),r=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),a=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=X([r,a]),i=this.traceSource_.getFeaturesInExtent(s);if(i.length===0)return;const o=Zr(e.coordinate,i);o.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const r=e.startIndex<=e.endIndex,a=e.startIndex<=t;r===a?r&&t>e.endIndex||!r&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(r&&t<e.endIndex||!r&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let r=0;if(e<t){const a=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),r=s-a+1}else{const a=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),r=a-s+1}r>0&&this.removeLastPoints_(r)}addTracedCoordinates_(e,t,r){if(t===r)return;const a=[];if(t<r){const s=Math.ceil(t);let i=Math.floor(r);i===r&&(i-=1);for(let o=s;o<=i;++o)a.push(ye(e.coordinates,o))}else{const s=Math.floor(t);let i=Math.ceil(r);i===r&&(i+=1);for(let o=s;o>=i;--o)a.push(ye(e.coordinates,o))}a.length&&this.appendCoordinates(a)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const o=e.map.getPixelFromCoordinate(t.startCoord);if(we(o,e.pixel)<this.snapTolerance_)return}const r=Qr(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==r.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const o=t.targets[r.index];this.addTracedCoordinates_(o,o.startIndex,r.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,r.endIndex)}t.targetIndex=r.index;const a=t.targets[t.targetIndex];a.endIndex=r.endIndex;const s=Se(a.coordinates,a.endIndex),i=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(i[0]),Math.round(i[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const r=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const a=!this.finishCoordinate_;a&&this.startDrawing_(e.coordinate),!a&&this.freehand_?this.finishDrawing():!this.freehand_&&(!a||this.mode_==="Point")&&(this.atFinish_(e.pixel,r)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,r=e.pixel,a=t[0]-r[0],s=t[1]-r[1],i=a*a+s*s;if(this.shouldHandle_=this.freehand_?i>this.squaredClickTolerance_:i<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let r=!1;if(this.sketchFeature_){let a=!1,s=[this.finishCoordinate_];const i=this.mode_;if(i==="Point")r=!0;else if(i==="Circle")r=this.sketchCoords_.length===2;else if(i==="LineString")a=!t&&this.sketchCoords_.length>this.minPoints_;else if(i==="Polygon"){const o=this.sketchCoords_;a=o[0].length>this.minPoints_,s=[o[0][0],o[0][o[0].length-2]],t?s=[o[0][0]]:s=[o[0][0],o[0][o[0].length-2]]}if(a){const o=this.getMap();for(let l=0,d=s.length;l<d;l++){const c=s[l],u=o.getPixelFromCoordinate(c),h=e[0]-u[0],p=e[1]-u[1],k=this.freehand_?1:this.snapTolerance_;if(r=Math.sqrt(h*h+p*p)<=k,r){this.finishCoordinate_=c;break}}}}return r}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new re(new ce(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new re);const t=e.getLinearRing(0);let r=this.sketchLine_.getGeometry();r?(r.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),r.changed()):(r=new Ve(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(r))}startDrawing_(e){const t=this.getMap().getView().getProjection(),r=sr(this.geometryLayout_);for(;e.length<r;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new re(new Ve(this.sketchLineCoords_)));const a=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new re,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(a),this.updateSketchFeatures_(),this.dispatchEvent(new nt(rt.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),r=this.sketchFeature_.getGeometry(),a=t.getView().getProjection(),s=sr(this.geometryLayout_);let i,o;for(;e.length<s;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(i=this.sketchCoords_[0],o=i[i.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(i=this.sketchCoords_,o=i[i.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,r,a),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),r.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(r):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();let a,s;const i=this.mode_;return i==="LineString"||i==="Circle"?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():a=!0),s.push(e.slice()),this.geometryFunction_(s,t,r)):i==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():a=!0),s.push(e.slice()),a&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,r)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),a?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),a=this.mode_;for(let s=0;s<e;++s){let i;if(a==="LineString"||a==="Circle"){if(i=this.sketchCoords_,i.splice(-2,1),i.length>=2){this.finishCoordinate_=i[i.length-2].slice();const o=this.finishCoordinate_.slice();i[i.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(i,t,r),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(a==="Polygon"){i=this.sketchCoords_[0],i.splice(-2,1);const o=this.sketchLine_.getGeometry();if(i.length>=2){const l=i[i.length-2].slice();i[i.length-1]=l,this.createOrUpdateSketchPoint_(l)}o.setCoordinates(i),this.geometryFunction_(this.sketchCoords_,t,r)}if(i.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const r=e.getGeometry(),a=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,r,a)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,r,a),t=r.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new Tr([t])):this.type_==="MultiLineString"?e.setGeometry(new qt([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Kt([t])),this.dispatchEvent(new nt(rt.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new nt(rt.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,r=!this.sketchFeature_;r&&this.startDrawing_(e[0]);let a;if(t==="LineString"||t==="Circle")a=this.sketchCoords_;else if(t==="Polygon")a=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;r&&a.shift(),a.pop();for(let i=0;i<e.length;i++)this.addToDrawing_(e[i]);const s=e[e.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new re(new ce(r)),this.updateSketchFeatures_(),this.dispatchEvent(new nt(rt.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function ll(){const n=Xt();return function(e,t){return n[e.getGeometry().getType()]}}function dl(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}const mr=0,ze=1,yr=[0,0,0,0],$e=[],Pt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function Rt(n,e,t){let r;switch(e){case"LineString":r=n;break;case"MultiLineString":case"Polygon":r=n[t[0]];break;case"MultiPolygon":r=n[t[1]][t[0]];break}return r}class Mt extends qe{constructor(e,t,r){super(e),this.features=t,this.mapBrowserEvent=r}}class cl extends jt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Nn,this.defaultDeleteCondition_=function(r){return Bn(r)&&Sr(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Te,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Vn,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Fe({source:new je({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:hl(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Ee(this.source_.getFeatures()),this.source_.addEventListener(ir.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(ir.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(xe.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(xe.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=Te:t=e:t=ct,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const a=this.SEGMENT_WRITERS_[t.getType()];a&&a(e,t)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(Bt.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ee;const r=this.featuresBeingModified_.getArray();for(let a=0,s=t.length;a<s;++a){const i=t[a].feature;i&&!r.includes(i)&&this.featuresBeingModified_.push(i)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Mt(Pt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Bt.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,r=[];t.forEach(function(a){e===a.feature&&r.push(a)});for(let a=r.length-1;a>=0;--a){const s=r[a];for(let i=this.dragSegments_.length-1;i>=0;--i)this.dragSegments_[i][0]===s&&this.dragSegments_.splice(i,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const r=t.getCoordinates(),a={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),a)}writeMultiPointGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a],o={feature:e,geometry:t,depth:[a],index:a,segment:[i,i]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length-1;a<s;++a){const i=r.slice(a,a+2),o={feature:e,geometry:t,index:a,segment:i};this.rBush_.insert(X(i),o)}}writeMultiLineStringGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length-1;o<l;++o){const d=i.slice(o,o+2),c={feature:e,geometry:t,depth:[a],index:o,segment:d};this.rBush_.insert(X(d),c)}}}writePolygonGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length-1;o<l;++o){const d=i.slice(o,o+2),c={feature:e,geometry:t,depth:[a],index:o,segment:d};this.rBush_.insert(X(d),c)}}}writeMultiPolygonGeometry_(e,t){const r=t.getCoordinates();for(let a=0,s=r.length;a<s;++a){const i=r[a];for(let o=0,l=i.length;o<l;++o){const d=i[o];for(let c=0,u=d.length-1;c<u;++c){const h=d.slice(c,c+2),p={feature:e,geometry:t,depth:[o,a],index:c,segment:h};this.rBush_.insert(X(h),p)}}}}writeCircleGeometry_(e,t){const r=t.getCenter(),a={feature:e,geometry:t,index:mr,segment:[r,r]},s={feature:e,geometry:t,index:ze,segment:[r,r]},i=[a,s];a.featureSegments=i,s.featureSegments=i,this.rBush_.insert(Lt(r),a);let o=t;this.rBush_.insert(o.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const r=t.getGeometriesArray();for(let a=0;a<r.length;++a){const s=r[a],i=this.SEGMENT_WRITERS_[s.getType()];i(e,s)}}createOrUpdateVertexFeature_(e,t,r,a){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new re(new ce(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",r),s.set("existing",a),s}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==ee.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=ee.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==ee.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const t=[],r=this.vertexFeature_.getGeometry().getCoordinates(),a=X([r]),s=this.rBush_.getInExtent(a),i={};s.sort(ul);for(let o=0,l=s.length;o<l;++o){const d=s[o],c=d.segment;let u=te(d.geometry);const h=d.depth;if(h&&(u+="-"+h.join("-")),i[u]||(i[u]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===ze){const p=vr(e,d);oe(p,r)&&!i[u][0]&&(this.dragSegments_.push([d,0]),i[u][0]=d);continue}if(oe(c[0],r)&&!i[u][0]){this.dragSegments_.push([d,0]),i[u][0]=d;continue}if(oe(c[1],r)&&!i[u][1]){if(i[u][0]&&i[u][0].index===0){let p=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":p=p[h[1]];case"Polygon":if(d.index!==p[h[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),i[u][1]=d;continue}te(c)in this.vertexSegments_&&!i[u][0]&&!i[u][1]&&t.push(d)}return t}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const s=e.map.getPixelFromCoordinate(t.startCoord);if(we(s,e.pixel)<this.pixelTolerance_)return}const r=Qr(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(r.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==r.index){if(t.targetIndex!==-1){const i=t.targets[t.targetIndex];this.removeTracedCoordinates_(i.startIndex,i.endIndex)}else for(const i of this.traceSegments_){const o=i[0],l=o.geometry,d=i[1],c=l.getCoordinates();Rt(c,l.getType(),o.depth).splice(o.index+d,1),l.setCoordinates(c),d===0&&(o.index-=1)}const s=t.targets[r.index];this.addTracedCoordinates_(s,s.startIndex,r.endIndex)}else{const s=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(s,r.endIndex)}t.targetIndex=r.index;const a=t.targets[t.targetIndex];a.endIndex=r.endIndex}getTraceCandidates_(e){const t=this.getMap(),r=this.pixelTolerance_,a=t.getCoordinateFromPixel([e.pixel[0]-r,e.pixel[1]+r]),s=t.getCoordinateFromPixel([e.pixel[0]+r,e.pixel[1]-r]),i=X([a,s]);return this.traceSource_.getFeaturesInExtent(i)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const r=Zr(e.coordinate,t);r.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:r,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const r=e.startIndex<=e.endIndex,a=e.startIndex<=t;r===a?r&&t>e.endIndex||!r&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(r&&t<e.endIndex||!r&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let r=0;if(e<t){const a=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),r=s-a+1}else{const a=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),r=a-s+1}if(r>0)for(const a of this.traceSegments_){const s=a[0],i=s.geometry,o=a[1];let l=a[0].index+1;o===1&&(l-=r);const d=i.getCoordinates();Rt(d,i.getType(),s.depth).splice(l,r),i.setCoordinates(d),o===1&&(s.index-=r)}}addTracedCoordinates_(e,t,r){if(t===r)return;const a=[];if(t<r){const s=Math.ceil(t);let i=Math.floor(r);i===r&&(i-=1);for(let o=s;o<=i;++o)a.push(ye(e.coordinates,o))}else{const s=Math.floor(t);let i=Math.ceil(r);i===r&&(i+=1);for(let o=s;o>=i;--o)a.push(ye(e.coordinates,o))}if(a.length)for(const s of this.traceSegments_){const i=s[0],o=i.geometry,l=s[1],d=i.index+1;l===0&&a.reverse();const c=o.getCoordinates();Rt(c,o.getType(),i.depth).splice(d,0,...a),o.setCoordinates(c),l===1&&(i.index+=a.length)}}updateGeometry_(e,t){const r=t[0],a=r.depth;let s;const i=r.segment,o=r.geometry,l=t[1];for(;e.length<o.getStride();)e.push(i[l][e.length]);switch(o.getType()){case"Point":s=e,i[0]=e,i[1]=e;break;case"MultiPoint":s=o.getCoordinates(),s[r.index]=e,i[0]=e,i[1]=e;break;case"LineString":s=o.getCoordinates(),s[r.index+l]=e,i[l]=e;break;case"MultiLineString":s=o.getCoordinates(),s[a[0]][r.index+l]=e,i[l]=e;break;case"Polygon":s=o.getCoordinates(),s[a[0]][r.index+l]=e,i[l]=e;break;case"MultiPolygon":s=o.getCoordinates(),s[a[1]][a[0]][r.index+l]=e,i[l]=e;break;case"Circle":const d=o;if(i[0]=e,i[1]=e,r.index===mr)this.changingFeature_=!0,d.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let c=we(j(d.getCenter()),j(e));d.setRadius(c),this.changingFeature_=!1}break}s&&this.setGeometryCoordinates_(o,s)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([i])=>i));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],a=[],s=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(s){this.traceSegments_=[];for(const i of this.dragSegments_){const o=i[0];we($r(s,o.segment),s)/e.map.getView().getResolution()<1&&this.traceSegments_.push(i)}}for(let i=0,o=this.dragSegments_.length;i<o;++i){const l=this.dragSegments_[i],d=l[0],c=d.feature;r.includes(c)||r.push(c);const u=d.geometry;a.includes(u)||a.push(u),this.updateGeometry_(t,l)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,r,a,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(t);if(r?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const a=this.vertexFeature_.getGeometry().getCoordinates();for(let s=r.length-1;s>=0;--s)this.insertVertex_(r[s],a);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const r=this.dragSegments_[t][0],a=r.geometry;if(a.getType()==="Circle"){const s=a,i=s.getCenter(),o=r.featureSegments[0],l=r.featureSegments[1];o.segment[0]=i,o.segment[1]=i,l.segment[0]=i,l.segment[1]=i,this.rBush_.update(Lt(i),o);let d=s;this.rBush_.update(d.getExtent(),l)}else this.rBush_.update(X(r.segment),r)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new Mt(Pt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),r=t.getPixelFromCoordinate(e);t.getView().getProjection();const a=function(o,l){return _r(e,o)-_r(e,l)};let s,i;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(r,(l,d,c)=>{c&&c.getType()==="Point"&&(c=new ce(ht(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof re&&this.features_.getArray().includes(l)){i=u;const h=l.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:l,geometry:i,segment:[h,h]}]}return!0},{layerFilter:o})}if(!s){const o=Un(Lt(e,yr)),l=t.getView().getResolution()*this.pixelTolerance_,d=zn(Hn(o,l,yr));s=this.rBush_.getInExtent(d)}if(s&&s.length>0){const o=s.sort(a)[0],l=o.segment;let d=vr(e,o);const c=t.getPixelFromCoordinate(d);let u=we(r,c);if(i||u<=this.pixelTolerance_){const h={};if(h[te(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===ze)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[o.feature],[o.geometry],this.snappedToVertex_);else{const p=t.getPixelFromCoordinate(l[0]),k=t.getPixelFromCoordinate(l[1]),f=ut(c,p),_=ut(c,k);if(u=Math.sqrt(Math.min(f,_)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=f>_?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[o.feature],[o.geometry],this.snappedToVertex_);const g={};g[te(o.geometry)]=!0;for(let y=1,x=s.length;y<x;++y){const L=s[y].segment;if(oe(l[0],L[0])&&oe(l[1],L[1])||oe(l[0],L[1])&&oe(l[1],L[0])){const w=te(s[y].geometry);w in g||(g[w]=!0,h[te(L)]=!0)}else break}}this.vertexSegments_=h;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const r=e.segment,a=e.feature,s=e.geometry,i=e.depth,o=e.index;let l;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":l=s.getCoordinates(),l[i[0]].splice(o+1,0,t);break;case"Polygon":l=s.getCoordinates(),l[i[0]].splice(o+1,0,t);break;case"MultiPolygon":l=s.getCoordinates(),l[i[1]][i[0]].splice(o+1,0,t);break;case"LineString":l=s.getCoordinates(),l.splice(o+1,0,t);break;default:return!1}this.setGeometryCoordinates_(s,l);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(s,o,i,1);const c={segment:[r[0],t],feature:a,geometry:s,depth:i,index:o};d.insert(X(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,r[1]],feature:a,geometry:s,depth:i,index:o+1};return d.insert(X(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?ht(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:t})=>oe(t[0],e)||oe(t[1],e))}removePoint(e){if(e&&(e=j(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=ee.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([a])=>a));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Mt(Pt.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,t={};let r=!1,a,s,i,o,l,d,c,u,h,p,k;for(l=e.length-1;l>=0;--l)i=e[l],p=i[0],k=te(p.feature),p.depth&&(k+="-"+p.depth.join("-")),k in t||(t[k]={}),i[1]===0?(t[k].right=p,t[k].index=p.index):i[1]==1&&(t[k].left=p,t[k].index=p.index+1);for(k in t){switch(h=t[k].right,c=t[k].left,d=t[k].index,u=d-1,c!==void 0?p=c:p=h,u<0&&(u=0),o=p.geometry,s=o.getCoordinates(),a=s,r=!1,o.getType()){case"MultiLineString":s[p.depth[0]].length>2&&(s[p.depth[0]].splice(d,1),r=!0);break;case"LineString":s.length>2&&(s.splice(d,1),r=!0);break;case"MultiPolygon":a=a[p.depth[1]];case"Polygon":a=a[p.depth[0]],a.length>4&&(d==a.length-1&&(d=0),a.splice(d,1),r=!0,d===0&&(a.pop(),a.push(a[0]),u=a.length-1));break}if(r){this.setGeometryCoordinates_(o,s);const f=[];if(c!==void 0&&(this.rBush_.remove(c),f.push(c.segment[0])),h!==void 0&&(this.rBush_.remove(h),f.push(h.segment[1])),c!==void 0&&h!==void 0){const _={depth:p.depth,feature:p.feature,geometry:p.geometry,index:u,segment:f};this.rBush_.insert(X(_.segment),_)}this.updateSegmentIndices_(o,d,p.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:t})=>!(oe(t[0],e)||oe(t[1],e)))}insertPoint(e){const t=e?j(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((r,a)=>r||this.insertVertex_(a,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,r,a){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(r===void 0||s.depth===void 0||Wn(s.depth,r))&&s.index>t&&(s.index+=a)})}}function ul(n,e){return n.index-e.index}function _r(n,e,t){const r=e.geometry;if(r.getType()==="Circle"){let s=r;if(e.index===ze){const i=ut(s.getCenter(),j(n)),o=Math.sqrt(i)-s.getRadius();return o*o}}const a=j(n);return $e[0]=j(e.segment[0]),$e[1]=j(e.segment[1]),ra(a,$e)}function vr(n,e,t){const r=e.geometry;if(r.getType()==="Circle"&&e.index===ze)return ht(r.getClosestPoint(j(n)));const a=j(n);return $e[0]=j(e.segment[0]),$e[1]=j(e.segment[1]),ht($r(a,$e))}function hl(){const n=Xt();return function(e,t){return n.Point}}const at={SELECT:"select"};class st extends qe{constructor(e,t,r,a){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=a}}const it={};class er extends Rn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Sr,this.addCondition_=e.addCondition?e.addCondition:ct,this.removeCondition_=e.removeCondition?e.removeCondition:ct,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Nt,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:He,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:gl(),this.features_=e.features||new Ee;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const r=e.layers;t=function(a){return r.includes(a)}}else t=He;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[te(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[te(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(xe.ADD,this.boundAddFeature_),this.features_.addEventListener(xe.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(xe.ADD,this.boundAddFeature_),this.features_.removeEventListener(xe.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const r=this.findLayerOfFeature_(t);r&&this.addFeatureLayerAssociation_(t,r)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(t){if(t instanceof Fe&&t.getSource()&&t.getSource().hasFeature(e))return t})}getStyle(){return this.style_}applySelectedStyle_(e){const t=te(e);t in it||(it[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let a=t.length-1;a>=0;--a){const s=t[a];if(s!==this&&s instanceof er&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(s.getStyle());return}}const r=te(e);e.setStyle(it[r]),delete it[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[te(e)]}selectFeatureInternal_(e,t,r){if(!(e instanceof re)||!this.filter_(e,t))return;const a=this.getFeatures();return a.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),a.push(e),r?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const r=this.selectFeatureInternal_(e,t);return r&&this.dispatchEvent(new st(at.SELECT,[r],[],void 0)),!!r}removeFeatureInternal_(e,t){const r=this.getFeatures();if(!(!(e instanceof re)||!r.getArray().includes(e)))return r.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new st(at.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Mn(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new st(at.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),a=this.toggleCondition_(e),s=!t&&!r&&!a,i=e.map,o=this.getFeatures(),l=[],d=[];if(s){let c=!1;i.forEachFeatureAtPixel(e.pixel,(u,h)=>{if(c=!0,!!this.selectFeatureInternal_(u,h,d))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=o.getLength()-1;u>=0;--u){const h=o.item(u);(d.length>0&&!d.includes(h)||!c)&&this.removeFeatureInternal_(h,l)}}else i.forEachFeatureAtPixel(e.pixel,(c,u)=>{let h;if((r||a)&&(h=this.removeFeatureInternal_(c,l)),(t||a)&&!h&&(h=this.selectFeatureInternal_(c,u,d)),!!h)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(d.length>0||l.length>0)&&this.dispatchEvent(new st(at.SELECT,d,l,e)),!0}}function gl(){const n=Xt();return or(n.Polygon,n.LineString),or(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const Dt={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class Ot extends qe{constructor(e,t,r,a,s){super(e),this.features=t,this.coordinate=r,this.startCoordinate=a,this.mapBrowserEvent=s}}class pl extends jt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const r=e.layers;t=function(a){return r.includes(a)}}else t=He;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:He,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Te,this.lastFeature_=null,this.addChangeListener(Er.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new Ee([this.lastFeature_]);return this.dispatchEvent(new Ot(Dt.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new Ee([this.lastFeature_]);return this.dispatchEvent(new Ot(Dt.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const r=j(t),a=j(this.lastCoordinate_),s=r[0]-a[0],i=r[1]-a[1],o=this.features_||new Ee([this.lastFeature_]);o.forEach(function(l){const d=l.getGeometry();d.translate(s,i),l.setGeometry(d)}),this.lastCoordinate_=t,this.dispatchEvent(new Ot(Dt.TRANSLATING,o,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(r,a)=>{if(!(!(r instanceof re)||!this.filter_(r,a))&&!(this.features_&&!this.features_.getArray().includes(r)))return r},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const r=this.getActive();(!t||!r)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const fl=(n,e,t)=>{if(t){const r=new DOMParser().parseFromString(t,"image/svg+xml");return r.querySelectorAll("[fill]").forEach(a=>{a.setAttribute("fill",n)}),r.querySelectorAll("[stroke]").forEach(a=>{a.setAttribute("stroke",e)}),r.querySelectorAll("path, circle, rect, polygon, ellipse").forEach(a=>{a.hasAttribute("fill")||a.setAttribute("fill",n),a.hasAttribute("stroke")||a.setAttribute("stroke",e)}),new XMLSerializer().serializeToString(r)}return`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="-1 -1 25 25"
  >
    <path
      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"
      fill="${n}"
      stroke="${e}"
      stroke-width="1"
    />
  </svg>
`},ml=({fill:n="#005CA9",stroke:e="#FFF",svg:t})=>{let r="";typeof n=="string"?r=n:"oklch"in n?r=`oklch(${n.oklch.l} ${n.oklch.c} ${n.oklch.h})`:"rgba"in n&&(r=`${n.rgba.r} ${n.rgba.g} ${n.rgba.b} ${n.rgba.a?n.rgba.a:""}`);let a="";return typeof e=="string"?a=e:"oklch"in e?a=`oklch(${e.oklch.l} ${e.oklch.c} ${e.oklch.h})`:"rgba"in e&&(a=`${e.rgba.r} ${e.rgba.g} ${e.rgba.b} ${e.rgba.a?e.rgba.a:""}`),new dt({image:new Pn({src:`data:image/svg+xml;base64,${btoa(fl(r,a,t))}`,scale:2,anchor:[.5,1]})})},yl={Circle:Xe,LinearRing:jn,LineString:Ve,MultiLineString:qt,MultiPoint:Tr,MultiPolygon:Kt,Point:ce,Polygon:yt};function _l(n,e,t,r){const a=new yl[t](r);let s=qn(a.getExtent());return(t==="Polygon"||t==="MultiPolygon")&&!a.intersectsCoordinate(s)&&(s=(a.getType()==="Polygon"?a.getInteriorPoint():a.getInteriorPoints()).getFirstCoordinate()),n===e?s:We(s,n,e)}async function br(n,e,t){if(!t)return!0;const r=await Br(e,t.layerId,n);return r===!0||typeof r=="symbol"&&t.onError!=="strict"?!0:(typeof r=="symbol"?(Be("error",()=>le(a=>a.boundaryError,{ns:"pins"})),console.error(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:39:3)
`,"Checking boundary layer failed.")):(Be("info",()=>le(a=>a.notInBoundary,{ns:"pins"})),console.info(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:43:3)
`,"Pin position outside of boundary layer:",n)),!1)}const vl=be("plugins/pins",()=>{const n=Q(),e=P(null),t=P(!1),r=T(()=>B({minZoomLevel:0,movable:"none",toZoomLevel:0},n.configuration.pins||{})),a=T(()=>{if(!e.value)return null;const g=Fn(e.value,n.configuration.epsg);return[g[1],g[0]]}),s=new Fe({source:new je,style:ml(r.value.style||{})}),i=new er({layers:g=>g===s,style:null,condition:An}),o=new pl({condition:()=>n.map.getView().getZoom()>=r.value.minZoomLevel,layers:[s]});let l=null;function d(){n.map.addLayer(s),s.setZIndex(100),n.map.on("singleclick",async({coordinate:g})=>{await k(g)}),u(),h(),p()}function c(){const{map:g}=n;g.un("singleclick",async({coordinate:y})=>{await k(y)}),_(),g.removeLayer(s),g.removeInteraction(i),g.removeInteraction(o),l&&l()}function u(){const{coordinateSources:g}=r.value;g&&g.forEach(y=>{const x=y.plugin?n.getPluginStore(y.plugin):n;x&&(l=Ae(()=>x[y.key],L=>{L&&L.type!=="reverse_geocoded"&&f(L.geometry.coordinates,!1,{type:L.geometry.type})}))})}function h(){const{initial:g}=r.value;if(g){const{coordinate:y,centerOn:x,epsg:L}=g;if(x){f(y,!1,{epsg:L||n.configuration.epsg,type:"Point"});return}f(y)}}function p(){i.on("select",({selected:y})=>{r.value.movable==="none"&&(document.body.style.cursor=y.length?"not-allowed":"")}),n.map.addInteraction(i);const{movable:g}=r.value;g==="drag"&&(o.on("translatestart",()=>t.value=!0),o.on("translateend",({features:y})=>{t.value=!1,y.forEach(async x=>{const L=x.getGeometry().getCoordinates(),w=await br(L,n.map,r.value.boundary)?L:e.value;w&&f(w)})}),n.map.addInteraction(o))}async function k(g){const y=n.map.getInteractions().getArray().some(w=>w instanceof ol&&(w._isMultiSelect||w._isDrawPlugin)||w instanceof cl||w._isDeleteSelect),{minZoomLevel:x,movable:L}=r.value;(L==="drag"||L==="click")&&n.map.getView().getZoom()>=x&&!y&&await br(g,n.map,r.value.boundary)&&f(g)}function f(g,y=!0,x){_(),e.value=g,!y&&x&&(e.value=_l(x.epsg||n.configuration.epsg,n.configuration.epsg,x.type,g),n.map.getView().setCenter(e.value),n.map.getView().setZoom(r.value.toZoomLevel)),s.getSource().addFeature(new re({geometry:new ce(e.value),type:"point",name:"mapMarker",zIndex:100}))}function _(){s.getSource().clear()}return{coordinate:e,latLon:a,setupPlugin:d,teardownPlugin:c}}),bl={boundaryError:"Die Überprüfung der Koordinate ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Diese Koordinate kann nicht gewählt werden."},kl={boundaryError:"Validating the coordinate failed. Please try again later or contact an administrator if the issue persists.",notInBoundary:"It is not possible to select this coordinate."},xl=[{type:"de",resources:bl},{type:"en",resources:kl}],wl="pins";function Cl(n){return{id:wl,locales:xl,storeModule:vl,options:n}}const tr="reverseGeocoder",rn=be("plugins/reverseGeocoder",()=>{const n=Q(),e=T(()=>n.configuration[tr]),t=P([]);function r(){for(const o of e.value.coordinateSources||[]){const l=o.plugin?n.getPluginStore(o.plugin):n;l&&t.value.push(Ae(()=>l[o.key],async d=>{d&&await i(d)},{immediate:!0}))}}function a(){t.value.forEach(o=>{o()})}function s(o,l){const d=o.plugin?n.getPluginStore(o.plugin):n;d&&d[o.key](l)}async function i(o){const l=ya();try{const d=await _a(e.value.url,o);return e.value.addressTarget&&s(e.value.addressTarget,d),e.value.zoomTo&&n.map.getView().fit(new ce(o),{maxZoom:e.value.zoomTo,duration:400,easing:aa}),d}catch(d){return console.error(`@polar/polar(plugins/reverseGeocoder/store:102:5)
`,"Reverse geocoding failed:",d),null}finally{l()}}return{reverseGeocode:i,setupPlugin:r,teardownPlugin:a}});if(import.meta.vitest){const{expect:n,test:e,vi:t}=import.meta.vitest,{createPinia:r,setActivePinia:a}=await Me(async()=>{const{createPinia:c,setActivePinia:u}=await import("./pinia-BhmAVTvm-Dvvq2Cue.js");return{createPinia:c,setActivePinia:u}},__vite__mapDeps([0,1]),import.meta.url),{reactive:s}=await Me(async()=>{const{reactive:c}=await import("./vue.runtime.esm-bundler-APnTtYuL-TgjA0Nnx.js");return{reactive:c}},[],import.meta.url),i=await Me(()=>import("./store-DasbBd0O.js").then(c=>c.s),__vite__mapDeps([2,0,1,3]),import.meta.url),o=await Me(()=>import("./reverseGeocode-CR3Bbmu1-CShN2cyn.js"),__vite__mapDeps([4,2,0,1,3]),import.meta.url),l=await Me(()=>import("./indicateLoading-CX8lh8tr-65EH0W1L.js"),__vite__mapDeps([5,3,0,1]),import.meta.url),d=e.extend({reverseGeocodeUtil:[async({},c)=>{const u=t.spyOn(o,"reverseGeocode").mockResolvedValue(null);await c(u)},{auto:!0}],indicateLoading:[async({},c)=>{const u=t.spyOn(l,"indicateLoading").mockImplementation(()=>()=>{});await c(u)},{auto:!0}],coreStore:[async({},c)=>{const u=t.fn(),h=s({configuration:{[tr]:{url:"https://wps.example",coordinateSources:[{key:"coordinateSource"}],addressTarget:{key:"addressTarget"},zoomTo:99}},map:{getView:()=>({fit:u})},coordinateSource:null,addressTarget:t.fn()});t.spyOn(i,"useCoreStore").mockReturnValue(h),await c(h)},{auto:!0}],store:[async({},c)=>{a(r());const u=rn();u.setupPlugin(),await c(u),u.teardownPlugin()},{auto:!0}]});d("detects changes in coordinate sources",async({reverseGeocodeUtil:c,coreStore:u})=>{u.coordinateSource=[1,2],await new Promise(h=>setTimeout(h)),n(c).toHaveBeenCalledWith("https://wps.example",[1,2])}),d("passes geocoding result to address target",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const p=Symbol("feature");c.mockResolvedValueOnce(p),await h.reverseGeocode([3,4]),n(u.addressTarget).toHaveBeenCalledOnce(),n(u.addressTarget).toHaveBeenCalledWith(p)}),d("zooms to input coordinate",async({reverseGeocodeUtil:c,coreStore:u,store:h})=>{const p=Symbol("feature");c.mockResolvedValueOnce(p),await h.reverseGeocode([3,4]),n(u.map.getView().fit).toHaveBeenCalledOnce()})}function Sl(n){return{id:tr,storeModule:rn,options:n}}const El={style:{background:"#fff"}},Tl=vt({__name:"EmptyComponent",setup(n){return(e,t)=>(kt(),bt("div",El,"HELLO THERE"))}}),$l={class:"kern-btn kern-btn--tertiary",style:{"border-radius":"0.25rem","min-height":"2rem",width:"2rem"}},Ll=vt({__name:"MockAttributions.ce",setup(n){return(e,t)=>(kt(),bt("button",$l,[...t[0]||(t[0]=[ot("span",{class:"kern-icon kern-icon-fill--copyright",style:{color:"var(--kern-color-action-default)"}},null,-1)])]))}}),Il={style:{display:"flex",gap:"0.5rem"}},Al=vt({__name:"MockPointerPosition.ce",setup(n){return(e,t)=>(kt(),bt("div",Il,[...t[0]||(t[0]=[ot("span",{class:"kern-icon kern-icon--fullscreen","aria-hidden":"true"},null,-1),ot("span",{style:{display:"flex","align-items":"center"}},"9.9555 | 53.5479",-1),ot("button",{class:"kern-btn kern-btn--tertiary",style:{"min-height":"1rem","font-size":"1.125rem","text-decoration-line":"underline","text-underline-offset":"2px","text-underline-position":"from-font",color:"#1a3da5"}}," EPSG:4326 ",-1)])]))}}),nn=[{id:"23420",name:"basemap.de Web Raster Farbe",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_farbe",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"23421",name:"basemap.de Web Raster Grau",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_grau",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"1454",name:"Ausgleichsflächen",url:"https://geodienste.hamburg.de/HH_WFS_Ausgleichsflaechen",typ:"WFS",featureType:"ausgleichsflaechen",outputFormat:"XML",version:"1.1.0",featureNS:"https://registry.gdi-de.org/id/de.hh.up",featurePrefix:"de.hh.up",legendURL:""},{id:"6059",name:"MML Anliegen",url:"https://geodienste.hamburg.de/lgv-config/anliegen_extern.json",typ:"GeoJSON",format:"XML",version:"1.0",minScale:"0",maxScale:"2500000",legendURL:"",urlIsVisible:!0},{id:"denkmaelerWMS",name:"Denkmal WMS",url:"https://efi2-deegree.schleswig-holstein.de/dish-deegree/services/wms_shp",typ:"WMS",layers:"0,1,2,3,4,6,24,25",legendURL:"ignore",format:"image/png",version:"1.3.0",transparent:!0}],Fl="data:application/json;base64,WwoJewoJCSJzdHlsZUlkIjogInBhbmRhIiwKCQkicnVsZXMiOiBbCgkJCXsKCQkJCSJzdHlsZSI6IHsKCQkJCQkicG9seWdvblN0cm9rZUNvbG9yIjogWzMsIDI1NSwgMSwgMV0sCgkJCQkJInBvbHlnb25GaWxsSGF0Y2giOiB7CgkJCQkJCSJiYWNrZ3JvdW5kQ29sb3IiOiBbMCwgMCwgMCwgMC4yNV0sCgkJCQkJCSJwYXR0ZXJuIjogImRpYWdvbmFsLXJpZ2h0IiwKCQkJCQkJInBhdHRlcm5Db2xvciI6IFszLCAyNTUsIDEsIDFdCgkJCQkJfQoJCQkJfQoJCQl9CgkJXQoJfQpdCg==",Pl={style:{background:"#fff"}},Rl=vt({__name:"YetAnotherEmptyComponent",setup(n){return(e,t)=>(kt(),bt("div",Pl,"Awesome"))}}),an="23420",Ml="23421",Dl="1454",kr="6059",Ol="denkmaelerWMS",sn="1693";let Ne="light";const K=await sa("snowbox",{colorScheme:Ne,startCenter:[573364,6028874],layers:[{id:an,visibility:!0,type:"background",name:"Basemap.de (Farbe)"},{id:Ml,type:"background",name:"Basemap.de (Grau)",maxZoom:6},{id:sn,visibility:!0,hideInMenu:!0,type:"mask",name:"meldemichel.layers.hamburgBorder"},{id:kr,type:"mask",name:"Anliegen (MML)",visibility:!1},{id:Dl,type:"mask",name:"Ausgleichsflächen",styleId:"panda",visibility:!0,minZoom:5},{id:Ol,type:"mask",name:"Kulturdenkmale",visibility:!0,options:{layers:{order:"6,24,25,4,3,2,1,0",title:{6:"Denkmalbereich",24:"Mehrheit von baulichen Anlagen",25:"Sachgesamtheit",4:"Baudenkmal",3:"Gründenkmal",2:"Gewässer",1:"Baudenkmal (Fläche)",0:"Gründenkmal (Fläche)"},legend:!0}}}],layout:"standard",checkServiceAvailability:!0,featureStyles:Fl,markers:{layers:[{id:kr,defaultStyle:{stroke:"#FFFFFF",fill:"#005CA9"},hoverStyle:{stroke:"#46688E",fill:"#8BA1B8"},selectionStyle:{stroke:"#FFFFFF",fill:"#E10019"},unselectableStyle:{stroke:"#FFFFFF",fill:"#333333"}}],clusterClickZoom:!0},locales:[{type:"de",resources:{fullscreen:{button:{label_on:"Mach groß",label_off:"Mach klein"}},iconMenu:{hints:{attributions:"LMAO",fullscreen:"BEEEEEG YOSHEEEEE"}}}}],scale:{showScaleSwitcher:!0}},nn);document.getElementById("secondMap").addEventListener("click",async()=>{const n=ia({startCenter:[573364,6028874],layers:[{id:an,visibility:!0,type:"background",name:"snowbox.layers.basemap"}]},nn);n.classList.add("snowbox"),document.getElementById("secondMapContainer").appendChild(n),pe(n,Ar({layoutTag:"TOP_RIGHT"}))});document.getElementById("secondMapClean").addEventListener("click",()=>{document.getElementById("secondMapContainer").innerText=""});pe(K,Fr({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"}));setTimeout(()=>{oa(K,"toast")},3e3);setTimeout(()=>{pe(K,Fr({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"})),Jt(K,"toast").addToast({text:"Sechs Sekunden",severity:"info"})},6e3);pe(K,il({loaderStyle:"BasicLoader"}));pe(K,Cs({searchMethods:[{queryParameters:{searchStreets:!0,searchHouseNumbers:!0},type:"mpapi",url:"https://geodienste.hamburg.de/HH_WFS_GAGES?service=WFS&request=GetFeature&version=2.0.0"}],minLength:3,waitMs:300,focusAfterSearch:!0,groupProperties:{defaultGroup:{limitResults:5}}}));pe(K,Cl({coordinateSources:[{plugin:"addressSearch",key:"chosenAddress"}],boundary:{layerId:sn},movable:"drag",style:{fill:"#FF0019"},toZoomLevel:7}));pe(K,Sl({url:"https://geodienste.hamburg.de/HH_WPS",coordinateSources:[{plugin:"pins",key:"coordinate"}],addressTarget:{plugin:"addressSearch",key:"selectResult"},zoomTo:7}));pe(K,da({displayComponent:!0,layoutTag:"TOP_RIGHT",initiallyOpen:"layerChooser",focusMenus:[{plugin:{component:Rl,id:"attributions",locales:[]},icon:"kern-icon--near-me"}],menus:[[{plugin:ei({checkLocationInitially:!1,keepCentered:!1,showTooltip:!0,zoomLevel:7})}],[{plugin:{component:Tl,id:"realKewl",locales:[]},icon:"kern-icon-fill--share"}],[{plugin:To({})},{plugin:Ar({})}]]}));pe(K,Ps({leftEntries:[{id:"mockPointer",component:Al}],rightEntries:[ca({}),{id:"mockAttributions",component:Ll}]}));const on=Jt(K,"toast");on.addToast({text:"Hallo Welt",severity:"info"});on.addToast({text:"Achtung! Dies ist ein Toast!",severity:"error"});const ln=Jt(K,"loadingIndicator");ln.addLoadingKey("loadingTest");setTimeout(()=>ln.removeLoadingKey("loadingTest"),2e3);la(K,"core","selectedCoordinates",n=>document.getElementById("selected-feature-coordinates").innerText=JSON.stringify(n));document.getElementById("language-switcher").addEventListener("change",n=>{const e=n.target,{value:t}=e;Ir(K,"core","language",t),e[0].innerHTML=t==="en"?"English":"Englisch",e[1].innerHTML=t==="en"?"German":"Deutsch"});document.getElementById("color-scheme-switcher").addEventListener("click",({target:n})=>{n.innerHTML=`Switch to ${Ne} mode`,Ne=Ne==="light"?"dark":"light",Ir(K,"core","colorScheme",Ne)});
