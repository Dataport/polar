const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./invisibleStyle-disvIazK-BJCxgIMi.js","./pinia-DFMOV6lD-BZLsqLPB.js","./vue.runtime.esm-bundler-CYHrvVzW-BTeeWO83.js","./index-D77Jrxw7-DFnJizui.js","./Style-CC5j0Z4t-BLHRPo7B.js","./asserts-segPWjJo-pcJD3tIw.js","./xml2js-DjsFtvPy-CazYFt_-.js","./doesFeaturePassFilter-nD_k0aUS-C1YLimjK.js","./Feature-CUNTJeri-jt2nLCGJ.js","./reverseGeocode-DMu2C9hG-OuZRICI0.js","./indicateLoading-CZl7lU8I-D1yCdDMR.js"])))=>i.map(i=>d[i]);
import{a2 as D,a3 as pe,a4 as me,a5 as Wn,a6 as Le,a7 as jn,a8 as Me,a9 as zn,aa as R,ab as y,ac as ft,ad as E,ae as tn,af as B,ag as _e,ah as Ft,ai as J,aj as te,ak as O,al as St,am as Yn,an as Kn,ao as qn,ap as Jn,aq as nn,ar as tt,as as Lt,at as xe,au as ve,av as Pt,aw as Ce,ax as rn,ay as Zn,az as Z,aA as Xn,aB as De,aC as an,aD as At,aE as Mt,aF as Qn,aG as er,aH as tr,aI as nr,G as lt,K as dt,L as ct,N as Qe,aJ as rr,aK as ar,aL as ge,aM as ir,S as Dt,I as or,aN as on,W as sn,V as ln,T as sr,U as lr}from"./runtime-core.esm-bundler-K07Yzxcu.js";import{defineComponent as P,createElementBlock as k,openBlock as p,createElementVNode as C,renderSlot as Rt,watch as Se,ref as F,computed as L,createBlock as M,withCtx as ie,createCommentVNode as z,unref as f,toDisplayString as W,useModel as le,withDirectives as Te,vModelSelect as dr,Fragment as G,renderList as H,resolveDynamicComponent as Oe,useTemplateRef as dn,mergeProps as Tt,nextTick as cn,mergeModels as ye,useId as ut,vModelCheckbox as un,withKeys as nt,withModifiers as Re,vModelRadio as cr,normalizeClass as $e,createVNode as fe,createTextVNode as ur,vModelText as hr,markRaw as Nt,isRef as Ut,onMounted as gr,vModelDynamic as pr}from"./vue.runtime.esm-bundler-CYHrvVzW-BTeeWO83.js";import{defineStore as ue,storeToRefs as de}from"./pinia-DFMOV6lD-BZLsqLPB.js";import{W as K,b0 as ae,b as oe,o as rt,bj as hn,aM as fr,a7 as se,aA as Pe,ce as mr,cc as yr,bm as _r,aw as ht,cf as vr,bn as br,bg as U,cg as at,ax as q,ch as be,ci as Ht,p as Wt,am as mt,cj as ee,ck as gn,bf as it,Y as kr,H as xr,$ as Cr,N as Vt,ay as wr,aj as Sr,t as Lr,n as Tr,g as $r,cl as Ir,cm as Er,cn as Fr,co as Pr,al as Ar}from"./index-D77Jrxw7-DFnJizui.js";import{y as Mr,n as Dr}from"./invisibleStyle-disvIazK-BJCxgIMi.js";import{doesFeaturePassFilter as Rr}from"./doesFeaturePassFilter-nD_k0aUS-C1YLimjK.js";import{i as j}from"./Feature-CUNTJeri-jt2nLCGJ.js";import{V as Vr,E as Ge,D as Be,x as X,g as Or,B as Br,L as $t,A as Gr,K as jt}from"./asserts-segPWjJo-pcJD3tIw.js";import{k as pn,D as Nr,C as ot,I as Ur,i as Hr,X as Wr,am as Ot,x as jr,v as fn,y as zr}from"./Style-CC5j0Z4t-BLHRPo7B.js";import"./xml2js-DjsFtvPy-CazYFt_-.js";import{indicateLoading as Yr}from"./indicateLoading-CZl7lU8I-D1yCdDMR.js";import{reverseGeocode as Kr}from"./reverseGeocode-DMu2C9hG-OuZRICI0.js";const qr={class:"kern-card kern-card--small",tabindex:"-1"},Jr={class:"kern-card__container"},Zr=P({__name:"PolarCard.ce",setup(r){return(e,t)=>(p(),k("article",qr,[C("div",Jr,[Rt(e.$slots,"default",{},void 0,!0)])]))}}),Xr=".kern-card{&[data-v-0249006d]{height:inherit;min-width:25rem;border-radius:var(--kern-metric-border-radius-large);box-shadow:var(--polar-shadow)}.kern-card__container[data-v-0249006d]{padding:var(--kern-metric-space-small);padding-bottom:.625rem}}",gt=D(Zr,[["styles",[Xr]],["__scopeId","data-v-0249006d"]]);function Qr(r){let e=r.getSource();if(!e)throw new Error("Could not find a vector source for this layer");for(;e instanceof Wn;)if(e=e.getSource(),!e)throw new Error("Could not find a vector source for this layer");if(!(e instanceof me))throw new Error("Could not find a vector source for this layer");return e}const ne="filter",mn=ue("plugins/filter/main",()=>{const r=K(),e=L(()=>r.configuration[ne]??{layers:{}}),t=F({}),n=L(()=>Object.entries(e.value.layers).map(([c,u])=>({layerId:c,layerConfiguration:r.getLayerMapConfiguration(c),filterConfiguration:u}))),a=F(null);Se(()=>e.value.layers,c=>{Object.keys(c).forEach(u=>{t.value[u]??={}}),a.value=Object.keys(c)[0]||""},{immediate:!0,deep:!0});const i=L(()=>n.value.find(c=>c.layerId===a.value)??null),o=L(()=>a.value?e.value.layers[a.value]:{}),s=L(()=>a.value?t.value[a.value]:null),l=L(()=>o.value.time?.last||o.value.time?.next||o.value.time?.freeSelection),d=L(()=>r.map.getAllLayers().filter(c=>Object.keys(e.value.layers).includes(c.get("id"))));return{configuration:e,state:t,layers:n,selectedLayerId:a,selectedLayer:i,selectedLayerConfiguration:o,selectedLayerState:s,selectedLayerHasTimeFilter:l,filteredLayers:d}}),ea=ue("plugins/filter/time",()=>{const r=new Date(-864e13),e=new Date(864e13),t=K(),n=mn(),a=L(()=>n.selectedLayerConfiguration.time||{}),i=L(()=>n.selectedLayerState?.timeSpan||null),o=L(()=>a.value.targetProperty||""),s=L(()=>a.value.pattern||"YYYY-MM-DD"),l=L(()=>i.value?.[o.value]??{from:r,until:e,pattern:s.value}),d=L({get:()=>l.value.from.getTime()===r.getTime()?null:l.value.from,set:m=>{if(!n.selectedLayerState)return;const v=n.selectedLayerState,_=v.timeSpan??={},T=_[o.value]??={from:r,until:e,pattern:s.value};T.from=m||r}}),c=L({get:()=>{if(l.value.until.getTime()===e.getTime())return null;const m=new Date(l.value.until);return m.setDate(m.getDate()-1),m},set:m=>{if(!n.selectedLayerState)return;const v=n.selectedLayerState,_=v.timeSpan??={},T=_[o.value]??={from:r,until:e,pattern:s.value};if(m===null){T.until=e;return}const $=new Date(m);$.setDate($.getDate()+1),T.until=$}});function u(m,v){const _=new Date;return _.setDate(_.getDate()+m),v.toDateString()===_.toDateString()}const g=F(!1),h=L({get:()=>{if(g.value)return"custom";if(d.value===null&&c.value===null)return"all";if(d.value&&c.value){for(const m of n.selectedLayerConfiguration.time?.last||[])if(u(0,c.value)&&u(-m,d.value))return`last-${m}`;for(const m of n.selectedLayerConfiguration.time?.next||[])if(u(0,d.value)&&u(m,c.value))return`next-${m}`}return"custom"},set:m=>{if(m==="all"||m==="custom")d.value=null,c.value=null;else if(m.startsWith("last-")){const v=Number(m.substring(5)),_=new Date,T=new Date(_.getFullYear(),_.getMonth(),_.getDate()-v),$=new Date(_.getFullYear(),_.getMonth(),_.getDate());d.value=T,c.value=$}else if(m.startsWith("next-")){const v=Number(m.substring(5)),_=new Date,T=new Date(_.getFullYear(),_.getMonth(),_.getDate()),$=new Date(_.getFullYear(),_.getMonth(),_.getDate()+v);$.setDate($.getDate()+v),d.value=T,c.value=$}g.value=m==="custom"}}),b=L(()=>({from:{min:new Date},until:{max:new Date}})[n.selectedLayerConfiguration.time?.freeSelection||""]||{}),w=L(()=>(t.language,[{value:"all",label:ae(m=>m.time.noRestriction,{ns:ne}),icon:"kern-icon--all-inclusive"},...a.value.last?.map(m=>({value:`last-${m}`,label:ae(v=>v.time.last,{ns:ne,count:m}),icon:"kern-icon--history"}))||[],...a.value.next?.map(m=>({value:`next-${m}`,label:ae(v=>v.time.next,{ns:ne,count:m}),icon:"kern-icon--timeline"}))||[],...a.value.freeSelection?[{value:"custom",label:ae(m=>m.time.chooseTimeFrame,{ns:ne}),icon:"kern-icon--calendar-month"}]:[]]));return{model:h,customModelStart:d,customModelEnd:c,timeConstraints:b,items:w}});function yn(r,e){const t=r.getFeatures().flatMap(n=>n.get("features")||[n]);r.clear(),t.forEach(n=>{(Rr(n,e)?Mr:Dr)(n)}),r.addFeatures(t)}if(import.meta.vitest){const{test:r,expect:e,vi:t}=import.meta.vitest,{isVisible:n,isInvisible:a}=await pe(async()=>{const{isVisible:o,isInvisible:s}=await import("./invisibleStyle-disvIazK-BJCxgIMi.js").then(l=>l.i);return{isVisible:o,isInvisible:s}},__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),i=await pe(()=>import("./doesFeaturePassFilter-nD_k0aUS-C1YLimjK.js"),__vite__mapDeps([7,8,5]),import.meta.url);t.spyOn(i,"doesFeaturePassFilter").mockImplementation(o=>o.get("filter")==="yes"),r("feature visibility is updated according to filter",()=>{const o=new j;o.set("filter","yes");const s=new j;s.set("filter","no");const l=new me;l.addFeatures([o,s]),yn(l,{}),e(l.getFeatures()).toHaveLength(2),e(l.getFeatures()).toContain(o),e(n(o)).toBeTruthy(),e(l.getFeatures()).toContain(s),e(a(s)).toBeTruthy()})}const Ne=ue("plugins/filter",()=>{const r=mn(),e=de(r),t=ea(),n=de(t),a=[];function i(){r.filteredLayers.forEach(s=>{const l=Qr(s),d=()=>{yn(l,r.state[s.get("id")]??{})};l.on("featuresloadend",d),a.push(()=>{l.un("featuresloadend",d)}),a.push(Se(()=>r.state[s.get("id")],()=>{d()},{deep:!0,immediate:!0}))})}function o(){a.forEach(s=>{s()})}return{layers:e.layers,selectedLayerId:e.selectedLayerId,selectedLayer:e.selectedLayer,selectedLayerConfiguration:e.selectedLayerConfiguration,selectedLayerState:e.selectedLayerState,selectedLayerHasTimeFilter:e.selectedLayerHasTimeFilter,timeModel:n.model,timeStart:n.customModelStart,timeEnd:n.customModelEnd,timeConstraints:n.timeConstraints,timeItems:n.items,setupPlugin:i,teardownPlugin:o}}),ta={class:"kern-label"},na=P({__name:"KernBlockButton.ce",props:{icon:{type:Boolean},label:{type:String}},emits:["click"],setup(r,{emit:e}){const t=r,n=e;return(a,i)=>(p(),k("button",{class:"kern-btn kern-btn--block kern-btn--tertiary",onClick:i[0]||(i[0]=o=>n("click"))},[t.icon?(p(),k("span",{key:0,class:$e({"kern-icon":!0,[t.icon]:!0}),"aria-hidden":"true"},null,2)):z("",!0),C("span",ta,W(t.label),1)]))}}),ra=".kern-btn--tertiary{&[data-v-36d236e4]{background-color:#edf1fa;justify-content:left}.kern-label[data-v-36d236e4]{text-decoration:none}}",aa=D(na,[["styles",[ra]],["__scopeId","data-v-36d236e4"]]),ia=["id"],oa=["for"],sa={class:"kern-label"},la=P({__name:"KernBlockButtonCheckbox.ce",props:ye({icon:{type:Boolean},label:{type:String}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=le(r,"modelValue"),n=ut();function a(i){const o=i.target,s=o.parentElement?.querySelector(`label[for="${o.id}"]`);s?.scrollIntoView&&s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}return(i,o)=>(p(),k(G,null,[Te(C("input",{id:f(n),"onUpdate:modelValue":o[0]||(o[0]=s=>t.value=s),type:"checkbox",onKeydown:o[1]||(o[1]=nt(Re(s=>t.value=!t.value,["prevent"]),["enter"])),onFocus:o[2]||(o[2]=s=>a(s))},null,40,ia),[[un,t.value]]),C("label",{for:f(n),class:"kern-btn kern-btn--block kern-btn--tertiary"},[e.icon?(p(),k("span",{key:0,class:$e({"kern-icon":!0,[e.icon]:!0}),"aria-hidden":"true"},null,2)):z("",!0),C("span",sa,W(e.label),1)],8,oa)],64))}}),da=".kern-btn--tertiary{&[data-v-b66c5b7b]{background-color:#edf1fa;justify-content:left}.kern-label[data-v-b66c5b7b]{text-decoration:none}}label[data-v-b66c5b7b]{border:var(--kern-metric-border-width-default) solid transparent}input[type=checkbox]{&[data-v-b66c5b7b]{position:absolute;height:0;clip-path:circle(0)}&:focus-visible+label[data-v-b66c5b7b]{padding:var(--kern-metric-space-none) var(--kern-metric-space-default);border-radius:var(--kern-metric-border-radius-default);box-shadow:0 0 0 2px var(--kern-color-action-on-default),0 0 0 4px var(--kern-color-action-focus-border-inside),0 0 0 6px var(--kern-color-action-focus-border-outside)}&:checked+label[data-v-b66c5b7b]{border-color:var(--kern-color-action-default)}}",ca=D(la,[["styles",[da]],["__scopeId","data-v-b66c5b7b"]]),ua={class:"kern-form-check"},ha=["id"],ga=["for"],pa=P({__name:"KernCheckbox.ce",props:ye({icon:{type:Boolean},label:{type:String}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=le(r,"modelValue"),n=ut();return(a,i)=>(p(),k("div",ua,[Te(C("input",{id:f(n),"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o),class:"kern-form-check__checkbox",type:"checkbox",onKeydown:i[1]||(i[1]=nt(Re(o=>t.value=!t.value,["prevent"]),["enter"]))},null,40,ha),[[un,t.value]]),C("label",{for:f(n),class:"kern-label"},W(e.label),9,ga)]))}}),fa={class:"kern-heading-small"},ma={class:"polar-filter-category-values"},ya=P({__name:"FilterCategory.ce",setup(r){const e=K(),t=Ne();function n(d){return typeof d=="string"?{key:d,values:[d]}:d}function a(d){return n(d).key}function i(d){const c=t.selectedLayerState;return c.knownValues??={},c.knownValues[d]??=Object.fromEntries(t.selectedLayerConfiguration.categories?.find(u=>u.targetProperty===d)?.knownValues.map(u=>[a(u),!0])??[])}function o(d,{values:c}){return Object.entries(t.selectedLayerState?.knownValues?.[d]??{}).filter(([u])=>c.includes(u)).every(([,u])=>u)}function s(d,{values:c},u){const g=i(d);c.forEach(h=>g[h]=u)}function l(d){const c=i(d.targetProperty),u=d.knownValues.flatMap(h=>typeof h=="string"?[h]:h.values),g=Object.values(c).filter(h=>h).length!==u.length;u.forEach(h=>c[h]=g)}return(d,c)=>(p(!0),k(G,null,H(f(t).selectedLayerConfiguration.categories,(u,g)=>(p(),k("section",{key:g,class:"polar-filter-section"},[C("h3",fa,W(d.$t(h=>h.layer[f(t).selectedLayerId].category[u.targetProperty].title,{ns:f(ne),defaultValue:u.targetProperty})),1),C("div",ma,[u.selectAll?(p(),M(aa,{key:0,icon:"kern-icon--deselect",label:d.$t(h=>h.category.deselectAll,{ns:f(ne)}),onClick:h=>l(u)},null,8,["label","onClick"])):z("",!0),(p(!0),k(G,null,H(u.knownValues,h=>(p(),M(Oe(f(e).layout==="standard"?ca:pa),{key:a(h),icon:typeof h!="string"&&h.icon,label:d.$t(b=>b.layer[f(t).selectedLayerId].category[u.targetProperty].knownValue[a(h)],{ns:f(ne),defaultValue:a(h)}),"model-value":o(u.targetProperty,n(h)),"onUpdate:modelValue":b=>s(u.targetProperty,n(h),b)},null,8,["icon","label","model-value","onUpdate:modelValue"]))),128))])]))),128))}}),_a={class:"kern-form-input"},va={class:"kern-form-input__select-wrapper"},ba=["value"],ka=P({__name:"FilterLayerChooser.ce",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(r){const e=le(r,"modelValue"),t=L({get:()=>e.value||"",set:a=>{e.value=a||null}}),n=Ne();return(a,i)=>(p(),k("div",_a,[i[1]||(i[1]=C("label",{class:"kern-label",for:"select"},"Fachdatensatz auswählen",-1)),C("div",va,[Te(C("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o),class:"kern-form-input__select"},[(p(!0),k(G,null,H(f(n).layers,o=>(p(),k("option",{key:o.layerId,value:o.layerId},W(o.layerConfiguration?.name||o.layerId),9,ba))),128))],512),[[dr,t.value]])])]))}}),xa={class:"radiogroup",role:"radiogroup"},Ca=["aria-checked","aria-labelledby","data-value","onKeydown"],wa=["id","onClick"],Sa={class:"kern-label"},La=P({__name:"KernBlockButtonRadioGroup.ce",props:ye({items:{type:Array}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=le(r,"modelValue"),n=ut(),a=dn("radios");function i(o){const s=o.target,l=s.parentElement?.querySelector(`label[id="${s.getAttribute("aria-labelledby")}"]`);l?.scrollIntoView&&l.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}return(o,s)=>(p(),k("div",xa,[(p(!0),k(G,null,H(e.items,(l,d)=>(p(),k(G,{key:l.value},[C("span",{ref_for:!0,ref_key:"radios",ref:a,role:"radio","aria-checked":t.value===l.value,"aria-labelledby":f(n)+"*"+l.value,tabindex:"0","data-value":l.value,onKeydown:[nt(Re(c=>t.value=l.value,["prevent"]),["space"]),nt(Re(c=>t.value=l.value,["prevent"]),["enter"])],onFocus:s[0]||(s[0]=c=>i(c))},null,40,Ca),C("label",{id:f(n)+"*"+l.value,class:"kern-btn kern-btn--block kern-btn--tertiary",onClick:Re(c=>(t.value=l.value,a.value?.[d].focus()),["prevent"])},[l.icon?(p(),k("span",{key:0,class:$e({"kern-icon":!0,[l.icon]:!0}),"aria-hidden":"true"},null,2)):z("",!0),C("span",Sa,W(l.label),1)],8,wa)],64))),128))]))}}),Ta=".radiogroup[data-v-69676e58]{display:contents}.kern-btn--tertiary{&[data-v-69676e58]{background-color:#edf1fa;justify-content:left}.kern-label[data-v-69676e58]{text-decoration:none}}label[data-v-69676e58]{border:var(--kern-metric-border-width-default) solid transparent}[role=radio]{&[data-v-69676e58]{position:absolute;height:0;clip-path:circle(0)}&:focus-visible+label[data-v-69676e58]{padding:var(--kern-metric-space-none) var(--kern-metric-space-default);border-radius:var(--kern-metric-border-radius-default);box-shadow:0 0 0 2px var(--kern-color-action-on-default),0 0 0 4px var(--kern-color-action-focus-border-inside),0 0 0 6px var(--kern-color-action-focus-border-outside)}&[aria-checked=true]+label[data-v-69676e58]{border-color:var(--kern-color-action-default)}}",$a=D(La,[["styles",[Ta]],["__scopeId","data-v-69676e58"]]);function yt(r){return r===null?"":[r.getFullYear(),r.getMonth()+1,r.getDate()].map(e=>e.toString().padStart(2,"0")).join("-")}function Ia(r){if(r.length===0)return null;const[e,t,n]=r.split("-");return new Date(Number(e),Number(t)-1,Number(n))}const Ea=["min","max"],zt=P({__name:"KernDatePicker.ce",props:ye({min:{type:Date},max:{type:Date}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=le(r,"modelValue"),n=L({get:()=>yt(t.value),set:a=>{t.value=Ia(a)}});return(a,i)=>Te((p(),k("input",{"onUpdate:modelValue":i[0]||(i[0]=o=>n.value=o),type:"date",class:"kern-form-input__input",min:f(yt)(e.min??null),max:f(yt)(e.max??null)},null,8,Ea)),[[hr,n.value]])}}),Fa={class:"range-picker"},Pa=P({__name:"KernDateRangePicker.ce",props:ye({min:{type:Date},max:{type:Date}},{start:{required:!0},startModifiers:{},end:{required:!0},endModifiers:{}}),emits:["update:start","update:end"],setup(r){const e=r,t=le(r,"start"),n=le(r,"end");return(a,i)=>(p(),k("div",Fa,[fe(zt,Tt({modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=o=>t.value=o)},e),null,16,["modelValue"]),i[2]||(i[2]=ur(" – ",-1)),fe(zt,Tt({modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=o=>n.value=o)},e),null,16,["modelValue"])]))}}),Aa=".range-picker[data-v-7414cb2a]{display:flex;align-items:center;justify-content:space-between;margin:.3em 0}",Ma=D(Pa,[["styles",[Aa]],["__scopeId","data-v-7414cb2a"]]),Da={class:"kern-fieldset"},Ra={class:"kern-fieldset__body"},Va=["id","value"],Oa=["for"],Ba=P({__name:"KernRadioGroup.ce",props:ye({items:{type:Array}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=r,t=le(r,"modelValue"),n=ut();return(a,i)=>(p(),k("fieldset",Da,[i[1]||(i[1]=C("legend",{class:"kern-label"},"Wo sind Sie aktuell gemeldet?",-1)),C("div",Ra,[(p(!0),k(G,null,H(e.items,o=>(p(),k("div",{key:o.value,class:"kern-form-check"},[Te(C("input",{id:f(n)+"*"+o.value,"onUpdate:modelValue":i[0]||(i[0]=s=>t.value=s),class:"kern-form-check__radio",type:"radio",value:o.value},null,8,Va),[[cr,t.value]]),C("label",{for:f(n)+"*"+o.value,class:"kern-label"},W(o.label),9,Oa)]))),128))])]))}}),Ga={class:"kern-heading-small"},Na={class:"polar-filter-category-values"},Ua=P({__name:"FilterTime.ce",setup(r){const e=K(),t=Ne(),n=dn("section");async function a(i){i==="custom"&&(await cn(),n.value?.lastElementChild?.scrollIntoView&&n.value.lastElementChild.scrollIntoView({behavior:"smooth"}))}return(i,o)=>(p(),k("section",{ref_key:"section",ref:n,class:"polar-filter-section"},[C("h3",Ga,W(i.$t(s=>s.time.header,{ns:f(ne)})),1),C("div",Na,[(p(),M(Oe(f(e).layout==="standard"?$a:Ba),{modelValue:f(t).timeModel,"onUpdate:modelValue":[o[0]||(o[0]=s=>f(t).timeModel=s),o[1]||(o[1]=s=>a(s))],items:f(t).timeItems},null,8,["modelValue","items"]))]),f(t).timeModel==="custom"?(p(),M(Ma,Tt({key:0,start:f(t).timeStart,"onUpdate:start":o[2]||(o[2]=s=>f(t).timeStart=s),end:f(t).timeEnd,"onUpdate:end":o[3]||(o[3]=s=>f(t).timeEnd=s)},f(t).timeConstraints),null,16,["start","end"])):z("",!0)],512))}}),Ha={key:1,class:"kern-heading-medium"},Wa=P({__name:"FilterUI.ce",setup(r){const e=Ne();return(t,n)=>(p(),M(gt,null,{default:ie(()=>[f(e).layers.length>1?(p(),M(ka,{key:0,modelValue:f(e).selectedLayerId,"onUpdate:modelValue":n[0]||(n[0]=a=>f(e).selectedLayerId=a)},null,8,["modelValue"])):(p(),k("h2",Ha,W(f(e).selectedLayer?.layerConfiguration?.name),1)),f(e).selectedLayerId?(p(),M(ya,{key:2})):z("",!0),f(e).selectedLayerHasTimeFilter?(p(),M(Ua,{key:3})):z("",!0)]),_:1}))}}),ja="[data-v-e48f57e4] .polar-filter-section{width:100%;h3{padding-left:.15em}.polar-filter-category-values{display:flex;flex-direction:column;gap:var(--kern-metric-space-x-small)}}",za=D(Wa,[["styles",[ja]],["__scopeId","data-v-e48f57e4"]]),Ya={category:{deselectAll:"Alle an-/abwählen"},time:{header:"Zeitraum",noRestriction:"Keine Einschränkung",last_zero:"Heute",last_one:"Der letzte Tag",last_other:"Die letzten {{count}} Tage",next_zero:"Heute",next_one:"Der nächste Tag",next_other:"Die nächsten {{count}} Tage",chooseTimeFrame:"Zeitraum wählen"}},Ka={category:{deselectAll:"De-/select all"},time:{header:"Time frame",noRestriction:"No restriction",last_zero:"Today",last_one:"The last day",last_other:"The last {{count}} days",next_zero:"Today",next_one:"The next day",next_other:"The next {{count}} days",chooseTimeFrame:"Choose time frame"}},qa=[{type:"de",resources:Ya},{type:"en",resources:Ka}];function Ja(r){return{id:ne,component:za,locales:qa,icon:"kern-icon--filter-alt",storeModule:Ne,options:r}}const _n=ue("plugins/footer",()=>{const r=K(),e=F([]),t=F([]);function n(){e.value=(r.configuration.footer?.leftEntries||[]).filter(({id:i})=>{const o=r.configuration[i]?.displayComponent;return typeof o=="boolean"?o:!0}),t.value=(r.configuration.footer?.rightEntries||[]).filter(({id:i})=>{const o=r.configuration[i]?.displayComponent;return typeof o=="boolean"?o:!0}),e.value.concat(t.value).forEach(i=>{r.addPlugin(oe(i,{independent:!1}))}),e.value.map(i=>oe(i,{component:Nt(i.component)})),t.value.map(i=>oe(i,{component:Nt(i.component)}))}function a(){}return{leftEntries:e,rightEntries:t,setupPlugin:n,teardownPlugin:a}}),Za={class:"polar-plugin-footer-wrapper"},Xa=P({__name:"PolarFooter.ce",setup(r){const{leftEntries:e,rightEntries:t}=de(_n());return(n,a)=>(p(),k("div",Za,[C("ul",null,[(p(!0),k(G,null,H(f(e),(i,o)=>(p(),k("li",{key:o},[(p(),M(Oe(i.component)))]))),128))]),C("ul",null,[(p(!0),k(G,null,H(f(t),(i,o)=>(p(),k("li",{key:o},[(p(),M(Oe(i.component)))]))),128))])]))}}),Qa=".polar-plugin-footer-wrapper{&[data-v-9004f27e]{position:absolute;bottom:0;display:flex;width:100%;height:var(--kern-metric-dimension-large);padding:var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-x-small) var(--kern-metric-space-small);justify-content:space-between;align-items:center;flex-shrink:0;background:var(--kern-color-layout-background-hued);box-shadow:0 1px 1px #35395629,0 1px 2px #35395640,0 1px 6px #6e759740;border-radius:0 0 var(--kern-metric-border-radius-large) var(--kern-metric-border-radius-large)}ul{&[data-v-9004f27e]{display:flex;align-items:center;gap:var(--kern-metric-space-small);padding:0}li[data-v-9004f27e]{list-style:none}}}",ei=D(Xa,[["styles",[Qa]],["__scopeId","data-v-9004f27e"]]),ti={},ni={},ri=[{type:"de",resources:ti},{type:"en",resources:ni}],ai="footer";function ii(r){return{id:ai,component:ei,locales:ri,storeModule:_n,options:r}}const oi=100,si=100,_t={undefinedBoundaryLayer:Symbol.for("Boundary Layer undefined"),undefinedBoundarySource:Symbol.for("Boundary Source undefined"),sourceNotReady:Symbol.for("Source not ready")};async function li(r){let e=0;for(;r.getState()!=="ready"||r.getFeatures().length===0;)if(e++<oi)await new Promise(t=>{setTimeout(t,si)});else return!1;return!0}async function vn(r,e,t){if(typeof e>"u")return!0;const n=r.getLayers().getArray().find(i=>i.get("id")===e);if(!(n instanceof Le))return console.error(`@polar/polar(lib/passesBoundaryCheck:61:3)
`,`No layer configured to match boundaryLayerId "${e}".`),_t.undefinedBoundaryLayer;const a=n.getSource();return a instanceof me?await li(a)?a.getFeatures().some(i=>i.getGeometry()?.intersectsCoordinate(t)):(console.error(`@polar/polar(lib/passesBoundaryCheck:79:3)
`,`Layer with boundaryLayerId "${e}" did not load or is featureless.`),_t.sourceNotReady):(console.error(`@polar/polar(lib/passesBoundaryCheck:70:3)
`,`Layer with boundaryLayerId "${e}" missing source.`),_t.undefinedBoundarySource)}function Yt(){}const A={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},di={ERROR:"error"};let ci=class extends Ge{constructor(e){super(di.ERROR),this.code=e.code,this.message=e.message}},ui=class extends Vr{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=mr,this.watchId_=void 0,this.addChangeListener(A.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(A.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=yr(rt("EPSG:4326"),e),this.position_&&this.set(A.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(A.ACCURACY,t.accuracy),this.set(A.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(A.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(A.HEADING,t.heading===null?void 0:Hr(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(A.POSITION,n.slice()),this.set(A.SPEED,t.speed===null?void 0:t.speed);const a=_r(this.position_,t.accuracy);a.applyTransform(this.transform_),this.set(A.ACCURACY_GEOMETRY,a),this.changed()}positionError_(e){this.dispatchEvent(new ci(e))}getAccuracy(){return this.get(A.ACCURACY)}getAccuracyGeometry(){return this.get(A.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(A.ALTITUDE)}getAltitudeAccuracy(){return this.get(A.ALTITUDE_ACCURACY)}getHeading(){return this.get(A.HEADING)}getPosition(){return this.get(A.POSITION)}getProjection(){return this.get(A.PROJECTION)}getSpeed(){return this.get(A.SPEED)}getTracking(){return this.get(A.TRACKING)}getTrackingOptions(){return this.get(A.TRACKING_OPTIONS)}setProjection(e){this.set(A.PROJECTION,rt(e))}setTracking(e){this.set(A.TRACKING,e)}setTrackingOptions(e){this.set(A.TRACKING_OPTIONS,e)}};const hi=(r,e)=>()=>r.innerHTML=e.map(([t,n,a={}])=>`<${t}>${Pe.t(n,a)}</${t}>`).join(""),gi=`
	background: rgba(255, 255, 255, 0.8);
	padding: 0.2em 0.5em;
	border-radius: 4px;
	color: #16161d;
	box-shadow: 0px 0px 3px 2px rgba(0, 0, 0, 0.5);
`;function pi(r,e=gi){const t=document.createElement("div");t.style.cssText=e;const n=hi(t,r);return Pe.on("languageChanged",n),Pe.store.on("added",n),n(),{element:t,unregister:()=>{Pe.off("languageChanges",n),Pe.store.off("added",n)}}}function fi(){return navigator.permissions.query({name:"geolocation"}).then(({state:r})=>r==="denied").catch(()=>!1)}function mi(r,e){const t=e/2*Math.sqrt(3),n=document.createElement("canvas").getContext("2d").createLinearGradient(0,-t,Math.sin(r),t+Math.cos(r));return n.addColorStop(0,"#0794FAFF"),n.addColorStop(2/3,"#0794FA00"),n}function yi(r){if(typeof r.get("heading")>"u")return new ot;const e=42,t=Math.PI-r.get("heading");return new ot({image:new Wr({points:3,radius:e,rotation:t,fill:new pn({color:mi(t,e)}),displacement:[0,-30]})})}function _i(){const r=new pn({color:"#0078D4"}),e=new Nr({color:"#FFFFFF",width:2});return t=>[yi(t),new ot({image:new Ur({fill:r,stroke:e,radius:12}),fill:r,stroke:e})]}const vi=(r,e)=>r[0]!==e[0]||r[1]!==e[1],bn=ue("plugins/geoLocation",()=>{const r=K(),e=F(!1),t=F(null),n=F(null),a=F([]),i=L(()=>oe({showTooltip:!1,zoomLevel:7},r.configuration.geoLocation||{})),o=L(()=>i.value.boundary),s=L(()=>e.value?"DISABLED":t.value===null?"LOCATABLE":"LOCATED"),l=new j({type:"point",name:"geoLocationMarker"}),d=new Le({source:new me({features:[l]}),properties:{name:"geoLocationMarkerLayer"},zIndex:1/0,style:_i()});function c(){r.map.addLayer(d),i.value.checkLocationInitially?w():fi().then(x=>e.value=x),h()}function u(){r.map.removeLayer(d),v(),$(),g()}let g=Yt;function h(){if(i.value.showTooltip){const{unregister:x,element:I}=pi([["h2","markerText",{ns:"geoLocation"}]]),N=new jn({element:I,positioning:"bottom-center",offset:[0,-5]});r.map.addOverlay(N);const re=({pixel:Ee,dragging:Nn})=>{if(Nn)return;const Un=r.map.getFeaturesAtPixel(Ee,{layerFilter:Hn=>Hn.get("name")==="geoLocationMarkerLayer"}).length?r.map.getCoordinateFromPixel(Ee):void 0;N.setPosition(Un)};r.map.on("pointermove",re),g=()=>{x(),r.map.removeOverlay(N),r.map.un("pointermove",re),g=Yt}}}function b(){(s.value==="LOCATABLE"?w:v)()}function w(){if(e.value){m({message:"Geolocation API usage was denied by user or configuration."});return}t.value===null?t.value=new ui({trackingOptions:{enableHighAccuracy:!0},tracking:!0,projection:rt("EPSG:4326")}):_(),t.value.on("change:position",_),t.value.on("change:heading",({target:x})=>{l.set("heading",x.getHeading())}),t.value.on("error",m)}function m(x){Me("error",ae(I=>I.button.locationAccessDenied,{ns:"geoLocation"})),console.error(`@polar/polar(plugins/geoLocation/store:176:3)
`,x.message),e.value=!0,$()}function v(){t.value?.setTracking(!1),$(),t.value=null}async function _(){const x=hn(t.value?.getPosition(),rt("EPSG:4326"),r.configuration.epsg),I=r.configuration.extent?fr(r.configuration.extent,x):!0,N=await vn(r.map,o.value?.layerId,x),re=n.value!==N;n.value=N;const Ee=typeof N=="symbol"&&o.value?.onError==="strict";if(!I||Ee){S(Ee),v();return}vi(a.value,x)&&(T(x),re&&!N&&S(!1))}function T(x){a.value=x;const I=!!l.getGeometry();l.setGeometry(new se(x)),(i.value.keepCentered||!I)&&n.value&&(r.map.getView().setCenter(x),r.map.getView().setZoom(i.value.zoomLevel))}function $(){l.setGeometry(void 0),a.value=[]}function S(x){if(x){const N=ae(re=>re.toast.boundaryError,{ns:"geoLocation"});Me("error",N),console.error(`@polar/polar(plugins/geoLocation/store:264:4)
`,N);return}const I=ae(N=>N.toast.notInBoundary,{ns:"geoLocation"});Me("info",I,{timeout:1e4}),console.info(`@polar/polar(plugins/geoLocation/store:272:3)
`,I)}return{setupPlugin:c,teardownPlugin:u,locate:b,configuration:i,isGeolocationDenied:e,state:s,position:a,boundaryCheck:n}}),kn="geoLocation",bi=P({__name:"GeoLocation.ce",setup(r){const{layout:e}=de(K()),t=bn(),{state:n}=de(t),a=L(()=>n.value==="LOCATED"?"kern-icon-fill--near-me":n.value==="LOCATABLE"?"kern-icon--near-me":"kern-icon--near-me-disabled"),i=L(()=>t.configuration.renderType==="iconMenu"?void 0:e.value==="standard"||t.configuration.layoutTag?.includes("RIGHT")?"left":"right");return(o,s)=>(p(),M(zn,{class:$e(f(e)==="nineRegions"?"polar-plugin-geoLocation-nineRegions":""),hint:o.$t(l=>l.button.tooltip,{ns:f(kn)}),icon:a.value,"tooltip-position":i.value,disabled:f(n)==="DISABLED",onClick:f(t).locate},null,8,["class","hint","icon","tooltip-position","disabled","onClick"]))}}),ki=".polar-plugin-geoLocation-nineRegions[data-v-45fc3e3e]{margin:var(--kern-metric-space-small)}",xi=D(bi,[["styles",[ki]],["__scopeId","data-v-45fc3e3e"]]),Ci={markerText:"Aktuelle Position",button:{locationAccessDenied:"Standortzugriff nutzerseitig abgelehnt",tooltip:"Eigene Position markieren"},toast:{boundaryError:"Die Überprüfung Ihrer Position ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Sie befinden sich nicht im Kartengebiet."}},wi={markerText:"Current location",button:{locationAccessDenied:"Location access denied by user",tooltip:"Mark own location"},toast:{boundaryError:"Validating your position failed. Please try later again or contact an administrator if the issue persists.",notInBoundary:"You are not within the map's boundaries."}},Si=[{type:"de",resources:Ci},{type:"en",resources:wi}];function Li(r){return{id:kn,component:xi,locales:Si,storeModule:bn,options:r}}const V=[null,"http://www.opengis.net/wms","http://www.opengis.net/sld"];function Ue(r){return Yn(r[0].version,"1.3")>=0}const Ti=R(V,{Service:y(qi),Capability:y(Ki)}),$i=R(V,{Request:y(ao),Exception:y(Qi),Layer:y(eo),UserDefinedSymbolization:y(zi)});let Ii=class extends Kn{constructor(){super(),this.version=void 0}readFromNode(e){return this.version=e.getAttribute("version").trim(),O({version:this.version},Ti,e,[])||null}};const xn={Name:y(E),Title:y(E),Abstract:y(E),KeywordList:y($n),OnlineResource:y(Ft),ContactInformation:y(Ji),Fees:y(E),AccessConstraints:y(E)},Ei=R(V,xn),Fi=R(V,{...xn,LayerLimit:y(ft),MaxWidth:y(ft),MaxHeight:y(ft)}),Pi=R(V,{ContactPersonPrimary:y(Zi),ContactPosition:y(E),ContactAddress:y(Xi),ContactVoiceTelephone:y(E),ContactFacsimileTelephone:y(E),ContactElectronicMailAddress:y(E)}),Ai=R(V,{ContactPerson:y(E),ContactOrganization:y(E)}),Mi=R(V,{AddressType:y(E),Address:y(E),City:y(E),StateOrProvince:y(E),PostCode:y(E),Country:y(E)}),Di=R(V,{Format:tn(E)}),Cn={Name:y(E),Title:y(E),Abstract:y(E),KeywordList:y($n),BoundingBox:B(Ln),Dimension:B(to),Attribution:y(ji),AuthorityURL:B(so),Identifier:B(E),MetadataURL:B(lo),DataURL:B(ce),FeatureListURL:B(ce),Style:B(co),Layer:B(pt)},wn=R(V,{...Cn,SRS:B(E),Extent:y(no),ScaleHint:B(ro),LatLonBoundingBox:y((r,e)=>Ln(r,e,!1)),Layer:B(pt)}),Sn=R(V,{...Cn,CRS:B(E),EX_GeographicBoundingBox:y(Yi),MinScaleDenominator:y(_e),MaxScaleDenominator:y(_e),Layer:B(pt)}),Ri=R(V,{Title:y(E),OnlineResource:y(Ft),LogoURL:y(Tn)}),Vi=R(V,{westBoundLongitude:y(_e),eastBoundLongitude:y(_e),southBoundLatitude:y(_e),northBoundLatitude:y(_e)}),Oi=R(V,{GetCapabilities:y(Fe),GetMap:y(Fe),GetFeatureInfo:y(Fe),DescribeLayer:y(Fe),GetLegendGraphic:y(Fe)}),Bi=R(V,{Format:B(E),DCPType:B(io)}),Gi=R(V,{HTTP:y(oo)}),Ni=R(V,{Get:y(ce),Post:y(ce)}),Ui=R(V,{Name:y(E),Title:y(E),Abstract:y(E),LegendURL:B(Tn),StyleSheetURL:y(ce),StyleURL:y(ce)}),Hi=R(V,{Format:y(E),OnlineResource:y(Ft)}),Wi=R(V,{Keyword:tn(E)});function ji(r,e){return O({},Ri,r,e)}function zi(r,e){return{SupportSLD:!!J(r.getAttribute("SupportSLD")),UserLayer:!!J(r.getAttribute("UserLayer")),UserStyle:!!J(r.getAttribute("UserStyle")),RemoteWFS:!!J(r.getAttribute("RemoteWFS")),InlineFeatureData:!!J(r.getAttribute("InlineFeatureData")),RemoteWCS:!!J(r.getAttribute("RemoteWCS"))}}function Ln(r,e,t=!0){const n=[te(r.getAttribute("minx")),te(r.getAttribute("miny")),te(r.getAttribute("maxx")),te(r.getAttribute("maxy"))],a=[te(r.getAttribute("resx")),te(r.getAttribute("resy"))],i={extent:n,res:a};return t&&(Ue(e)?i.crs=r.getAttribute("CRS"):i.srs=r.getAttribute("SRS")),i}function Yi(r,e){const t=O({},Vi,r,e);if(!t)return;const n=t.westBoundLongitude,a=t.southBoundLatitude,i=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||a===void 0||i===void 0||o===void 0))return[n,a,i,o]}function Ki(r,e){return O({},$i,r,e)}function qi(r,e){return O({},Ue(e)?Fi:Ei,r,e)}function Ji(r,e){return O({},Pi,r,e)}function Zi(r,e){return O({},Ai,r,e)}function Xi(r,e){return O({},Mi,r,e)}function Qi(r,e){return O([],Di,r,e)}function eo(r,e){const t=O({},Ue(e)?Sn:wn,r,e);return t.Layer===void 0?Object.assign(t,pt(r,e)):t}function pt(r,e){const t=Ue(e),n=e[e.length-1],a=O({},t?Sn:wn,r,e);if(!a)return;let i=J(r.getAttribute("queryable"));i===void 0&&(i=n.queryable),a.queryable=i!==void 0?i:!1;let o=St(r.getAttribute("cascaded"));o===void 0&&(o=n.cascaded),a.cascaded=o;let s=J(r.getAttribute("opaque"));s===void 0&&(s=n.opaque),a.opaque=s!==void 0?s:!1;let l=J(r.getAttribute("noSubsets"));l===void 0&&(l=n.noSubsets),a.noSubsets=l!==void 0?l:!1;let d=te(r.getAttribute("fixedWidth"));d||(d=n.fixedWidth),a.fixedWidth=d;let c=te(r.getAttribute("fixedHeight"));c||(c=n.fixedHeight),a.fixedHeight=c;const u=["Style","AuthorityURL"];t?u.push("CRS"):u.push("SRS","Dimension"),u.forEach(function(h){if(h in n){const b=a[h]||[];a[h]=b.concat(n[h])}});const g=["BoundingBox","Attribution"];return t?g.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):g.push("LatLonBoundingBox","ScaleHint","Extent"),g.forEach(function(h){if(!(h in a)){const b=n[h];a[h]=b}}),a}function to(r,e){const t={name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol")};return Ue(e)&&Object.assign(t,{default:r.getAttribute("default"),multipleValues:J(r.getAttribute("multipleValues")),nearestValue:J(r.getAttribute("nearestValue")),current:J(r.getAttribute("current")),values:E(r)}),t}function no(r,e){return{name:r.getAttribute("name"),default:r.getAttribute("default"),nearestValue:J(r.getAttribute("nearestValue"))}}function ro(r,e){return{min:te(r.getAttribute("min")),max:te(r.getAttribute("max"))}}function ce(r,e){return O({},Hi,r,e)}function ao(r,e){return O({},Oi,r,e)}function io(r,e){return O({},Gi,r,e)}function oo(r,e){return O({},Ni,r,e)}function Fe(r,e){return O({},Bi,r,e)}function Tn(r,e){const t=ce(r,e);if(t){const n=[St(r.getAttribute("width")),St(r.getAttribute("height"))];return t.size=n,t}}function so(r,e){const t=ce(r,e);if(t)return t.name=r.getAttribute("name"),t}function lo(r,e){const t=ce(r,e);if(t)return t.type=r.getAttribute("type"),t}function co(r,e){return O({},Ui,r,e)}function $n(r,e){return O([],Wi,r,e)}function uo({legendURL:r,layers:e="",url:t,typ:n,format:a,version:i}){return r?r==="ignore"?[]:[r]:e.split(",").filter(o=>o).map(o=>`${t}?SERVICE=${n}&REQUEST=GetLegendGraphic&FORMAT=${a||"image/png"}&VERSION=${i}&LAYER=${o}`)}const Kt=(r,e)=>r.filter(t=>{let{minZoom:n,maxZoom:a}=t;return typeof n>"u"&&(n=0),typeof a>"u"&&(a=Number.MAX_SAFE_INTEGER),n<=e&&e<=a});function st(r,e){if(Array.isArray(r))return r.map(t=>st(t,e)).find(t=>t!==null)||null;if(typeof r=="object"){if(r.Name===e)return r;if(r.Layer)return st(r.Layer,e)}return null}const ho=r=>(Array.isArray(r)?r:[r]).map(e=>(Array.isArray(e.LegendURL)?e.LegendURL:typeof e.LegendURL=="object"?[e.LegendURL]:[]).map(t=>t.OnlineResource)).flat(1);function go(r,e){return st(r.Capability.Layer,e)?.Title||""}function po(r,e){const t=st(r.Capability.Layer,e)?.Style;return t&&ho(t)[0]||""}function fo(r,e){const t=e[r];if(t)try{return new Ii().read(t)}catch(n){console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:21:4)
`,`Error reading xml '${t}' for id '${r}'.`,n)}return null}function mo(r,e){return Promise.all(r.map(async t=>{const{id:n}=t,a=t.options?.layers;if(a&&(a.title===!0||a.legend===!0)){if(typeof e[n]=="string")return console.warn(`@polar/polar(plugins/layerChooser/utils/capabilities:41:6)
`,`Re-fired loadCapabilities on id '${n}' albeit the GetCapabilities have already been successfully fetched. No re-fetch will occur.`),[n,null];const i=ht.getLayerWhere({id:t.id});if(!i||!i.url||!i.version||!i.typ)return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:49:6)
`,`Missing data for service '${i}' with id '${n}'.`),[n,null];const o=`${i.url}?service=${i.typ}&version=${i.version}&request=GetCapabilities`;try{const s=await fetch(o);return[n,await s.text()]}catch(s){return console.error(`@polar/polar(plugins/layerChooser/utils/capabilities:61:6)
`,`Capabilities from ${o} could not be fetched.`,s),[n,null]}}return[n,null]})).then(t=>t.reduce((n,[a,i])=>oe(n,{[a]:i}),{}))}function yo(r,e,t){const n=ht.getLayerWhere({id:r}),a=fo(r,e);return{[r]:(t.order?.split(",")||n.layers.split(",")).map(i=>({layerName:i,displayName:t.title===!0&&a?go(a,i):t.title===!1?i:t.title?.[i]||i,layerImage:t.legend===!0&&a?po(a,i):t.legend===!1?null:t.legend?.[i]||null}))}}const _o=r=>r.reduce(([e,t],n)=>ht.getLayerWhere({id:n.id})===null?(console.error(`@polar/polar(plugins/layerChooser/utils/getBackgroundsAndMasks:15:5)
`,`Layer ${n.id} not found in service register. This is a configuration issue. The map might behave in unexpected ways.`,n),[e,t]):n.type==="background"?[[...e,n],t]:[e,[...t,n]],[[],[]]),vo=r=>r.map(({id:e,name:t})=>({id:e,name:t})).map(e=>oe(e,{rawLayer:ht.getLayerWhere({id:e.id})})).filter(({rawLayer:e})=>e!==null).reduce((e,t)=>{const n=uo(t.rawLayer)[0];return typeof n=="string"?{...e,[t.id]:{name:t.name,url:n}}:e},{}),Ie=ue("plugins/layerChooser",()=>{const r=K(),e=F({}),t=F([]),n=F([]),a=F([]),i=F([]),o=F(""),s=F([]),l=F({}),d=F(""),c=F({}),u=F(""),g=L(()=>t.value.reduce((S,{id:x})=>({...S,[x]:a.value.findIndex(({id:I})=>I===x)===-1}),{})),h=L(()=>b.value.reduce((S,{id:x})=>({...S,[x]:i.value.findIndex(({id:I})=>I===x)===-1}),{})),b=L(()=>n.value.filter(({hideInMenu:S})=>!S)),w=L(()=>b.value.reduce((S,x)=>oe(S,{[x.type]:Array.isArray(S[x.type])?S[x.type].concat(x):[x]}),{}));function m(){const[S,x]=_o(r.configuration.layers);t.value=S,n.value=x,S.length===0&&console.error(`@polar/polar(plugins/layerChooser/store:100:4)
`,'No layers of type "background" have been configured.'),o.value=S.find(({visibility:I})=>I)?.id||"",s.value=x.filter(({visibility:I})=>I).map(({id:I})=>I),T(),r.map.on("moveend",T),l.value=vo(r.configuration.layers),mo(r.configuration.layers,e.value).then(I=>{e.value=I,r.configuration.layers.forEach(N=>{const re=N.options?.layers;re&&(c.value=oe(c.value,yo(N.id,I,re)))})})}function v(){r.map.un("moveend",T)}Se(o,S=>{r.map.getLayers().getArray().forEach(x=>{t.value.find(({id:I})=>I===x.get("id"))&&x.setVisible(x.get("id")===S)})}),Se(s,S=>{_(S)});function _(S){r.map.getLayers().getArray().forEach(x=>{n.value.find(({id:I})=>I===x.get("id"))&&x.setVisible(S.includes(x.get("id")))})}function T(){const S=r.map.getView().getZoom();a.value=Kt(t.value,S),i.value=Kt(n.value,S);const x=a.value.map(({id:I})=>I);x.includes(o.value)||(o.value=x[0]||""),_(i.value.map(({id:I})=>I).filter(I=>s.value.includes(I)))}function $(S){const x=r.map.getLayers().getArray().find(I=>I.get("id")===u.value).getSource();if(!x){console.error(`@polar/polar(plugins/layerChooser/store:208:4)
`,`Action 'toggleOpenedOptionsServiceLayer' failed on ${u.value}. Layer not found in OpenLayers or source not initialized in OpenLayers.`);return}x.updateParams({...x.getParams(),LAYERS:S})}return{activeBackgroundId:o,activeMaskIds:s,backgrounds:t,capabilities:e,disabledBackgrounds:g,disabledMasks:h,layersWithLegends:l,layersWithOptions:c,masksSeparatedByType:w,shownMasks:b,openedLegendId:d,openedOptionsId:u,setupPlugin:m,teardownPlugin:v,toggleOpenedOptionsServiceLayer:$}}),Q="layerChooser",bo=["id"],ko={class:"kern-label"},In=P({__name:"LayerInformationCard.ce",props:{identifier:{type:String},idName:{type:String}},setup(r){const e=r,t=K(),n=Ie();gr(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-back-button`)?.focus()});function a(){const i=n[e.idName];n[e.idName]="",cn(()=>{t.shadowRoot?.getElementById(`polar-layer-chooser-${e.identifier}-${i}-button`)?.focus()})}return(i,o)=>(p(),M(gt,null,{default:ie(()=>[C("button",{id:`polar-layer-chooser-${r.identifier}-back-button`,class:"kern-btn kern-btn--secondary",onClick:a},[o[0]||(o[0]=C("span",{class:"kern-icon kern-icon--arrow-back","aria-hidden":"true"},null,-1)),C("span",ko,W(i.$t(s=>s.returnToLayers,{ns:f(Q)})),1)],8,bo),Rt(i.$slots,"default")]),_:3}))}}),xo={class:"kern-label",for:"polar-layer-chooser-legend-anchor"},Co=["href","aria-label"],wo=["src","alt"],So=P({__name:"LayerLegend.ce",setup(r){const e=Ie(),t=L(()=>e.layersWithLegends[e.openedLegendId]);return(n,a)=>(p(),M(In,{identifier:"legend","id-name":"openedLegendId",class:"legend-card"},{default:ie(()=>[C("label",xo,W(n.$t(i=>i.legend.to,{name:t.value.name,ns:f(Q)})),1),C("a",{id:"polar-layer-chooser-legend-anchor",href:t.value.url,"aria-label":n.$t(i=>i.legend.to,{name:t.value.name,ns:f(Q)}),target:"_blank"},[C("img",{src:t.value.url,alt:n.$t(i=>i.legend.to,{name:t.value.name,ns:f(Q)})},null,8,wo)],8,Co)]),_:1}))}}),Lo=".legend-card[data-v-e248e19b]{overflow-y:scroll}",To=D(So,[["styles",[Lo]],["__scopeId","data-v-e248e19b"]]),$o={class:"kern-form-check"},Io=["id","name","value","type","disabled"],Eo=["for"],Fo=P({__name:"PolarInput.ce",props:ye({idSuffix:{type:String},label:{type:String},type:{type:null},value:{type:String},disabled:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const e=le(r,"modelValue");return(t,n)=>(p(),k("div",$o,[Te(C("input",{id:`polar-${r.type}-${r.value}-${r.idSuffix}`,"onUpdate:modelValue":n[0]||(n[0]=a=>e.value=a),class:$e(`polar-input kern-form-check__${r.type}`),name:r.value,value:r.value,type:r.type,disabled:r.disabled},null,10,Io),[[pr,e.value]]),C("label",{class:"polar-input kern-label",for:`polar-${r.type}-${r.value}-${r.idSuffix}`},W(r.label),9,Eo)]))}}),Po=".kern-form-check__radio[disabled],.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:hover{border:var(--kern-metric-border-width-default) solid var(--kern-color-form-input-border)}}.kern-form-check__checkbox[disabled]{&[data-v-83635f17]:checked:hover:before{margin:var(--kern-metric-space-x-small)}}",It=D(Fo,[["styles",[Po]],["__scopeId","data-v-83635f17"]]),Ao={class:"kern-fieldset"},Mo={class:"kern-label"},Do={class:"kern-fieldset__body"},Ro=P({__name:"PolarInputGroup.ce",props:{legend:{type:String}},setup(r){return(e,t)=>(p(),k("fieldset",Ao,[C("legend",Mo,W(r.legend),1),C("div",Do,[Rt(e.$slots,"default",{},void 0,!0)])]))}}),Vo=".kern-fieldset[data-v-69d29a6c]{width:100%}.kern-fieldset__body[data-v-69d29a6c]{width:100%;padding:var(--kern-metric-space-small) 0;gap:var(--kern-metric-space-small);border-radius:var(--kern-metric-border-radius-default);background-color:var(--kern-color-layout-background-hued)}.kern-label[data-v-69d29a6c]{padding-left:.75rem}[data-v-69d29a6c] .kern-form-check{align-items:center;gap:var(--kern-metric-space-large);margin-left:.75rem;padding-right:0}",Et=D(Ro,[["styles",[Vo]],["__scopeId","data-v-69d29a6c"]]),Oo=["src","alt"],Bo=P({__name:"LayerOptions.ce",setup(r){const e=K(),t=Ie(),{openedOptionsId:n}=de(t),a=L(()=>t.layersWithOptions[n.value]),i=F(a.value.map(({layerName:l})=>l).reverse()),o=L({get:()=>i.value,set:l=>{i.value=l,t.toggleOpenedOptionsServiceLayer(l)}}),s=L(()=>e.configuration.layers.find(({id:l})=>l===n.value)?.name||"");return(l,d)=>(p(),M(In,{identifier:"options","id-name":"openedOptionsId"},{default:ie(()=>[fe(Et,{legend:l.$t(c=>c.layerHeader,{ns:f(Q),name:s.value})},{default:ie(()=>[(p(!0),k(G,null,H(a.value,({displayName:c,layerImage:u,layerName:g})=>(p(),k("div",{key:`polar-layer-chooser-mask-options-checkbox-${g}`,class:"polar-layer-chooser-options-checkbox-wrapper"},[u?(p(),k("img",{key:0,src:u,alt:g},null,8,Oo)):z("",!0),fe(It,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=h=>o.value=h),"id-suffix":"polar-layer-chooser-mask-options",label:c,type:"checkbox",value:g,class:$e(a.value.some(({layerImage:h})=>h!==null)?"polar-layer-chooser-options-checkbox":"")},null,8,["modelValue","label","value","class"])]))),128))]),_:1},8,["legend"])]),_:1}))}}),Go=".polar-layer-chooser-options-checkbox-wrapper[data-v-1ce80731]{display:flex;justify-content:flex-start;align-items:center;gap:var(--kern-metric-space-large)}.kern-form-check.polar-layer-chooser-options-checkbox[data-v-1ce80731]{margin-left:0}.kern-btn[data-v-1ce80731]{border:none;min-height:inherit;padding:var(--kern-metric-space-x-small)}.kern-label[data-v-1ce80731]{padding:0;padding-left:var(--kern-metric-space-small)}",No=D(Bo,[["styles",[Go]],["__scopeId","data-v-1ce80731"]]),Uo=["id","disabled"],Ho={class:"kern-label kern-sr-only"},qt=P({__name:"LegendButton.ce",props:{disabled:{type:Boolean},id:{type:String}},setup(r){return(e,t)=>(p(),k("button",{id:`polar-layer-chooser-legend-${r.id}-button`,class:"kern-btn kern-btn--tertiary",disabled:r.disabled},[t[0]||(t[0]=C("span",{class:"kern-icon kern-icon--info","aria-hidden":"true"},null,-1)),C("span",Ho,W(e.$t(n=>n.legend.open,{ns:f(Q)})),1)],8,Uo))}}),Wo=["id","disabled","onClick"],jo={class:"kern-label kern-sr-only"},zo=P({__name:"LayerSelection.ce",setup(r){const e=Ie(),{activeBackgroundId:t,activeMaskIds:n,backgrounds:a,disabledBackgrounds:i,disabledMasks:o,layersWithOptions:s,masksSeparatedByType:l,openedLegendId:d,shownMasks:c}=de(e),u=L(()=>Object.keys(e.layersWithLegends));function g(h){e.openedOptionsId=h}return(h,b)=>(p(),M(gt,{id:"polar-layer-chooser-card"},{default:ie(()=>[f(a).length?(p(),M(Et,{key:0,legend:h.$t(w=>w.backgroundTitle,{ns:f(Q)})},{default:ie(()=>[(p(!0),k(G,null,H(f(a),({name:w,id:m})=>(p(),k("div",{key:`polar-layer-chooser-background-radio-${m}`,class:"polar-layer-chooser-input-wrapper"},[fe(It,{modelValue:f(t),"onUpdate:modelValue":b[0]||(b[0]=v=>Ut(t)?t.value=v:null),"id-suffix":"polar-layer-chooser-background",label:w,type:"radio",value:m,disabled:f(i)[m]},null,8,["modelValue","label","value","disabled"]),u.value.includes(m)?(p(),M(qt,{key:0,id:m,disabled:f(i)[m],onClick:v=>d.value=m},null,8,["id","disabled","onClick"])):z("",!0)]))),128))]),_:1},8,["legend"])):z("",!0),f(c).length?(p(!0),k(G,{key:1},H(Object.entries(f(l)),([w,m])=>(p(),M(Et,{key:`polar-layer-chooser-mask-${w}`,legend:h.$t(v=>v[`${w}Title`],{ns:f(Q)})},{default:ie(()=>[(p(!0),k(G,null,H(m,({name:v,id:_})=>(p(),k("div",{key:`polar-layer-chooser-mask-${w}-checkbox-${_}`,class:"polar-layer-chooser-input-wrapper"},[fe(It,{modelValue:f(n),"onUpdate:modelValue":b[1]||(b[1]=T=>Ut(n)?n.value=T:null),"id-suffix":`polar-layer-chooser-mask-${w}`,label:v,type:"checkbox",value:_,disabled:f(o)[_]},null,8,["modelValue","id-suffix","label","value","disabled"]),Object.keys(f(s)).includes(_)?(p(),k("button",{key:0,id:`polar-layer-chooser-options-${_}-button`,class:"kern-btn kern-btn--tertiary",disabled:f(o)[_],onClick:()=>g(_)},[b[2]||(b[2]=C("span",{class:"kern-icon kern-icon-fill--settings","aria-hidden":"true"},null,-1)),C("span",jo,W(h.$t(T=>T.layerOptions,{ns:f(Q)})),1)],8,Wo)):u.value.includes(_)?(p(),M(qt,{key:1,id:_,disabled:f(o)[_],onClick:T=>d.value=_},null,8,["id","disabled","onClick"])):z("",!0)]))),128))]),_:2},1032,["legend"]))),128)):z("",!0)]),_:1}))}}),Yo="#polar-layer-chooser-card[data-v-c4509e12]{overflow-y:inherit}.polar-layer-chooser-input-wrapper[data-v-c4509e12]{display:flex;justify-content:space-between;align-items:center;gap:var(--kern-metric-space-large)}.kern-btn[data-v-c4509e12]{width:var(--kern-metric-dimension-large);min-height:var(--kern-metric-dimension-large);border:none;border-radius:50%}",Ko=D(zo,[["styles",[Yo]],["__scopeId","data-v-c4509e12"]]),qo=P({__name:"LayerChooser.ce",setup(r){const e=Ie(),t=L(()=>e.openedLegendId.length!==0),n=L(()=>e.openedOptionsId.length===0&&!t.value);return(a,i)=>n.value?(p(),M(Ko,{key:0})):t.value?(p(),M(To,{key:1})):(p(),M(No,{key:2}))}}),Jo={backgroundTitle:"Hintergrundkarten",maskTitle:"Fachdaten",layerHeader:'Auswahl sichtbarer Ebenen für Layer "{{name}}"',layerOptions:"Optionen für Kartenmaterial",legend:{title:"Legende",to:'Legendenbild zu "{{name}}"',open:`$t(legend.to, {ns: ${Q}}) öffnen`},returnToLayers:"Zurück"},Zo={backgroundTitle:"Background maps",maskTitle:"Subject data",layerHeader:'Visible layer selection for layer "{{name}}"',layerOptions:"Map data options",legend:{title:"Legend",to:'"{{name}}" legend image',open:`Open $t(legend.to, {ns: ${Q}})`},returnToLayers:"Back"},Xo=[{type:"de",resources:Jo},{type:"en",resources:Zo}];function Qo(r){return{id:Q,component:qo,icon:"kern-icon-fill--layers",locales:Xo,storeModule:Ie,options:r}}const es=["KernLoader","BasicLoader","RingLoader","RollerLoader","CircleLoader","SpinnerLoader"],En=ue("plugins/loadingIndicator",()=>{const r=F(new Set),e=F("KernLoader"),t=L(()=>r.value.size>0);function n(){const l=K().configuration.loadingIndicator?.loaderStyle;l&&s(l)}function a(){s("KernLoader")}function i(l){r.value=new Set([...r.value,l])}function o(l){const d=new Set(r.value);d.delete(l),r.value=d}function s(l){es.includes(l)?e.value=l:console.error(`@polar/polar(plugins/loadingIndicator/store:62:5)
`,`Loader style ${l} does not exist. Using previous style (${e.value}).`)}return{loaderStyle:e,showLoader:t,addLoadingKey:i,removeLoadingKey:o,setLoaderStyle:s,setupPlugin:n,teardownPlugin:a}}),ts={class:"lds-default"},ns=P({__name:"BasicLoader.ce",setup(r){return(e,t)=>(p(),k("div",ts,[(p(),k(G,null,H(12,n=>C("div",{key:n})),64))]))}}),rs=".lds-default[data-v-6079aaec]{color:var(--kern-color-action-default)}.lds-default[data-v-6079aaec],.lds-default div[data-v-6079aaec]{box-sizing:border-box}.lds-default[data-v-6079aaec]{display:inline-block;position:relative;width:80px;height:80px}.lds-default div[data-v-6079aaec]{position:absolute;width:6.4px;height:6.4px;background:currentColor;border-radius:50%;animation:lds-default-6079aaec 1.2s linear infinite}.lds-default div[data-v-6079aaec]:nth-child(1){animation-delay:0s;top:36.8px;left:66.24px}.lds-default div[data-v-6079aaec]:nth-child(2){animation-delay:-.1s;top:22.08px;left:62.29579px}.lds-default div[data-v-6079aaec]:nth-child(3){animation-delay:-.2s;top:11.30421px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(4){animation-delay:-.3s;top:7.36px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(5){animation-delay:-.4s;top:11.30421px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(6){animation-delay:-.5s;top:22.08px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(7){animation-delay:-.6s;top:36.8px;left:7.36px}.lds-default div[data-v-6079aaec]:nth-child(8){animation-delay:-.7s;top:51.52px;left:11.30421px}.lds-default div[data-v-6079aaec]:nth-child(9){animation-delay:-.8s;top:62.29579px;left:22.08px}.lds-default div[data-v-6079aaec]:nth-child(10){animation-delay:-.9s;top:66.24px;left:36.8px}.lds-default div[data-v-6079aaec]:nth-child(11){animation-delay:-1s;top:62.29579px;left:51.52px}.lds-default div[data-v-6079aaec]:nth-child(12){animation-delay:-1.1s;top:51.52px;left:62.29579px}@keyframes lds-default-6079aaec{0%,20%,80%,to{transform:scale(1)}50%{transform:scale(1.5)}}",as=D(ns,[["styles",[rs]],["__scopeId","data-v-6079aaec"]]),is={},os=".lds-circle[data-v-149ac9d5]{color:var(--kern-color-action-default)}.lds-circle[data-v-149ac9d5],.lds-circle div[data-v-149ac9d5]{box-sizing:border-box}.lds-circle[data-v-149ac9d5]{display:inline-block;transform:translateZ(1px);width:80px;height:80px}.lds-circle>div[data-v-149ac9d5]{display:inline-block;width:64px;height:64px;margin:8px;background:currentColor;border-radius:50%;animation:lds-circle-149ac9d5 2.4s cubic-bezier(0,.2,.8,1) infinite}@keyframes lds-circle-149ac9d5{0%,to{animation-timing-function:cubic-bezier(.5,0,1,.5)}0%{transform:rotateY(0)}50%{transform:rotateY(1800deg);animation-timing-function:cubic-bezier(0,.5,.5,1)}to{transform:rotateY(3600deg)}}",ss={class:"lds-circle"};function ls(r,e,t,n,a,i){return p(),k("div",ss,[...e[0]||(e[0]=[C("div",null,null,-1)])])}const ds=D(is,[["render",ls],["styles",[os]],["__scopeId","data-v-149ac9d5"]]),cs={},us=".lds-ring[data-v-712a38e8]{color:var(--kern-color-action-default)}.lds-ring[data-v-712a38e8],.lds-ring div[data-v-712a38e8]{box-sizing:border-box}.lds-ring[data-v-712a38e8]{display:inline-block;position:relative;width:80px;height:80px}.lds-ring div[data-v-712a38e8]{box-sizing:border-box;display:block;position:absolute;width:64px;height:64px;margin:8px;border:8px solid currentColor;border-radius:50%;animation:lds-ring-712a38e8 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:currentColor transparent transparent transparent}.lds-ring div[data-v-712a38e8]:nth-child(1){animation-delay:-.45s}.lds-ring div[data-v-712a38e8]:nth-child(2){animation-delay:-.3s}.lds-ring div[data-v-712a38e8]:nth-child(3){animation-delay:-.15s}@keyframes lds-ring-712a38e8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}",hs={class:"lds-ring"};function gs(r,e,t,n,a,i){return p(),k("div",hs,[(p(),k(G,null,H(4,o=>C("div",{key:o})),64))])}const ps=D(cs,[["render",gs],["styles",[us]],["__scopeId","data-v-712a38e8"]]),fs={},ms='.lds-roller[data-v-c8254b29]{color:var(--kern-color-action-default)}.lds-roller[data-v-c8254b29],.lds-roller div[data-v-c8254b29],.lds-roller div[data-v-c8254b29]:after{box-sizing:border-box}.lds-roller[data-v-c8254b29]{display:inline-block;position:relative;width:80px;height:80px}.lds-roller div[data-v-c8254b29]{animation:lds-roller-c8254b29 1.2s cubic-bezier(.5,0,.5,1) infinite;transform-origin:40px 40px}.lds-roller div[data-v-c8254b29]:after{content:" ";display:block;position:absolute;width:7.2px;height:7.2px;border-radius:50%;background:currentColor;margin:-3.6px 0 0 -3.6px}.lds-roller div[data-v-c8254b29]:nth-child(1){animation-delay:-36ms}.lds-roller div[data-v-c8254b29]:nth-child(1):after{top:62.62742px;left:62.62742px}.lds-roller div[data-v-c8254b29]:nth-child(2){animation-delay:-72ms}.lds-roller div[data-v-c8254b29]:nth-child(2):after{top:67.71281px;left:56px}.lds-roller div[data-v-c8254b29]:nth-child(3){animation-delay:-.108s}.lds-roller div[data-v-c8254b29]:nth-child(3):after{top:70.90963px;left:48.28221px}.lds-roller div[data-v-c8254b29]:nth-child(4){animation-delay:-.144s}.lds-roller div[data-v-c8254b29]:nth-child(4):after{top:72px;left:40px}.lds-roller div[data-v-c8254b29]:nth-child(5){animation-delay:-.18s}.lds-roller div[data-v-c8254b29]:nth-child(5):after{top:70.90963px;left:31.71779px}.lds-roller div[data-v-c8254b29]:nth-child(6){animation-delay:-.216s}.lds-roller div[data-v-c8254b29]:nth-child(6):after{top:67.71281px;left:24px}.lds-roller div[data-v-c8254b29]:nth-child(7){animation-delay:-.252s}.lds-roller div[data-v-c8254b29]:nth-child(7):after{top:62.62742px;left:17.37258px}.lds-roller div[data-v-c8254b29]:nth-child(8){animation-delay:-.288s}.lds-roller div[data-v-c8254b29]:nth-child(8):after{top:56px;left:12.28719px}@keyframes lds-roller-c8254b29{0%{transform:rotate(0)}to{transform:rotate(360deg)}}',ys={class:"lds-roller"};function _s(r,e,t,n,a,i){return p(),k("div",ys,[(p(),k(G,null,H(8,o=>C("div",{key:o})),64))])}const vs=D(fs,[["render",_s],["styles",[ms]],["__scopeId","data-v-c8254b29"]]),bs={},ks='.lds-spinner[data-v-1790c8de]{color:var(--kern-color-action-default)}.lds-spinner[data-v-1790c8de],.lds-spinner div[data-v-1790c8de],.lds-spinner div[data-v-1790c8de]:after{box-sizing:border-box}.lds-spinner[data-v-1790c8de]{color:currentColor;display:inline-block;position:relative;width:80px;height:80px}.lds-spinner div[data-v-1790c8de]{transform-origin:40px 40px;animation:lds-spinner-1790c8de 1.2s linear infinite}.lds-spinner div[data-v-1790c8de]:after{content:" ";display:block;position:absolute;top:3.2px;left:36.8px;width:6.4px;height:17.6px;border-radius:20%;background:currentColor}.lds-spinner div[data-v-1790c8de]:nth-child(1){transform:rotate(0);animation-delay:-1.1s}.lds-spinner div[data-v-1790c8de]:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div[data-v-1790c8de]:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div[data-v-1790c8de]:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div[data-v-1790c8de]:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div[data-v-1790c8de]:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div[data-v-1790c8de]:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div[data-v-1790c8de]:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div[data-v-1790c8de]:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div[data-v-1790c8de]:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div[data-v-1790c8de]:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div[data-v-1790c8de]:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner-1790c8de{0%{opacity:1}to{opacity:0}}',xs={class:"lds-spinner"};function Cs(r,e,t,n,a,i){return p(),k("div",xs,[(p(),k(G,null,H(12,o=>C("div",{key:o})),64))])}const ws=D(bs,[["render",Cs],["styles",[ks]],["__scopeId","data-v-1790c8de"]]),Ss={key:0,class:"polar-plugin-loading-indicator-wrapper"},Ls={key:0,class:"polar-plugin-loading-indicator-overlay"},Ts={key:0,class:"kern-loader kern-loader--visible",role:"status"},$s=P({__name:"LoadingIndicator.ce",setup(r){const{layout:e}=de(K()),{loaderStyle:t,showLoader:n}=de(En()),a={BasicLoader:as,CircleLoader:ds,RingLoader:ps,RollerLoader:vs,SpinnerLoader:ws};return(i,o)=>f(n)&&f(t)!==null?(p(),k("div",Ss,[f(e)==="standard"?(p(),k("div",Ls)):z("",!0),fe(gt,null,{default:ie(()=>[f(t)==="KernLoader"?(p(),k("div",Ts)):(p(),M(Oe(a[f(t)]),{key:1,class:"kern-loader--visible",role:"status"}))]),_:1})])):z("",!0)}}),Is=".polar-plugin-loading-indicator-wrapper{&[data-v-d34e6512]{z-index:100;position:absolute;display:flex;align-items:center;justify-content:center;width:100%;height:100%}.polar-plugin-loading-indicator-overlay[data-v-d34e6512]{position:absolute;width:100%;height:100%;opacity:var(--kern-color-action-state-opacity-overlay);background:#fff}.kern-card[data-v-d34e6512]{min-width:fit-content;height:fit-content;border-radius:50%}[data-v-d34e6512] .kern-card__container{padding:var(--kern-metric-space-small)!important}}",Es=D($s,[["styles",[Is]],["__scopeId","data-v-d34e6512"]]),Fs="loadingIndicator";function Ps(r){return{id:Fs,component:Es,storeModule:En,options:r}}class He extends Lr{constructor(e,t,n){super(),n!==void 0&&t===void 0?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new He(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,a){const i=this.flatCoordinates,o=e-i[0],s=t-i[1],l=o*o+s*s;if(l<a){if(l===0)for(let d=0;d<this.stride;++d)n[d]=i[d];else{const d=this.getRadius()/Math.sqrt(l);n[0]=i[0]+d*o,n[1]=i[1]+d*s;for(let c=2;c<this.stride;++c)n[c]=i[c]}return n.length=this.stride,l}return a}containsXY(e,t){const n=this.flatCoordinates,a=e-n[0],i=t-n[1];return a*a+i*i<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return Tr(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if($r(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]?!0:Ir(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],a=e.slice();a[t]=a[0]+n;for(let i=1;i<t;++i)a[t+i]=e[i];this.setFlatCoordinates(this.layout,a),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const a=this.flatCoordinates;let i=Er(a,0,e,this.stride);a[i++]=a[0]+t;for(let o=1,s=this.stride;o<s;++o)a[i++]=a[o];a.length=i,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),a=this.getStride();this.setCenter(Fr(n,0,n.length,a,e,t,n)),this.changed()}}He.prototype.transform;function he(r,e){const t=r.length;return e<0?r[e+t]:e>=t?r[e-t]:r[e]}function ke(r,e){const t=r.length;let n=Math.floor(e);const a=e-n;n>=t?n-=t:n<0&&(n+=t);let i=n+1;i>=t&&(i-=t);const o=r[n],s=o[0],l=o[1],d=r[i],c=d[0]-s,u=d[1]-l;return[s+c*a,l+u*a]}const We={index:-1,endIndex:NaN,closestTargetDistance:1/0};function Fn(r,e,t,n){const a=r[0],i=r[1];let o=1/0,s=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const g=e.targets[u],h=g.coordinates;let b=1/0,w;for(let m=0;m<h.length-1;++m){const v=h[m],_=h[m+1],T=Mn(a,i,v,_);T.squaredDistance<b&&(b=T.squaredDistance,w=m+T.along)}b<o&&(o=b,g.ring&&e.targetIndex===u&&(g.endIndex>g.startIndex?w<g.startIndex&&(w+=h.length):g.endIndex<g.startIndex&&w>g.startIndex&&(w-=h.length)),l=w,s=u)}const d=e.targets[s];let c=d.ring;if(e.targetIndex===s&&c){const u=ke(d.coordinates,l),g=t.getPixelFromCoordinate(u),h=t.getPixelFromCoordinate(e.startCoord);be(g,h)>n&&(c=!1)}if(c){const u=d.coordinates,g=u.length,h=d.startIndex,b=l;if(h<b){const w=Ye(u,h,b);Ye(u,h,b-g)<w&&(l-=g)}else{const w=Ye(u,h,b);Ye(u,h,b+g)<w&&(l+=g)}}return We.index=s,We.endIndex=l,We.closestTargetDistance=o,We}function Pn(r,e){const t=[];for(let n=0;n<e.length;++n){const a=e[n].getGeometry();An(r,a,t)}return t}function An(r,e,t){if(e instanceof De){je(r,e.getCoordinates(),!1,t);return}if(e instanceof At){const n=e.getCoordinates();for(let a=0,i=n.length;a<i;++a)je(r,n[a],!1,t);return}if(e instanceof Vt){const n=e.getCoordinates();for(let a=0,i=n.length;a<i;++a)je(r,n[a],!0,t);return}if(e instanceof Mt){const n=e.getCoordinates();for(let a=0,i=n.length;a<i;++a){const o=n[a];for(let s=0,l=o.length;s<l;++s)je(r,o[s],!0,t)}return}if(e instanceof nr){const n=e.getGeometries();for(let a=0;a<n.length;++a)An(r,n[a],t);return}}function je(r,e,t,n){const a=r[0],i=r[1];for(let o=0,s=e.length-1;o<s;++o){const l=e[o],d=e[o+1],c=Mn(a,i,l,d);if(c.squaredDistance===0){const u=o+c.along;n.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function ze(r,e){return fn(r[0],r[1],e[0],e[1])}function Ye(r,e,t){let n,a;e<t?(n=e,a=t):(n=t,a=e);const i=Math.ceil(n),o=Math.floor(a);if(i>o){const l=ke(r,n),d=ke(r,a);return ze(l,d)}let s=0;if(n<i){const l=ke(r,n),d=he(r,i);s+=ze(l,d)}if(o<a){const l=he(r,o),d=ke(r,a);s+=ze(l,d)}for(let l=i;l<o-1;++l){const d=he(r,l),c=he(r,l+1);s+=ze(d,c)}return s}const vt={along:0,squaredDistance:0};function Mn(r,e,t,n){const a=t[0],i=t[1],o=n[0],s=n[1],l=o-a,d=s-i;let c=0,u=a,g=i;return(l!==0||d!==0)&&(c=zr(((r-a)*l+(e-i)*d)/(l*l+d*d),0,1),u+=l*c,g+=d*c),vt.along=c,vt.squaredDistance=jr(fn(r,e,u,g),10),vt}const Ke={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class qe extends Ge{constructor(e,t){super(e),this.feature=t}}class As extends Pt{constructor(e){const t=e;t.stopDown||(t.stopDown=Br),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=Ds(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Be,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const a=this.mode_;if(a==="Circle")n=(i,o,s)=>{const l=o||new He([NaN,NaN]),d=U(i[0]),c=at(d,U(i[i.length-1]));return l.setCenterAndRadius(d,Math.sqrt(c),this.geometryLayout_),l};else{let i;a==="Point"?i=se:a==="LineString"?i=De:a==="Polygon"&&(i=Vt),n=(o,s,l)=>(s?a==="Polygon"?o[0].length?s.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):s.setCoordinates([],this.geometryLayout_):s.setCoordinates(o,this.geometryLayout_):s=new i(o,this.geometryLayout_),s)}}this.geometryFunction_=n,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Le({source:new me({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:Ms(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Zn,this.freehandCondition_,e.freehand?this.freehandCondition_=Ce:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Lt,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(rn.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Ce:t=e:t=tt,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=Ce:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:Lt}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===$t.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Z.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Z.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===Z.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===Z.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Z.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Z.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Xn(Z.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),a=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),i=q([n,a]),o=this.traceSource_.getFeaturesInExtent(i);if(o.length===0)return;const s=Pn(e.coordinate,o);s.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,a=e.startIndex<=t;n===a?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const a=Math.ceil(e);let i=Math.floor(t);i===t&&(i-=1),n=i-a+1}else{const a=Math.floor(e);let i=Math.ceil(t);i===t&&(i+=1),n=a-i+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const a=[];if(t<n){const i=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=i;s<=o;++s)a.push(he(e.coordinates,s))}else{const i=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=i;s>=o;--s)a.push(he(e.coordinates,s))}a.length&&this.appendCoordinates(a)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const s=e.map.getPixelFromCoordinate(t.startCoord);if(be(s,e.pixel)<this.snapTolerance_)return}const n=Fn(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const s=t.targets[n.index];this.addTracedCoordinates_(s,s.startIndex,n.endIndex)}else{const s=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(s,n.endIndex)}t.targetIndex=n.index;const a=t.targets[t.targetIndex];a.endIndex=n.endIndex;const i=ke(a.coordinates,a.endIndex),o=this.getMap().getPixelFromCoordinate(i);e.coordinate=i,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const a=!this.finishCoordinate_;a&&this.startDrawing_(e.coordinate),!a&&this.freehand_?this.finishDrawing():!this.freehand_&&(!a||this.mode_==="Point")&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,a=t[0]-n[0],i=t[1]-n[1],o=a*a+i*i;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let a=!1,i=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")n=!0;else if(o==="Circle")n=this.sketchCoords_.length===2;else if(o==="LineString")a=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const s=this.sketchCoords_;a=s[0].length>this.minPoints_,i=[s[0][0],s[0][s[0].length-2]],t?i=[s[0][0]]:i=[s[0][0],s[0][s[0].length-2]]}if(a){const s=this.getMap();for(let l=0,d=i.length;l<d;l++){const c=i[l],u=s.getPixelFromCoordinate(c),g=e[0]-u[0],h=e[1]-u[1],b=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(g*g+h*h)<=b,n){this.finishCoordinate_=c;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new j(new se(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new j);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new De(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=Ht(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new j(new De(this.sketchLineCoords_)));const a=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new j,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(a),this.updateSketchFeatures_(),this.dispatchEvent(new qe(Ke.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),a=t.getView().getProjection(),i=Ht(this.geometryLayout_);let o,s;for(;e.length<i;)e.push(0);this.mode_==="Point"?s=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],s=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,s=o[o.length-1]),s[0]=e[0],s[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,a),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let a,i;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),i=this.sketchCoords_,i.length>=this.maxPoints_&&(this.freehand_?i.pop():a=!0),i.push(e.slice()),this.geometryFunction_(i,t,n)):o==="Polygon"&&(i=this.sketchCoords_[0],i.length>=this.maxPoints_&&(this.freehand_?i.pop():a=!0),i.push(e.slice()),a&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),a?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),a=this.mode_;for(let i=0;i<e;++i){let o;if(a==="LineString"||a==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const s=this.finishCoordinate_.slice();o[o.length-1]=s,this.createOrUpdateSketchPoint_(s)}this.geometryFunction_(o,t,n),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(a==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const s=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}s.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,n)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const n=e.getGeometry(),a=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,n,a)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,n,a),t=n.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new an([t])):this.type_==="MultiLineString"?e.setGeometry(new At([t])):this.type_==="MultiPolygon"&&e.setGeometry(new Mt([t])),this.dispatchEvent(new qe(Ke.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new qe(Ke.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(e[0]);let a;if(t==="LineString"||t==="Circle")a=this.sketchCoords_;else if(t==="Polygon")a=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&a.shift(),a.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const i=e[e.length-1];this.sketchFeature_=this.addToDrawing_(i),this.modifyDrawing_(i)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new j(new se(n)),this.updateSketchFeatures_(),this.dispatchEvent(new qe(Ke.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function Ms(){const r=Ot();return function(e,t){return r[e.getGeometry().getType()]}}function Ds(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}const Jt=0,Ve=1,Zt=[0,0,0,0],we=[],bt={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function kt(r,e,t){let n;switch(e){case"LineString":n=r;break;case"MultiLineString":case"Polygon":n=r[t[0]];break;case"MultiPolygon":n=r[t[1]][t[0]];break}return n}class xt extends Ge{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}class Rs extends Pt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Qn,this.defaultDeleteCondition_=function(n){return er(n)&&nn(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Ce,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new tr,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Le({source:new me({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Os(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new xe(this.source_.getFeatures()),this.source_.addEventListener(Wt.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Wt.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ve.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ve.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=Ce:t=e:t=tt,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const a=this.SEGMENT_WRITERS_[t.getType()];a&&a(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener($t.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new xe;const n=this.featuresBeingModified_.getArray();for(let a=0,i=t.length;a<i;++a){const o=t[a].feature;o&&!n.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new xt(bt.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener($t.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(a){e===a.feature&&n.push(a)});for(let a=n.length-1;a>=0;--a){const i=n[a];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===i&&this.dragSegments_.splice(o,1);t.remove(i)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),a={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),a)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let a=0,i=n.length;a<i;++a){const o=n[a],s={feature:e,geometry:t,depth:[a],index:a,segment:[o,o]};this.rBush_.insert(t.getExtent(),s)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let a=0,i=n.length-1;a<i;++a){const o=n.slice(a,a+2),s={feature:e,geometry:t,index:a,segment:o};this.rBush_.insert(q(o),s)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let a=0,i=n.length;a<i;++a){const o=n[a];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[a],index:s,segment:d};this.rBush_.insert(q(d),c)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let a=0,i=n.length;a<i;++a){const o=n[a];for(let s=0,l=o.length-1;s<l;++s){const d=o.slice(s,s+2),c={feature:e,geometry:t,depth:[a],index:s,segment:d};this.rBush_.insert(q(d),c)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let a=0,i=n.length;a<i;++a){const o=n[a];for(let s=0,l=o.length;s<l;++s){const d=o[s];for(let c=0,u=d.length-1;c<u;++c){const g=d.slice(c,c+2),h={feature:e,geometry:t,depth:[s,a],index:c,segment:g};this.rBush_.insert(q(g),h)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),a={feature:e,geometry:t,index:Jt,segment:[n,n]},i={feature:e,geometry:t,index:Ve,segment:[n,n]},o=[a,i];a.featureSegments=o,i.featureSegments=o,this.rBush_.insert(mt(n),a);let s=t;this.rBush_.insert(s.getExtent(),i)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let a=0;a<n.length;++a){const i=n[a],o=this.SEGMENT_WRITERS_[i.getType()];o(e,i)}}createOrUpdateVertexFeature_(e,t,n,a){let i=this.vertexFeature_;return i?i.getGeometry().setCoordinates(e):(i=new j(new se(e)),this.vertexFeature_=i,this.overlay_.getSource().addFeature(i)),i.set("features",t),i.set("geometries",n),i.set("existing",a),i}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Z.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const t=[],n=this.vertexFeature_.getGeometry().getCoordinates(),a=q([n]),i=this.rBush_.getInExtent(a),o={};i.sort(Vs);for(let s=0,l=i.length;s<l;++s){const d=i[s],c=d.segment;let u=X(d.geometry);const g=d.depth;if(g&&(u+="-"+g.join("-")),o[u]||(o[u]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===Ve){const h=Qt(e,d);ee(h,n)&&!o[u][0]&&(this.dragSegments_.push([d,0]),o[u][0]=d);continue}if(ee(c[0],n)&&!o[u][0]){this.dragSegments_.push([d,0]),o[u][0]=d;continue}if(ee(c[1],n)&&!o[u][1]){if(o[u][0]&&o[u][0].index===0){let h=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":h=h[g[1]];case"Polygon":if(d.index!==h[g[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[u][1]=d;continue}X(c)in this.vertexSegments_&&!o[u][0]&&!o[u][1]&&t.push(d)}return t}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const i=e.map.getPixelFromCoordinate(t.startCoord);if(be(i,e.pixel)<this.pixelTolerance_)return}const n=Fn(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(n.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==n.index){if(t.targetIndex!==-1){const o=t.targets[t.targetIndex];this.removeTracedCoordinates_(o.startIndex,o.endIndex)}else for(const o of this.traceSegments_){const s=o[0],l=s.geometry,d=o[1],c=l.getCoordinates();kt(c,l.getType(),s.depth).splice(s.index+d,1),l.setCoordinates(c),d===0&&(s.index-=1)}const i=t.targets[n.index];this.addTracedCoordinates_(i,i.startIndex,n.endIndex)}else{const i=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(i,n.endIndex)}t.targetIndex=n.index;const a=t.targets[t.targetIndex];a.endIndex=n.endIndex}getTraceCandidates_(e){const t=this.getMap(),n=this.pixelTolerance_,a=t.getCoordinateFromPixel([e.pixel[0]-n,e.pixel[1]+n]),i=t.getCoordinateFromPixel([e.pixel[0]+n,e.pixel[1]-n]),o=q([a,i]);return this.traceSource_.getFeaturesInExtent(o)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const n=Pn(e.coordinate,t);n.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:n,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex,a=e.startIndex<=t;n===a?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const a=Math.ceil(e);let i=Math.floor(t);i===t&&(i-=1),n=i-a+1}else{const a=Math.floor(e);let i=Math.ceil(t);i===t&&(i+=1),n=a-i+1}if(n>0)for(const a of this.traceSegments_){const i=a[0],o=i.geometry,s=a[1];let l=a[0].index+1;s===1&&(l-=n);const d=o.getCoordinates();kt(d,o.getType(),i.depth).splice(l,n),o.setCoordinates(d),s===1&&(i.index-=n)}}addTracedCoordinates_(e,t,n){if(t===n)return;const a=[];if(t<n){const i=Math.ceil(t);let o=Math.floor(n);o===n&&(o-=1);for(let s=i;s<=o;++s)a.push(he(e.coordinates,s))}else{const i=Math.floor(t);let o=Math.ceil(n);o===n&&(o+=1);for(let s=i;s>=o;--s)a.push(he(e.coordinates,s))}if(a.length)for(const i of this.traceSegments_){const o=i[0],s=o.geometry,l=i[1],d=o.index+1;l===0&&a.reverse();const c=s.getCoordinates();kt(c,s.getType(),o.depth).splice(d,0,...a),s.setCoordinates(c),l===1&&(o.index+=a.length)}}updateGeometry_(e,t){const n=t[0],a=n.depth;let i;const o=n.segment,s=n.geometry,l=t[1];for(;e.length<s.getStride();)e.push(o[l][e.length]);switch(s.getType()){case"Point":i=e,o[0]=e,o[1]=e;break;case"MultiPoint":i=s.getCoordinates(),i[n.index]=e,o[0]=e,o[1]=e;break;case"LineString":i=s.getCoordinates(),i[n.index+l]=e,o[l]=e;break;case"MultiLineString":i=s.getCoordinates(),i[a[0]][n.index+l]=e,o[l]=e;break;case"Polygon":i=s.getCoordinates(),i[a[0]][n.index+l]=e,o[l]=e;break;case"MultiPolygon":i=s.getCoordinates(),i[a[1]][a[0]][n.index+l]=e,o[l]=e;break;case"Circle":const d=s;if(o[0]=e,o[1]=e,n.index===Jt)this.changingFeature_=!0,d.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let c=be(U(d.getCenter()),U(e));d.setRadius(c),this.changingFeature_=!1}break}i&&this.setGeometryCoordinates_(s,i)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],a=[],i=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(i){this.traceSegments_=[];for(const o of this.dragSegments_){const s=o[0];be(gn(i,s.segment),i)/e.map.getView().getResolution()<1&&this.traceSegments_.push(o)}}for(let o=0,s=this.dragSegments_.length;o<s;++o){const l=this.dragSegments_[o],d=l[0],c=d.feature;n.includes(c)||n.push(c);const u=d.geometry;a.includes(u)||a.push(u),this.updateGeometry_(t,l)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,n,a,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,n=this.findInsertVerticesAndUpdateDragSegments_(t);if(n?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,n),this.vertexFeature_)){const a=this.vertexFeature_.getGeometry().getCoordinates();for(let i=n.length-1;i>=0;--i)this.insertVertex_(n[i],a);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],a=n.geometry;if(a.getType()==="Circle"){const i=a,o=i.getCenter(),s=n.featureSegments[0],l=n.featureSegments[1];s.segment[0]=o,s.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update(mt(o),s);let d=i;this.rBush_.update(d.getExtent(),l)}else this.rBush_.update(q(n.segment),n)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new xt(bt.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),n=t.getPixelFromCoordinate(e);t.getView().getProjection();const a=function(s,l){return Xt(e,s)-Xt(e,l)};let i,o;if(this.hitDetection_){const s=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(n,(l,d,c)=>{c&&c.getType()==="Point"&&(c=new se(it(c.getCoordinates())));const u=c||l.getGeometry();if(u&&u.getType()==="Point"&&l instanceof j&&this.features_.getArray().includes(l)){o=u;const g=l.getGeometry().getFlatCoordinates().slice(0,2);i=[{feature:l,geometry:o,segment:[g,g]}]}return!0},{layerFilter:s})}if(!i){const s=kr(mt(e,Zt)),l=t.getView().getResolution()*this.pixelTolerance_,d=xr(Cr(s,l,Zt));i=this.rBush_.getInExtent(d)}if(i&&i.length>0){const s=i.sort(a)[0],l=s.segment;let d=Qt(e,s);const c=t.getPixelFromCoordinate(d);let u=be(n,c);if(o||u<=this.pixelTolerance_){const g={};if(g[X(l)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),s.geometry.getType()==="Circle"&&s.index===Ve)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);else{const h=t.getPixelFromCoordinate(l[0]),b=t.getPixelFromCoordinate(l[1]),w=at(c,h),m=at(c,b);if(u=Math.sqrt(Math.min(w,m)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=w>m?l[1]:l[0]),this.createOrUpdateVertexFeature_(d,[s.feature],[s.geometry],this.snappedToVertex_);const v={};v[X(s.geometry)]=!0;for(let _=1,T=i.length;_<T;++_){const $=i[_].segment;if(ee(l[0],$[0])&&ee(l[1],$[1])||ee(l[0],$[1])&&ee(l[1],$[0])){const S=X(i[_].geometry);S in v||(v[S]=!0,g[X($)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,a=e.feature,i=e.geometry,o=e.depth,s=e.index;let l;for(;t.length<i.getStride();)t.push(0);switch(i.getType()){case"MultiLineString":l=i.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"Polygon":l=i.getCoordinates(),l[o[0]].splice(s+1,0,t);break;case"MultiPolygon":l=i.getCoordinates(),l[o[1]][o[0]].splice(s+1,0,t);break;case"LineString":l=i.getCoordinates(),l.splice(s+1,0,t);break;default:return!1}this.setGeometryCoordinates_(i,l);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(i,s,o,1);const c={segment:[n[0],t],feature:a,geometry:i,depth:o,index:s};d.insert(q(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,n[1]],feature:a,geometry:i,depth:o,index:s+1};return d.insert(q(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?it(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(q([e])).some(({segment:t})=>ee(t[0],e)||ee(t[1],e))}removePoint(e){if(e&&(e=U(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Z.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([a])=>a));const n=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new xt(bt.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,n}return!1}removeVertex_(){const e=this.dragSegments_,t={};let n=!1,a,i,o,s,l,d,c,u,g,h,b;for(l=e.length-1;l>=0;--l)o=e[l],h=o[0],b=X(h.feature),h.depth&&(b+="-"+h.depth.join("-")),b in t||(t[b]={}),o[1]===0?(t[b].right=h,t[b].index=h.index):o[1]==1&&(t[b].left=h,t[b].index=h.index+1);for(b in t){switch(g=t[b].right,c=t[b].left,d=t[b].index,u=d-1,c!==void 0?h=c:h=g,u<0&&(u=0),s=h.geometry,i=s.getCoordinates(),a=i,n=!1,s.getType()){case"MultiLineString":i[h.depth[0]].length>2&&(i[h.depth[0]].splice(d,1),n=!0);break;case"LineString":i.length>2&&(i.splice(d,1),n=!0);break;case"MultiPolygon":a=a[h.depth[1]];case"Polygon":a=a[h.depth[0]],a.length>4&&(d==a.length-1&&(d=0),a.splice(d,1),n=!0,d===0&&(a.pop(),a.push(a[0]),u=a.length-1));break}if(n){this.setGeometryCoordinates_(s,i);const w=[];if(c!==void 0&&(this.rBush_.remove(c),w.push(c.segment[0])),g!==void 0&&(this.rBush_.remove(g),w.push(g.segment[1])),c!==void 0&&g!==void 0){const m={depth:h.depth,feature:h.feature,geometry:h.geometry,index:u,segment:w};this.rBush_.insert(q(m.segment),m)}this.updateSegmentIndices_(s,d,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(t=>t.getType()==="Circle"||t.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(q([e])).some(({segment:t})=>!(ee(t[0],e)||ee(t[1],e)))}insertPoint(e){const t=e?U(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,a)=>n||this.insertVertex_(a,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,a){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(n===void 0||i.depth===void 0||Gr(i.depth,n))&&i.index>t&&(i.index+=a)})}}function Vs(r,e){return r.index-e.index}function Xt(r,e,t){const n=e.geometry;if(n.getType()==="Circle"){let i=n;if(e.index===Ve){const o=at(i.getCenter(),U(r)),s=Math.sqrt(o)-i.getRadius();return s*s}}const a=U(r);return we[0]=U(e.segment[0]),we[1]=U(e.segment[1]),Pr(a,we)}function Qt(r,e,t){const n=e.geometry;if(n.getType()==="Circle"&&e.index===Ve)return it(n.getClosestPoint(U(r)));const a=U(r);return we[0]=U(e.segment[0]),we[1]=U(e.segment[1]),it(gn(a,we))}function Os(){const r=Ot();return function(e,t){return r.Point}}const Je={SELECT:"select"};class Ze extends Ge{constructor(e,t,n,a){super(e),this.selected=t,this.deselected=n,this.mapBrowserEvent=a}}const Xe={};class Bt extends Jn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:nn,this.addCondition_=e.addCondition?e.addCondition:tt,this.removeCondition_=e.removeCondition?e.removeCondition:tt,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Lt,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Be,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Bs(),this.features_=e.features||new xe;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(a){return n.includes(a)}}else t=Be;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[X(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[X(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(ve.ADD,this.boundAddFeature_),this.features_.addEventListener(ve.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(ve.ADD,this.boundAddFeature_),this.features_.removeEventListener(ve.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const n=this.findLayerOfFeature_(t);n&&this.addFeatureLayerAssociation_(t,n)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(t){if(t instanceof Le&&t.getSource()&&t.getSource().hasFeature(e))return t})}getStyle(){return this.style_}applySelectedStyle_(e){const t=X(e);t in Xe||(Xe[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let a=t.length-1;a>=0;--a){const i=t[a];if(i!==this&&i instanceof Bt&&i.getStyle()&&i.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(i.getStyle());return}}const n=X(e);e.setStyle(Xe[n]),delete Xe[n]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[X(e)]}selectFeatureInternal_(e,t,n){if(!(e instanceof j)||!this.filter_(e,t))return;const a=this.getFeatures();return a.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),a.push(e),n?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const n=this.selectFeatureInternal_(e,t);return n&&this.dispatchEvent(new Ze(Je.SELECT,[n],[],void 0)),!!n}removeFeatureInternal_(e,t){const n=this.getFeatures();if(!(!(e instanceof j)||!n.getArray().includes(e)))return n.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new Ze(Je.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Or(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new Ze(Je.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),n=this.removeCondition_(e),a=this.toggleCondition_(e),i=!t&&!n&&!a,o=e.map,s=this.getFeatures(),l=[],d=[];if(i){let c=!1;o.forEachFeatureAtPixel(e.pixel,(u,g)=>{if(c=!0,!!this.selectFeatureInternal_(u,g,d))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let u=s.getLength()-1;u>=0;--u){const g=s.item(u);(d.length>0&&!d.includes(g)||!c)&&this.removeFeatureInternal_(g,l)}}else o.forEachFeatureAtPixel(e.pixel,(c,u)=>{let g;if((n||a)&&(g=this.removeFeatureInternal_(c,l)),(t||a)&&!g&&(g=this.selectFeatureInternal_(c,u,d)),!!g)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(d.length>0||l.length>0)&&this.dispatchEvent(new Ze(Je.SELECT,d,l,e)),!0}}function Bs(){const r=Ot();return jt(r.Polygon,r.LineString),jt(r.GeometryCollection,r.LineString),function(e){return e.getGeometry()?r[e.getGeometry().getType()]:null}}const Ct={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class wt extends Ge{constructor(e,t,n,a,i){super(e),this.features=t,this.coordinate=n,this.startCoordinate=a,this.mapBrowserEvent=i}}class Gs extends Pt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const n=e.layers;t=function(a){return n.includes(a)}}else t=Be;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Be,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Ce,this.lastFeature_=null,this.addChangeListener(rn.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new xe([this.lastFeature_]);return this.dispatchEvent(new wt(Ct.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new xe([this.lastFeature_]);return this.dispatchEvent(new wt(Ct.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const n=U(t),a=U(this.lastCoordinate_),i=n[0]-a[0],o=n[1]-a[1],s=this.features_||new xe([this.lastFeature_]);s.forEach(function(l){const d=l.getGeometry();d.translate(i,o),l.setGeometry(d)}),this.lastCoordinate_=t,this.dispatchEvent(new wt(Ct.TRANSLATING,s,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(n,a)=>{if(!(!(n instanceof j)||!this.filter_(n,a))&&!(this.features_&&!this.features_.getArray().includes(n)))return n},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const n=this.getActive();(!t||!n)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}const Ns=(r,e,t)=>{if(t){const n=new DOMParser().parseFromString(t,"image/svg+xml");return n.querySelectorAll("[fill]").forEach(a=>{a.setAttribute("fill",r)}),n.querySelectorAll("[stroke]").forEach(a=>{a.setAttribute("stroke",e)}),n.querySelectorAll("path, circle, rect, polygon, ellipse").forEach(a=>{a.hasAttribute("fill")||a.setAttribute("fill",r),a.hasAttribute("stroke")||a.setAttribute("stroke",e)}),new XMLSerializer().serializeToString(n)}return`
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="-1 -1 25 25"
  >
    <path
      d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"
      fill="${r}"
      stroke="${e}"
      stroke-width="1"
    />
  </svg>
`},Us=({fill:r="#005CA9",stroke:e="#FFF",svg:t})=>{let n="";typeof r=="string"?n=r:"oklch"in r?n=`oklch(${r.oklch.l} ${r.oklch.c} ${r.oklch.h})`:"rgba"in r&&(n=`${r.rgba.r} ${r.rgba.g} ${r.rgba.b} ${r.rgba.a?r.rgba.a:""}`);let a="";return typeof e=="string"?a=e:"oklch"in e?a=`oklch(${e.oklch.l} ${e.oklch.c} ${e.oklch.h})`:"rgba"in e&&(a=`${e.rgba.r} ${e.rgba.g} ${e.rgba.b} ${e.rgba.a?e.rgba.a:""}`),new ot({image:new br({src:`data:image/svg+xml;base64,${btoa(Ns(n,a,t))}`,scale:2,anchor:[.5,1]})})},Hs={Circle:He,LinearRing:wr,LineString:De,MultiLineString:At,MultiPoint:an,MultiPolygon:Mt,Point:se,Polygon:Vt};function Ws(r,e,t,n){const a=new Hs[t](n);let i=Sr(a.getExtent());return(t==="Polygon"||t==="MultiPolygon")&&!a.intersectsCoordinate(i)&&(i=(a.getType()==="Polygon"?a.getInteriorPoint():a.getInteriorPoints()).getFirstCoordinate()),r===e?i:hn(i,r,e)}async function en(r,e,t){if(!t)return!0;const n=await vn(e,t.layerId,r);return n===!0||typeof n=="symbol"&&t.onError!=="strict"?!0:(typeof n=="symbol"?(Me("error",()=>ae(a=>a.boundaryError,{ns:"pins"})),console.error(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:39:3)
`,"Checking boundary layer failed.")):(Me("info",()=>ae(a=>a.notInBoundary,{ns:"pins"})),console.info(`@polar/polar(plugins/pins/utils/isCoordinateInBoundaryLayer:43:3)
`,"Pin position outside of boundary layer:",r)),!1)}const js=ue("plugins/pins",()=>{const r=K(),e=F(null),t=F(!1),n=L(()=>oe({minZoomLevel:0,movable:"none",toZoomLevel:0},r.configuration.pins||{})),a=L(()=>{if(!e.value)return null;const v=vr(e.value,r.configuration.epsg);return[v[1],v[0]]}),i=new Le({source:new me,style:Us(n.value.style||{})}),o=new Bt({layers:v=>v===i,style:null,condition:qn}),s=new Gs({condition:()=>r.map.getView().getZoom()>=n.value.minZoomLevel,layers:[i]});let l=null;function d(){r.map.addLayer(i),i.setZIndex(100),r.map.on("singleclick",async({coordinate:v})=>{await b(v)}),u(),g(),h()}function c(){const{map:v}=r;v.un("singleclick",async({coordinate:_})=>{await b(_)}),m(),v.removeLayer(i),v.removeInteraction(o),v.removeInteraction(s),l&&l()}function u(){const{coordinateSources:v}=n.value;v&&v.forEach(_=>{const T=r.getPluginStore(_.pluginName);T&&(l=Se(()=>T[_.getterName],$=>{$&&$.type!=="reverse_geocoded"&&w($.geometry.coordinates,!1,{epsg:$.epsg,type:$.geometry.type})}))})}function g(){const{initial:v}=n.value;if(v){const{coordinate:_,centerOn:T,epsg:$}=v;if(T){w(_,!1,{epsg:$||r.configuration.epsg,type:"Point"});return}w(_)}}function h(){o.on("select",({selected:_})=>{n.value.movable==="none"&&(document.body.style.cursor=_.length?"not-allowed":"")}),r.map.addInteraction(o);const{movable:v}=n.value;v==="drag"&&(s.on("translatestart",()=>t.value=!0),s.on("translateend",({features:_})=>{t.value=!1,_.forEach(async T=>{const $=T.getGeometry().getCoordinates(),S=await en($,r.map,n.value.boundary)?$:e.value;S&&w(S)})}),r.map.addInteraction(s))}async function b(v){const _=r.map.getInteractions().getArray().some(S=>S instanceof As&&(S._isMultiSelect||S._isDrawPlugin)||S instanceof Rs||S._isDeleteSelect),{minZoomLevel:T,movable:$}=n.value;($==="drag"||$==="click")&&r.map.getView().getZoom()>=T&&!_&&await en(v,r.map,n.value.boundary)&&w(v)}function w(v,_=!0,T){m(),e.value=v,!_&&T&&(e.value=Ws(T.epsg,r.configuration.epsg,T.type,v),r.map.getView().setCenter(e.value),r.map.getView().setZoom(n.value.toZoomLevel)),i.getSource().addFeature(new j({geometry:new se(e.value),type:"point",name:"mapMarker",zIndex:100}))}function m(){i.getSource().clear()}return{coordinate:e,latLon:a,setupPlugin:d,teardownPlugin:c}}),zs={boundaryError:"Die Überprüfung der Koordinate ist fehlgeschlagen. Bitte versuchen Sie es später erneut oder wenden Sie sich an einen Administrator, wenn das Problem bestehen bleibt.",notInBoundary:"Diese Koordinate kann nicht gewählt werden."},Ys={boundaryError:"Validating the coordinate failed. Please try again later or contact an administrator if the issue persists.",notInBoundary:"It is not possible to select this coordinate."},Ks=[{type:"de",resources:zs},{type:"en",resources:Ys}],qs="pins";function Js(r){return{id:qs,locales:Ks,storeModule:js,options:r}}const Gt="reverseGeocoder",Dn=ue("plugins/reverseGeocoder",()=>{const r=K(),e=L(()=>r.configuration[Gt]),t=F([]);function n(){for(const s of e.value.coordinateSources||[]){const l=s.plugin?r.getPluginStore(s.plugin):r;l&&t.value.push(Se(()=>l[s.key],async d=>{d&&await o(d)},{immediate:!0}))}}function a(){t.value.forEach(s=>{s()})}function i(s,l){const d=s.plugin?r.getPluginStore(s.plugin):r;d&&(d[s.key]=l)}async function o(s){const l=Yr();try{const d=await Kr(e.value.url,s);return e.value.addressTarget&&i(e.value.addressTarget,d),e.value.zoomTo&&r.map.getView().fit(new se(s),{maxZoom:e.value.zoomTo,duration:400,easing:Ar}),d}catch(d){return console.error(`@polar/polar(plugins/reverseGeocoder/store:102:5)
`,"Reverse geocoding failed:",d),null}finally{l()}}return{reverseGeocode:o,setupPlugin:n,teardownPlugin:a}});if(import.meta.vitest){const{expect:r,test:e,vi:t}=import.meta.vitest,{createPinia:n,setActivePinia:a}=await pe(async()=>{const{createPinia:c,setActivePinia:u}=await import("./pinia-DFMOV6lD-BZLsqLPB.js");return{createPinia:c,setActivePinia:u}},__vite__mapDeps([1,2]),import.meta.url),{reactive:i}=await pe(async()=>{const{reactive:c}=await import("./vue.runtime.esm-bundler-CYHrvVzW-BTeeWO83.js");return{reactive:c}},[],import.meta.url),o=await pe(()=>import("./invisibleStyle-disvIazK-BJCxgIMi.js").then(c=>c.s),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url),s=await pe(()=>import("./reverseGeocode-DMu2C9hG-OuZRICI0.js"),__vite__mapDeps([9,6]),import.meta.url),l=await pe(()=>import("./indicateLoading-CZl7lU8I-D1yCdDMR.js"),__vite__mapDeps([10,3,1,2,4,5,6]),import.meta.url),d=e.extend({reverseGeocodeUtil:[async({},c)=>{const u=t.spyOn(s,"reverseGeocode").mockResolvedValue(null);await c(u)},{auto:!0}],indicateLoading:[async({},c)=>{const u=t.spyOn(l,"indicateLoading").mockImplementation(()=>()=>{});await c(u)},{auto:!0}],coreStore:[async({},c)=>{const u=t.fn(),g=i({configuration:{[Gt]:{url:"https://wps.example",coordinateSources:[{key:"coordinateSource"}],addressTarget:{key:"addressTarget"},zoomTo:99}},map:{getView:()=>({fit:u})},coordinateSource:null,addressTarget:null});t.spyOn(o,"useCoreStore").mockReturnValue(g),await c(g)},{auto:!0}],store:[async({},c)=>{a(n());const u=Dn();u.setupPlugin(),await c(u),u.teardownPlugin()},{auto:!0}]});d("detects changes in coordinate sources",async({reverseGeocodeUtil:c,coreStore:u})=>{u.coordinateSource=[1,2],await new Promise(g=>setTimeout(g)),r(c).toHaveBeenCalledWith("https://wps.example",[1,2])}),d("passes geocoding result to address target",async({reverseGeocodeUtil:c,coreStore:u,store:g})=>{const h=Symbol("feature");c.mockResolvedValueOnce(h),await g.reverseGeocode([3,4]),r(u.addressTarget).toBe(h)}),d("zooms to input coordinate",async({reverseGeocodeUtil:c,coreStore:u,store:g})=>{const h=Symbol("feature");c.mockResolvedValueOnce(h),await g.reverseGeocode([3,4]),r(u.map.getView().fit).toHaveBeenCalledOnce()})}function Zs(r){return{id:Gt,storeModule:Dn,options:r}}const Xs={style:{background:"#fff"}},Qs=lt({__name:"EmptyComponent",setup(r){return(e,t)=>(ct(),dt("div",Xs,"HELLO THERE"))}}),el={class:"kern-btn kern-btn--tertiary",style:{"border-radius":"0.25rem","min-height":"2rem",width:"2rem"}},tl=lt({__name:"MockAttributions.ce",setup(r){return(e,t)=>(ct(),dt("button",el,[...t[0]||(t[0]=[Qe("span",{class:"kern-icon kern-icon-fill--copyright",style:{color:"var(--kern-color-action-default)"}},null,-1)])]))}}),nl={style:{display:"flex",gap:"0.5rem"}},rl=lt({__name:"MockPointerPosition.ce",setup(r){return(e,t)=>(ct(),dt("div",nl,[...t[0]||(t[0]=[Qe("span",{class:"kern-icon kern-icon--fullscreen","aria-hidden":"true"},null,-1),Qe("span",{style:{display:"flex","align-items":"center"}},"9.9555 | 53.5479",-1),Qe("button",{class:"kern-btn kern-btn--tertiary",style:{"min-height":"1rem","font-size":"1.125rem","text-decoration-line":"underline","text-underline-offset":"2px","text-underline-position":"from-font",color:"#1a3da5"}}," EPSG:4326 ",-1)])]))}}),Rn=[{id:"23420",name:"basemap.de Web Raster Farbe",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_farbe",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"23421",name:"basemap.de Web Raster Grau",url:"https://sgx.geodatenzentrum.de/wms_basemapde",typ:"WMS",layers:"de_basemapde_web_raster_grau",format:"image/png",version:"1.3.0",singleTile:!1,transparent:!0,transparency:0,urlIsVisible:!0,tilesize:512,gutter:0,minScale:"0",maxScale:"2500000",legendURL:"",cache:!1,featureCount:5},{id:"1454",name:"Ausgleichsflächen",url:"https://geodienste.hamburg.de/HH_WFS_Ausgleichsflaechen",typ:"WFS",featureType:"ausgleichsflaechen",outputFormat:"XML",version:"1.1.0",featureNS:"https://registry.gdi-de.org/id/de.hh.up",featurePrefix:"de.hh.up",legendURL:""},{id:"6059",name:"MML Anliegen",url:"https://geodienste.hamburg.de/lgv-config/anliegen_extern.json",typ:"GeoJSON",format:"XML",version:"1.0",minScale:"0",maxScale:"2500000",legendURL:"",urlIsVisible:!0},{id:"denkmaelerWMS",name:"Denkmal WMS",url:"https://efi2-deegree.schleswig-holstein.de/dish-deegree/services/wms_shp",typ:"WMS",layers:"0,1,2,3,4,6,24,25",legendURL:"ignore",format:"image/png",version:"1.3.0",transparent:!0}],al="data:application/json;base64,WwoJewoJCSJzdHlsZUlkIjogInBhbmRhIiwKCQkicnVsZXMiOiBbCgkJCXsKCQkJCSJzdHlsZSI6IHsKCQkJCQkicG9seWdvblN0cm9rZUNvbG9yIjogWzMsIDI1NSwgMSwgMV0sCgkJCQkJInBvbHlnb25GaWxsSGF0Y2giOiB7CgkJCQkJCSJiYWNrZ3JvdW5kQ29sb3IiOiBbMCwgMCwgMCwgMC4yNV0sCgkJCQkJCSJwYXR0ZXJuIjogImRpYWdvbmFsLXJpZ2h0IiwKCQkJCQkJInBhdHRlcm5Db2xvciI6IFszLCAyNTUsIDEsIDFdCgkJCQkJfQoJCQkJfQoJCQl9CgkJXQoJfQpdCg==",il={style:{background:"#fff"}},ol=lt({__name:"YetAnotherEmptyComponent",setup(r){return(e,t)=>(ct(),dt("div",il,"Awesome"))}}),Vn="23420",sl="23421",ll="1454",et="6059",dl="denkmaelerWMS",On="1693";let Ae="light";const Y=await rr("snowbox",{colorScheme:Ae,startCenter:[573364,6028874],layers:[{id:Vn,visibility:!0,type:"background",name:"Basemap.de (Farbe)"},{id:sl,type:"background",name:"Basemap.de (Grau)",maxZoom:6},{id:On,visibility:!0,hideInMenu:!0,type:"mask",name:"meldemichel.layers.hamburgBorder"},{id:et,type:"mask",name:"Anliegen (MML)",visibility:!1},{id:ll,type:"mask",name:"Ausgleichsflächen",styleId:"panda",visibility:!0,minZoom:5},{id:dl,type:"mask",name:"Kulturdenkmale",visibility:!0,options:{layers:{order:"6,24,25,4,3,2,1,0",title:{6:"Denkmalbereich",24:"Mehrheit von baulichen Anlagen",25:"Sachgesamtheit",4:"Baudenkmal",3:"Gründenkmal",2:"Gewässer",1:"Baudenkmal (Fläche)",0:"Gründenkmal (Fläche)"},legend:!0}}}],layout:"standard",checkServiceAvailability:!0,featureStyles:al,markers:{layers:[{id:et,defaultStyle:{stroke:"#FFFFFF",fill:"#005CA9"},hoverStyle:{stroke:"#46688E",fill:"#8BA1B8"},selectionStyle:{stroke:"#FFFFFF",fill:"#E10019"},unselectableStyle:{stroke:"#FFFFFF",fill:"#333333"}}],clusterClickZoom:!0},locales:[{type:"de",resources:{filter:{layer:{[et]:{category:{skat:{title:"Schadensart",knownValue:{"1xx":"Alle Wege- und Straßenschäden",100:"Wege und Straßen",101:"Schlagloch und Wegeschaden",102:"Verunreinigung und Vandalismus"}},statu:{title:"Bearbeitungsstatus",knownValue:{todo:"In Bearbeitung",done:"Abgeschlossen"}}}}}},fullscreen:{button:{label_on:"Mach groß",label_off:"Mach klein"}},iconMenu:{hints:{attributions:"LMAO",fullscreen:"BEEEEEG YOSHEEEEE"}}}}],scale:{showScaleSwitcher:!0}},Rn);document.getElementById("secondMap").addEventListener("click",async()=>{const r=ar({startCenter:[573364,6028874],layers:[{id:Vn,visibility:!0,type:"background",name:"snowbox.layers.basemap"}]},Rn);r.classList.add("snowbox"),document.getElementById("secondMapContainer").appendChild(r),ge(r,sn({layoutTag:"TOP_RIGHT"}))});document.getElementById("secondMapClean").addEventListener("click",()=>{document.getElementById("secondMapContainer").innerText=""});ge(Y,ln({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"}));setTimeout(()=>{ir(Y,"toast")},3e3);setTimeout(()=>{ge(Y,ln({displayComponent:!0,layoutTag:"BOTTOM_MIDDLE"})),Dt(Y,"toast").addToast({text:"Sechs Sekunden",severity:"info"})},6e3);ge(Y,Ps({loaderStyle:"BasicLoader"}));ge(Y,Js({boundary:{layerId:On},movable:"drag",style:{fill:"#FF0019"},toZoomLevel:7}));ge(Y,Zs({url:"https://geodienste.hamburg.de/HH_WPS",coordinateSources:[{plugin:"pins",key:"coordinate"}],addressTarget:{plugin:"addressSearch",key:"selectResult"},zoomTo:7}));ge(Y,sr({displayComponent:!0,layoutTag:"TOP_RIGHT",initiallyOpen:"layerChooser",focusMenus:[{plugin:{component:ol,id:"attributions",locales:[]},icon:"kern-icon--near-me"}],menus:[[{plugin:Li({checkLocationInitially:!1,keepCentered:!1,showTooltip:!0,zoomLevel:7})}],[{plugin:{component:Qs,id:"realKewl",locales:[]},icon:"kern-icon-fill--share"}],[{plugin:Ja({layers:{[et]:{categories:[{targetProperty:"skat",knownValues:[{key:"100",values:["100"],icon:"kern-icon--road"},{key:"101",values:["101"],icon:"kern-icon--remove-road"},{key:"102",values:["102"],icon:"kern-icon--destruction"}],selectAll:!0},{targetProperty:"skat",knownValues:[{key:"1xx",values:["100","101","102"],icon:"kern-icon--road"}],selectAll:!0},{targetProperty:"statu",knownValues:[{key:"todo",values:["In Bearbeitung"],icon:"kern-icon--assignment"},{key:"done",values:["abgeschlossen"],icon:"kern-icon--check"}]}],time:{targetProperty:"start",freeSelection:"until",last:[0,7,30],pattern:"YYYYMMDD"}}}})}],[{plugin:Qo({})},{plugin:sn({})}]]}));ge(Y,ii({leftEntries:[{id:"mockPointer",component:rl}],rightEntries:[lr({}),{id:"mockAttributions",component:tl}]}));const Bn=Dt(Y,"toast");Bn.addToast({text:"Hallo Welt",severity:"info"});Bn.addToast({text:"Achtung! Dies ist ein Toast!",severity:"error"});const Gn=Dt(Y,"loadingIndicator");Gn.addLoadingKey("loadingTest");setTimeout(()=>Gn.removeLoadingKey("loadingTest"),2e3);or(Y,"core","selectedCoordinates",r=>document.getElementById("selected-feature-coordinates").innerText=JSON.stringify(r));document.getElementById("language-switcher").addEventListener("change",r=>{const e=r.target,{value:t}=e;on(Y,"core","language",t),e[0].innerHTML=t==="en"?"English":"Englisch",e[1].innerHTML=t==="en"?"German":"Deutsch"});document.getElementById("color-scheme-switcher").addEventListener("click",({target:r})=>{r.innerHTML=`Switch to ${Ae} mode`,Ae=Ae==="light"?"dark":"light",on(Y,"core","colorScheme",Ae)});
